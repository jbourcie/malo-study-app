function rR(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function GT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hp={exports:{}},jc={},fp={exports:{}},vt={};var fw;function sR(){if(fw)return vt;fw=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function _(z){return z===null||typeof z!="object"?null:(z=y&&z[y]||z["@@iterator"],typeof z=="function"?z:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,k={};function S(z,ee,Q){this.props=z,this.context=ee,this.refs=k,this.updater=Q||x}S.prototype.isReactComponent={},S.prototype.setState=function(z,ee){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,ee,"setState")},S.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function O(){}O.prototype=S.prototype;function B(z,ee,Q){this.props=z,this.context=ee,this.refs=k,this.updater=Q||x}var V=B.prototype=new O;V.constructor=B,I(V,S.prototype),V.isPureReactComponent=!0;var $=Array.isArray,F=Object.prototype.hasOwnProperty,H={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function E(z,ee,Q){var de,Se={},fe=null,Re=null;if(ee!=null)for(de in ee.ref!==void 0&&(Re=ee.ref),ee.key!==void 0&&(fe=""+ee.key),ee)F.call(ee,de)&&!A.hasOwnProperty(de)&&(Se[de]=ee[de]);var $e=arguments.length-2;if($e===1)Se.children=Q;else if(1<$e){for(var Me=Array($e),At=0;At<$e;At++)Me[At]=arguments[At+2];Se.children=Me}if(z&&z.defaultProps)for(de in $e=z.defaultProps,$e)Se[de]===void 0&&(Se[de]=$e[de]);return{$$typeof:t,type:z,key:fe,ref:Re,props:Se,_owner:H.current}}function P(z,ee){return{$$typeof:t,type:z.type,key:ee,ref:z.ref,props:z.props,_owner:z._owner}}function L(z){return typeof z=="object"&&z!==null&&z.$$typeof===t}function C(z){var ee={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(Q){return ee[Q]})}var N=/\/+/g;function M(z,ee){return typeof z=="object"&&z!==null&&z.key!=null?C(""+z.key):ee.toString(36)}function ie(z,ee,Q,de,Se){var fe=typeof z;(fe==="undefined"||fe==="boolean")&&(z=null);var Re=!1;if(z===null)Re=!0;else switch(fe){case"string":case"number":Re=!0;break;case"object":switch(z.$$typeof){case t:case e:Re=!0}}if(Re)return Re=z,Se=Se(Re),z=de===""?"."+M(Re,0):de,$(Se)?(Q="",z!=null&&(Q=z.replace(N,"$&/")+"/"),ie(Se,ee,Q,"",function(At){return At})):Se!=null&&(L(Se)&&(Se=P(Se,Q+(!Se.key||Re&&Re.key===Se.key?"":(""+Se.key).replace(N,"$&/")+"/")+z)),ee.push(Se)),1;if(Re=0,de=de===""?".":de+":",$(z))for(var $e=0;$e<z.length;$e++){fe=z[$e];var Me=de+M(fe,$e);Re+=ie(fe,ee,Q,Me,Se)}else if(Me=_(z),typeof Me=="function")for(z=Me.call(z),$e=0;!(fe=z.next()).done;)fe=fe.value,Me=de+M(fe,$e++),Re+=ie(fe,ee,Q,Me,Se);else if(fe==="object")throw ee=String(z),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.");return Re}function te(z,ee,Q){if(z==null)return z;var de=[],Se=0;return ie(z,de,"","",function(fe){return ee.call(Q,fe,Se++)}),de}function q(z){if(z._status===-1){var ee=z._result;ee=ee(),ee.then(function(Q){(z._status===0||z._status===-1)&&(z._status=1,z._result=Q)},function(Q){(z._status===0||z._status===-1)&&(z._status=2,z._result=Q)}),z._status===-1&&(z._status=0,z._result=ee)}if(z._status===1)return z._result.default;throw z._result}var W={current:null},Y={transition:null},ne={ReactCurrentDispatcher:W,ReactCurrentBatchConfig:Y,ReactCurrentOwner:H};function se(){throw Error("act(...) is not supported in production builds of React.")}return vt.Children={map:te,forEach:function(z,ee,Q){te(z,function(){ee.apply(this,arguments)},Q)},count:function(z){var ee=0;return te(z,function(){ee++}),ee},toArray:function(z){return te(z,function(ee){return ee})||[]},only:function(z){if(!L(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},vt.Component=S,vt.Fragment=n,vt.Profiler=s,vt.PureComponent=B,vt.StrictMode=r,vt.Suspense=h,vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,vt.act=se,vt.cloneElement=function(z,ee,Q){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var de=I({},z.props),Se=z.key,fe=z.ref,Re=z._owner;if(ee!=null){if(ee.ref!==void 0&&(fe=ee.ref,Re=H.current),ee.key!==void 0&&(Se=""+ee.key),z.type&&z.type.defaultProps)var $e=z.type.defaultProps;for(Me in ee)F.call(ee,Me)&&!A.hasOwnProperty(Me)&&(de[Me]=ee[Me]===void 0&&$e!==void 0?$e[Me]:ee[Me])}var Me=arguments.length-2;if(Me===1)de.children=Q;else if(1<Me){$e=Array(Me);for(var At=0;At<Me;At++)$e[At]=arguments[At+2];de.children=$e}return{$$typeof:t,type:z.type,key:Se,ref:fe,props:de,_owner:Re}},vt.createContext=function(z){return z={$$typeof:l,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:o,_context:z},z.Consumer=z},vt.createElement=E,vt.createFactory=function(z){var ee=E.bind(null,z);return ee.type=z,ee},vt.createRef=function(){return{current:null}},vt.forwardRef=function(z){return{$$typeof:d,render:z}},vt.isValidElement=L,vt.lazy=function(z){return{$$typeof:g,_payload:{_status:-1,_result:z},_init:q}},vt.memo=function(z,ee){return{$$typeof:f,type:z,compare:ee===void 0?null:ee}},vt.startTransition=function(z){var ee=Y.transition;Y.transition={};try{z()}finally{Y.transition=ee}},vt.unstable_act=se,vt.useCallback=function(z,ee){return W.current.useCallback(z,ee)},vt.useContext=function(z){return W.current.useContext(z)},vt.useDebugValue=function(){},vt.useDeferredValue=function(z){return W.current.useDeferredValue(z)},vt.useEffect=function(z,ee){return W.current.useEffect(z,ee)},vt.useId=function(){return W.current.useId()},vt.useImperativeHandle=function(z,ee,Q){return W.current.useImperativeHandle(z,ee,Q)},vt.useInsertionEffect=function(z,ee){return W.current.useInsertionEffect(z,ee)},vt.useLayoutEffect=function(z,ee){return W.current.useLayoutEffect(z,ee)},vt.useMemo=function(z,ee){return W.current.useMemo(z,ee)},vt.useReducer=function(z,ee,Q){return W.current.useReducer(z,ee,Q)},vt.useRef=function(z){return W.current.useRef(z)},vt.useState=function(z){return W.current.useState(z)},vt.useSyncExternalStore=function(z,ee,Q){return W.current.useSyncExternalStore(z,ee,Q)},vt.useTransition=function(){return W.current.useTransition()},vt.version="18.3.1",vt}var mw;function Gg(){return mw||(mw=1,fp.exports=sR()),fp.exports}var pw;function iR(){if(pw)return jc;pw=1;var t=Gg(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(d,h,f){var g,y={},_=null,x=null;f!==void 0&&(_=""+f),h.key!==void 0&&(_=""+h.key),h.ref!==void 0&&(x=h.ref);for(g in h)r.call(h,g)&&!o.hasOwnProperty(g)&&(y[g]=h[g]);if(d&&d.defaultProps)for(g in h=d.defaultProps,h)y[g]===void 0&&(y[g]=h[g]);return{$$typeof:e,type:d,key:_,ref:x,props:y,_owner:s.current}}return jc.Fragment=n,jc.jsx=l,jc.jsxs=l,jc}var gw;function oR(){return gw||(gw=1,hp.exports=iR()),hp.exports}var c=oR(),ue=Gg();const j=GT(ue),aR=rR({__proto__:null,default:j},[ue]);var Xd={},mp={exports:{}},Lr={},pp={exports:{}},gp={};var yw;function lR(){return yw||(yw=1,(function(t){function e(Y,ne){var se=Y.length;Y.push(ne);e:for(;0<se;){var z=se-1>>>1,ee=Y[z];if(0<s(ee,ne))Y[z]=ne,Y[se]=ee,se=z;else break e}}function n(Y){return Y.length===0?null:Y[0]}function r(Y){if(Y.length===0)return null;var ne=Y[0],se=Y.pop();if(se!==ne){Y[0]=se;e:for(var z=0,ee=Y.length,Q=ee>>>1;z<Q;){var de=2*(z+1)-1,Se=Y[de],fe=de+1,Re=Y[fe];if(0>s(Se,se))fe<ee&&0>s(Re,Se)?(Y[z]=Re,Y[fe]=se,z=fe):(Y[z]=Se,Y[de]=se,z=de);else if(fe<ee&&0>s(Re,se))Y[z]=Re,Y[fe]=se,z=fe;else break e}}return ne}function s(Y,ne){var se=Y.sortIndex-ne.sortIndex;return se!==0?se:Y.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var h=[],f=[],g=1,y=null,_=3,x=!1,I=!1,k=!1,S=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(Y){for(var ne=n(f);ne!==null;){if(ne.callback===null)r(f);else if(ne.startTime<=Y)r(f),ne.sortIndex=ne.expirationTime,e(h,ne);else break;ne=n(f)}}function $(Y){if(k=!1,V(Y),!I)if(n(h)!==null)I=!0,q(F);else{var ne=n(f);ne!==null&&W($,ne.startTime-Y)}}function F(Y,ne){I=!1,k&&(k=!1,O(E),E=-1),x=!0;var se=_;try{for(V(ne),y=n(h);y!==null&&(!(y.expirationTime>ne)||Y&&!C());){var z=y.callback;if(typeof z=="function"){y.callback=null,_=y.priorityLevel;var ee=z(y.expirationTime<=ne);ne=t.unstable_now(),typeof ee=="function"?y.callback=ee:y===n(h)&&r(h),V(ne)}else r(h);y=n(h)}if(y!==null)var Q=!0;else{var de=n(f);de!==null&&W($,de.startTime-ne),Q=!1}return Q}finally{y=null,_=se,x=!1}}var H=!1,A=null,E=-1,P=5,L=-1;function C(){return!(t.unstable_now()-L<P)}function N(){if(A!==null){var Y=t.unstable_now();L=Y;var ne=!0;try{ne=A(!0,Y)}finally{ne?M():(H=!1,A=null)}}else H=!1}var M;if(typeof B=="function")M=function(){B(N)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,te=ie.port2;ie.port1.onmessage=N,M=function(){te.postMessage(null)}}else M=function(){S(N,0)};function q(Y){A=Y,H||(H=!0,M())}function W(Y,ne){E=S(function(){Y(t.unstable_now())},ne)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Y){Y.callback=null},t.unstable_continueExecution=function(){I||x||(I=!0,q(F))},t.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<Y?Math.floor(1e3/Y):5},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_getFirstCallbackNode=function(){return n(h)},t.unstable_next=function(Y){switch(_){case 1:case 2:case 3:var ne=3;break;default:ne=_}var se=_;_=ne;try{return Y()}finally{_=se}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Y,ne){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var se=_;_=Y;try{return ne()}finally{_=se}},t.unstable_scheduleCallback=function(Y,ne,se){var z=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?z+se:z):se=z,Y){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=se+ee,Y={id:g++,callback:ne,priorityLevel:Y,startTime:se,expirationTime:ee,sortIndex:-1},se>z?(Y.sortIndex=se,e(f,Y),n(h)===null&&Y===n(f)&&(k?(O(E),E=-1):k=!0,W($,se-z))):(Y.sortIndex=ee,e(h,Y),I||x||(I=!0,q(F))),Y},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(Y){var ne=_;return function(){var se=_;_=ne;try{return Y.apply(this,arguments)}finally{_=se}}}})(gp)),gp}var vw;function cR(){return vw||(vw=1,pp.exports=lR()),pp.exports}var _w;function uR(){if(_w)return Lr;_w=1;var t=Gg(),e=cR();function n(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,u=1;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,s={};function o(i,a){l(i,a),l(i+"Capture",a)}function l(i,a){for(s[i]=a,i=0;i<a.length;i++)r.add(a[i])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},y={};function _(i){return h.call(y,i)?!0:h.call(g,i)?!1:f.test(i)?y[i]=!0:(g[i]=!0,!1)}function x(i,a,u,p){if(u!==null&&u.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return p?!1:u!==null?!u.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function I(i,a,u,p){if(a===null||typeof a>"u"||x(i,a,u,p))return!0;if(p)return!1;if(u!==null)switch(u.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function k(i,a,u,p,v,w,R){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=u,this.propertyName=i,this.type=a,this.sanitizeURL=w,this.removeEmptyString=R}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){S[i]=new k(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];S[a]=new k(a,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){S[i]=new k(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){S[i]=new k(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){S[i]=new k(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){S[i]=new k(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){S[i]=new k(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){S[i]=new k(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){S[i]=new k(i,5,!1,i.toLowerCase(),null,!1,!1)});var O=/[\-:]([a-z])/g;function B(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(O,B);S[a]=new k(a,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(O,B);S[a]=new k(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(O,B);S[a]=new k(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){S[i]=new k(i,1,!1,i.toLowerCase(),null,!1,!1)}),S.xlinkHref=new k("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){S[i]=new k(i,1,!1,i.toLowerCase(),null,!0,!0)});function V(i,a,u,p){var v=S.hasOwnProperty(a)?S[a]:null;(v!==null?v.type!==0:p||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(I(a,u,v,p)&&(u=null),p||v===null?_(a)&&(u===null?i.removeAttribute(a):i.setAttribute(a,""+u)):v.mustUseProperty?i[v.propertyName]=u===null?v.type===3?!1:"":u:(a=v.attributeName,p=v.attributeNamespace,u===null?i.removeAttribute(a):(v=v.type,u=v===3||v===4&&u===!0?"":""+u,p?i.setAttributeNS(p,a,u):i.setAttribute(a,u))))}var $=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,F=Symbol.for("react.element"),H=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),C=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),W=Symbol.for("react.offscreen"),Y=Symbol.iterator;function ne(i){return i===null||typeof i!="object"?null:(i=Y&&i[Y]||i["@@iterator"],typeof i=="function"?i:null)}var se=Object.assign,z;function ee(i){if(z===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);z=a&&a[1]||""}return`
`+z+i}var Q=!1;function de(i,a){if(!i||Q)return"";Q=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(oe){var p=oe}Reflect.construct(i,[],a)}else{try{a.call()}catch(oe){p=oe}i.call(a.prototype)}else{try{throw Error()}catch(oe){p=oe}i()}}catch(oe){if(oe&&p&&typeof oe.stack=="string"){for(var v=oe.stack.split(`
`),w=p.stack.split(`
`),R=v.length-1,U=w.length-1;1<=R&&0<=U&&v[R]!==w[U];)U--;for(;1<=R&&0<=U;R--,U--)if(v[R]!==w[U]){if(R!==1||U!==1)do if(R--,U--,0>U||v[R]!==w[U]){var K=`
`+v[R].replace(" at new "," at ");return i.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",i.displayName)),K}while(1<=R&&0<=U);break}}}finally{Q=!1,Error.prepareStackTrace=u}return(i=i?i.displayName||i.name:"")?ee(i):""}function Se(i){switch(i.tag){case 5:return ee(i.type);case 16:return ee("Lazy");case 13:return ee("Suspense");case 19:return ee("SuspenseList");case 0:case 2:case 15:return i=de(i.type,!1),i;case 11:return i=de(i.type.render,!1),i;case 1:return i=de(i.type,!0),i;default:return""}}function fe(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case H:return"Portal";case P:return"Profiler";case E:return"StrictMode";case M:return"Suspense";case ie:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case C:return(i.displayName||"Context")+".Consumer";case L:return(i._context.displayName||"Context")+".Provider";case N:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case te:return a=i.displayName||null,a!==null?a:fe(i.type)||"Memo";case q:a=i._payload,i=i._init;try{return fe(i(a))}catch{}}return null}function Re(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fe(a);case 8:return a===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function $e(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Me(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function At(i){var a=Me(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),p=""+i[a];if(!i.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var v=u.get,w=u.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return v.call(this)},set:function(R){p=""+R,w.call(this,R)}}),Object.defineProperty(i,a,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function(R){p=""+R},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function Wt(i){i._valueTracker||(i._valueTracker=At(i))}function ur(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var u=a.getValue(),p="";return i&&(p=Me(i)?i.checked?"true":"false":i.value),i=p,i!==u?(a.setValue(i),!0):!1}function Ie(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Ir(i,a){var u=a.checked;return se({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??i._wrapperState.initialChecked})}function ce(i,a){var u=a.defaultValue==null?"":a.defaultValue,p=a.checked!=null?a.checked:a.defaultChecked;u=$e(a.value!=null?a.value:u),i._wrapperState={initialChecked:p,initialValue:u,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function xe(i,a){a=a.checked,a!=null&&V(i,"checked",a,!1)}function De(i,a){xe(i,a);var u=$e(a.value),p=a.type;if(u!=null)p==="number"?(u===0&&i.value===""||i.value!=u)&&(i.value=""+u):i.value!==""+u&&(i.value=""+u);else if(p==="submit"||p==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?Ze(i,a.type,u):a.hasOwnProperty("defaultValue")&&Ze(i,a.type,$e(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function Rt(i,a,u){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var p=a.type;if(!(p!=="submit"&&p!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,u||a===i.value||(i.value=a),i.defaultValue=a}u=i.name,u!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,u!==""&&(i.name=u)}function Ze(i,a,u){(a!=="number"||Ie(i.ownerDocument)!==i)&&(u==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+u&&(i.defaultValue=""+u))}var pt=Array.isArray;function ye(i,a,u,p){if(i=i.options,a){a={};for(var v=0;v<u.length;v++)a["$"+u[v]]=!0;for(u=0;u<i.length;u++)v=a.hasOwnProperty("$"+i[u].value),i[u].selected!==v&&(i[u].selected=v),v&&p&&(i[u].defaultSelected=!0)}else{for(u=""+$e(u),a=null,v=0;v<i.length;v++){if(i[v].value===u){i[v].selected=!0,p&&(i[v].defaultSelected=!0);return}a!==null||i[v].disabled||(a=i[v])}a!==null&&(a.selected=!0)}}function Ne(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(n(91));return se({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ke(i,a){var u=a.value;if(u==null){if(u=a.children,a=a.defaultValue,u!=null){if(a!=null)throw Error(n(92));if(pt(u)){if(1<u.length)throw Error(n(93));u=u[0]}a=u}a==null&&(a=""),u=a}i._wrapperState={initialValue:$e(u)}}function kt(i,a){var u=$e(a.value),p=$e(a.defaultValue);u!=null&&(u=""+u,u!==i.value&&(i.value=u),a.defaultValue==null&&i.defaultValue!==u&&(i.defaultValue=u)),p!=null&&(i.defaultValue=""+p)}function it(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function _n(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sr(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?_n(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var gt,Yt=(function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,u,p,v){MSApp.execUnsafeLocalFunction(function(){return i(a,u,p,v)})}:i})(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(gt=gt||document.createElement("div"),gt.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=gt.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function Bt(i,a){if(a){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=a;return}}i.textContent=a}var tn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tr=["Webkit","ms","Moz","O"];Object.keys(tn).forEach(function(i){tr.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),tn[a]=tn[i]})});function Un(i,a,u){return a==null||typeof a=="boolean"||a===""?"":u||typeof a!="number"||a===0||tn.hasOwnProperty(i)&&tn[i]?(""+a).trim():a+"px"}function Or(i,a){i=i.style;for(var u in a)if(a.hasOwnProperty(u)){var p=u.indexOf("--")===0,v=Un(u,a[u],p);u==="float"&&(u="cssFloat"),p?i.setProperty(u,v):i[u]=v}}var Ht=se({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xe(i,a){if(a){if(Ht[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(n(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(n(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(n(61))}if(a.style!=null&&typeof a.style!="object")throw Error(n(62))}}function Kn(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jt=null;function Ee(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var nt=null,ht=null,dt=null;function Be(i){if(i=yc(i)){if(typeof nt!="function")throw Error(n(280));var a=i.stateNode;a&&(a=dd(a),nt(i.stateNode,i.type,a))}}function Le(i){ht?dt?dt.push(i):dt=[i]:ht=i}function _t(){if(ht){var i=ht,a=dt;if(dt=ht=null,Be(i),a)for(i=0;i<a.length;i++)Be(a[i])}}function Pt(i,a){return i(a)}function Lt(){}var mt=!1;function jn(i,a,u){if(mt)return i(a,u);mt=!0;try{return Pt(i,a,u)}finally{mt=!1,(ht!==null||dt!==null)&&(Lt(),_t())}}function je(i,a){var u=i.stateNode;if(u===null)return null;var p=dd(u);if(p===null)return null;u=p[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(n(231,a,typeof u));return u}var It=!1;if(d)try{var Nn={};Object.defineProperty(Nn,"passive",{get:function(){It=!0}}),window.addEventListener("test",Nn,Nn),window.removeEventListener("test",Nn,Nn)}catch{It=!1}function Gn(i,a,u,p,v,w,R,U,K){var oe=Array.prototype.slice.call(arguments,3);try{a.apply(u,oe)}catch(ve){this.onError(ve)}}var Mn=!1,nn=null,fn=!1,ft=null,Ft={onError:function(i){Mn=!0,nn=i}};function wn(i,a,u,p,v,w,R,U,K){Mn=!1,nn=null,Gn.apply(Ft,arguments)}function mn(i,a,u,p,v,w,R,U,K){if(wn.apply(this,arguments),Mn){if(Mn){var oe=nn;Mn=!1,nn=null}else throw Error(n(198));fn||(fn=!0,ft=oe)}}function rn(i){var a=i,u=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(u=a.return),i=a.return;while(i)}return a.tag===3?u:null}function Fr(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Br(i){if(rn(i)!==i)throw Error(n(188))}function X(i){var a=i.alternate;if(!a){if(a=rn(i),a===null)throw Error(n(188));return a!==i?null:i}for(var u=i,p=a;;){var v=u.return;if(v===null)break;var w=v.alternate;if(w===null){if(p=v.return,p!==null){u=p;continue}break}if(v.child===w.child){for(w=v.child;w;){if(w===u)return Br(v),i;if(w===p)return Br(v),a;w=w.sibling}throw Error(n(188))}if(u.return!==p.return)u=v,p=w;else{for(var R=!1,U=v.child;U;){if(U===u){R=!0,u=v,p=w;break}if(U===p){R=!0,p=v,u=w;break}U=U.sibling}if(!R){for(U=w.child;U;){if(U===u){R=!0,u=w,p=v;break}if(U===p){R=!0,p=w,u=v;break}U=U.sibling}if(!R)throw Error(n(189))}}if(u.alternate!==p)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?i:a}function le(i){return i=X(i),i!==null?_e(i):null}function _e(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=_e(i);if(a!==null)return a;i=i.sibling}return null}var ke=e.unstable_scheduleCallback,We=e.unstable_cancelCallback,St=e.unstable_shouldYield,jt=e.unstable_requestPaint,Pe=e.unstable_now,pn=e.unstable_getCurrentPriorityLevel,sn=e.unstable_ImmediatePriority,bn=e.unstable_UserBlockingPriority,Dn=e.unstable_NormalPriority,xn=e.unstable_LowPriority,pe=e.unstable_IdlePriority,lt=null,Nt=null;function gn(i){if(Nt&&typeof Nt.onCommitFiberRoot=="function")try{Nt.onCommitFiberRoot(lt,i,void 0,(i.current.flags&128)===128)}catch{}}var Zt=Math.clz32?Math.clz32:Tn,Ut=Math.log,ct=Math.LN2;function Tn(i){return i>>>=0,i===0?32:31-(Ut(i)/ct|0)|0}var dr=64,Ur=4194304;function yt(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function si(i,a){var u=i.pendingLanes;if(u===0)return 0;var p=0,v=i.suspendedLanes,w=i.pingedLanes,R=u&268435455;if(R!==0){var U=R&~v;U!==0?p=yt(U):(w&=R,w!==0&&(p=yt(w)))}else R=u&~v,R!==0?p=yt(R):w!==0&&(p=yt(w));if(p===0)return 0;if(a!==0&&a!==p&&(a&v)===0&&(v=p&-p,w=a&-a,v>=w||v===16&&(w&4194240)!==0))return a;if((p&4)!==0&&(p|=u&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=p;0<a;)u=31-Zt(a),v=1<<u,p|=i[u],a&=~v;return p}function Do(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lo(i,a){for(var u=i.suspendedLanes,p=i.pingedLanes,v=i.expirationTimes,w=i.pendingLanes;0<w;){var R=31-Zt(w),U=1<<R,K=v[R];K===-1?((U&u)===0||(U&p)!==0)&&(v[R]=Do(U,a)):K<=a&&(i.expiredLanes|=U),w&=~U}}function Xl(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Yl(){var i=dr;return dr<<=1,(dr&4194240)===0&&(dr=64),i}function Jl(i){for(var a=[],u=0;31>u;u++)a.push(i);return a}function Vo(i,a,u){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-Zt(a),i[a]=u}function qf(i,a){var u=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var p=i.eventTimes;for(i=i.expirationTimes;0<u;){var v=31-Zt(u),w=1<<v;a[v]=0,p[v]=-1,i[v]=-1,u&=~w}}function Zl(i,a){var u=i.entangledLanes|=a;for(i=i.entanglements;u;){var p=31-Zt(u),v=1<<p;v&a|i[p]&a&&(i[p]|=a),u&=~v}}var Tt=0;function js(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var ec,Ca,tc,nc,rc,Ns=!1,Aa=[],Ms=null,Ds=null,nr=null,Oo=new Map,ii=new Map,$r=[],Qu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Li(i,a){switch(i){case"focusin":case"focusout":Ms=null;break;case"dragenter":case"dragleave":Ds=null;break;case"mouseover":case"mouseout":nr=null;break;case"pointerover":case"pointerout":Oo.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ii.delete(a.pointerId)}}function hs(i,a,u,p,v,w){return i===null||i.nativeEvent!==w?(i={blockedOn:a,domEventName:u,eventSystemFlags:p,nativeEvent:w,targetContainers:[v]},a!==null&&(a=yc(a),a!==null&&Ca(a)),i):(i.eventSystemFlags|=p,a=i.targetContainers,v!==null&&a.indexOf(v)===-1&&a.push(v),i)}function Xu(i,a,u,p,v){switch(a){case"focusin":return Ms=hs(Ms,i,a,u,p,v),!0;case"dragenter":return Ds=hs(Ds,i,a,u,p,v),!0;case"mouseover":return nr=hs(nr,i,a,u,p,v),!0;case"pointerover":var w=v.pointerId;return Oo.set(w,hs(Oo.get(w)||null,i,a,u,p,v)),!0;case"gotpointercapture":return w=v.pointerId,ii.set(w,hs(ii.get(w)||null,i,a,u,p,v)),!0}return!1}function Ra(i){var a=$o(i.target);if(a!==null){var u=rn(a);if(u!==null){if(a=u.tag,a===13){if(a=Fr(u),a!==null){i.blockedOn=a,rc(i.priority,function(){tc(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function $t(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var u=ka(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(u===null){u=i.nativeEvent;var p=new u.constructor(u.type,u);Jt=p,u.target.dispatchEvent(p),Jt=null}else return a=yc(u),a!==null&&Ca(a),i.blockedOn=u,!1;a.shift()}return!0}function Yu(i,a,u){$t(i)&&u.delete(a)}function Wf(){Ns=!1,Ms!==null&&$t(Ms)&&(Ms=null),Ds!==null&&$t(Ds)&&(Ds=null),nr!==null&&$t(nr)&&(nr=null),Oo.forEach(Yu),ii.forEach(Yu)}function Vi(i,a){i.blockedOn===a&&(i.blockedOn=null,Ns||(Ns=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Wf)))}function Oi(i){function a(v){return Vi(v,i)}if(0<Aa.length){Vi(Aa[0],i);for(var u=1;u<Aa.length;u++){var p=Aa[u];p.blockedOn===i&&(p.blockedOn=null)}}for(Ms!==null&&Vi(Ms,i),Ds!==null&&Vi(Ds,i),nr!==null&&Vi(nr,i),Oo.forEach(a),ii.forEach(a),u=0;u<$r.length;u++)p=$r[u],p.blockedOn===i&&(p.blockedOn=null);for(;0<$r.length&&(u=$r[0],u.blockedOn===null);)Ra(u),u.blockedOn===null&&$r.shift()}var oi=$.ReactCurrentBatchConfig,ai=!0;function Ls(i,a,u,p){var v=Tt,w=oi.transition;oi.transition=null;try{Tt=1,sc(i,a,u,p)}finally{Tt=v,oi.transition=w}}function Ju(i,a,u,p){var v=Tt,w=oi.transition;oi.transition=null;try{Tt=4,sc(i,a,u,p)}finally{Tt=v,oi.transition=w}}function sc(i,a,u,p){if(ai){var v=ka(i,a,u,p);if(v===null)nm(i,a,p,Vs,u),Li(i,p);else if(Xu(v,i,a,u,p))p.stopPropagation();else if(Li(i,p),a&4&&-1<Qu.indexOf(i)){for(;v!==null;){var w=yc(v);if(w!==null&&ec(w),w=ka(i,a,u,p),w===null&&nm(i,a,p,Vs,u),w===v)break;v=w}v!==null&&p.stopPropagation()}else nm(i,a,p,null,u)}}var Vs=null;function ka(i,a,u,p){if(Vs=null,i=Ee(p),i=$o(i),i!==null)if(a=rn(i),a===null)i=null;else if(u=a.tag,u===13){if(i=Fr(a),i!==null)return i;i=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Vs=i,null}function Pa(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pn()){case sn:return 1;case bn:return 4;case Dn:case xn:return 16;case pe:return 536870912;default:return 16}default:return 16}}var zr=null,ja=null,li=null;function Zu(){if(li)return li;var i,a=ja,u=a.length,p,v="value"in zr?zr.value:zr.textContent,w=v.length;for(i=0;i<u&&a[i]===v[i];i++);var R=u-i;for(p=1;p<=R&&a[u-p]===v[w-p];p++);return li=v.slice(i,1<p?1-p:void 0)}function Fo(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function Os(){return!0}function ic(){return!1}function hr(i){function a(u,p,v,w,R){this._reactName=u,this._targetInst=v,this.type=p,this.nativeEvent=w,this.target=R,this.currentTarget=null;for(var U in i)i.hasOwnProperty(U)&&(u=i[U],this[U]=u?u(w):w[U]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Os:ic,this.isPropagationStopped=ic,this}return se(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Os)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Os)},persist:function(){},isPersistent:Os}),a}var Fs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bo=hr(Fs),Fi=se({},Fs,{view:0,detail:0}),Na=hr(Fi),Ma,Da,qr,Uo=se({},Fi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ut,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==qr&&(qr&&i.type==="mousemove"?(Ma=i.screenX-qr.screenX,Da=i.screenY-qr.screenY):Da=Ma=0,qr=i),Ma)},movementY:function(i){return"movementY"in i?i.movementY:Da}}),oc=hr(Uo),ed=se({},Uo,{dataTransfer:0}),td=hr(ed),La=se({},Fi,{relatedTarget:0}),rr=hr(La),nd=se({},Fs,{animationName:0,elapsedTime:0,pseudoElement:0}),rd=hr(nd),Bi=se({},Fs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),m=hr(Bi),b=se({},Fs,{data:0}),T=hr(b),D={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Z={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ae={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ce(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=ae[i])?!!a[i]:!1}function ut(){return Ce}var En=se({},Fi,{key:function(i){if(i.key){var a=D[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=Fo(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Z[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ut,charCode:function(i){return i.type==="keypress"?Fo(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Fo(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Vt=hr(En),Ln=se({},Uo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wr=hr(Ln),ci=se({},Fi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ut}),Bs=hr(ci),Us=se({},Fs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Va=hr(Us),ac=se({},Uo,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),YA=hr(ac),JA=[9,13,27,32],Hf=d&&"CompositionEvent"in window,lc=null;d&&"documentMode"in document&&(lc=document.documentMode);var ZA=d&&"TextEvent"in window&&!lc,i_=d&&(!Hf||lc&&8<lc&&11>=lc),o_=" ",a_=!1;function l_(i,a){switch(i){case"keyup":return JA.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function c_(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Oa=!1;function e1(i,a){switch(i){case"compositionend":return c_(a);case"keypress":return a.which!==32?null:(a_=!0,o_);case"textInput":return i=a.data,i===o_&&a_?null:i;default:return null}}function t1(i,a){if(Oa)return i==="compositionend"||!Hf&&l_(i,a)?(i=Zu(),li=ja=zr=null,Oa=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return i_&&a.locale!=="ko"?null:a.data;default:return null}}var n1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u_(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!n1[i.type]:a==="textarea"}function d_(i,a,u,p){Le(p),a=ld(a,"onChange"),0<a.length&&(u=new Bo("onChange","change",null,u,p),i.push({event:u,listeners:a}))}var cc=null,uc=null;function r1(i){R_(i,0)}function sd(i){var a=za(i);if(ur(a))return i}function s1(i,a){if(i==="change")return a}var h_=!1;if(d){var Kf;if(d){var Gf="oninput"in document;if(!Gf){var f_=document.createElement("div");f_.setAttribute("oninput","return;"),Gf=typeof f_.oninput=="function"}Kf=Gf}else Kf=!1;h_=Kf&&(!document.documentMode||9<document.documentMode)}function m_(){cc&&(cc.detachEvent("onpropertychange",p_),uc=cc=null)}function p_(i){if(i.propertyName==="value"&&sd(uc)){var a=[];d_(a,uc,i,Ee(i)),jn(r1,a)}}function i1(i,a,u){i==="focusin"?(m_(),cc=a,uc=u,cc.attachEvent("onpropertychange",p_)):i==="focusout"&&m_()}function o1(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return sd(uc)}function a1(i,a){if(i==="click")return sd(a)}function l1(i,a){if(i==="input"||i==="change")return sd(a)}function c1(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var fs=typeof Object.is=="function"?Object.is:c1;function dc(i,a){if(fs(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var u=Object.keys(i),p=Object.keys(a);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var v=u[p];if(!h.call(a,v)||!fs(i[v],a[v]))return!1}return!0}function g_(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function y_(i,a){var u=g_(i);i=0;for(var p;u;){if(u.nodeType===3){if(p=i+u.textContent.length,i<=a&&p>=a)return{node:u,offset:a-i};i=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=g_(u)}}function v_(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?v_(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function __(){for(var i=window,a=Ie();a instanceof i.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)i=a.contentWindow;else break;a=Ie(i.document)}return a}function Qf(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function u1(i){var a=__(),u=i.focusedElem,p=i.selectionRange;if(a!==u&&u&&u.ownerDocument&&v_(u.ownerDocument.documentElement,u)){if(p!==null&&Qf(u)){if(a=p.start,i=p.end,i===void 0&&(i=a),"selectionStart"in u)u.selectionStart=a,u.selectionEnd=Math.min(i,u.value.length);else if(i=(a=u.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var v=u.textContent.length,w=Math.min(p.start,v);p=p.end===void 0?w:Math.min(p.end,v),!i.extend&&w>p&&(v=p,p=w,w=v),v=y_(u,w);var R=y_(u,p);v&&R&&(i.rangeCount!==1||i.anchorNode!==v.node||i.anchorOffset!==v.offset||i.focusNode!==R.node||i.focusOffset!==R.offset)&&(a=a.createRange(),a.setStart(v.node,v.offset),i.removeAllRanges(),w>p?(i.addRange(a),i.extend(R.node,R.offset)):(a.setEnd(R.node,R.offset),i.addRange(a)))}}for(a=[],i=u;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<a.length;u++)i=a[u],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var d1=d&&"documentMode"in document&&11>=document.documentMode,Fa=null,Xf=null,hc=null,Yf=!1;function w_(i,a,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;Yf||Fa==null||Fa!==Ie(p)||(p=Fa,"selectionStart"in p&&Qf(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),hc&&dc(hc,p)||(hc=p,p=ld(Xf,"onSelect"),0<p.length&&(a=new Bo("onSelect","select",null,a,u),i.push({event:a,listeners:p}),a.target=Fa)))}function id(i,a){var u={};return u[i.toLowerCase()]=a.toLowerCase(),u["Webkit"+i]="webkit"+a,u["Moz"+i]="moz"+a,u}var Ba={animationend:id("Animation","AnimationEnd"),animationiteration:id("Animation","AnimationIteration"),animationstart:id("Animation","AnimationStart"),transitionend:id("Transition","TransitionEnd")},Jf={},b_={};d&&(b_=document.createElement("div").style,"AnimationEvent"in window||(delete Ba.animationend.animation,delete Ba.animationiteration.animation,delete Ba.animationstart.animation),"TransitionEvent"in window||delete Ba.transitionend.transition);function od(i){if(Jf[i])return Jf[i];if(!Ba[i])return i;var a=Ba[i],u;for(u in a)if(a.hasOwnProperty(u)&&u in b_)return Jf[i]=a[u];return i}var x_=od("animationend"),T_=od("animationiteration"),E_=od("animationstart"),I_=od("transitionend"),S_=new Map,C_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ui(i,a){S_.set(i,a),o(a,[i])}for(var Zf=0;Zf<C_.length;Zf++){var em=C_[Zf],h1=em.toLowerCase(),f1=em[0].toUpperCase()+em.slice(1);Ui(h1,"on"+f1)}Ui(x_,"onAnimationEnd"),Ui(T_,"onAnimationIteration"),Ui(E_,"onAnimationStart"),Ui("dblclick","onDoubleClick"),Ui("focusin","onFocus"),Ui("focusout","onBlur"),Ui(I_,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),m1=new Set("cancel close invalid load scroll toggle".split(" ").concat(fc));function A_(i,a,u){var p=i.type||"unknown-event";i.currentTarget=u,mn(p,a,void 0,i),i.currentTarget=null}function R_(i,a){a=(a&4)!==0;for(var u=0;u<i.length;u++){var p=i[u],v=p.event;p=p.listeners;e:{var w=void 0;if(a)for(var R=p.length-1;0<=R;R--){var U=p[R],K=U.instance,oe=U.currentTarget;if(U=U.listener,K!==w&&v.isPropagationStopped())break e;A_(v,U,oe),w=K}else for(R=0;R<p.length;R++){if(U=p[R],K=U.instance,oe=U.currentTarget,U=U.listener,K!==w&&v.isPropagationStopped())break e;A_(v,U,oe),w=K}}}if(fn)throw i=ft,fn=!1,ft=null,i}function Kt(i,a){var u=a[lm];u===void 0&&(u=a[lm]=new Set);var p=i+"__bubble";u.has(p)||(k_(a,i,2,!1),u.add(p))}function tm(i,a,u){var p=0;a&&(p|=4),k_(u,i,p,a)}var ad="_reactListening"+Math.random().toString(36).slice(2);function mc(i){if(!i[ad]){i[ad]=!0,r.forEach(function(u){u!=="selectionchange"&&(m1.has(u)||tm(u,!1,i),tm(u,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[ad]||(a[ad]=!0,tm("selectionchange",!1,a))}}function k_(i,a,u,p){switch(Pa(a)){case 1:var v=Ls;break;case 4:v=Ju;break;default:v=sc}u=v.bind(null,a,u,i),v=void 0,!It||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(v=!0),p?v!==void 0?i.addEventListener(a,u,{capture:!0,passive:v}):i.addEventListener(a,u,!0):v!==void 0?i.addEventListener(a,u,{passive:v}):i.addEventListener(a,u,!1)}function nm(i,a,u,p,v){var w=p;if((a&1)===0&&(a&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var U=p.stateNode.containerInfo;if(U===v||U.nodeType===8&&U.parentNode===v)break;if(R===4)for(R=p.return;R!==null;){var K=R.tag;if((K===3||K===4)&&(K=R.stateNode.containerInfo,K===v||K.nodeType===8&&K.parentNode===v))return;R=R.return}for(;U!==null;){if(R=$o(U),R===null)return;if(K=R.tag,K===5||K===6){p=w=R;continue e}U=U.parentNode}}p=p.return}jn(function(){var oe=w,ve=Ee(u),be=[];e:{var ge=S_.get(i);if(ge!==void 0){var Ve=Bo,ze=i;switch(i){case"keypress":if(Fo(u)===0)break e;case"keydown":case"keyup":Ve=Vt;break;case"focusin":ze="focus",Ve=rr;break;case"focusout":ze="blur",Ve=rr;break;case"beforeblur":case"afterblur":Ve=rr;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ve=oc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ve=td;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ve=Bs;break;case x_:case T_:case E_:Ve=rd;break;case I_:Ve=Va;break;case"scroll":Ve=Na;break;case"wheel":Ve=YA;break;case"copy":case"cut":case"paste":Ve=m;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ve=Wr}var qe=(a&4)!==0,In=!qe&&i==="scroll",J=qe?ge!==null?ge+"Capture":null:ge;qe=[];for(var G=oe,re;G!==null;){re=G;var Te=re.stateNode;if(re.tag===5&&Te!==null&&(re=Te,J!==null&&(Te=je(G,J),Te!=null&&qe.push(pc(G,Te,re)))),In)break;G=G.return}0<qe.length&&(ge=new Ve(ge,ze,null,u,ve),be.push({event:ge,listeners:qe}))}}if((a&7)===0){e:{if(ge=i==="mouseover"||i==="pointerover",Ve=i==="mouseout"||i==="pointerout",ge&&u!==Jt&&(ze=u.relatedTarget||u.fromElement)&&($o(ze)||ze[ui]))break e;if((Ve||ge)&&(ge=ve.window===ve?ve:(ge=ve.ownerDocument)?ge.defaultView||ge.parentWindow:window,Ve?(ze=u.relatedTarget||u.toElement,Ve=oe,ze=ze?$o(ze):null,ze!==null&&(In=rn(ze),ze!==In||ze.tag!==5&&ze.tag!==6)&&(ze=null)):(Ve=null,ze=oe),Ve!==ze)){if(qe=oc,Te="onMouseLeave",J="onMouseEnter",G="mouse",(i==="pointerout"||i==="pointerover")&&(qe=Wr,Te="onPointerLeave",J="onPointerEnter",G="pointer"),In=Ve==null?ge:za(Ve),re=ze==null?ge:za(ze),ge=new qe(Te,G+"leave",Ve,u,ve),ge.target=In,ge.relatedTarget=re,Te=null,$o(ve)===oe&&(qe=new qe(J,G+"enter",ze,u,ve),qe.target=re,qe.relatedTarget=In,Te=qe),In=Te,Ve&&ze)t:{for(qe=Ve,J=ze,G=0,re=qe;re;re=Ua(re))G++;for(re=0,Te=J;Te;Te=Ua(Te))re++;for(;0<G-re;)qe=Ua(qe),G--;for(;0<re-G;)J=Ua(J),re--;for(;G--;){if(qe===J||J!==null&&qe===J.alternate)break t;qe=Ua(qe),J=Ua(J)}qe=null}else qe=null;Ve!==null&&P_(be,ge,Ve,qe,!1),ze!==null&&In!==null&&P_(be,In,ze,qe,!0)}}e:{if(ge=oe?za(oe):window,Ve=ge.nodeName&&ge.nodeName.toLowerCase(),Ve==="select"||Ve==="input"&&ge.type==="file")var He=s1;else if(u_(ge))if(h_)He=l1;else{He=o1;var Ye=i1}else(Ve=ge.nodeName)&&Ve.toLowerCase()==="input"&&(ge.type==="checkbox"||ge.type==="radio")&&(He=a1);if(He&&(He=He(i,oe))){d_(be,He,u,ve);break e}Ye&&Ye(i,ge,oe),i==="focusout"&&(Ye=ge._wrapperState)&&Ye.controlled&&ge.type==="number"&&Ze(ge,"number",ge.value)}switch(Ye=oe?za(oe):window,i){case"focusin":(u_(Ye)||Ye.contentEditable==="true")&&(Fa=Ye,Xf=oe,hc=null);break;case"focusout":hc=Xf=Fa=null;break;case"mousedown":Yf=!0;break;case"contextmenu":case"mouseup":case"dragend":Yf=!1,w_(be,u,ve);break;case"selectionchange":if(d1)break;case"keydown":case"keyup":w_(be,u,ve)}var Je;if(Hf)e:{switch(i){case"compositionstart":var ot="onCompositionStart";break e;case"compositionend":ot="onCompositionEnd";break e;case"compositionupdate":ot="onCompositionUpdate";break e}ot=void 0}else Oa?l_(i,u)&&(ot="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(ot="onCompositionStart");ot&&(i_&&u.locale!=="ko"&&(Oa||ot!=="onCompositionStart"?ot==="onCompositionEnd"&&Oa&&(Je=Zu()):(zr=ve,ja="value"in zr?zr.value:zr.textContent,Oa=!0)),Ye=ld(oe,ot),0<Ye.length&&(ot=new T(ot,i,null,u,ve),be.push({event:ot,listeners:Ye}),Je?ot.data=Je:(Je=c_(u),Je!==null&&(ot.data=Je)))),(Je=ZA?e1(i,u):t1(i,u))&&(oe=ld(oe,"onBeforeInput"),0<oe.length&&(ve=new T("onBeforeInput","beforeinput",null,u,ve),be.push({event:ve,listeners:oe}),ve.data=Je))}R_(be,a)})}function pc(i,a,u){return{instance:i,listener:a,currentTarget:u}}function ld(i,a){for(var u=a+"Capture",p=[];i!==null;){var v=i,w=v.stateNode;v.tag===5&&w!==null&&(v=w,w=je(i,u),w!=null&&p.unshift(pc(i,w,v)),w=je(i,a),w!=null&&p.push(pc(i,w,v))),i=i.return}return p}function Ua(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function P_(i,a,u,p,v){for(var w=a._reactName,R=[];u!==null&&u!==p;){var U=u,K=U.alternate,oe=U.stateNode;if(K!==null&&K===p)break;U.tag===5&&oe!==null&&(U=oe,v?(K=je(u,w),K!=null&&R.unshift(pc(u,K,U))):v||(K=je(u,w),K!=null&&R.push(pc(u,K,U)))),u=u.return}R.length!==0&&i.push({event:a,listeners:R})}var p1=/\r\n?/g,g1=/\u0000|\uFFFD/g;function j_(i){return(typeof i=="string"?i:""+i).replace(p1,`
`).replace(g1,"")}function cd(i,a,u){if(a=j_(a),j_(i)!==a&&u)throw Error(n(425))}function ud(){}var rm=null,sm=null;function im(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var om=typeof setTimeout=="function"?setTimeout:void 0,y1=typeof clearTimeout=="function"?clearTimeout:void 0,N_=typeof Promise=="function"?Promise:void 0,v1=typeof queueMicrotask=="function"?queueMicrotask:typeof N_<"u"?function(i){return N_.resolve(null).then(i).catch(_1)}:om;function _1(i){setTimeout(function(){throw i})}function am(i,a){var u=a,p=0;do{var v=u.nextSibling;if(i.removeChild(u),v&&v.nodeType===8)if(u=v.data,u==="/$"){if(p===0){i.removeChild(v),Oi(a);return}p--}else u!=="$"&&u!=="$?"&&u!=="$!"||p++;u=v}while(u);Oi(a)}function $i(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function M_(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return i;a--}else u==="/$"&&a++}i=i.previousSibling}return null}var $a=Math.random().toString(36).slice(2),$s="__reactFiber$"+$a,gc="__reactProps$"+$a,ui="__reactContainer$"+$a,lm="__reactEvents$"+$a,w1="__reactListeners$"+$a,b1="__reactHandles$"+$a;function $o(i){var a=i[$s];if(a)return a;for(var u=i.parentNode;u;){if(a=u[ui]||u[$s]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(i=M_(i);i!==null;){if(u=i[$s])return u;i=M_(i)}return a}i=u,u=i.parentNode}return null}function yc(i){return i=i[$s]||i[ui],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function za(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(n(33))}function dd(i){return i[gc]||null}var cm=[],qa=-1;function zi(i){return{current:i}}function Gt(i){0>qa||(i.current=cm[qa],cm[qa]=null,qa--)}function zt(i,a){qa++,cm[qa]=i.current,i.current=a}var qi={},fr=zi(qi),Pr=zi(!1),zo=qi;function Wa(i,a){var u=i.type.contextTypes;if(!u)return qi;var p=i.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===a)return p.__reactInternalMemoizedMaskedChildContext;var v={},w;for(w in u)v[w]=a[w];return p&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=v),v}function jr(i){return i=i.childContextTypes,i!=null}function hd(){Gt(Pr),Gt(fr)}function D_(i,a,u){if(fr.current!==qi)throw Error(n(168));zt(fr,a),zt(Pr,u)}function L_(i,a,u){var p=i.stateNode;if(a=a.childContextTypes,typeof p.getChildContext!="function")return u;p=p.getChildContext();for(var v in p)if(!(v in a))throw Error(n(108,Re(i)||"Unknown",v));return se({},u,p)}function fd(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||qi,zo=fr.current,zt(fr,i),zt(Pr,Pr.current),!0}function V_(i,a,u){var p=i.stateNode;if(!p)throw Error(n(169));u?(i=L_(i,a,zo),p.__reactInternalMemoizedMergedChildContext=i,Gt(Pr),Gt(fr),zt(fr,i)):Gt(Pr),zt(Pr,u)}var di=null,md=!1,um=!1;function O_(i){di===null?di=[i]:di.push(i)}function x1(i){md=!0,O_(i)}function Wi(){if(!um&&di!==null){um=!0;var i=0,a=Tt;try{var u=di;for(Tt=1;i<u.length;i++){var p=u[i];do p=p(!0);while(p!==null)}di=null,md=!1}catch(v){throw di!==null&&(di=di.slice(i+1)),ke(sn,Wi),v}finally{Tt=a,um=!1}}return null}var Ha=[],Ka=0,pd=null,gd=0,ns=[],rs=0,qo=null,hi=1,fi="";function Wo(i,a){Ha[Ka++]=gd,Ha[Ka++]=pd,pd=i,gd=a}function F_(i,a,u){ns[rs++]=hi,ns[rs++]=fi,ns[rs++]=qo,qo=i;var p=hi;i=fi;var v=32-Zt(p)-1;p&=~(1<<v),u+=1;var w=32-Zt(a)+v;if(30<w){var R=v-v%5;w=(p&(1<<R)-1).toString(32),p>>=R,v-=R,hi=1<<32-Zt(a)+v|u<<v|p,fi=w+i}else hi=1<<w|u<<v|p,fi=i}function dm(i){i.return!==null&&(Wo(i,1),F_(i,1,0))}function hm(i){for(;i===pd;)pd=Ha[--Ka],Ha[Ka]=null,gd=Ha[--Ka],Ha[Ka]=null;for(;i===qo;)qo=ns[--rs],ns[rs]=null,fi=ns[--rs],ns[rs]=null,hi=ns[--rs],ns[rs]=null}var Hr=null,Kr=null,en=!1,ms=null;function B_(i,a){var u=as(5,null,null,0);u.elementType="DELETED",u.stateNode=a,u.return=i,a=i.deletions,a===null?(i.deletions=[u],i.flags|=16):a.push(u)}function U_(i,a){switch(i.tag){case 5:var u=i.type;return a=a.nodeType!==1||u.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,Hr=i,Kr=$i(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,Hr=i,Kr=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(u=qo!==null?{id:hi,overflow:fi}:null,i.memoizedState={dehydrated:a,treeContext:u,retryLane:1073741824},u=as(18,null,null,0),u.stateNode=a,u.return=i,i.child=u,Hr=i,Kr=null,!0):!1;default:return!1}}function fm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function mm(i){if(en){var a=Kr;if(a){var u=a;if(!U_(i,a)){if(fm(i))throw Error(n(418));a=$i(u.nextSibling);var p=Hr;a&&U_(i,a)?B_(p,u):(i.flags=i.flags&-4097|2,en=!1,Hr=i)}}else{if(fm(i))throw Error(n(418));i.flags=i.flags&-4097|2,en=!1,Hr=i}}}function $_(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Hr=i}function yd(i){if(i!==Hr)return!1;if(!en)return $_(i),en=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!im(i.type,i.memoizedProps)),a&&(a=Kr)){if(fm(i))throw z_(),Error(n(418));for(;a;)B_(i,a),a=$i(a.nextSibling)}if($_(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"){if(a===0){Kr=$i(i.nextSibling);break e}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++}i=i.nextSibling}Kr=null}}else Kr=Hr?$i(i.stateNode.nextSibling):null;return!0}function z_(){for(var i=Kr;i;)i=$i(i.nextSibling)}function Ga(){Kr=Hr=null,en=!1}function pm(i){ms===null?ms=[i]:ms.push(i)}var T1=$.ReactCurrentBatchConfig;function vc(i,a,u){if(i=u.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(n(309));var p=u.stateNode}if(!p)throw Error(n(147,i));var v=p,w=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===w?a.ref:(a=function(R){var U=v.refs;R===null?delete U[w]:U[w]=R},a._stringRef=w,a)}if(typeof i!="string")throw Error(n(284));if(!u._owner)throw Error(n(290,i))}return i}function vd(i,a){throw i=Object.prototype.toString.call(a),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function q_(i){var a=i._init;return a(i._payload)}function W_(i){function a(J,G){if(i){var re=J.deletions;re===null?(J.deletions=[G],J.flags|=16):re.push(G)}}function u(J,G){if(!i)return null;for(;G!==null;)a(J,G),G=G.sibling;return null}function p(J,G){for(J=new Map;G!==null;)G.key!==null?J.set(G.key,G):J.set(G.index,G),G=G.sibling;return J}function v(J,G){return J=Zi(J,G),J.index=0,J.sibling=null,J}function w(J,G,re){return J.index=re,i?(re=J.alternate,re!==null?(re=re.index,re<G?(J.flags|=2,G):re):(J.flags|=2,G)):(J.flags|=1048576,G)}function R(J){return i&&J.alternate===null&&(J.flags|=2),J}function U(J,G,re,Te){return G===null||G.tag!==6?(G=op(re,J.mode,Te),G.return=J,G):(G=v(G,re),G.return=J,G)}function K(J,G,re,Te){var He=re.type;return He===A?ve(J,G,re.props.children,Te,re.key):G!==null&&(G.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===q&&q_(He)===G.type)?(Te=v(G,re.props),Te.ref=vc(J,G,re),Te.return=J,Te):(Te=$d(re.type,re.key,re.props,null,J.mode,Te),Te.ref=vc(J,G,re),Te.return=J,Te)}function oe(J,G,re,Te){return G===null||G.tag!==4||G.stateNode.containerInfo!==re.containerInfo||G.stateNode.implementation!==re.implementation?(G=ap(re,J.mode,Te),G.return=J,G):(G=v(G,re.children||[]),G.return=J,G)}function ve(J,G,re,Te,He){return G===null||G.tag!==7?(G=Zo(re,J.mode,Te,He),G.return=J,G):(G=v(G,re),G.return=J,G)}function be(J,G,re){if(typeof G=="string"&&G!==""||typeof G=="number")return G=op(""+G,J.mode,re),G.return=J,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case F:return re=$d(G.type,G.key,G.props,null,J.mode,re),re.ref=vc(J,null,G),re.return=J,re;case H:return G=ap(G,J.mode,re),G.return=J,G;case q:var Te=G._init;return be(J,Te(G._payload),re)}if(pt(G)||ne(G))return G=Zo(G,J.mode,re,null),G.return=J,G;vd(J,G)}return null}function ge(J,G,re,Te){var He=G!==null?G.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return He!==null?null:U(J,G,""+re,Te);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case F:return re.key===He?K(J,G,re,Te):null;case H:return re.key===He?oe(J,G,re,Te):null;case q:return He=re._init,ge(J,G,He(re._payload),Te)}if(pt(re)||ne(re))return He!==null?null:ve(J,G,re,Te,null);vd(J,re)}return null}function Ve(J,G,re,Te,He){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return J=J.get(re)||null,U(G,J,""+Te,He);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case F:return J=J.get(Te.key===null?re:Te.key)||null,K(G,J,Te,He);case H:return J=J.get(Te.key===null?re:Te.key)||null,oe(G,J,Te,He);case q:var Ye=Te._init;return Ve(J,G,re,Ye(Te._payload),He)}if(pt(Te)||ne(Te))return J=J.get(re)||null,ve(G,J,Te,He,null);vd(G,Te)}return null}function ze(J,G,re,Te){for(var He=null,Ye=null,Je=G,ot=G=0,Yn=null;Je!==null&&ot<re.length;ot++){Je.index>ot?(Yn=Je,Je=null):Yn=Je.sibling;var Dt=ge(J,Je,re[ot],Te);if(Dt===null){Je===null&&(Je=Yn);break}i&&Je&&Dt.alternate===null&&a(J,Je),G=w(Dt,G,ot),Ye===null?He=Dt:Ye.sibling=Dt,Ye=Dt,Je=Yn}if(ot===re.length)return u(J,Je),en&&Wo(J,ot),He;if(Je===null){for(;ot<re.length;ot++)Je=be(J,re[ot],Te),Je!==null&&(G=w(Je,G,ot),Ye===null?He=Je:Ye.sibling=Je,Ye=Je);return en&&Wo(J,ot),He}for(Je=p(J,Je);ot<re.length;ot++)Yn=Ve(Je,J,ot,re[ot],Te),Yn!==null&&(i&&Yn.alternate!==null&&Je.delete(Yn.key===null?ot:Yn.key),G=w(Yn,G,ot),Ye===null?He=Yn:Ye.sibling=Yn,Ye=Yn);return i&&Je.forEach(function(eo){return a(J,eo)}),en&&Wo(J,ot),He}function qe(J,G,re,Te){var He=ne(re);if(typeof He!="function")throw Error(n(150));if(re=He.call(re),re==null)throw Error(n(151));for(var Ye=He=null,Je=G,ot=G=0,Yn=null,Dt=re.next();Je!==null&&!Dt.done;ot++,Dt=re.next()){Je.index>ot?(Yn=Je,Je=null):Yn=Je.sibling;var eo=ge(J,Je,Dt.value,Te);if(eo===null){Je===null&&(Je=Yn);break}i&&Je&&eo.alternate===null&&a(J,Je),G=w(eo,G,ot),Ye===null?He=eo:Ye.sibling=eo,Ye=eo,Je=Yn}if(Dt.done)return u(J,Je),en&&Wo(J,ot),He;if(Je===null){for(;!Dt.done;ot++,Dt=re.next())Dt=be(J,Dt.value,Te),Dt!==null&&(G=w(Dt,G,ot),Ye===null?He=Dt:Ye.sibling=Dt,Ye=Dt);return en&&Wo(J,ot),He}for(Je=p(J,Je);!Dt.done;ot++,Dt=re.next())Dt=Ve(Je,J,ot,Dt.value,Te),Dt!==null&&(i&&Dt.alternate!==null&&Je.delete(Dt.key===null?ot:Dt.key),G=w(Dt,G,ot),Ye===null?He=Dt:Ye.sibling=Dt,Ye=Dt);return i&&Je.forEach(function(nR){return a(J,nR)}),en&&Wo(J,ot),He}function In(J,G,re,Te){if(typeof re=="object"&&re!==null&&re.type===A&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case F:e:{for(var He=re.key,Ye=G;Ye!==null;){if(Ye.key===He){if(He=re.type,He===A){if(Ye.tag===7){u(J,Ye.sibling),G=v(Ye,re.props.children),G.return=J,J=G;break e}}else if(Ye.elementType===He||typeof He=="object"&&He!==null&&He.$$typeof===q&&q_(He)===Ye.type){u(J,Ye.sibling),G=v(Ye,re.props),G.ref=vc(J,Ye,re),G.return=J,J=G;break e}u(J,Ye);break}else a(J,Ye);Ye=Ye.sibling}re.type===A?(G=Zo(re.props.children,J.mode,Te,re.key),G.return=J,J=G):(Te=$d(re.type,re.key,re.props,null,J.mode,Te),Te.ref=vc(J,G,re),Te.return=J,J=Te)}return R(J);case H:e:{for(Ye=re.key;G!==null;){if(G.key===Ye)if(G.tag===4&&G.stateNode.containerInfo===re.containerInfo&&G.stateNode.implementation===re.implementation){u(J,G.sibling),G=v(G,re.children||[]),G.return=J,J=G;break e}else{u(J,G);break}else a(J,G);G=G.sibling}G=ap(re,J.mode,Te),G.return=J,J=G}return R(J);case q:return Ye=re._init,In(J,G,Ye(re._payload),Te)}if(pt(re))return ze(J,G,re,Te);if(ne(re))return qe(J,G,re,Te);vd(J,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,G!==null&&G.tag===6?(u(J,G.sibling),G=v(G,re),G.return=J,J=G):(u(J,G),G=op(re,J.mode,Te),G.return=J,J=G),R(J)):u(J,G)}return In}var Qa=W_(!0),H_=W_(!1),_d=zi(null),wd=null,Xa=null,gm=null;function ym(){gm=Xa=wd=null}function vm(i){var a=_d.current;Gt(_d),i._currentValue=a}function _m(i,a,u){for(;i!==null;){var p=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,p!==null&&(p.childLanes|=a)):p!==null&&(p.childLanes&a)!==a&&(p.childLanes|=a),i===u)break;i=i.return}}function Ya(i,a){wd=i,gm=Xa=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&a)!==0&&(Nr=!0),i.firstContext=null)}function ss(i){var a=i._currentValue;if(gm!==i)if(i={context:i,memoizedValue:a,next:null},Xa===null){if(wd===null)throw Error(n(308));Xa=i,wd.dependencies={lanes:0,firstContext:i}}else Xa=Xa.next=i;return a}var Ho=null;function wm(i){Ho===null?Ho=[i]:Ho.push(i)}function K_(i,a,u,p){var v=a.interleaved;return v===null?(u.next=u,wm(a)):(u.next=v.next,v.next=u),a.interleaved=u,mi(i,p)}function mi(i,a){i.lanes|=a;var u=i.alternate;for(u!==null&&(u.lanes|=a),u=i,i=i.return;i!==null;)i.childLanes|=a,u=i.alternate,u!==null&&(u.childLanes|=a),u=i,i=i.return;return u.tag===3?u.stateNode:null}var Hi=!1;function bm(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function G_(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function pi(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function Ki(i,a,u){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(Mt&2)!==0){var v=p.pending;return v===null?a.next=a:(a.next=v.next,v.next=a),p.pending=a,mi(i,u)}return v=p.interleaved,v===null?(a.next=a,wm(p)):(a.next=v.next,v.next=a),p.interleaved=a,mi(i,u)}function bd(i,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194240)!==0)){var p=a.lanes;p&=i.pendingLanes,u|=p,a.lanes=u,Zl(i,u)}}function Q_(i,a){var u=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var v=null,w=null;if(u=u.firstBaseUpdate,u!==null){do{var R={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};w===null?v=w=R:w=w.next=R,u=u.next}while(u!==null);w===null?v=w=a:w=w.next=a}else v=w=a;u={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:w,shared:p.shared,effects:p.effects},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=a:i.next=a,u.lastBaseUpdate=a}function xd(i,a,u,p){var v=i.updateQueue;Hi=!1;var w=v.firstBaseUpdate,R=v.lastBaseUpdate,U=v.shared.pending;if(U!==null){v.shared.pending=null;var K=U,oe=K.next;K.next=null,R===null?w=oe:R.next=oe,R=K;var ve=i.alternate;ve!==null&&(ve=ve.updateQueue,U=ve.lastBaseUpdate,U!==R&&(U===null?ve.firstBaseUpdate=oe:U.next=oe,ve.lastBaseUpdate=K))}if(w!==null){var be=v.baseState;R=0,ve=oe=K=null,U=w;do{var ge=U.lane,Ve=U.eventTime;if((p&ge)===ge){ve!==null&&(ve=ve.next={eventTime:Ve,lane:0,tag:U.tag,payload:U.payload,callback:U.callback,next:null});e:{var ze=i,qe=U;switch(ge=a,Ve=u,qe.tag){case 1:if(ze=qe.payload,typeof ze=="function"){be=ze.call(Ve,be,ge);break e}be=ze;break e;case 3:ze.flags=ze.flags&-65537|128;case 0:if(ze=qe.payload,ge=typeof ze=="function"?ze.call(Ve,be,ge):ze,ge==null)break e;be=se({},be,ge);break e;case 2:Hi=!0}}U.callback!==null&&U.lane!==0&&(i.flags|=64,ge=v.effects,ge===null?v.effects=[U]:ge.push(U))}else Ve={eventTime:Ve,lane:ge,tag:U.tag,payload:U.payload,callback:U.callback,next:null},ve===null?(oe=ve=Ve,K=be):ve=ve.next=Ve,R|=ge;if(U=U.next,U===null){if(U=v.shared.pending,U===null)break;ge=U,U=ge.next,ge.next=null,v.lastBaseUpdate=ge,v.shared.pending=null}}while(!0);if(ve===null&&(K=be),v.baseState=K,v.firstBaseUpdate=oe,v.lastBaseUpdate=ve,a=v.shared.interleaved,a!==null){v=a;do R|=v.lane,v=v.next;while(v!==a)}else w===null&&(v.shared.lanes=0);Qo|=R,i.lanes=R,i.memoizedState=be}}function X_(i,a,u){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var p=i[a],v=p.callback;if(v!==null){if(p.callback=null,p=u,typeof v!="function")throw Error(n(191,v));v.call(p)}}}var _c={},zs=zi(_c),wc=zi(_c),bc=zi(_c);function Ko(i){if(i===_c)throw Error(n(174));return i}function xm(i,a){switch(zt(bc,a),zt(wc,i),zt(zs,_c),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Sr(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=Sr(a,i)}Gt(zs),zt(zs,a)}function Ja(){Gt(zs),Gt(wc),Gt(bc)}function Y_(i){Ko(bc.current);var a=Ko(zs.current),u=Sr(a,i.type);a!==u&&(zt(wc,i),zt(zs,u))}function Tm(i){wc.current===i&&(Gt(zs),Gt(wc))}var on=zi(0);function Td(i){for(var a=i;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Em=[];function Im(){for(var i=0;i<Em.length;i++)Em[i]._workInProgressVersionPrimary=null;Em.length=0}var Ed=$.ReactCurrentDispatcher,Sm=$.ReactCurrentBatchConfig,Go=0,an=null,$n=null,Qn=null,Id=!1,xc=!1,Tc=0,E1=0;function mr(){throw Error(n(321))}function Cm(i,a){if(a===null)return!1;for(var u=0;u<a.length&&u<i.length;u++)if(!fs(i[u],a[u]))return!1;return!0}function Am(i,a,u,p,v,w){if(Go=w,an=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Ed.current=i===null||i.memoizedState===null?A1:R1,i=u(p,v),xc){w=0;do{if(xc=!1,Tc=0,25<=w)throw Error(n(301));w+=1,Qn=$n=null,a.updateQueue=null,Ed.current=k1,i=u(p,v)}while(xc)}if(Ed.current=Ad,a=$n!==null&&$n.next!==null,Go=0,Qn=$n=an=null,Id=!1,a)throw Error(n(300));return i}function Rm(){var i=Tc!==0;return Tc=0,i}function qs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qn===null?an.memoizedState=Qn=i:Qn=Qn.next=i,Qn}function is(){if($n===null){var i=an.alternate;i=i!==null?i.memoizedState:null}else i=$n.next;var a=Qn===null?an.memoizedState:Qn.next;if(a!==null)Qn=a,$n=i;else{if(i===null)throw Error(n(310));$n=i,i={memoizedState:$n.memoizedState,baseState:$n.baseState,baseQueue:$n.baseQueue,queue:$n.queue,next:null},Qn===null?an.memoizedState=Qn=i:Qn=Qn.next=i}return Qn}function Ec(i,a){return typeof a=="function"?a(i):a}function km(i){var a=is(),u=a.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=i;var p=$n,v=p.baseQueue,w=u.pending;if(w!==null){if(v!==null){var R=v.next;v.next=w.next,w.next=R}p.baseQueue=v=w,u.pending=null}if(v!==null){w=v.next,p=p.baseState;var U=R=null,K=null,oe=w;do{var ve=oe.lane;if((Go&ve)===ve)K!==null&&(K=K.next={lane:0,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),p=oe.hasEagerState?oe.eagerState:i(p,oe.action);else{var be={lane:ve,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null};K===null?(U=K=be,R=p):K=K.next=be,an.lanes|=ve,Qo|=ve}oe=oe.next}while(oe!==null&&oe!==w);K===null?R=p:K.next=U,fs(p,a.memoizedState)||(Nr=!0),a.memoizedState=p,a.baseState=R,a.baseQueue=K,u.lastRenderedState=p}if(i=u.interleaved,i!==null){v=i;do w=v.lane,an.lanes|=w,Qo|=w,v=v.next;while(v!==i)}else v===null&&(u.lanes=0);return[a.memoizedState,u.dispatch]}function Pm(i){var a=is(),u=a.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=i;var p=u.dispatch,v=u.pending,w=a.memoizedState;if(v!==null){u.pending=null;var R=v=v.next;do w=i(w,R.action),R=R.next;while(R!==v);fs(w,a.memoizedState)||(Nr=!0),a.memoizedState=w,a.baseQueue===null&&(a.baseState=w),u.lastRenderedState=w}return[w,p]}function J_(){}function Z_(i,a){var u=an,p=is(),v=a(),w=!fs(p.memoizedState,v);if(w&&(p.memoizedState=v,Nr=!0),p=p.queue,jm(n0.bind(null,u,p,i),[i]),p.getSnapshot!==a||w||Qn!==null&&Qn.memoizedState.tag&1){if(u.flags|=2048,Ic(9,t0.bind(null,u,p,v,a),void 0,null),Xn===null)throw Error(n(349));(Go&30)!==0||e0(u,a,v)}return v}function e0(i,a,u){i.flags|=16384,i={getSnapshot:a,value:u},a=an.updateQueue,a===null?(a={lastEffect:null,stores:null},an.updateQueue=a,a.stores=[i]):(u=a.stores,u===null?a.stores=[i]:u.push(i))}function t0(i,a,u,p){a.value=u,a.getSnapshot=p,r0(a)&&s0(i)}function n0(i,a,u){return u(function(){r0(a)&&s0(i)})}function r0(i){var a=i.getSnapshot;i=i.value;try{var u=a();return!fs(i,u)}catch{return!0}}function s0(i){var a=mi(i,1);a!==null&&vs(a,i,1,-1)}function i0(i){var a=qs();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ec,lastRenderedState:i},a.queue=i,i=i.dispatch=C1.bind(null,an,i),[a.memoizedState,i]}function Ic(i,a,u,p){return i={tag:i,create:a,destroy:u,deps:p,next:null},a=an.updateQueue,a===null?(a={lastEffect:null,stores:null},an.updateQueue=a,a.lastEffect=i.next=i):(u=a.lastEffect,u===null?a.lastEffect=i.next=i:(p=u.next,u.next=i,i.next=p,a.lastEffect=i)),i}function o0(){return is().memoizedState}function Sd(i,a,u,p){var v=qs();an.flags|=i,v.memoizedState=Ic(1|a,u,void 0,p===void 0?null:p)}function Cd(i,a,u,p){var v=is();p=p===void 0?null:p;var w=void 0;if($n!==null){var R=$n.memoizedState;if(w=R.destroy,p!==null&&Cm(p,R.deps)){v.memoizedState=Ic(a,u,w,p);return}}an.flags|=i,v.memoizedState=Ic(1|a,u,w,p)}function a0(i,a){return Sd(8390656,8,i,a)}function jm(i,a){return Cd(2048,8,i,a)}function l0(i,a){return Cd(4,2,i,a)}function c0(i,a){return Cd(4,4,i,a)}function u0(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function d0(i,a,u){return u=u!=null?u.concat([i]):null,Cd(4,4,u0.bind(null,a,i),u)}function Nm(){}function h0(i,a){var u=is();a=a===void 0?null:a;var p=u.memoizedState;return p!==null&&a!==null&&Cm(a,p[1])?p[0]:(u.memoizedState=[i,a],i)}function f0(i,a){var u=is();a=a===void 0?null:a;var p=u.memoizedState;return p!==null&&a!==null&&Cm(a,p[1])?p[0]:(i=i(),u.memoizedState=[i,a],i)}function m0(i,a,u){return(Go&21)===0?(i.baseState&&(i.baseState=!1,Nr=!0),i.memoizedState=u):(fs(u,a)||(u=Yl(),an.lanes|=u,Qo|=u,i.baseState=!0),a)}function I1(i,a){var u=Tt;Tt=u!==0&&4>u?u:4,i(!0);var p=Sm.transition;Sm.transition={};try{i(!1),a()}finally{Tt=u,Sm.transition=p}}function p0(){return is().memoizedState}function S1(i,a,u){var p=Yi(i);if(u={lane:p,action:u,hasEagerState:!1,eagerState:null,next:null},g0(i))y0(a,u);else if(u=K_(i,a,u,p),u!==null){var v=Ar();vs(u,i,p,v),v0(u,a,p)}}function C1(i,a,u){var p=Yi(i),v={lane:p,action:u,hasEagerState:!1,eagerState:null,next:null};if(g0(i))y0(a,v);else{var w=i.alternate;if(i.lanes===0&&(w===null||w.lanes===0)&&(w=a.lastRenderedReducer,w!==null))try{var R=a.lastRenderedState,U=w(R,u);if(v.hasEagerState=!0,v.eagerState=U,fs(U,R)){var K=a.interleaved;K===null?(v.next=v,wm(a)):(v.next=K.next,K.next=v),a.interleaved=v;return}}catch{}u=K_(i,a,v,p),u!==null&&(v=Ar(),vs(u,i,p,v),v0(u,a,p))}}function g0(i){var a=i.alternate;return i===an||a!==null&&a===an}function y0(i,a){xc=Id=!0;var u=i.pending;u===null?a.next=a:(a.next=u.next,u.next=a),i.pending=a}function v0(i,a,u){if((u&4194240)!==0){var p=a.lanes;p&=i.pendingLanes,u|=p,a.lanes=u,Zl(i,u)}}var Ad={readContext:ss,useCallback:mr,useContext:mr,useEffect:mr,useImperativeHandle:mr,useInsertionEffect:mr,useLayoutEffect:mr,useMemo:mr,useReducer:mr,useRef:mr,useState:mr,useDebugValue:mr,useDeferredValue:mr,useTransition:mr,useMutableSource:mr,useSyncExternalStore:mr,useId:mr,unstable_isNewReconciler:!1},A1={readContext:ss,useCallback:function(i,a){return qs().memoizedState=[i,a===void 0?null:a],i},useContext:ss,useEffect:a0,useImperativeHandle:function(i,a,u){return u=u!=null?u.concat([i]):null,Sd(4194308,4,u0.bind(null,a,i),u)},useLayoutEffect:function(i,a){return Sd(4194308,4,i,a)},useInsertionEffect:function(i,a){return Sd(4,2,i,a)},useMemo:function(i,a){var u=qs();return a=a===void 0?null:a,i=i(),u.memoizedState=[i,a],i},useReducer:function(i,a,u){var p=qs();return a=u!==void 0?u(a):a,p.memoizedState=p.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},p.queue=i,i=i.dispatch=S1.bind(null,an,i),[p.memoizedState,i]},useRef:function(i){var a=qs();return i={current:i},a.memoizedState=i},useState:i0,useDebugValue:Nm,useDeferredValue:function(i){return qs().memoizedState=i},useTransition:function(){var i=i0(!1),a=i[0];return i=I1.bind(null,i[1]),qs().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,u){var p=an,v=qs();if(en){if(u===void 0)throw Error(n(407));u=u()}else{if(u=a(),Xn===null)throw Error(n(349));(Go&30)!==0||e0(p,a,u)}v.memoizedState=u;var w={value:u,getSnapshot:a};return v.queue=w,a0(n0.bind(null,p,w,i),[i]),p.flags|=2048,Ic(9,t0.bind(null,p,w,u,a),void 0,null),u},useId:function(){var i=qs(),a=Xn.identifierPrefix;if(en){var u=fi,p=hi;u=(p&~(1<<32-Zt(p)-1)).toString(32)+u,a=":"+a+"R"+u,u=Tc++,0<u&&(a+="H"+u.toString(32)),a+=":"}else u=E1++,a=":"+a+"r"+u.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},R1={readContext:ss,useCallback:h0,useContext:ss,useEffect:jm,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:f0,useReducer:km,useRef:o0,useState:function(){return km(Ec)},useDebugValue:Nm,useDeferredValue:function(i){var a=is();return m0(a,$n.memoizedState,i)},useTransition:function(){var i=km(Ec)[0],a=is().memoizedState;return[i,a]},useMutableSource:J_,useSyncExternalStore:Z_,useId:p0,unstable_isNewReconciler:!1},k1={readContext:ss,useCallback:h0,useContext:ss,useEffect:jm,useImperativeHandle:d0,useInsertionEffect:l0,useLayoutEffect:c0,useMemo:f0,useReducer:Pm,useRef:o0,useState:function(){return Pm(Ec)},useDebugValue:Nm,useDeferredValue:function(i){var a=is();return $n===null?a.memoizedState=i:m0(a,$n.memoizedState,i)},useTransition:function(){var i=Pm(Ec)[0],a=is().memoizedState;return[i,a]},useMutableSource:J_,useSyncExternalStore:Z_,useId:p0,unstable_isNewReconciler:!1};function ps(i,a){if(i&&i.defaultProps){a=se({},a),i=i.defaultProps;for(var u in i)a[u]===void 0&&(a[u]=i[u]);return a}return a}function Mm(i,a,u,p){a=i.memoizedState,u=u(p,a),u=u==null?a:se({},a,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Rd={isMounted:function(i){return(i=i._reactInternals)?rn(i)===i:!1},enqueueSetState:function(i,a,u){i=i._reactInternals;var p=Ar(),v=Yi(i),w=pi(p,v);w.payload=a,u!=null&&(w.callback=u),a=Ki(i,w,v),a!==null&&(vs(a,i,v,p),bd(a,i,v))},enqueueReplaceState:function(i,a,u){i=i._reactInternals;var p=Ar(),v=Yi(i),w=pi(p,v);w.tag=1,w.payload=a,u!=null&&(w.callback=u),a=Ki(i,w,v),a!==null&&(vs(a,i,v,p),bd(a,i,v))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var u=Ar(),p=Yi(i),v=pi(u,p);v.tag=2,a!=null&&(v.callback=a),a=Ki(i,v,p),a!==null&&(vs(a,i,p,u),bd(a,i,p))}};function _0(i,a,u,p,v,w,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,w,R):a.prototype&&a.prototype.isPureReactComponent?!dc(u,p)||!dc(v,w):!0}function w0(i,a,u){var p=!1,v=qi,w=a.contextType;return typeof w=="object"&&w!==null?w=ss(w):(v=jr(a)?zo:fr.current,p=a.contextTypes,w=(p=p!=null)?Wa(i,v):qi),a=new a(u,w),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Rd,i.stateNode=a,a._reactInternals=i,p&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=v,i.__reactInternalMemoizedMaskedChildContext=w),a}function b0(i,a,u,p){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,p),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,p),a.state!==i&&Rd.enqueueReplaceState(a,a.state,null)}function Dm(i,a,u,p){var v=i.stateNode;v.props=u,v.state=i.memoizedState,v.refs={},bm(i);var w=a.contextType;typeof w=="object"&&w!==null?v.context=ss(w):(w=jr(a)?zo:fr.current,v.context=Wa(i,w)),v.state=i.memoizedState,w=a.getDerivedStateFromProps,typeof w=="function"&&(Mm(i,a,w,u),v.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(a=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),a!==v.state&&Rd.enqueueReplaceState(v,v.state,null),xd(i,u,v,p),v.state=i.memoizedState),typeof v.componentDidMount=="function"&&(i.flags|=4194308)}function Za(i,a){try{var u="",p=a;do u+=Se(p),p=p.return;while(p);var v=u}catch(w){v=`
Error generating stack: `+w.message+`
`+w.stack}return{value:i,source:a,stack:v,digest:null}}function Lm(i,a,u){return{value:i,source:null,stack:u??null,digest:a??null}}function Vm(i,a){try{console.error(a.value)}catch(u){setTimeout(function(){throw u})}}var P1=typeof WeakMap=="function"?WeakMap:Map;function x0(i,a,u){u=pi(-1,u),u.tag=3,u.payload={element:null};var p=a.value;return u.callback=function(){Ld||(Ld=!0,Jm=p),Vm(i,a)},u}function T0(i,a,u){u=pi(-1,u),u.tag=3;var p=i.type.getDerivedStateFromError;if(typeof p=="function"){var v=a.value;u.payload=function(){return p(v)},u.callback=function(){Vm(i,a)}}var w=i.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(u.callback=function(){Vm(i,a),typeof p!="function"&&(Qi===null?Qi=new Set([this]):Qi.add(this));var R=a.stack;this.componentDidCatch(a.value,{componentStack:R!==null?R:""})}),u}function E0(i,a,u){var p=i.pingCache;if(p===null){p=i.pingCache=new P1;var v=new Set;p.set(a,v)}else v=p.get(a),v===void 0&&(v=new Set,p.set(a,v));v.has(u)||(v.add(u),i=W1.bind(null,i,a,u),a.then(i,i))}function I0(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function S0(i,a,u,p,v){return(i.mode&1)===0?(i===a?i.flags|=65536:(i.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(a=pi(-1,1),a.tag=2,Ki(u,a,1))),u.lanes|=1),i):(i.flags|=65536,i.lanes=v,i)}var j1=$.ReactCurrentOwner,Nr=!1;function Cr(i,a,u,p){a.child=i===null?H_(a,null,u,p):Qa(a,i.child,u,p)}function C0(i,a,u,p,v){u=u.render;var w=a.ref;return Ya(a,v),p=Am(i,a,u,p,w,v),u=Rm(),i!==null&&!Nr?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~v,gi(i,a,v)):(en&&u&&dm(a),a.flags|=1,Cr(i,a,p,v),a.child)}function A0(i,a,u,p,v){if(i===null){var w=u.type;return typeof w=="function"&&!ip(w)&&w.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(a.tag=15,a.type=w,R0(i,a,w,p,v)):(i=$d(u.type,null,p,a,a.mode,v),i.ref=a.ref,i.return=a,a.child=i)}if(w=i.child,(i.lanes&v)===0){var R=w.memoizedProps;if(u=u.compare,u=u!==null?u:dc,u(R,p)&&i.ref===a.ref)return gi(i,a,v)}return a.flags|=1,i=Zi(w,p),i.ref=a.ref,i.return=a,a.child=i}function R0(i,a,u,p,v){if(i!==null){var w=i.memoizedProps;if(dc(w,p)&&i.ref===a.ref)if(Nr=!1,a.pendingProps=p=w,(i.lanes&v)!==0)(i.flags&131072)!==0&&(Nr=!0);else return a.lanes=i.lanes,gi(i,a,v)}return Om(i,a,u,p,v)}function k0(i,a,u){var p=a.pendingProps,v=p.children,w=i!==null?i.memoizedState:null;if(p.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(tl,Gr),Gr|=u;else{if((u&1073741824)===0)return i=w!==null?w.baseLanes|u:u,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,zt(tl,Gr),Gr|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=w!==null?w.baseLanes:u,zt(tl,Gr),Gr|=p}else w!==null?(p=w.baseLanes|u,a.memoizedState=null):p=u,zt(tl,Gr),Gr|=p;return Cr(i,a,v,u),a.child}function P0(i,a){var u=a.ref;(i===null&&u!==null||i!==null&&i.ref!==u)&&(a.flags|=512,a.flags|=2097152)}function Om(i,a,u,p,v){var w=jr(u)?zo:fr.current;return w=Wa(a,w),Ya(a,v),u=Am(i,a,u,p,w,v),p=Rm(),i!==null&&!Nr?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~v,gi(i,a,v)):(en&&p&&dm(a),a.flags|=1,Cr(i,a,u,v),a.child)}function j0(i,a,u,p,v){if(jr(u)){var w=!0;fd(a)}else w=!1;if(Ya(a,v),a.stateNode===null)Pd(i,a),w0(a,u,p),Dm(a,u,p,v),p=!0;else if(i===null){var R=a.stateNode,U=a.memoizedProps;R.props=U;var K=R.context,oe=u.contextType;typeof oe=="object"&&oe!==null?oe=ss(oe):(oe=jr(u)?zo:fr.current,oe=Wa(a,oe));var ve=u.getDerivedStateFromProps,be=typeof ve=="function"||typeof R.getSnapshotBeforeUpdate=="function";be||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(U!==p||K!==oe)&&b0(a,R,p,oe),Hi=!1;var ge=a.memoizedState;R.state=ge,xd(a,p,R,v),K=a.memoizedState,U!==p||ge!==K||Pr.current||Hi?(typeof ve=="function"&&(Mm(a,u,ve,p),K=a.memoizedState),(U=Hi||_0(a,u,U,p,ge,K,oe))?(be||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(a.flags|=4194308)):(typeof R.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=p,a.memoizedState=K),R.props=p,R.state=K,R.context=oe,p=U):(typeof R.componentDidMount=="function"&&(a.flags|=4194308),p=!1)}else{R=a.stateNode,G_(i,a),U=a.memoizedProps,oe=a.type===a.elementType?U:ps(a.type,U),R.props=oe,be=a.pendingProps,ge=R.context,K=u.contextType,typeof K=="object"&&K!==null?K=ss(K):(K=jr(u)?zo:fr.current,K=Wa(a,K));var Ve=u.getDerivedStateFromProps;(ve=typeof Ve=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(U!==be||ge!==K)&&b0(a,R,p,K),Hi=!1,ge=a.memoizedState,R.state=ge,xd(a,p,R,v);var ze=a.memoizedState;U!==be||ge!==ze||Pr.current||Hi?(typeof Ve=="function"&&(Mm(a,u,Ve,p),ze=a.memoizedState),(oe=Hi||_0(a,u,oe,p,ge,ze,K)||!1)?(ve||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(p,ze,K),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(p,ze,K)),typeof R.componentDidUpdate=="function"&&(a.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof R.componentDidUpdate!="function"||U===i.memoizedProps&&ge===i.memoizedState||(a.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||U===i.memoizedProps&&ge===i.memoizedState||(a.flags|=1024),a.memoizedProps=p,a.memoizedState=ze),R.props=p,R.state=ze,R.context=K,p=oe):(typeof R.componentDidUpdate!="function"||U===i.memoizedProps&&ge===i.memoizedState||(a.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||U===i.memoizedProps&&ge===i.memoizedState||(a.flags|=1024),p=!1)}return Fm(i,a,u,p,w,v)}function Fm(i,a,u,p,v,w){P0(i,a);var R=(a.flags&128)!==0;if(!p&&!R)return v&&V_(a,u,!1),gi(i,a,w);p=a.stateNode,j1.current=a;var U=R&&typeof u.getDerivedStateFromError!="function"?null:p.render();return a.flags|=1,i!==null&&R?(a.child=Qa(a,i.child,null,w),a.child=Qa(a,null,U,w)):Cr(i,a,U,w),a.memoizedState=p.state,v&&V_(a,u,!0),a.child}function N0(i){var a=i.stateNode;a.pendingContext?D_(i,a.pendingContext,a.pendingContext!==a.context):a.context&&D_(i,a.context,!1),xm(i,a.containerInfo)}function M0(i,a,u,p,v){return Ga(),pm(v),a.flags|=256,Cr(i,a,u,p),a.child}var Bm={dehydrated:null,treeContext:null,retryLane:0};function Um(i){return{baseLanes:i,cachePool:null,transitions:null}}function D0(i,a,u){var p=a.pendingProps,v=on.current,w=!1,R=(a.flags&128)!==0,U;if((U=R)||(U=i!==null&&i.memoizedState===null?!1:(v&2)!==0),U?(w=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(v|=1),zt(on,v&1),i===null)return mm(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((a.mode&1)===0?a.lanes=1:i.data==="$!"?a.lanes=8:a.lanes=1073741824,null):(R=p.children,i=p.fallback,w?(p=a.mode,w=a.child,R={mode:"hidden",children:R},(p&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=R):w=zd(R,p,0,null),i=Zo(i,p,u,null),w.return=a,i.return=a,w.sibling=i,a.child=w,a.child.memoizedState=Um(u),a.memoizedState=Bm,i):$m(a,R));if(v=i.memoizedState,v!==null&&(U=v.dehydrated,U!==null))return N1(i,a,R,p,U,v,u);if(w){w=p.fallback,R=a.mode,v=i.child,U=v.sibling;var K={mode:"hidden",children:p.children};return(R&1)===0&&a.child!==v?(p=a.child,p.childLanes=0,p.pendingProps=K,a.deletions=null):(p=Zi(v,K),p.subtreeFlags=v.subtreeFlags&14680064),U!==null?w=Zi(U,w):(w=Zo(w,R,u,null),w.flags|=2),w.return=a,p.return=a,p.sibling=w,a.child=p,p=w,w=a.child,R=i.child.memoizedState,R=R===null?Um(u):{baseLanes:R.baseLanes|u,cachePool:null,transitions:R.transitions},w.memoizedState=R,w.childLanes=i.childLanes&~u,a.memoizedState=Bm,p}return w=i.child,i=w.sibling,p=Zi(w,{mode:"visible",children:p.children}),(a.mode&1)===0&&(p.lanes=u),p.return=a,p.sibling=null,i!==null&&(u=a.deletions,u===null?(a.deletions=[i],a.flags|=16):u.push(i)),a.child=p,a.memoizedState=null,p}function $m(i,a){return a=zd({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function kd(i,a,u,p){return p!==null&&pm(p),Qa(a,i.child,null,u),i=$m(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function N1(i,a,u,p,v,w,R){if(u)return a.flags&256?(a.flags&=-257,p=Lm(Error(n(422))),kd(i,a,R,p)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(w=p.fallback,v=a.mode,p=zd({mode:"visible",children:p.children},v,0,null),w=Zo(w,v,R,null),w.flags|=2,p.return=a,w.return=a,p.sibling=w,a.child=p,(a.mode&1)!==0&&Qa(a,i.child,null,R),a.child.memoizedState=Um(R),a.memoizedState=Bm,w);if((a.mode&1)===0)return kd(i,a,R,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var U=p.dgst;return p=U,w=Error(n(419)),p=Lm(w,p,void 0),kd(i,a,R,p)}if(U=(R&i.childLanes)!==0,Nr||U){if(p=Xn,p!==null){switch(R&-R){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=(v&(p.suspendedLanes|R))!==0?0:v,v!==0&&v!==w.retryLane&&(w.retryLane=v,mi(i,v),vs(p,i,v,-1))}return sp(),p=Lm(Error(n(421))),kd(i,a,R,p)}return v.data==="$?"?(a.flags|=128,a.child=i.child,a=H1.bind(null,i),v._reactRetry=a,null):(i=w.treeContext,Kr=$i(v.nextSibling),Hr=a,en=!0,ms=null,i!==null&&(ns[rs++]=hi,ns[rs++]=fi,ns[rs++]=qo,hi=i.id,fi=i.overflow,qo=a),a=$m(a,p.children),a.flags|=4096,a)}function L0(i,a,u){i.lanes|=a;var p=i.alternate;p!==null&&(p.lanes|=a),_m(i.return,a,u)}function zm(i,a,u,p,v){var w=i.memoizedState;w===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:v}:(w.isBackwards=a,w.rendering=null,w.renderingStartTime=0,w.last=p,w.tail=u,w.tailMode=v)}function V0(i,a,u){var p=a.pendingProps,v=p.revealOrder,w=p.tail;if(Cr(i,a,p.children,u),p=on.current,(p&2)!==0)p=p&1|2,a.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&L0(i,u,a);else if(i.tag===19)L0(i,u,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}p&=1}if(zt(on,p),(a.mode&1)===0)a.memoizedState=null;else switch(v){case"forwards":for(u=a.child,v=null;u!==null;)i=u.alternate,i!==null&&Td(i)===null&&(v=u),u=u.sibling;u=v,u===null?(v=a.child,a.child=null):(v=u.sibling,u.sibling=null),zm(a,!1,v,u,w);break;case"backwards":for(u=null,v=a.child,a.child=null;v!==null;){if(i=v.alternate,i!==null&&Td(i)===null){a.child=v;break}i=v.sibling,v.sibling=u,u=v,v=i}zm(a,!0,u,null,w);break;case"together":zm(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Pd(i,a){(a.mode&1)===0&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function gi(i,a,u){if(i!==null&&(a.dependencies=i.dependencies),Qo|=a.lanes,(u&a.childLanes)===0)return null;if(i!==null&&a.child!==i.child)throw Error(n(153));if(a.child!==null){for(i=a.child,u=Zi(i,i.pendingProps),a.child=u,u.return=a;i.sibling!==null;)i=i.sibling,u=u.sibling=Zi(i,i.pendingProps),u.return=a;u.sibling=null}return a.child}function M1(i,a,u){switch(a.tag){case 3:N0(a),Ga();break;case 5:Y_(a);break;case 1:jr(a.type)&&fd(a);break;case 4:xm(a,a.stateNode.containerInfo);break;case 10:var p=a.type._context,v=a.memoizedProps.value;zt(_d,p._currentValue),p._currentValue=v;break;case 13:if(p=a.memoizedState,p!==null)return p.dehydrated!==null?(zt(on,on.current&1),a.flags|=128,null):(u&a.child.childLanes)!==0?D0(i,a,u):(zt(on,on.current&1),i=gi(i,a,u),i!==null?i.sibling:null);zt(on,on.current&1);break;case 19:if(p=(u&a.childLanes)!==0,(i.flags&128)!==0){if(p)return V0(i,a,u);a.flags|=128}if(v=a.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),zt(on,on.current),p)break;return null;case 22:case 23:return a.lanes=0,k0(i,a,u)}return gi(i,a,u)}var O0,qm,F0,B0;O0=function(i,a){for(var u=a.child;u!==null;){if(u.tag===5||u.tag===6)i.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return;u=u.return}u.sibling.return=u.return,u=u.sibling}},qm=function(){},F0=function(i,a,u,p){var v=i.memoizedProps;if(v!==p){i=a.stateNode,Ko(zs.current);var w=null;switch(u){case"input":v=Ir(i,v),p=Ir(i,p),w=[];break;case"select":v=se({},v,{value:void 0}),p=se({},p,{value:void 0}),w=[];break;case"textarea":v=Ne(i,v),p=Ne(i,p),w=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(i.onclick=ud)}Xe(u,p);var R;u=null;for(oe in v)if(!p.hasOwnProperty(oe)&&v.hasOwnProperty(oe)&&v[oe]!=null)if(oe==="style"){var U=v[oe];for(R in U)U.hasOwnProperty(R)&&(u||(u={}),u[R]="")}else oe!=="dangerouslySetInnerHTML"&&oe!=="children"&&oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&oe!=="autoFocus"&&(s.hasOwnProperty(oe)?w||(w=[]):(w=w||[]).push(oe,null));for(oe in p){var K=p[oe];if(U=v?.[oe],p.hasOwnProperty(oe)&&K!==U&&(K!=null||U!=null))if(oe==="style")if(U){for(R in U)!U.hasOwnProperty(R)||K&&K.hasOwnProperty(R)||(u||(u={}),u[R]="");for(R in K)K.hasOwnProperty(R)&&U[R]!==K[R]&&(u||(u={}),u[R]=K[R])}else u||(w||(w=[]),w.push(oe,u)),u=K;else oe==="dangerouslySetInnerHTML"?(K=K?K.__html:void 0,U=U?U.__html:void 0,K!=null&&U!==K&&(w=w||[]).push(oe,K)):oe==="children"?typeof K!="string"&&typeof K!="number"||(w=w||[]).push(oe,""+K):oe!=="suppressContentEditableWarning"&&oe!=="suppressHydrationWarning"&&(s.hasOwnProperty(oe)?(K!=null&&oe==="onScroll"&&Kt("scroll",i),w||U===K||(w=[])):(w=w||[]).push(oe,K))}u&&(w=w||[]).push("style",u);var oe=w;(a.updateQueue=oe)&&(a.flags|=4)}},B0=function(i,a,u,p){u!==p&&(a.flags|=4)};function Sc(i,a){if(!en)switch(i.tailMode){case"hidden":a=i.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function pr(i){var a=i.alternate!==null&&i.alternate.child===i.child,u=0,p=0;if(a)for(var v=i.child;v!==null;)u|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=i,v=v.sibling;else for(v=i.child;v!==null;)u|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=i,v=v.sibling;return i.subtreeFlags|=p,i.childLanes=u,a}function D1(i,a,u){var p=a.pendingProps;switch(hm(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pr(a),null;case 1:return jr(a.type)&&hd(),pr(a),null;case 3:return p=a.stateNode,Ja(),Gt(Pr),Gt(fr),Im(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(i===null||i.child===null)&&(yd(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,ms!==null&&(tp(ms),ms=null))),qm(i,a),pr(a),null;case 5:Tm(a);var v=Ko(bc.current);if(u=a.type,i!==null&&a.stateNode!=null)F0(i,a,u,p,v),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!p){if(a.stateNode===null)throw Error(n(166));return pr(a),null}if(i=Ko(zs.current),yd(a)){p=a.stateNode,u=a.type;var w=a.memoizedProps;switch(p[$s]=a,p[gc]=w,i=(a.mode&1)!==0,u){case"dialog":Kt("cancel",p),Kt("close",p);break;case"iframe":case"object":case"embed":Kt("load",p);break;case"video":case"audio":for(v=0;v<fc.length;v++)Kt(fc[v],p);break;case"source":Kt("error",p);break;case"img":case"image":case"link":Kt("error",p),Kt("load",p);break;case"details":Kt("toggle",p);break;case"input":ce(p,w),Kt("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!w.multiple},Kt("invalid",p);break;case"textarea":Ke(p,w),Kt("invalid",p)}Xe(u,w),v=null;for(var R in w)if(w.hasOwnProperty(R)){var U=w[R];R==="children"?typeof U=="string"?p.textContent!==U&&(w.suppressHydrationWarning!==!0&&cd(p.textContent,U,i),v=["children",U]):typeof U=="number"&&p.textContent!==""+U&&(w.suppressHydrationWarning!==!0&&cd(p.textContent,U,i),v=["children",""+U]):s.hasOwnProperty(R)&&U!=null&&R==="onScroll"&&Kt("scroll",p)}switch(u){case"input":Wt(p),Rt(p,w,!0);break;case"textarea":Wt(p),it(p);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(p.onclick=ud)}p=v,a.updateQueue=p,p!==null&&(a.flags|=4)}else{R=v.nodeType===9?v:v.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=_n(u)),i==="http://www.w3.org/1999/xhtml"?u==="script"?(i=R.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof p.is=="string"?i=R.createElement(u,{is:p.is}):(i=R.createElement(u),u==="select"&&(R=i,p.multiple?R.multiple=!0:p.size&&(R.size=p.size))):i=R.createElementNS(i,u),i[$s]=a,i[gc]=p,O0(i,a,!1,!1),a.stateNode=i;e:{switch(R=Kn(u,p),u){case"dialog":Kt("cancel",i),Kt("close",i),v=p;break;case"iframe":case"object":case"embed":Kt("load",i),v=p;break;case"video":case"audio":for(v=0;v<fc.length;v++)Kt(fc[v],i);v=p;break;case"source":Kt("error",i),v=p;break;case"img":case"image":case"link":Kt("error",i),Kt("load",i),v=p;break;case"details":Kt("toggle",i),v=p;break;case"input":ce(i,p),v=Ir(i,p),Kt("invalid",i);break;case"option":v=p;break;case"select":i._wrapperState={wasMultiple:!!p.multiple},v=se({},p,{value:void 0}),Kt("invalid",i);break;case"textarea":Ke(i,p),v=Ne(i,p),Kt("invalid",i);break;default:v=p}Xe(u,v),U=v;for(w in U)if(U.hasOwnProperty(w)){var K=U[w];w==="style"?Or(i,K):w==="dangerouslySetInnerHTML"?(K=K?K.__html:void 0,K!=null&&Yt(i,K)):w==="children"?typeof K=="string"?(u!=="textarea"||K!=="")&&Bt(i,K):typeof K=="number"&&Bt(i,""+K):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(s.hasOwnProperty(w)?K!=null&&w==="onScroll"&&Kt("scroll",i):K!=null&&V(i,w,K,R))}switch(u){case"input":Wt(i),Rt(i,p,!1);break;case"textarea":Wt(i),it(i);break;case"option":p.value!=null&&i.setAttribute("value",""+$e(p.value));break;case"select":i.multiple=!!p.multiple,w=p.value,w!=null?ye(i,!!p.multiple,w,!1):p.defaultValue!=null&&ye(i,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(i.onclick=ud)}switch(u){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return pr(a),null;case 6:if(i&&a.stateNode!=null)B0(i,a,i.memoizedProps,p);else{if(typeof p!="string"&&a.stateNode===null)throw Error(n(166));if(u=Ko(bc.current),Ko(zs.current),yd(a)){if(p=a.stateNode,u=a.memoizedProps,p[$s]=a,(w=p.nodeValue!==u)&&(i=Hr,i!==null))switch(i.tag){case 3:cd(p.nodeValue,u,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&cd(p.nodeValue,u,(i.mode&1)!==0)}w&&(a.flags|=4)}else p=(u.nodeType===9?u:u.ownerDocument).createTextNode(p),p[$s]=a,a.stateNode=p}return pr(a),null;case 13:if(Gt(on),p=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(en&&Kr!==null&&(a.mode&1)!==0&&(a.flags&128)===0)z_(),Ga(),a.flags|=98560,w=!1;else if(w=yd(a),p!==null&&p.dehydrated!==null){if(i===null){if(!w)throw Error(n(318));if(w=a.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(n(317));w[$s]=a}else Ga(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;pr(a),w=!1}else ms!==null&&(tp(ms),ms=null),w=!0;if(!w)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=u,a):(p=p!==null,p!==(i!==null&&i.memoizedState!==null)&&p&&(a.child.flags|=8192,(a.mode&1)!==0&&(i===null||(on.current&1)!==0?zn===0&&(zn=3):sp())),a.updateQueue!==null&&(a.flags|=4),pr(a),null);case 4:return Ja(),qm(i,a),i===null&&mc(a.stateNode.containerInfo),pr(a),null;case 10:return vm(a.type._context),pr(a),null;case 17:return jr(a.type)&&hd(),pr(a),null;case 19:if(Gt(on),w=a.memoizedState,w===null)return pr(a),null;if(p=(a.flags&128)!==0,R=w.rendering,R===null)if(p)Sc(w,!1);else{if(zn!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if(R=Td(i),R!==null){for(a.flags|=128,Sc(w,!1),p=R.updateQueue,p!==null&&(a.updateQueue=p,a.flags|=4),a.subtreeFlags=0,p=u,u=a.child;u!==null;)w=u,i=p,w.flags&=14680066,R=w.alternate,R===null?(w.childLanes=0,w.lanes=i,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=R.childLanes,w.lanes=R.lanes,w.child=R.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=R.memoizedProps,w.memoizedState=R.memoizedState,w.updateQueue=R.updateQueue,w.type=R.type,i=R.dependencies,w.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),u=u.sibling;return zt(on,on.current&1|2),a.child}i=i.sibling}w.tail!==null&&Pe()>nl&&(a.flags|=128,p=!0,Sc(w,!1),a.lanes=4194304)}else{if(!p)if(i=Td(R),i!==null){if(a.flags|=128,p=!0,u=i.updateQueue,u!==null&&(a.updateQueue=u,a.flags|=4),Sc(w,!0),w.tail===null&&w.tailMode==="hidden"&&!R.alternate&&!en)return pr(a),null}else 2*Pe()-w.renderingStartTime>nl&&u!==1073741824&&(a.flags|=128,p=!0,Sc(w,!1),a.lanes=4194304);w.isBackwards?(R.sibling=a.child,a.child=R):(u=w.last,u!==null?u.sibling=R:a.child=R,w.last=R)}return w.tail!==null?(a=w.tail,w.rendering=a,w.tail=a.sibling,w.renderingStartTime=Pe(),a.sibling=null,u=on.current,zt(on,p?u&1|2:u&1),a):(pr(a),null);case 22:case 23:return rp(),p=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==p&&(a.flags|=8192),p&&(a.mode&1)!==0?(Gr&1073741824)!==0&&(pr(a),a.subtreeFlags&6&&(a.flags|=8192)):pr(a),null;case 24:return null;case 25:return null}throw Error(n(156,a.tag))}function L1(i,a){switch(hm(a),a.tag){case 1:return jr(a.type)&&hd(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Ja(),Gt(Pr),Gt(fr),Im(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 5:return Tm(a),null;case 13:if(Gt(on),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(n(340));Ga()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return Gt(on),null;case 4:return Ja(),null;case 10:return vm(a.type._context),null;case 22:case 23:return rp(),null;case 24:return null;default:return null}}var jd=!1,gr=!1,V1=typeof WeakSet=="function"?WeakSet:Set,Ue=null;function el(i,a){var u=i.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(p){yn(i,a,p)}else u.current=null}function Wm(i,a,u){try{u()}catch(p){yn(i,a,p)}}var U0=!1;function O1(i,a){if(rm=ai,i=__(),Qf(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var v=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{u.nodeType,w.nodeType}catch{u=null;break e}var R=0,U=-1,K=-1,oe=0,ve=0,be=i,ge=null;t:for(;;){for(var Ve;be!==u||v!==0&&be.nodeType!==3||(U=R+v),be!==w||p!==0&&be.nodeType!==3||(K=R+p),be.nodeType===3&&(R+=be.nodeValue.length),(Ve=be.firstChild)!==null;)ge=be,be=Ve;for(;;){if(be===i)break t;if(ge===u&&++oe===v&&(U=R),ge===w&&++ve===p&&(K=R),(Ve=be.nextSibling)!==null)break;be=ge,ge=be.parentNode}be=Ve}u=U===-1||K===-1?null:{start:U,end:K}}else u=null}u=u||{start:0,end:0}}else u=null;for(sm={focusedElem:i,selectionRange:u},ai=!1,Ue=a;Ue!==null;)if(a=Ue,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,Ue=i;else for(;Ue!==null;){a=Ue;try{var ze=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(ze!==null){var qe=ze.memoizedProps,In=ze.memoizedState,J=a.stateNode,G=J.getSnapshotBeforeUpdate(a.elementType===a.type?qe:ps(a.type,qe),In);J.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var re=a.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Te){yn(a,a.return,Te)}if(i=a.sibling,i!==null){i.return=a.return,Ue=i;break}Ue=a.return}return ze=U0,U0=!1,ze}function Cc(i,a,u){var p=a.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&i)===i){var w=v.destroy;v.destroy=void 0,w!==void 0&&Wm(a,u,w)}v=v.next}while(v!==p)}}function Nd(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var u=a=a.next;do{if((u.tag&i)===i){var p=u.create;u.destroy=p()}u=u.next}while(u!==a)}}function Hm(i){var a=i.ref;if(a!==null){var u=i.stateNode;i.tag,i=u,typeof a=="function"?a(i):a.current=i}}function $0(i){var a=i.alternate;a!==null&&(i.alternate=null,$0(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[$s],delete a[gc],delete a[lm],delete a[w1],delete a[b1])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function z0(i){return i.tag===5||i.tag===3||i.tag===4}function q0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||z0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Km(i,a,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,a?u.nodeType===8?u.parentNode.insertBefore(i,a):u.insertBefore(i,a):(u.nodeType===8?(a=u.parentNode,a.insertBefore(i,u)):(a=u,a.appendChild(i)),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=ud));else if(p!==4&&(i=i.child,i!==null))for(Km(i,a,u),i=i.sibling;i!==null;)Km(i,a,u),i=i.sibling}function Gm(i,a,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,a?u.insertBefore(i,a):u.appendChild(i);else if(p!==4&&(i=i.child,i!==null))for(Gm(i,a,u),i=i.sibling;i!==null;)Gm(i,a,u),i=i.sibling}var sr=null,gs=!1;function Gi(i,a,u){for(u=u.child;u!==null;)W0(i,a,u),u=u.sibling}function W0(i,a,u){if(Nt&&typeof Nt.onCommitFiberUnmount=="function")try{Nt.onCommitFiberUnmount(lt,u)}catch{}switch(u.tag){case 5:gr||el(u,a);case 6:var p=sr,v=gs;sr=null,Gi(i,a,u),sr=p,gs=v,sr!==null&&(gs?(i=sr,u=u.stateNode,i.nodeType===8?i.parentNode.removeChild(u):i.removeChild(u)):sr.removeChild(u.stateNode));break;case 18:sr!==null&&(gs?(i=sr,u=u.stateNode,i.nodeType===8?am(i.parentNode,u):i.nodeType===1&&am(i,u),Oi(i)):am(sr,u.stateNode));break;case 4:p=sr,v=gs,sr=u.stateNode.containerInfo,gs=!0,Gi(i,a,u),sr=p,gs=v;break;case 0:case 11:case 14:case 15:if(!gr&&(p=u.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var w=v,R=w.destroy;w=w.tag,R!==void 0&&((w&2)!==0||(w&4)!==0)&&Wm(u,a,R),v=v.next}while(v!==p)}Gi(i,a,u);break;case 1:if(!gr&&(el(u,a),p=u.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=u.memoizedProps,p.state=u.memoizedState,p.componentWillUnmount()}catch(U){yn(u,a,U)}Gi(i,a,u);break;case 21:Gi(i,a,u);break;case 22:u.mode&1?(gr=(p=gr)||u.memoizedState!==null,Gi(i,a,u),gr=p):Gi(i,a,u);break;default:Gi(i,a,u)}}function H0(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var u=i.stateNode;u===null&&(u=i.stateNode=new V1),a.forEach(function(p){var v=K1.bind(null,i,p);u.has(p)||(u.add(p),p.then(v,v))})}}function ys(i,a){var u=a.deletions;if(u!==null)for(var p=0;p<u.length;p++){var v=u[p];try{var w=i,R=a,U=R;e:for(;U!==null;){switch(U.tag){case 5:sr=U.stateNode,gs=!1;break e;case 3:sr=U.stateNode.containerInfo,gs=!0;break e;case 4:sr=U.stateNode.containerInfo,gs=!0;break e}U=U.return}if(sr===null)throw Error(n(160));W0(w,R,v),sr=null,gs=!1;var K=v.alternate;K!==null&&(K.return=null),v.return=null}catch(oe){yn(v,a,oe)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)K0(a,i),a=a.sibling}function K0(i,a){var u=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ys(a,i),Ws(i),p&4){try{Cc(3,i,i.return),Nd(3,i)}catch(qe){yn(i,i.return,qe)}try{Cc(5,i,i.return)}catch(qe){yn(i,i.return,qe)}}break;case 1:ys(a,i),Ws(i),p&512&&u!==null&&el(u,u.return);break;case 5:if(ys(a,i),Ws(i),p&512&&u!==null&&el(u,u.return),i.flags&32){var v=i.stateNode;try{Bt(v,"")}catch(qe){yn(i,i.return,qe)}}if(p&4&&(v=i.stateNode,v!=null)){var w=i.memoizedProps,R=u!==null?u.memoizedProps:w,U=i.type,K=i.updateQueue;if(i.updateQueue=null,K!==null)try{U==="input"&&w.type==="radio"&&w.name!=null&&xe(v,w),Kn(U,R);var oe=Kn(U,w);for(R=0;R<K.length;R+=2){var ve=K[R],be=K[R+1];ve==="style"?Or(v,be):ve==="dangerouslySetInnerHTML"?Yt(v,be):ve==="children"?Bt(v,be):V(v,ve,be,oe)}switch(U){case"input":De(v,w);break;case"textarea":kt(v,w);break;case"select":var ge=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!w.multiple;var Ve=w.value;Ve!=null?ye(v,!!w.multiple,Ve,!1):ge!==!!w.multiple&&(w.defaultValue!=null?ye(v,!!w.multiple,w.defaultValue,!0):ye(v,!!w.multiple,w.multiple?[]:"",!1))}v[gc]=w}catch(qe){yn(i,i.return,qe)}}break;case 6:if(ys(a,i),Ws(i),p&4){if(i.stateNode===null)throw Error(n(162));v=i.stateNode,w=i.memoizedProps;try{v.nodeValue=w}catch(qe){yn(i,i.return,qe)}}break;case 3:if(ys(a,i),Ws(i),p&4&&u!==null&&u.memoizedState.isDehydrated)try{Oi(a.containerInfo)}catch(qe){yn(i,i.return,qe)}break;case 4:ys(a,i),Ws(i);break;case 13:ys(a,i),Ws(i),v=i.child,v.flags&8192&&(w=v.memoizedState!==null,v.stateNode.isHidden=w,!w||v.alternate!==null&&v.alternate.memoizedState!==null||(Ym=Pe())),p&4&&H0(i);break;case 22:if(ve=u!==null&&u.memoizedState!==null,i.mode&1?(gr=(oe=gr)||ve,ys(a,i),gr=oe):ys(a,i),Ws(i),p&8192){if(oe=i.memoizedState!==null,(i.stateNode.isHidden=oe)&&!ve&&(i.mode&1)!==0)for(Ue=i,ve=i.child;ve!==null;){for(be=Ue=ve;Ue!==null;){switch(ge=Ue,Ve=ge.child,ge.tag){case 0:case 11:case 14:case 15:Cc(4,ge,ge.return);break;case 1:el(ge,ge.return);var ze=ge.stateNode;if(typeof ze.componentWillUnmount=="function"){p=ge,u=ge.return;try{a=p,ze.props=a.memoizedProps,ze.state=a.memoizedState,ze.componentWillUnmount()}catch(qe){yn(p,u,qe)}}break;case 5:el(ge,ge.return);break;case 22:if(ge.memoizedState!==null){X0(be);continue}}Ve!==null?(Ve.return=ge,Ue=Ve):X0(be)}ve=ve.sibling}e:for(ve=null,be=i;;){if(be.tag===5){if(ve===null){ve=be;try{v=be.stateNode,oe?(w=v.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(U=be.stateNode,K=be.memoizedProps.style,R=K!=null&&K.hasOwnProperty("display")?K.display:null,U.style.display=Un("display",R))}catch(qe){yn(i,i.return,qe)}}}else if(be.tag===6){if(ve===null)try{be.stateNode.nodeValue=oe?"":be.memoizedProps}catch(qe){yn(i,i.return,qe)}}else if((be.tag!==22&&be.tag!==23||be.memoizedState===null||be===i)&&be.child!==null){be.child.return=be,be=be.child;continue}if(be===i)break e;for(;be.sibling===null;){if(be.return===null||be.return===i)break e;ve===be&&(ve=null),be=be.return}ve===be&&(ve=null),be.sibling.return=be.return,be=be.sibling}}break;case 19:ys(a,i),Ws(i),p&4&&H0(i);break;case 21:break;default:ys(a,i),Ws(i)}}function Ws(i){var a=i.flags;if(a&2){try{e:{for(var u=i.return;u!==null;){if(z0(u)){var p=u;break e}u=u.return}throw Error(n(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(Bt(v,""),p.flags&=-33);var w=q0(i);Gm(i,w,v);break;case 3:case 4:var R=p.stateNode.containerInfo,U=q0(i);Km(i,U,R);break;default:throw Error(n(161))}}catch(K){yn(i,i.return,K)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function F1(i,a,u){Ue=i,G0(i)}function G0(i,a,u){for(var p=(i.mode&1)!==0;Ue!==null;){var v=Ue,w=v.child;if(v.tag===22&&p){var R=v.memoizedState!==null||jd;if(!R){var U=v.alternate,K=U!==null&&U.memoizedState!==null||gr;U=jd;var oe=gr;if(jd=R,(gr=K)&&!oe)for(Ue=v;Ue!==null;)R=Ue,K=R.child,R.tag===22&&R.memoizedState!==null?Y0(v):K!==null?(K.return=R,Ue=K):Y0(v);for(;w!==null;)Ue=w,G0(w),w=w.sibling;Ue=v,jd=U,gr=oe}Q0(i)}else(v.subtreeFlags&8772)!==0&&w!==null?(w.return=v,Ue=w):Q0(i)}}function Q0(i){for(;Ue!==null;){var a=Ue;if((a.flags&8772)!==0){var u=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:gr||Nd(5,a);break;case 1:var p=a.stateNode;if(a.flags&4&&!gr)if(u===null)p.componentDidMount();else{var v=a.elementType===a.type?u.memoizedProps:ps(a.type,u.memoizedProps);p.componentDidUpdate(v,u.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var w=a.updateQueue;w!==null&&X_(a,w,p);break;case 3:var R=a.updateQueue;if(R!==null){if(u=null,a.child!==null)switch(a.child.tag){case 5:u=a.child.stateNode;break;case 1:u=a.child.stateNode}X_(a,R,u)}break;case 5:var U=a.stateNode;if(u===null&&a.flags&4){u=U;var K=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":K.autoFocus&&u.focus();break;case"img":K.src&&(u.src=K.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var oe=a.alternate;if(oe!==null){var ve=oe.memoizedState;if(ve!==null){var be=ve.dehydrated;be!==null&&Oi(be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}gr||a.flags&512&&Hm(a)}catch(ge){yn(a,a.return,ge)}}if(a===i){Ue=null;break}if(u=a.sibling,u!==null){u.return=a.return,Ue=u;break}Ue=a.return}}function X0(i){for(;Ue!==null;){var a=Ue;if(a===i){Ue=null;break}var u=a.sibling;if(u!==null){u.return=a.return,Ue=u;break}Ue=a.return}}function Y0(i){for(;Ue!==null;){var a=Ue;try{switch(a.tag){case 0:case 11:case 15:var u=a.return;try{Nd(4,a)}catch(K){yn(a,u,K)}break;case 1:var p=a.stateNode;if(typeof p.componentDidMount=="function"){var v=a.return;try{p.componentDidMount()}catch(K){yn(a,v,K)}}var w=a.return;try{Hm(a)}catch(K){yn(a,w,K)}break;case 5:var R=a.return;try{Hm(a)}catch(K){yn(a,R,K)}}}catch(K){yn(a,a.return,K)}if(a===i){Ue=null;break}var U=a.sibling;if(U!==null){U.return=a.return,Ue=U;break}Ue=a.return}}var B1=Math.ceil,Md=$.ReactCurrentDispatcher,Qm=$.ReactCurrentOwner,os=$.ReactCurrentBatchConfig,Mt=0,Xn=null,Vn=null,ir=0,Gr=0,tl=zi(0),zn=0,Ac=null,Qo=0,Dd=0,Xm=0,Rc=null,Mr=null,Ym=0,nl=1/0,yi=null,Ld=!1,Jm=null,Qi=null,Vd=!1,Xi=null,Od=0,kc=0,Zm=null,Fd=-1,Bd=0;function Ar(){return(Mt&6)!==0?Pe():Fd!==-1?Fd:Fd=Pe()}function Yi(i){return(i.mode&1)===0?1:(Mt&2)!==0&&ir!==0?ir&-ir:T1.transition!==null?(Bd===0&&(Bd=Yl()),Bd):(i=Tt,i!==0||(i=window.event,i=i===void 0?16:Pa(i.type)),i)}function vs(i,a,u,p){if(50<kc)throw kc=0,Zm=null,Error(n(185));Vo(i,u,p),((Mt&2)===0||i!==Xn)&&(i===Xn&&((Mt&2)===0&&(Dd|=u),zn===4&&Ji(i,ir)),Dr(i,p),u===1&&Mt===0&&(a.mode&1)===0&&(nl=Pe()+500,md&&Wi()))}function Dr(i,a){var u=i.callbackNode;Lo(i,a);var p=si(i,i===Xn?ir:0);if(p===0)u!==null&&We(u),i.callbackNode=null,i.callbackPriority=0;else if(a=p&-p,i.callbackPriority!==a){if(u!=null&&We(u),a===1)i.tag===0?x1(Z0.bind(null,i)):O_(Z0.bind(null,i)),v1(function(){(Mt&6)===0&&Wi()}),u=null;else{switch(js(p)){case 1:u=sn;break;case 4:u=bn;break;case 16:u=Dn;break;case 536870912:u=pe;break;default:u=Dn}u=aw(u,J0.bind(null,i))}i.callbackPriority=a,i.callbackNode=u}}function J0(i,a){if(Fd=-1,Bd=0,(Mt&6)!==0)throw Error(n(327));var u=i.callbackNode;if(rl()&&i.callbackNode!==u)return null;var p=si(i,i===Xn?ir:0);if(p===0)return null;if((p&30)!==0||(p&i.expiredLanes)!==0||a)a=Ud(i,p);else{a=p;var v=Mt;Mt|=2;var w=tw();(Xn!==i||ir!==a)&&(yi=null,nl=Pe()+500,Yo(i,a));do try{z1();break}catch(U){ew(i,U)}while(!0);ym(),Md.current=w,Mt=v,Vn!==null?a=0:(Xn=null,ir=0,a=zn)}if(a!==0){if(a===2&&(v=Xl(i),v!==0&&(p=v,a=ep(i,v))),a===1)throw u=Ac,Yo(i,0),Ji(i,p),Dr(i,Pe()),u;if(a===6)Ji(i,p);else{if(v=i.current.alternate,(p&30)===0&&!U1(v)&&(a=Ud(i,p),a===2&&(w=Xl(i),w!==0&&(p=w,a=ep(i,w))),a===1))throw u=Ac,Yo(i,0),Ji(i,p),Dr(i,Pe()),u;switch(i.finishedWork=v,i.finishedLanes=p,a){case 0:case 1:throw Error(n(345));case 2:Jo(i,Mr,yi);break;case 3:if(Ji(i,p),(p&130023424)===p&&(a=Ym+500-Pe(),10<a)){if(si(i,0)!==0)break;if(v=i.suspendedLanes,(v&p)!==p){Ar(),i.pingedLanes|=i.suspendedLanes&v;break}i.timeoutHandle=om(Jo.bind(null,i,Mr,yi),a);break}Jo(i,Mr,yi);break;case 4:if(Ji(i,p),(p&4194240)===p)break;for(a=i.eventTimes,v=-1;0<p;){var R=31-Zt(p);w=1<<R,R=a[R],R>v&&(v=R),p&=~w}if(p=v,p=Pe()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*B1(p/1960))-p,10<p){i.timeoutHandle=om(Jo.bind(null,i,Mr,yi),p);break}Jo(i,Mr,yi);break;case 5:Jo(i,Mr,yi);break;default:throw Error(n(329))}}}return Dr(i,Pe()),i.callbackNode===u?J0.bind(null,i):null}function ep(i,a){var u=Rc;return i.current.memoizedState.isDehydrated&&(Yo(i,a).flags|=256),i=Ud(i,a),i!==2&&(a=Mr,Mr=u,a!==null&&tp(a)),i}function tp(i){Mr===null?Mr=i:Mr.push.apply(Mr,i)}function U1(i){for(var a=i;;){if(a.flags&16384){var u=a.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var p=0;p<u.length;p++){var v=u[p],w=v.getSnapshot;v=v.value;try{if(!fs(w(),v))return!1}catch{return!1}}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ji(i,a){for(a&=~Xm,a&=~Dd,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var u=31-Zt(a),p=1<<u;i[u]=-1,a&=~p}}function Z0(i){if((Mt&6)!==0)throw Error(n(327));rl();var a=si(i,0);if((a&1)===0)return Dr(i,Pe()),null;var u=Ud(i,a);if(i.tag!==0&&u===2){var p=Xl(i);p!==0&&(a=p,u=ep(i,p))}if(u===1)throw u=Ac,Yo(i,0),Ji(i,a),Dr(i,Pe()),u;if(u===6)throw Error(n(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,Jo(i,Mr,yi),Dr(i,Pe()),null}function np(i,a){var u=Mt;Mt|=1;try{return i(a)}finally{Mt=u,Mt===0&&(nl=Pe()+500,md&&Wi())}}function Xo(i){Xi!==null&&Xi.tag===0&&(Mt&6)===0&&rl();var a=Mt;Mt|=1;var u=os.transition,p=Tt;try{if(os.transition=null,Tt=1,i)return i()}finally{Tt=p,os.transition=u,Mt=a,(Mt&6)===0&&Wi()}}function rp(){Gr=tl.current,Gt(tl)}function Yo(i,a){i.finishedWork=null,i.finishedLanes=0;var u=i.timeoutHandle;if(u!==-1&&(i.timeoutHandle=-1,y1(u)),Vn!==null)for(u=Vn.return;u!==null;){var p=u;switch(hm(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&hd();break;case 3:Ja(),Gt(Pr),Gt(fr),Im();break;case 5:Tm(p);break;case 4:Ja();break;case 13:Gt(on);break;case 19:Gt(on);break;case 10:vm(p.type._context);break;case 22:case 23:rp()}u=u.return}if(Xn=i,Vn=i=Zi(i.current,null),ir=Gr=a,zn=0,Ac=null,Xm=Dd=Qo=0,Mr=Rc=null,Ho!==null){for(a=0;a<Ho.length;a++)if(u=Ho[a],p=u.interleaved,p!==null){u.interleaved=null;var v=p.next,w=u.pending;if(w!==null){var R=w.next;w.next=v,p.next=R}u.pending=p}Ho=null}return i}function ew(i,a){do{var u=Vn;try{if(ym(),Ed.current=Ad,Id){for(var p=an.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Id=!1}if(Go=0,Qn=$n=an=null,xc=!1,Tc=0,Qm.current=null,u===null||u.return===null){zn=1,Ac=a,Vn=null;break}e:{var w=i,R=u.return,U=u,K=a;if(a=ir,U.flags|=32768,K!==null&&typeof K=="object"&&typeof K.then=="function"){var oe=K,ve=U,be=ve.tag;if((ve.mode&1)===0&&(be===0||be===11||be===15)){var ge=ve.alternate;ge?(ve.updateQueue=ge.updateQueue,ve.memoizedState=ge.memoizedState,ve.lanes=ge.lanes):(ve.updateQueue=null,ve.memoizedState=null)}var Ve=I0(R);if(Ve!==null){Ve.flags&=-257,S0(Ve,R,U,w,a),Ve.mode&1&&E0(w,oe,a),a=Ve,K=oe;var ze=a.updateQueue;if(ze===null){var qe=new Set;qe.add(K),a.updateQueue=qe}else ze.add(K);break e}else{if((a&1)===0){E0(w,oe,a),sp();break e}K=Error(n(426))}}else if(en&&U.mode&1){var In=I0(R);if(In!==null){(In.flags&65536)===0&&(In.flags|=256),S0(In,R,U,w,a),pm(Za(K,U));break e}}w=K=Za(K,U),zn!==4&&(zn=2),Rc===null?Rc=[w]:Rc.push(w),w=R;do{switch(w.tag){case 3:w.flags|=65536,a&=-a,w.lanes|=a;var J=x0(w,K,a);Q_(w,J);break e;case 1:U=K;var G=w.type,re=w.stateNode;if((w.flags&128)===0&&(typeof G.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Qi===null||!Qi.has(re)))){w.flags|=65536,a&=-a,w.lanes|=a;var Te=T0(w,U,a);Q_(w,Te);break e}}w=w.return}while(w!==null)}rw(u)}catch(He){a=He,Vn===u&&u!==null&&(Vn=u=u.return);continue}break}while(!0)}function tw(){var i=Md.current;return Md.current=Ad,i===null?Ad:i}function sp(){(zn===0||zn===3||zn===2)&&(zn=4),Xn===null||(Qo&268435455)===0&&(Dd&268435455)===0||Ji(Xn,ir)}function Ud(i,a){var u=Mt;Mt|=2;var p=tw();(Xn!==i||ir!==a)&&(yi=null,Yo(i,a));do try{$1();break}catch(v){ew(i,v)}while(!0);if(ym(),Mt=u,Md.current=p,Vn!==null)throw Error(n(261));return Xn=null,ir=0,zn}function $1(){for(;Vn!==null;)nw(Vn)}function z1(){for(;Vn!==null&&!St();)nw(Vn)}function nw(i){var a=ow(i.alternate,i,Gr);i.memoizedProps=i.pendingProps,a===null?rw(i):Vn=a,Qm.current=null}function rw(i){var a=i;do{var u=a.alternate;if(i=a.return,(a.flags&32768)===0){if(u=D1(u,a,Gr),u!==null){Vn=u;return}}else{if(u=L1(u,a),u!==null){u.flags&=32767,Vn=u;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{zn=6,Vn=null;return}}if(a=a.sibling,a!==null){Vn=a;return}Vn=a=i}while(a!==null);zn===0&&(zn=5)}function Jo(i,a,u){var p=Tt,v=os.transition;try{os.transition=null,Tt=1,q1(i,a,u,p)}finally{os.transition=v,Tt=p}return null}function q1(i,a,u,p){do rl();while(Xi!==null);if((Mt&6)!==0)throw Error(n(327));u=i.finishedWork;var v=i.finishedLanes;if(u===null)return null;if(i.finishedWork=null,i.finishedLanes=0,u===i.current)throw Error(n(177));i.callbackNode=null,i.callbackPriority=0;var w=u.lanes|u.childLanes;if(qf(i,w),i===Xn&&(Vn=Xn=null,ir=0),(u.subtreeFlags&2064)===0&&(u.flags&2064)===0||Vd||(Vd=!0,aw(Dn,function(){return rl(),null})),w=(u.flags&15990)!==0,(u.subtreeFlags&15990)!==0||w){w=os.transition,os.transition=null;var R=Tt;Tt=1;var U=Mt;Mt|=4,Qm.current=null,O1(i,u),K0(u,i),u1(sm),ai=!!rm,sm=rm=null,i.current=u,F1(u),jt(),Mt=U,Tt=R,os.transition=w}else i.current=u;if(Vd&&(Vd=!1,Xi=i,Od=v),w=i.pendingLanes,w===0&&(Qi=null),gn(u.stateNode),Dr(i,Pe()),a!==null)for(p=i.onRecoverableError,u=0;u<a.length;u++)v=a[u],p(v.value,{componentStack:v.stack,digest:v.digest});if(Ld)throw Ld=!1,i=Jm,Jm=null,i;return(Od&1)!==0&&i.tag!==0&&rl(),w=i.pendingLanes,(w&1)!==0?i===Zm?kc++:(kc=0,Zm=i):kc=0,Wi(),null}function rl(){if(Xi!==null){var i=js(Od),a=os.transition,u=Tt;try{if(os.transition=null,Tt=16>i?16:i,Xi===null)var p=!1;else{if(i=Xi,Xi=null,Od=0,(Mt&6)!==0)throw Error(n(331));var v=Mt;for(Mt|=4,Ue=i.current;Ue!==null;){var w=Ue,R=w.child;if((Ue.flags&16)!==0){var U=w.deletions;if(U!==null){for(var K=0;K<U.length;K++){var oe=U[K];for(Ue=oe;Ue!==null;){var ve=Ue;switch(ve.tag){case 0:case 11:case 15:Cc(8,ve,w)}var be=ve.child;if(be!==null)be.return=ve,Ue=be;else for(;Ue!==null;){ve=Ue;var ge=ve.sibling,Ve=ve.return;if($0(ve),ve===oe){Ue=null;break}if(ge!==null){ge.return=Ve,Ue=ge;break}Ue=Ve}}}var ze=w.alternate;if(ze!==null){var qe=ze.child;if(qe!==null){ze.child=null;do{var In=qe.sibling;qe.sibling=null,qe=In}while(qe!==null)}}Ue=w}}if((w.subtreeFlags&2064)!==0&&R!==null)R.return=w,Ue=R;else e:for(;Ue!==null;){if(w=Ue,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Cc(9,w,w.return)}var J=w.sibling;if(J!==null){J.return=w.return,Ue=J;break e}Ue=w.return}}var G=i.current;for(Ue=G;Ue!==null;){R=Ue;var re=R.child;if((R.subtreeFlags&2064)!==0&&re!==null)re.return=R,Ue=re;else e:for(R=G;Ue!==null;){if(U=Ue,(U.flags&2048)!==0)try{switch(U.tag){case 0:case 11:case 15:Nd(9,U)}}catch(He){yn(U,U.return,He)}if(U===R){Ue=null;break e}var Te=U.sibling;if(Te!==null){Te.return=U.return,Ue=Te;break e}Ue=U.return}}if(Mt=v,Wi(),Nt&&typeof Nt.onPostCommitFiberRoot=="function")try{Nt.onPostCommitFiberRoot(lt,i)}catch{}p=!0}return p}finally{Tt=u,os.transition=a}}return!1}function sw(i,a,u){a=Za(u,a),a=x0(i,a,1),i=Ki(i,a,1),a=Ar(),i!==null&&(Vo(i,1,a),Dr(i,a))}function yn(i,a,u){if(i.tag===3)sw(i,i,u);else for(;a!==null;){if(a.tag===3){sw(a,i,u);break}else if(a.tag===1){var p=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Qi===null||!Qi.has(p))){i=Za(u,i),i=T0(a,i,1),a=Ki(a,i,1),i=Ar(),a!==null&&(Vo(a,1,i),Dr(a,i));break}}a=a.return}}function W1(i,a,u){var p=i.pingCache;p!==null&&p.delete(a),a=Ar(),i.pingedLanes|=i.suspendedLanes&u,Xn===i&&(ir&u)===u&&(zn===4||zn===3&&(ir&130023424)===ir&&500>Pe()-Ym?Yo(i,0):Xm|=u),Dr(i,a)}function iw(i,a){a===0&&((i.mode&1)===0?a=1:(a=Ur,Ur<<=1,(Ur&130023424)===0&&(Ur=4194304)));var u=Ar();i=mi(i,a),i!==null&&(Vo(i,a,u),Dr(i,u))}function H1(i){var a=i.memoizedState,u=0;a!==null&&(u=a.retryLane),iw(i,u)}function K1(i,a){var u=0;switch(i.tag){case 13:var p=i.stateNode,v=i.memoizedState;v!==null&&(u=v.retryLane);break;case 19:p=i.stateNode;break;default:throw Error(n(314))}p!==null&&p.delete(a),iw(i,u)}var ow;ow=function(i,a,u){if(i!==null)if(i.memoizedProps!==a.pendingProps||Pr.current)Nr=!0;else{if((i.lanes&u)===0&&(a.flags&128)===0)return Nr=!1,M1(i,a,u);Nr=(i.flags&131072)!==0}else Nr=!1,en&&(a.flags&1048576)!==0&&F_(a,gd,a.index);switch(a.lanes=0,a.tag){case 2:var p=a.type;Pd(i,a),i=a.pendingProps;var v=Wa(a,fr.current);Ya(a,u),v=Am(null,a,p,i,v,u);var w=Rm();return a.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,jr(p)?(w=!0,fd(a)):w=!1,a.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,bm(a),v.updater=Rd,a.stateNode=v,v._reactInternals=a,Dm(a,p,i,u),a=Fm(null,a,p,!0,w,u)):(a.tag=0,en&&w&&dm(a),Cr(null,a,v,u),a=a.child),a;case 16:p=a.elementType;e:{switch(Pd(i,a),i=a.pendingProps,v=p._init,p=v(p._payload),a.type=p,v=a.tag=Q1(p),i=ps(p,i),v){case 0:a=Om(null,a,p,i,u);break e;case 1:a=j0(null,a,p,i,u);break e;case 11:a=C0(null,a,p,i,u);break e;case 14:a=A0(null,a,p,ps(p.type,i),u);break e}throw Error(n(306,p,""))}return a;case 0:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:ps(p,v),Om(i,a,p,v,u);case 1:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:ps(p,v),j0(i,a,p,v,u);case 3:e:{if(N0(a),i===null)throw Error(n(387));p=a.pendingProps,w=a.memoizedState,v=w.element,G_(i,a),xd(a,p,null,u);var R=a.memoizedState;if(p=R.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},a.updateQueue.baseState=w,a.memoizedState=w,a.flags&256){v=Za(Error(n(423)),a),a=M0(i,a,p,u,v);break e}else if(p!==v){v=Za(Error(n(424)),a),a=M0(i,a,p,u,v);break e}else for(Kr=$i(a.stateNode.containerInfo.firstChild),Hr=a,en=!0,ms=null,u=H_(a,null,p,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Ga(),p===v){a=gi(i,a,u);break e}Cr(i,a,p,u)}a=a.child}return a;case 5:return Y_(a),i===null&&mm(a),p=a.type,v=a.pendingProps,w=i!==null?i.memoizedProps:null,R=v.children,im(p,v)?R=null:w!==null&&im(p,w)&&(a.flags|=32),P0(i,a),Cr(i,a,R,u),a.child;case 6:return i===null&&mm(a),null;case 13:return D0(i,a,u);case 4:return xm(a,a.stateNode.containerInfo),p=a.pendingProps,i===null?a.child=Qa(a,null,p,u):Cr(i,a,p,u),a.child;case 11:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:ps(p,v),C0(i,a,p,v,u);case 7:return Cr(i,a,a.pendingProps,u),a.child;case 8:return Cr(i,a,a.pendingProps.children,u),a.child;case 12:return Cr(i,a,a.pendingProps.children,u),a.child;case 10:e:{if(p=a.type._context,v=a.pendingProps,w=a.memoizedProps,R=v.value,zt(_d,p._currentValue),p._currentValue=R,w!==null)if(fs(w.value,R)){if(w.children===v.children&&!Pr.current){a=gi(i,a,u);break e}}else for(w=a.child,w!==null&&(w.return=a);w!==null;){var U=w.dependencies;if(U!==null){R=w.child;for(var K=U.firstContext;K!==null;){if(K.context===p){if(w.tag===1){K=pi(-1,u&-u),K.tag=2;var oe=w.updateQueue;if(oe!==null){oe=oe.shared;var ve=oe.pending;ve===null?K.next=K:(K.next=ve.next,ve.next=K),oe.pending=K}}w.lanes|=u,K=w.alternate,K!==null&&(K.lanes|=u),_m(w.return,u,a),U.lanes|=u;break}K=K.next}}else if(w.tag===10)R=w.type===a.type?null:w.child;else if(w.tag===18){if(R=w.return,R===null)throw Error(n(341));R.lanes|=u,U=R.alternate,U!==null&&(U.lanes|=u),_m(R,u,a),R=w.sibling}else R=w.child;if(R!==null)R.return=w;else for(R=w;R!==null;){if(R===a){R=null;break}if(w=R.sibling,w!==null){w.return=R.return,R=w;break}R=R.return}w=R}Cr(i,a,v.children,u),a=a.child}return a;case 9:return v=a.type,p=a.pendingProps.children,Ya(a,u),v=ss(v),p=p(v),a.flags|=1,Cr(i,a,p,u),a.child;case 14:return p=a.type,v=ps(p,a.pendingProps),v=ps(p.type,v),A0(i,a,p,v,u);case 15:return R0(i,a,a.type,a.pendingProps,u);case 17:return p=a.type,v=a.pendingProps,v=a.elementType===p?v:ps(p,v),Pd(i,a),a.tag=1,jr(p)?(i=!0,fd(a)):i=!1,Ya(a,u),w0(a,p,v),Dm(a,p,v,u),Fm(null,a,p,!0,i,u);case 19:return V0(i,a,u);case 22:return k0(i,a,u)}throw Error(n(156,a.tag))};function aw(i,a){return ke(i,a)}function G1(i,a,u,p){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function as(i,a,u,p){return new G1(i,a,u,p)}function ip(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Q1(i){if(typeof i=="function")return ip(i)?1:0;if(i!=null){if(i=i.$$typeof,i===N)return 11;if(i===te)return 14}return 2}function Zi(i,a){var u=i.alternate;return u===null?(u=as(i.tag,a,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=a,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&14680064,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,a=i.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u}function $d(i,a,u,p,v,w){var R=2;if(p=i,typeof i=="function")ip(i)&&(R=1);else if(typeof i=="string")R=5;else e:switch(i){case A:return Zo(u.children,v,w,a);case E:R=8,v|=8;break;case P:return i=as(12,u,a,v|2),i.elementType=P,i.lanes=w,i;case M:return i=as(13,u,a,v),i.elementType=M,i.lanes=w,i;case ie:return i=as(19,u,a,v),i.elementType=ie,i.lanes=w,i;case W:return zd(u,v,w,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case L:R=10;break e;case C:R=9;break e;case N:R=11;break e;case te:R=14;break e;case q:R=16,p=null;break e}throw Error(n(130,i==null?i:typeof i,""))}return a=as(R,u,a,v),a.elementType=i,a.type=p,a.lanes=w,a}function Zo(i,a,u,p){return i=as(7,i,p,a),i.lanes=u,i}function zd(i,a,u,p){return i=as(22,i,p,a),i.elementType=W,i.lanes=u,i.stateNode={isHidden:!1},i}function op(i,a,u){return i=as(6,i,null,a),i.lanes=u,i}function ap(i,a,u){return a=as(4,i.children!==null?i.children:[],i.key,a),a.lanes=u,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function X1(i,a,u,p,v){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jl(0),this.expirationTimes=Jl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jl(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function lp(i,a,u,p,v,w,R,U,K){return i=new X1(i,a,u,U,K),a===1?(a=1,w===!0&&(a|=8)):a=0,w=as(3,null,null,a),i.current=w,w.stateNode=i,w.memoizedState={element:p,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},bm(w),i}function Y1(i,a,u){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H,key:p==null?null:""+p,children:i,containerInfo:a,implementation:u}}function lw(i){if(!i)return qi;i=i._reactInternals;e:{if(rn(i)!==i||i.tag!==1)throw Error(n(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(jr(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(n(171))}if(i.tag===1){var u=i.type;if(jr(u))return L_(i,u,a)}return a}function cw(i,a,u,p,v,w,R,U,K){return i=lp(u,p,!0,i,v,w,R,U,K),i.context=lw(null),u=i.current,p=Ar(),v=Yi(u),w=pi(p,v),w.callback=a??null,Ki(u,w,v),i.current.lanes=v,Vo(i,v,p),Dr(i,p),i}function qd(i,a,u,p){var v=a.current,w=Ar(),R=Yi(v);return u=lw(u),a.context===null?a.context=u:a.pendingContext=u,a=pi(w,R),a.payload={element:i},p=p===void 0?null:p,p!==null&&(a.callback=p),i=Ki(v,a,R),i!==null&&(vs(i,v,R,w),bd(i,v,R)),R}function Wd(i){return i=i.current,i.child?(i.child.tag===5,i.child.stateNode):null}function uw(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<a?u:a}}function cp(i,a){uw(i,a),(i=i.alternate)&&uw(i,a)}function J1(){return null}var dw=typeof reportError=="function"?reportError:function(i){console.error(i)};function up(i){this._internalRoot=i}Hd.prototype.render=up.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(n(409));qd(i,a,null,null)},Hd.prototype.unmount=up.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Xo(function(){qd(null,i,null,null)}),a[ui]=null}};function Hd(i){this._internalRoot=i}Hd.prototype.unstable_scheduleHydration=function(i){if(i){var a=nc();i={blockedOn:null,target:i,priority:a};for(var u=0;u<$r.length&&a!==0&&a<$r[u].priority;u++);$r.splice(u,0,i),u===0&&Ra(i)}};function dp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Kd(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function hw(){}function Z1(i,a,u,p,v){if(v){if(typeof p=="function"){var w=p;p=function(){var oe=Wd(R);w.call(oe)}}var R=cw(a,p,i,0,null,!1,!1,"",hw);return i._reactRootContainer=R,i[ui]=R.current,mc(i.nodeType===8?i.parentNode:i),Xo(),R}for(;v=i.lastChild;)i.removeChild(v);if(typeof p=="function"){var U=p;p=function(){var oe=Wd(K);U.call(oe)}}var K=lp(i,0,!1,null,null,!1,!1,"",hw);return i._reactRootContainer=K,i[ui]=K.current,mc(i.nodeType===8?i.parentNode:i),Xo(function(){qd(a,K,u,p)}),K}function Gd(i,a,u,p,v){var w=u._reactRootContainer;if(w){var R=w;if(typeof v=="function"){var U=v;v=function(){var K=Wd(R);U.call(K)}}qd(a,R,i,v)}else R=Z1(u,a,i,v,p);return Wd(R)}ec=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var u=yt(a.pendingLanes);u!==0&&(Zl(a,u|1),Dr(a,Pe()),(Mt&6)===0&&(nl=Pe()+500,Wi()))}break;case 13:Xo(function(){var p=mi(i,1);if(p!==null){var v=Ar();vs(p,i,1,v)}}),cp(i,1)}},Ca=function(i){if(i.tag===13){var a=mi(i,134217728);if(a!==null){var u=Ar();vs(a,i,134217728,u)}cp(i,134217728)}},tc=function(i){if(i.tag===13){var a=Yi(i),u=mi(i,a);if(u!==null){var p=Ar();vs(u,i,a,p)}cp(i,a)}},nc=function(){return Tt},rc=function(i,a){var u=Tt;try{return Tt=i,a()}finally{Tt=u}},nt=function(i,a,u){switch(a){case"input":if(De(i,u),a=u.name,u.type==="radio"&&a!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<u.length;a++){var p=u[a];if(p!==i&&p.form===i.form){var v=dd(p);if(!v)throw Error(n(90));ur(p),De(p,v)}}}break;case"textarea":kt(i,u);break;case"select":a=u.value,a!=null&&ye(i,!!u.multiple,a,!1)}},Pt=np,Lt=Xo;var eR={usingClientEntryPoint:!1,Events:[yc,za,dd,Le,_t,np]},Pc={findFiberByHostInstance:$o,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tR={bundleType:Pc.bundleType,version:Pc.version,rendererPackageName:Pc.rendererPackageName,rendererConfig:Pc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=le(i),i===null?null:i.stateNode},findFiberByHostInstance:Pc.findFiberByHostInstance||J1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qd.isDisabled&&Qd.supportsFiber)try{lt=Qd.inject(tR),Nt=Qd}catch{}}return Lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eR,Lr.createPortal=function(i,a){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dp(a))throw Error(n(200));return Y1(i,a,null,u)},Lr.createRoot=function(i,a){if(!dp(i))throw Error(n(299));var u=!1,p="",v=dw;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(p=a.identifierPrefix),a.onRecoverableError!==void 0&&(v=a.onRecoverableError)),a=lp(i,1,!1,null,null,u,!1,p,v),i[ui]=a.current,mc(i.nodeType===8?i.parentNode:i),new up(a)},Lr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=le(a),i=i===null?null:i.stateNode,i},Lr.flushSync=function(i){return Xo(i)},Lr.hydrate=function(i,a,u){if(!Kd(a))throw Error(n(200));return Gd(null,i,a,!0,u)},Lr.hydrateRoot=function(i,a,u){if(!dp(i))throw Error(n(405));var p=u!=null&&u.hydratedSources||null,v=!1,w="",R=dw;if(u!=null&&(u.unstable_strictMode===!0&&(v=!0),u.identifierPrefix!==void 0&&(w=u.identifierPrefix),u.onRecoverableError!==void 0&&(R=u.onRecoverableError)),a=cw(a,null,i,1,u??null,v,!1,w,R),i[ui]=a.current,mc(i),p)for(i=0;i<p.length;i++)u=p[i],v=u._getVersion,v=v(u._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[u,v]:a.mutableSourceEagerHydrationData.push(u,v);return new Hd(a)},Lr.render=function(i,a,u){if(!Kd(a))throw Error(n(200));return Gd(null,i,a,!1,u)},Lr.unmountComponentAtNode=function(i){if(!Kd(i))throw Error(n(40));return i._reactRootContainer?(Xo(function(){Gd(null,null,i,!1,function(){i._reactRootContainer=null,i[ui]=null})}),!0):!1},Lr.unstable_batchedUpdates=np,Lr.unstable_renderSubtreeIntoContainer=function(i,a,u,p){if(!Kd(u))throw Error(n(200));if(i==null||i._reactInternals===void 0)throw Error(n(38));return Gd(i,a,u,!1,p)},Lr.version="18.3.1-next-f1338f8080-20240426",Lr}var ww;function QT(){if(ww)return mp.exports;ww=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),mp.exports=uR(),mp.exports}var bw;function dR(){if(bw)return Xd;bw=1;var t=QT();return Xd.createRoot=t.createRoot,Xd.hydrateRoot=t.hydrateRoot,Xd}var hR=dR();const fR=GT(hR);var mR=QT();function au(){return au=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},au.apply(this,arguments)}var lo;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(lo||(lo={}));const xw="popstate";function pR(t){t===void 0&&(t={});function e(s,o){let{pathname:l="/",search:d="",hash:h=""}=_a(s.location.hash.substr(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),Yp("",{pathname:l,search:d,hash:h},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(s,o){let l=s.document.querySelector("base"),d="";if(l&&l.getAttribute("href")){let h=s.location.href,f=h.indexOf("#");d=f===-1?h:h.slice(0,f)}return d+"#"+(typeof o=="string"?o:Ah(o))}function r(s,o){df(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return yR(e,n,r,t)}function kn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function df(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function gR(){return Math.random().toString(36).substr(2,8)}function Tw(t,e){return{usr:t.state,key:t.key,idx:e}}function Yp(t,e,n,r){return n===void 0&&(n=null),au({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?_a(e):e,{state:n,key:e&&e.key||r||gR()})}function Ah(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function _a(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function yR(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:o=!1}=r,l=s.history,d=lo.Pop,h=null,f=g();f==null&&(f=0,l.replaceState(au({},l.state,{idx:f}),""));function g(){return(l.state||{idx:null}).idx}function y(){d=lo.Pop;let S=g(),O=S==null?null:S-f;f=S,h&&h({action:d,location:k.location,delta:O})}function _(S,O){d=lo.Push;let B=Yp(k.location,S,O);n&&n(B,S),f=g()+1;let V=Tw(B,f),$=k.createHref(B);try{l.pushState(V,"",$)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;s.location.assign($)}o&&h&&h({action:d,location:k.location,delta:1})}function x(S,O){d=lo.Replace;let B=Yp(k.location,S,O);n&&n(B,S),f=g();let V=Tw(B,f),$=k.createHref(B);l.replaceState(V,"",$),o&&h&&h({action:d,location:k.location,delta:0})}function I(S){let O=s.location.origin!=="null"?s.location.origin:s.location.href,B=typeof S=="string"?S:Ah(S);return B=B.replace(/ $/,"%20"),kn(O,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,O)}let k={get action(){return d},get location(){return t(s,l)},listen(S){if(h)throw new Error("A history only accepts one active listener");return s.addEventListener(xw,y),h=S,()=>{s.removeEventListener(xw,y),h=null}},createHref(S){return e(s,S)},createURL:I,encodeLocation(S){let O=I(S);return{pathname:O.pathname,search:O.search,hash:O.hash}},push:_,replace:x,go(S){return l.go(S)}};return k}var Ew;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ew||(Ew={}));function vR(t,e,n){return n===void 0&&(n="/"),_R(t,e,n)}function _R(t,e,n,r){let s=typeof e=="string"?_a(e):e,o=Qg(s.pathname||"/",n);if(o==null)return null;let l=XT(t);wR(l);let d=null;for(let h=0;d==null&&h<l.length;++h){let f=jR(o);d=RR(l[h],f)}return d}function XT(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(o,l,d)=>{let h={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};h.relativePath.startsWith("/")&&(kn(h.relativePath.startsWith(r),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(r.length));let f=ho([r,h.relativePath]),g=n.concat(h);o.children&&o.children.length>0&&(kn(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),XT(o.children,e,g,f)),!(o.path==null&&!o.index)&&e.push({path:f,score:CR(f,o.index),routesMeta:g})};return t.forEach((o,l)=>{var d;if(o.path===""||!((d=o.path)!=null&&d.includes("?")))s(o,l);else for(let h of YT(o.path))s(o,l,h)}),e}function YT(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return s?[o,""]:[o];let l=YT(r.join("/")),d=[];return d.push(...l.map(h=>h===""?o:[o,h].join("/"))),s&&d.push(...l),d.map(h=>t.startsWith("/")&&h===""?"/":h)}function wR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:AR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const bR=/^:[\w-]+$/,xR=3,TR=2,ER=1,IR=10,SR=-2,Iw=t=>t==="*";function CR(t,e){let n=t.split("/"),r=n.length;return n.some(Iw)&&(r+=SR),e&&(r+=TR),n.filter(s=>!Iw(s)).reduce((s,o)=>s+(bR.test(o)?xR:o===""?ER:IR),r)}function AR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function RR(t,e,n){let{routesMeta:r}=t,s={},o="/",l=[];for(let d=0;d<r.length;++d){let h=r[d],f=d===r.length-1,g=o==="/"?e:e.slice(o.length)||"/",y=kR({path:h.relativePath,caseSensitive:h.caseSensitive,end:f},g),_=h.route;if(!y)return null;Object.assign(s,y.params),l.push({params:s,pathname:ho([o,y.pathname]),pathnameBase:VR(ho([o,y.pathnameBase])),route:_}),y.pathnameBase!=="/"&&(o=ho([o,y.pathnameBase]))}return l}function kR(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=PR(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let o=s[0],l=o.replace(/(.)\/+$/,"$1"),d=s.slice(1);return{params:r.reduce((f,g,y)=>{let{paramName:_,isOptional:x}=g;if(_==="*"){let k=d[y]||"";l=o.slice(0,o.length-k.length).replace(/(.)\/+$/,"$1")}const I=d[y];return x&&!I?f[_]=void 0:f[_]=(I||"").replace(/%2F/g,"/"),f},{}),pathname:o,pathnameBase:l,pattern:t}}function PR(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),df(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,d,h)=>(r.push({paramName:d,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function jR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return df(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Qg(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}const NR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,MR=t=>NR.test(t);function DR(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?_a(t):t,o;if(n)if(MR(n))o=n;else{if(n.includes("//")){let l=n;n=n.replace(/\/\/+/g,"/"),df(!1,"Pathnames cannot have embedded double slashes - normalizing "+(l+" -> "+n))}n.startsWith("/")?o=Sw(n.substring(1),"/"):o=Sw(n,e)}else o=e;return{pathname:o,search:OR(r),hash:FR(s)}}function Sw(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function yp(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function LR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Xg(t,e){let n=LR(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Yg(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=_a(t):(s=au({},t),kn(!s.pathname||!s.pathname.includes("?"),yp("?","pathname","search",s)),kn(!s.pathname||!s.pathname.includes("#"),yp("#","pathname","hash",s)),kn(!s.search||!s.search.includes("#"),yp("#","search","hash",s)));let o=t===""||s.pathname==="",l=o?"/":s.pathname,d;if(l==null)d=n;else{let y=e.length-1;if(!r&&l.startsWith("..")){let _=l.split("/");for(;_[0]==="..";)_.shift(),y-=1;s.pathname=_.join("/")}d=y>=0?e[y]:"/"}let h=DR(s,d),f=l&&l!=="/"&&l.endsWith("/"),g=(o||l===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(f||g)&&(h.pathname+="/"),h}const ho=t=>t.join("/").replace(/\/\/+/g,"/"),VR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),OR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,FR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function BR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const JT=["post","put","patch","delete"];new Set(JT);const UR=["get",...JT];new Set(UR);function lu(){return lu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},lu.apply(this,arguments)}const Jg=ue.createContext(null),$R=ue.createContext(null),Ao=ue.createContext(null),hf=ue.createContext(null),Ni=ue.createContext({outlet:null,matches:[],isDataRoute:!1}),ZT=ue.createContext(null);function zR(t,e){let{relative:n}=e===void 0?{}:e;Vl()||kn(!1);let{basename:r,navigator:s}=ue.useContext(Ao),{hash:o,pathname:l,search:d}=tE(t,{relative:n}),h=l;return r!=="/"&&(h=l==="/"?r:ho([r,l])),s.createHref({pathname:h,search:d,hash:o})}function Vl(){return ue.useContext(hf)!=null}function ks(){return Vl()||kn(!1),ue.useContext(hf).location}function eE(t){ue.useContext(Ao).static||ue.useLayoutEffect(t)}function ts(){let{isDataRoute:t}=ue.useContext(Ni);return t?nk():qR()}function qR(){Vl()||kn(!1);let t=ue.useContext(Jg),{basename:e,future:n,navigator:r}=ue.useContext(Ao),{matches:s}=ue.useContext(Ni),{pathname:o}=ks(),l=JSON.stringify(Xg(s,n.v7_relativeSplatPath)),d=ue.useRef(!1);return eE(()=>{d.current=!0}),ue.useCallback(function(f,g){if(g===void 0&&(g={}),!d.current)return;if(typeof f=="number"){r.go(f);return}let y=Yg(f,JSON.parse(l),o,g.relative==="path");t==null&&e!=="/"&&(y.pathname=y.pathname==="/"?e:ho([e,y.pathname])),(g.replace?r.replace:r.push)(y,g.state,g)},[e,r,l,o,t])}function Ru(){let{matches:t}=ue.useContext(Ni),e=t[t.length-1];return e?e.params:{}}function tE(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=ue.useContext(Ao),{matches:s}=ue.useContext(Ni),{pathname:o}=ks(),l=JSON.stringify(Xg(s,r.v7_relativeSplatPath));return ue.useMemo(()=>Yg(t,JSON.parse(l),o,n==="path"),[t,l,o,n])}function WR(t,e){return HR(t,e)}function HR(t,e,n,r){Vl()||kn(!1);let{navigator:s}=ue.useContext(Ao),{matches:o}=ue.useContext(Ni),l=o[o.length-1],d=l?l.params:{};l&&l.pathname;let h=l?l.pathnameBase:"/";l&&l.route;let f=ks(),g;if(e){var y;let S=typeof e=="string"?_a(e):e;h==="/"||(y=S.pathname)!=null&&y.startsWith(h)||kn(!1),g=S}else g=f;let _=g.pathname||"/",x=_;if(h!=="/"){let S=h.replace(/^\//,"").split("/");x="/"+_.replace(/^\//,"").split("/").slice(S.length).join("/")}let I=vR(t,{pathname:x}),k=YR(I&&I.map(S=>Object.assign({},S,{params:Object.assign({},d,S.params),pathname:ho([h,s.encodeLocation?s.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?h:ho([h,s.encodeLocation?s.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),o,n,r);return e&&k?ue.createElement(hf.Provider,{value:{location:lu({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:lo.Pop}},k):k}function KR(){let t=tk(),e=BR(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ue.createElement(ue.Fragment,null,ue.createElement("h2",null,"Unexpected Application Error!"),ue.createElement("h3",{style:{fontStyle:"italic"}},e),n?ue.createElement("pre",{style:s},n):null,null)}const GR=ue.createElement(KR,null);class QR extends ue.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?ue.createElement(Ni.Provider,{value:this.props.routeContext},ue.createElement(ZT.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function XR(t){let{routeContext:e,match:n,children:r}=t,s=ue.useContext(Jg);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),ue.createElement(Ni.Provider,{value:e},r)}function YR(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=r)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,d=(s=n)==null?void 0:s.errors;if(d!=null){let g=l.findIndex(y=>y.route.id&&d?.[y.route.id]!==void 0);g>=0||kn(!1),l=l.slice(0,Math.min(l.length,g+1))}let h=!1,f=-1;if(n&&r&&r.v7_partialHydration)for(let g=0;g<l.length;g++){let y=l[g];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(f=g),y.route.id){let{loaderData:_,errors:x}=n,I=y.route.loader&&_[y.route.id]===void 0&&(!x||x[y.route.id]===void 0);if(y.route.lazy||I){h=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}return l.reduceRight((g,y,_)=>{let x,I=!1,k=null,S=null;n&&(x=d&&y.route.id?d[y.route.id]:void 0,k=y.route.errorElement||GR,h&&(f<0&&_===0?(rk("route-fallback"),I=!0,S=null):f===_&&(I=!0,S=y.route.hydrateFallbackElement||null)));let O=e.concat(l.slice(0,_+1)),B=()=>{let V;return x?V=k:I?V=S:y.route.Component?V=ue.createElement(y.route.Component,null):y.route.element?V=y.route.element:V=g,ue.createElement(XR,{match:y,routeContext:{outlet:g,matches:O,isDataRoute:n!=null},children:V})};return n&&(y.route.ErrorBoundary||y.route.errorElement||_===0)?ue.createElement(QR,{location:n.location,revalidation:n.revalidation,component:k,error:x,children:B(),routeContext:{outlet:null,matches:O,isDataRoute:!0}}):B()},null)}var nE=(function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t})(nE||{}),rE=(function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t})(rE||{});function JR(t){let e=ue.useContext(Jg);return e||kn(!1),e}function ZR(t){let e=ue.useContext($R);return e||kn(!1),e}function ek(t){let e=ue.useContext(Ni);return e||kn(!1),e}function sE(t){let e=ek(),n=e.matches[e.matches.length-1];return n.route.id||kn(!1),n.route.id}function tk(){var t;let e=ue.useContext(ZT),n=ZR(),r=sE();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function nk(){let{router:t}=JR(nE.UseNavigateStable),e=sE(rE.UseNavigateStable),n=ue.useRef(!1);return eE(()=>{n.current=!0}),ue.useCallback(function(s,o){o===void 0&&(o={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,lu({fromRouteId:e},o)))},[t,e])}const Cw={};function rk(t,e,n){Cw[t]||(Cw[t]=!0)}function sk(t,e){t?.v7_startTransition,t?.v7_relativeSplatPath}function cu(t){let{to:e,replace:n,state:r,relative:s}=t;Vl()||kn(!1);let{future:o,static:l}=ue.useContext(Ao),{matches:d}=ue.useContext(Ni),{pathname:h}=ks(),f=ts(),g=Yg(e,Xg(d,o.v7_relativeSplatPath),h,s==="path"),y=JSON.stringify(g);return ue.useEffect(()=>f(JSON.parse(y),{replace:n,state:r,relative:s}),[f,y,s,n,r]),null}function Sn(t){kn(!1)}function ik(t){let{basename:e="/",children:n=null,location:r,navigationType:s=lo.Pop,navigator:o,static:l=!1,future:d}=t;Vl()&&kn(!1);let h=e.replace(/^\/*/,"/"),f=ue.useMemo(()=>({basename:h,navigator:o,static:l,future:lu({v7_relativeSplatPath:!1},d)}),[h,d,o,l]);typeof r=="string"&&(r=_a(r));let{pathname:g="/",search:y="",hash:_="",state:x=null,key:I="default"}=r,k=ue.useMemo(()=>{let S=Qg(g,h);return S==null?null:{location:{pathname:S,search:y,hash:_,state:x,key:I},navigationType:s}},[h,g,y,_,x,I,s]);return k==null?null:ue.createElement(Ao.Provider,{value:f},ue.createElement(hf.Provider,{children:n,value:k}))}function ok(t){let{children:e,location:n}=t;return WR(Jp(e),n)}new Promise(()=>{});function Jp(t,e){e===void 0&&(e=[]);let n=[];return ue.Children.forEach(t,(r,s)=>{if(!ue.isValidElement(r))return;let o=[...e,s];if(r.type===ue.Fragment){n.push.apply(n,Jp(r.props.children,o));return}r.type!==Sn&&kn(!1),!r.props.index||!r.props.children||kn(!1);let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=Jp(r.props.children,o)),n.push(l)}),n}function Zp(){return Zp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Zp.apply(this,arguments)}function ak(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,o;for(o=0;o<r.length;o++)s=r[o],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function lk(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ck(t,e){return t.button===0&&(!e||e==="_self")&&!lk(t)}function eg(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function uk(t,e){let n=eg(t);return e&&e.forEach((r,s)=>{n.has(s)||e.getAll(s).forEach(o=>{n.append(s,o)})}),n}const dk=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],hk="6";try{window.__reactRouterVersion=hk}catch{}const fk="startTransition",Aw=aR[fk];function mk(t){let{basename:e,children:n,future:r,window:s}=t,o=ue.useRef();o.current==null&&(o.current=pR({window:s,v5Compat:!0}));let l=o.current,[d,h]=ue.useState({action:l.action,location:l.location}),{v7_startTransition:f}=r||{},g=ue.useCallback(y=>{f&&Aw?Aw(()=>h(y)):h(y)},[h,f]);return ue.useLayoutEffect(()=>l.listen(g),[l,g]),ue.useEffect(()=>sk(r),[r]),ue.createElement(ik,{basename:e,children:n,location:d.location,navigationType:d.action,navigator:l,future:r})}const pk=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",gk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ea=ue.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:o,replace:l,state:d,target:h,to:f,preventScrollReset:g,viewTransition:y}=e,_=ak(e,dk),{basename:x}=ue.useContext(Ao),I,k=!1;if(typeof f=="string"&&gk.test(f)&&(I=f,pk))try{let V=new URL(window.location.href),$=f.startsWith("//")?new URL(V.protocol+f):new URL(f),F=Qg($.pathname,x);$.origin===V.origin&&F!=null?f=F+$.search+$.hash:k=!0}catch{}let S=zR(f,{relative:s}),O=yk(f,{replace:l,state:d,target:h,preventScrollReset:g,relative:s,viewTransition:y});function B(V){r&&r(V),V.defaultPrevented||O(V)}return ue.createElement("a",Zp({},_,{href:I||S,onClick:k||o?r:B,ref:n,target:h}))});var Rw;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Rw||(Rw={}));var kw;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(kw||(kw={}));function yk(t,e){let{target:n,replace:r,state:s,preventScrollReset:o,relative:l,viewTransition:d}=e===void 0?{}:e,h=ts(),f=ks(),g=tE(t,{relative:l});return ue.useCallback(y=>{if(ck(y,n)){y.preventDefault();let _=r!==void 0?r:Ah(f)===Ah(g);h(t,{replace:_,state:s,preventScrollReset:o,relative:l,viewTransition:d})}},[f,h,g,r,s,n,t,o,l,d])}function iE(t){let e=ue.useRef(eg(t)),n=ue.useRef(!1),r=ks(),s=ue.useMemo(()=>uk(r.search,n.current?null:e.current),[r.search]),o=ts(),l=ue.useCallback((d,h)=>{const f=eg(typeof d=="function"?d(s):d);n.current=!0,o("?"+f,h)},[o,s]);return[s,l]}const vk=()=>{};var Pw={};const oE=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},_k=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=t[n++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=t[n++],l=t[n++],d=t[n++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|d&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=t[n++],l=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return e.join("")},aE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const o=t[s],l=s+1<t.length,d=l?t[s+1]:0,h=s+2<t.length,f=h?t[s+2]:0,g=o>>2,y=(o&3)<<4|d>>4;let _=(d&15)<<2|f>>6,x=f&63;h||(x=64,l||(_=64)),r.push(n[g],n[y],n[_],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(oE(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):_k(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const o=n[t.charAt(s++)],d=s<t.length?n[t.charAt(s)]:0;++s;const f=s<t.length?n[t.charAt(s)]:64;++s;const y=s<t.length?n[t.charAt(s)]:64;if(++s,o==null||d==null||f==null||y==null)throw new wk;const _=o<<2|d>>4;if(r.push(_),f!==64){const x=d<<4&240|f>>2;if(r.push(x),y!==64){const I=f<<6&192|y;r.push(I)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class wk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const bk=function(t){const e=oE(t);return aE.encodeByteArray(e,!0)},Rh=function(t){return bk(t).replace(/\./g,"")},lE=function(t){try{return aE.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function xk(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Tk=()=>xk().__FIREBASE_DEFAULTS__,Ek=()=>{if(typeof process>"u"||typeof Pw>"u")return;const t=Pw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Ik=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&lE(t[1]);return e&&JSON.parse(e)},ff=()=>{try{return vk()||Tk()||Ek()||Ik()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},cE=t=>ff()?.emulatorHosts?.[t],Sk=t=>{const e=cE(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},uE=()=>ff()?.config,dE=t=>ff()?.[`_${t}`];class Ck{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}function Ol(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hE(t){return(await fetch(t,{credentials:"include"})).ok}function Ak(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Rh(JSON.stringify(n)),Rh(JSON.stringify(l)),""].join(".")}const Gc={};function Rk(){const t={prod:[],emulator:[]};for(const e of Object.keys(Gc))Gc[e]?t.emulator.push(e):t.prod.push(e);return t}function kk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let jw=!1;function fE(t,e){if(typeof window>"u"||typeof document>"u"||!Ol(window.location.host)||Gc[t]===e||Gc[t]||jw)return;Gc[t]=e;function n(_){return`__firebase__banner__${_}`}const r="__firebase__banner",o=Rk().prod.length>0;function l(){const _=document.getElementById(r);_&&_.remove()}function d(_){_.style.display="flex",_.style.background="#7faaf0",_.style.position="fixed",_.style.bottom="5px",_.style.left="5px",_.style.padding=".5em",_.style.borderRadius="5px",_.style.alignItems="center"}function h(_,x){_.setAttribute("width","24"),_.setAttribute("id",x),_.setAttribute("height","24"),_.setAttribute("viewBox","0 0 24 24"),_.setAttribute("fill","none"),_.style.marginLeft="-6px"}function f(){const _=document.createElement("span");return _.style.cursor="pointer",_.style.marginLeft="16px",_.style.fontSize="24px",_.innerHTML=" &times;",_.onclick=()=>{jw=!0,l()},_}function g(_,x){_.setAttribute("id",x),_.innerText="Learn more",_.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",_.setAttribute("target","__blank"),_.style.paddingLeft="5px",_.style.textDecoration="underline"}function y(){const _=kk(r),x=n("text"),I=document.getElementById(x)||document.createElement("span"),k=n("learnmore"),S=document.getElementById(k)||document.createElement("a"),O=n("preprendIcon"),B=document.getElementById(O)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(_.created){const V=_.element;d(V),g(S,k);const $=f();h(B,O),V.append(B,I,S,$),document.body.appendChild(V)}o?(I.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,I.innerText="Preview backend running in this workspace."),I.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function Er(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Pk(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Er())}function jk(){const t=ff()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Nk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Mk(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Dk(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Lk(){const t=Er();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Vk(){return!jk()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ok(){try{return typeof indexedDB=="object"}catch{return!1}}function Fk(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}const Bk="FirebaseError";class Mi extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Bk,Object.setPrototypeOf(this,Mi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ku.prototype.create)}}class ku{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,o=this.errors[e],l=o?Uk(o,r):"Error",d=`${this.serviceName}: ${l} (${s}).`;return new Mi(s,d,r)}}function Uk(t,e){return t.replace($k,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const $k=/\{\$([^}]+)}/g;function zk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Si(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const o=t[s],l=e[s];if(Nw(o)&&Nw(l)){if(!Si(o,l))return!1}else if(o!==l)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Nw(t){return t!==null&&typeof t=="object"}function Pu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Oc(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,o]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(o)}}),e}function Fc(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function qk(t,e){const n=new Wk(t,e);return n.subscribe.bind(n)}class Wk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Hk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=vp),s.error===void 0&&(s.error=vp),s.complete===void 0&&(s.complete=vp);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Hk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function vp(){}function un(t){return t&&t._delegate?t._delegate:t}class fa{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const na="[DEFAULT]";class Kk{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Ck;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Qk(e))try{this.getOrInitializeService({instanceIdentifier:na})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=na){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=na){return this.instances.has(e)}getOptions(e=na){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[o,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);r===d&&l.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Gk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=na){return this.component?this.component.multipleInstances?e:na:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Gk(t){return t===na?void 0:t}function Qk(t){return t.instantiationMode==="EAGER"}class Xk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Kk(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var wt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(wt||(wt={}));const Yk={debug:wt.DEBUG,verbose:wt.VERBOSE,info:wt.INFO,warn:wt.WARN,error:wt.ERROR,silent:wt.SILENT},Jk=wt.INFO,Zk={[wt.DEBUG]:"log",[wt.VERBOSE]:"log",[wt.INFO]:"info",[wt.WARN]:"warn",[wt.ERROR]:"error"},eP=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Zk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Zg{constructor(e){this.name=e,this._logLevel=Jk,this._logHandler=eP,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Yk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wt.DEBUG,...e),this._logHandler(this,wt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wt.VERBOSE,...e),this._logHandler(this,wt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wt.INFO,...e),this._logHandler(this,wt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wt.WARN,...e),this._logHandler(this,wt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wt.ERROR,...e),this._logHandler(this,wt.ERROR,...e)}}const tP=(t,e)=>e.some(n=>t instanceof n);let Mw,Dw;function nP(){return Mw||(Mw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rP(){return Dw||(Dw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const mE=new WeakMap,tg=new WeakMap,pE=new WeakMap,_p=new WeakMap,ey=new WeakMap;function sP(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",o),t.removeEventListener("error",l)},o=()=>{n(fo(t.result)),s()},l=()=>{r(t.error),s()};t.addEventListener("success",o),t.addEventListener("error",l)});return e.then(n=>{n instanceof IDBCursor&&mE.set(n,t)}).catch(()=>{}),ey.set(e,t),e}function iP(t){if(tg.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",l),t.removeEventListener("abort",l)},o=()=>{n(),s()},l=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",o),t.addEventListener("error",l),t.addEventListener("abort",l)});tg.set(t,e)}let ng={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return tg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||pE.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return fo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function oP(t){ng=t(ng)}function aP(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(wp(this),e,...n);return pE.set(r,e.sort?e.sort():[e]),fo(r)}:rP().includes(t)?function(...e){return t.apply(wp(this),e),fo(mE.get(this))}:function(...e){return fo(t.apply(wp(this),e))}}function lP(t){return typeof t=="function"?aP(t):(t instanceof IDBTransaction&&iP(t),tP(t,nP())?new Proxy(t,ng):t)}function fo(t){if(t instanceof IDBRequest)return sP(t);if(_p.has(t))return _p.get(t);const e=lP(t);return e!==t&&(_p.set(t,e),ey.set(e,t)),e}const wp=t=>ey.get(t);function cP(t,e,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const l=indexedDB.open(t,e),d=fo(l);return r&&l.addEventListener("upgradeneeded",h=>{r(fo(l.result),h.oldVersion,h.newVersion,fo(l.transaction),h)}),n&&l.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),d.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),d}const uP=["get","getKey","getAll","getAllKeys","count"],dP=["put","add","delete","clear"],bp=new Map;function Lw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(bp.get(e))return bp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=dP.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||uP.includes(n)))return;const o=async function(l,...d){const h=this.transaction(l,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(d.shift())),(await Promise.all([f[n](...d),s&&h.done]))[0]};return bp.set(e,o),o}oP(t=>({...t,get:(e,n,r)=>Lw(e,n)||t.get(e,n,r),has:(e,n)=>!!Lw(e,n)||t.has(e,n)}));class hP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(fP(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function fP(t){return t.getComponent()?.type==="VERSION"}const rg="@firebase/app",Vw="0.14.6";const Ci=new Zg("@firebase/app"),mP="@firebase/app-compat",pP="@firebase/analytics-compat",gP="@firebase/analytics",yP="@firebase/app-check-compat",vP="@firebase/app-check",_P="@firebase/auth",wP="@firebase/auth-compat",bP="@firebase/database",xP="@firebase/data-connect",TP="@firebase/database-compat",EP="@firebase/functions",IP="@firebase/functions-compat",SP="@firebase/installations",CP="@firebase/installations-compat",AP="@firebase/messaging",RP="@firebase/messaging-compat",kP="@firebase/performance",PP="@firebase/performance-compat",jP="@firebase/remote-config",NP="@firebase/remote-config-compat",MP="@firebase/storage",DP="@firebase/storage-compat",LP="@firebase/firestore",VP="@firebase/ai",OP="@firebase/firestore-compat",FP="firebase",BP="12.6.0";const sg="[DEFAULT]",UP={[rg]:"fire-core",[mP]:"fire-core-compat",[gP]:"fire-analytics",[pP]:"fire-analytics-compat",[vP]:"fire-app-check",[yP]:"fire-app-check-compat",[_P]:"fire-auth",[wP]:"fire-auth-compat",[bP]:"fire-rtdb",[xP]:"fire-data-connect",[TP]:"fire-rtdb-compat",[EP]:"fire-fn",[IP]:"fire-fn-compat",[SP]:"fire-iid",[CP]:"fire-iid-compat",[AP]:"fire-fcm",[RP]:"fire-fcm-compat",[kP]:"fire-perf",[PP]:"fire-perf-compat",[jP]:"fire-rc",[NP]:"fire-rc-compat",[MP]:"fire-gcs",[DP]:"fire-gcs-compat",[LP]:"fire-fst",[OP]:"fire-fst-compat",[VP]:"fire-vertex","fire-js":"fire-js",[FP]:"fire-js-all"};const kh=new Map,$P=new Map,ig=new Map;function Ow(t,e){try{t.container.addComponent(e)}catch(n){Ci.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function wl(t){const e=t.name;if(ig.has(e))return Ci.debug(`There were multiple attempts to register component ${e}.`),!1;ig.set(e,t);for(const n of kh.values())Ow(n,t);for(const n of $P.values())Ow(n,t);return!0}function ty(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Qr(t){return t==null?!1:t.settings!==void 0}const zP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mo=new ku("app","Firebase",zP);class qP{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new fa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mo.create("app-deleted",{appName:this._name})}}const Fl=BP;function gE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:sg,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw mo.create("bad-app-name",{appName:String(s)});if(n||(n=uE()),!n)throw mo.create("no-options");const o=kh.get(s);if(o){if(Si(n,o.options)&&Si(r,o.config))return o;throw mo.create("duplicate-app",{appName:s})}const l=new Xk(s);for(const h of ig.values())l.addComponent(h);const d=new qP(n,r,l);return kh.set(s,d),d}function yE(t=sg){const e=kh.get(t);if(!e&&t===sg&&uE())return gE();if(!e)throw mo.create("no-app",{appName:t});return e}function po(t,e,n){let r=UP[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const l=[`Unable to register library "${r}" with version "${e}":`];s&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ci.warn(l.join(" "));return}wl(new fa(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const WP="firebase-heartbeat-database",HP=1,uu="firebase-heartbeat-store";let xp=null;function vE(){return xp||(xp=cP(WP,HP,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(uu)}catch(n){console.warn(n)}}}}).catch(t=>{throw mo.create("idb-open",{originalErrorMessage:t.message})})),xp}async function KP(t){try{const n=(await vE()).transaction(uu),r=await n.objectStore(uu).get(_E(t));return await n.done,r}catch(e){if(e instanceof Mi)Ci.warn(e.message);else{const n=mo.create("idb-get",{originalErrorMessage:e?.message});Ci.warn(n.message)}}}async function Fw(t,e){try{const r=(await vE()).transaction(uu,"readwrite");await r.objectStore(uu).put(e,_E(t)),await r.done}catch(n){if(n instanceof Mi)Ci.warn(n.message);else{const r=mo.create("idb-set",{originalErrorMessage:n?.message});Ci.warn(r.message)}}}function _E(t){return`${t.name}!${t.options.appId}`}const GP=1024,QP=30;class XP{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new JP(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Bw();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>QP){const s=ZP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ci.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Bw(),{heartbeatsToSend:n,unsentEntries:r}=YP(this._heartbeatsCache.heartbeats),s=Rh(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Ci.warn(e),""}}}function Bw(){return new Date().toISOString().substring(0,10)}function YP(t,e=GP){const n=[];let r=t.slice();for(const s of t){const o=n.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Uw(n)>e){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Uw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class JP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ok()?Fk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await KP(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Fw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Fw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Uw(t){return Rh(JSON.stringify({version:2,heartbeats:t})).length}function ZP(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}function ej(t){wl(new fa("platform-logger",e=>new hP(e),"PRIVATE")),wl(new fa("heartbeat",e=>new XP(e),"PRIVATE")),po(rg,Vw,t),po(rg,Vw,"esm2020"),po("fire-js","")}ej("");function wE(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tj=wE,bE=new ku("auth","Firebase",wE());const Ph=new Zg("@firebase/auth");function nj(t,...e){Ph.logLevel<=wt.WARN&&Ph.warn(`Auth (${Fl}): ${t}`,...e)}function mh(t,...e){Ph.logLevel<=wt.ERROR&&Ph.error(`Auth (${Fl}): ${t}`,...e)}function us(t,...e){throw ry(t,...e)}function Is(t,...e){return ry(t,...e)}function ny(t,e,n){const r={...tj(),[e]:n};return new ku("auth","Firebase",r).create(e,{appName:t.name})}function Ti(t){return ny(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rj(t,e,n){const r=n;if(!(e instanceof r))throw r.name!==e.constructor.name&&us(t,"argument-error"),ny(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ry(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return bE.create(t,...e)}function tt(t,e,...n){if(!t)throw ry(e,...n)}function wi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw mh(e),new Error(e)}function Ai(t,e){t||wi(e)}function og(){return typeof self<"u"&&self.location?.href||""}function sj(){return $w()==="http:"||$w()==="https:"}function $w(){return typeof self<"u"&&self.location?.protocol||null}function ij(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sj()||Mk()||"connection"in navigator)?navigator.onLine:!0}function oj(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class ju{constructor(e,n){this.shortDelay=e,this.longDelay=n,Ai(n>e,"Short delay should be less than long delay!"),this.isMobile=Pk()||Dk()}get(){return ij()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sy(t,e){Ai(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class xE{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;wi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;wi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;wi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const aj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const lj=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cj=new ju(3e4,6e4);function Ro(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ko(t,e,n,r,s={}){return TE(t,s,async()=>{let o={},l={};r&&(e==="GET"?l=r:o={body:JSON.stringify(r)});const d=Pu({key:t.config.apiKey,...l}).slice(1),h=await t._getAdditionalHeaders();h["Content-Type"]="application/json",t.languageCode&&(h["X-Firebase-Locale"]=t.languageCode);const f={method:e,headers:h,...o};return Nk()||(f.referrerPolicy="no-referrer"),t.emulatorConfig&&Ol(t.emulatorConfig.host)&&(f.credentials="include"),xE.fetch()(await EE(t,t.config.apiHost,n,d),f)})}async function TE(t,e,n){t._canInitEmulator=!1;const r={...aj,...e};try{const s=new dj(t),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const l=await o.json();if("needConfirmation"in l)throw Yd(t,"account-exists-with-different-credential",l);if(o.ok&&!("errorMessage"in l))return l;{const d=o.ok?l.errorMessage:l.error.message,[h,f]=d.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Yd(t,"credential-already-in-use",l);if(h==="EMAIL_EXISTS")throw Yd(t,"email-already-in-use",l);if(h==="USER_DISABLED")throw Yd(t,"user-disabled",l);const g=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw ny(t,g,f);us(t,g)}}catch(s){if(s instanceof Mi)throw s;us(t,"network-request-failed",{message:String(s)})}}async function Nu(t,e,n,r,s={}){const o=await ko(t,e,n,r,s);return"mfaPendingCredential"in o&&us(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function EE(t,e,n,r){const s=`${e}${n}?${r}`,o=t,l=o.config.emulator?sy(t.config,s):`${t.config.apiScheme}://${s}`;return lj.includes(n)&&(await o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(l).toString():l}function uj(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dj{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Is(this.auth,"network-request-failed")),cj.get())})}}function Yd(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Is(t,e,r);return s.customData._tokenResponse=n,s}function zw(t){return t!==void 0&&t.enterprise!==void 0}class hj{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return uj(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fj(t,e){return ko(t,"GET","/v2/recaptchaConfig",Ro(t,e))}async function mj(t,e){return ko(t,"POST","/v1/accounts:delete",e)}async function jh(t,e){return ko(t,"POST","/v1/accounts:lookup",e)}function Qc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function pj(t,e=!1){const n=un(t),r=await n.getIdToken(e),s=iy(r);tt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,l=o?.sign_in_provider;return{claims:s,token:r,authTime:Qc(Tp(s.auth_time)),issuedAtTime:Qc(Tp(s.iat)),expirationTime:Qc(Tp(s.exp)),signInProvider:l||null,signInSecondFactor:o?.sign_in_second_factor||null}}function Tp(t){return Number(t)*1e3}function iy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return mh("JWT malformed, contained fewer than 3 sections"),null;try{const s=lE(n);return s?JSON.parse(s):(mh("Failed to decode base64 JWT payload"),null)}catch(s){return mh("Caught error parsing JWT payload as JSON",s?.toString()),null}}function qw(t){const e=iy(t);return tt(e,"internal-error"),tt(typeof e.exp<"u","internal-error"),tt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function du(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Mi&&gj(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function gj({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class yj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ag{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qc(this.lastLoginAt),this.creationTime=Qc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function hu(t){const e=t.auth,n=await t.getIdToken(),r=await du(t,jh(e,{idToken:n}));tt(r?.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const o=s.providerUserInfo?.length?IE(s.providerUserInfo):[],l=_j(t.providerData,o),d=t.isAnonymous,h=!(t.email&&s.passwordHash)&&!l?.length,f=d?h:!1,g={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new ag(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(t,g)}async function vj(t){const e=un(t);await hu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _j(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function IE(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function wj(t,e){const n=await TE(t,{},async()=>{const r=Pu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:o}=t.config,l=await EE(t,s,"/v1/token",`key=${o}`),d=await t._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const h={method:"POST",headers:d,body:r};return t.emulatorConfig&&Ol(t.emulatorConfig.host)&&(h.credentials="include"),xE.fetch()(l,h)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function bj(t,e){return ko(t,"POST","/v2/accounts:revokeToken",Ro(t,e))}class ml{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tt(e.idToken,"internal-error"),tt(typeof e.idToken<"u","internal-error"),tt(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):qw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){tt(e.length!==0,"internal-error");const n=qw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(tt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:o}=await wj(e,n);this.updateTokensAndExpiration(r,s,Number(o))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:o}=n,l=new ml;return r&&(tt(typeof r=="string","internal-error",{appName:e}),l.refreshToken=r),s&&(tt(typeof s=="string","internal-error",{appName:e}),l.accessToken=s),o&&(tt(typeof o=="number","internal-error",{appName:e}),l.expirationTime=o),l}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ml,this.toJSON())}_performRefresh(){return wi("not implemented")}}function to(t,e){tt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Es{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new yj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ag(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await du(this,this.stsTokenManager.getToken(this.auth,e));return tt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return pj(this,e)}reload(){return vj(this)}_assign(e){this!==e&&(tt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Es({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){tt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await hu(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qr(this.auth.app))return Promise.reject(Ti(this.auth));const e=await this.getIdToken();return await du(this,mj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,o=n.phoneNumber??void 0,l=n.photoURL??void 0,d=n.tenantId??void 0,h=n._redirectEventId??void 0,f=n.createdAt??void 0,g=n.lastLoginAt??void 0,{uid:y,emailVerified:_,isAnonymous:x,providerData:I,stsTokenManager:k}=n;tt(y&&k,e,"internal-error");const S=ml.fromJSON(this.name,k);tt(typeof y=="string",e,"internal-error"),to(r,e.name),to(s,e.name),tt(typeof _=="boolean",e,"internal-error"),tt(typeof x=="boolean",e,"internal-error"),to(o,e.name),to(l,e.name),to(d,e.name),to(h,e.name),to(f,e.name),to(g,e.name);const O=new Es({uid:y,auth:e,email:s,emailVerified:_,displayName:r,isAnonymous:x,photoURL:l,phoneNumber:o,tenantId:d,stsTokenManager:S,createdAt:f,lastLoginAt:g});return I&&Array.isArray(I)&&(O.providerData=I.map(B=>({...B}))),h&&(O._redirectEventId=h),O}static async _fromIdTokenResponse(e,n,r=!1){const s=new ml;s.updateFromServerResponse(n);const o=new Es({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await hu(o),o}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];tt(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?IE(s.providerUserInfo):[],l=!(s.email&&s.passwordHash)&&!o?.length,d=new ml;d.updateFromIdToken(r);const h=new Es({uid:s.localId,auth:e,stsTokenManager:d,isAnonymous:l}),f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new ag(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!o?.length};return Object.assign(h,f),h}}const Ww=new Map;function bi(t){Ai(t instanceof Function,"Expected a class definition");let e=Ww.get(t);return e?(Ai(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ww.set(t,e),e)}class SE{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}SE.type="NONE";const Hw=SE;function ph(t,e,n){return`firebase:${t}:${e}:${n}`}class pl{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:o}=this.auth;this.fullUserKey=ph(this.userKey,s.apiKey,o),this.fullPersistenceKey=ph("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await jh(this.auth,{idToken:e}).catch(()=>{});return n?Es._fromGetAccountInfoResponse(this.auth,n,e):null}return Es._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new pl(bi(Hw),e,r);const s=(await Promise.all(n.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let o=s[0]||bi(Hw);const l=ph(r,e.config.apiKey,e.name);let d=null;for(const f of n)try{const g=await f._get(l);if(g){let y;if(typeof g=="string"){const _=await jh(e,{idToken:g}).catch(()=>{});if(!_)break;y=await Es._fromGetAccountInfoResponse(e,_,g)}else y=Es._fromJSON(e,g);f!==o&&(d=y),o=f;break}}catch{}const h=s.filter(f=>f._shouldAllowMigration);return!o._shouldAllowMigration||!h.length?new pl(o,e,r):(o=h[0],d&&await o._set(l,d.toJSON()),await Promise.all(n.map(async f=>{if(f!==o)try{await f._remove(l)}catch{}})),new pl(o,e,r))}}function Kw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(kE(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(CE(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(jE(e))return"Blackberry";if(NE(e))return"Webos";if(AE(e))return"Safari";if((e.includes("chrome/")||RE(e))&&!e.includes("edge/"))return"Chrome";if(PE(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if(r?.length===2)return r[1]}return"Other"}function CE(t=Er()){return/firefox\//i.test(t)}function AE(t=Er()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function RE(t=Er()){return/crios\//i.test(t)}function kE(t=Er()){return/iemobile/i.test(t)}function PE(t=Er()){return/android/i.test(t)}function jE(t=Er()){return/blackberry/i.test(t)}function NE(t=Er()){return/webos/i.test(t)}function oy(t=Er()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function xj(t=Er()){return oy(t)&&!!window.navigator?.standalone}function Tj(){return Lk()&&document.documentMode===10}function ME(t=Er()){return oy(t)||PE(t)||NE(t)||jE(t)||/windows phone/i.test(t)||kE(t)}function DE(t,e=[]){let n;switch(t){case"Browser":n=Kw(Er());break;case"Worker":n=`${Kw(Er())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Fl}/${r}`}class Ej{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=o=>new Promise((l,d)=>{try{const h=e(o);l(h)}catch(h){d(h)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function Ij(t,e={}){return ko(t,"GET","/v2/passwordPolicy",Ro(t,e))}const Sj=6;class Cj{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??Sj,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}}class Aj{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gw(this),this.idTokenSubscription=new Gw(this),this.beforeStateQueue=new Ej(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bE,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=bi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await pl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await jh(this,{idToken:e}),r=await Es._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(Qr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=this.redirectUser?._redirectEventId,l=r?._redirectEventId,d=await this.tryRedirectSignIn(e);(!o||o===l)&&d?.user&&(r=d.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return tt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await hu(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=oj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qr(this.app))return Promise.reject(Ti(this));const n=e?un(e):null;return n&&tt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&tt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qr(this.app)?Promise.reject(Ti(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qr(this.app)?Promise.reject(Ti(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(bi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Ij(this),n=new Cj(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ku("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await bj(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&bi(e)||this._popupRedirectResolver;tt(n,this,"argument-error"),this.redirectPersistenceManager=await pl.create(this,[bi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let l=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(tt(d,this,"internal-error"),d.then(()=>{l||o(this.currentUser)}),typeof n=="function"){const h=e.addObserver(n,r,s);return()=>{l=!0,h()}}else{const h=e.addObserver(n);return()=>{l=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=DE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(Qr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&nj(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Po(t){return un(t)}class Gw{constructor(e){this.auth=e,this.observer=null,this.addObserver=qk(n=>this.observer=n)}get next(){return tt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let mf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Rj(t){mf=t}function LE(t){return mf.loadJS(t)}function kj(){return mf.recaptchaEnterpriseScript}function Pj(){return mf.gapiScript}function jj(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Nj{constructor(){this.enterprise=new Mj}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Mj{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Dj="recaptcha-enterprise",VE="NO_RECAPTCHA";class Lj{constructor(e){this.type=Dj,this.auth=Po(e)}async verify(e="verify",n=!1){async function r(o){if(!n){if(o.tenantId==null&&o._agentRecaptchaConfig!=null)return o._agentRecaptchaConfig.siteKey;if(o.tenantId!=null&&o._tenantRecaptchaConfigs[o.tenantId]!==void 0)return o._tenantRecaptchaConfigs[o.tenantId].siteKey}return new Promise(async(l,d)=>{fj(o,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)d(new Error("recaptcha Enterprise site key undefined"));else{const f=new hj(h);return o.tenantId==null?o._agentRecaptchaConfig=f:o._tenantRecaptchaConfigs[o.tenantId]=f,l(f.siteKey)}}).catch(h=>{d(h)})})}function s(o,l,d){const h=window.grecaptcha;zw(h)?h.enterprise.ready(()=>{h.enterprise.execute(o,{action:e}).then(f=>{l(f)}).catch(()=>{l(VE)})}):d(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Nj().execute("siteKey",{action:"verify"}):new Promise((o,l)=>{r(this.auth).then(d=>{if(!n&&zw(window.grecaptcha))s(d,o,l);else{if(typeof window>"u"){l(new Error("RecaptchaVerifier is only supported in browser"));return}let h=kj();h.length!==0&&(h+=d),LE(h).then(()=>{s(d,o,l)}).catch(f=>{l(f)})}}).catch(d=>{l(d)})})}}async function Qw(t,e,n,r=!1,s=!1){const o=new Lj(t);let l;if(s)l=VE;else try{l=await o.verify(n)}catch{l=await o.verify(n,!0)}const d={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in d){const h=d.phoneEnrollmentInfo.phoneNumber,f=d.phoneEnrollmentInfo.recaptchaToken;Object.assign(d,{phoneEnrollmentInfo:{phoneNumber:h,recaptchaToken:f,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in d){const h=d.phoneSignInInfo.recaptchaToken;Object.assign(d,{phoneSignInInfo:{recaptchaToken:h,captchaResponse:l,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return d}return r?Object.assign(d,{captchaResp:l}):Object.assign(d,{captchaResponse:l}),Object.assign(d,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(d,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),d}async function Xw(t,e,n,r,s){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Qw(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Qw(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}function Vj(t,e){const n=ty(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),o=n.getOptions();if(Si(o,e??{}))return s;us(s,"already-initialized")}return n.initialize({options:e})}function Oj(t,e){const n=e?.persistence||[],r=(Array.isArray(n)?n:[n]).map(bi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e?.popupRedirectResolver)}function Fj(t,e,n){const r=Po(t);tt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,o=OE(e),{host:l,port:d}=Bj(e),h=d===null?"":`:${d}`,f={url:`${o}//${l}${h}/`},g=Object.freeze({host:l,port:d,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){tt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),tt(Si(f,r.config.emulator)&&Si(g,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=f,r.emulatorConfig=g,r.settings.appVerificationDisabledForTesting=!0,Ol(l)?(hE(`${o}//${l}${h}`),fE("Auth",!0)):Uj()}function OE(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Bj(t){const e=OE(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const o=s[1];return{host:o,port:Yw(r.substr(o.length+1))}}else{const[o,l]=r.split(":");return{host:o,port:Yw(l)}}}function Yw(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Uj(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class ay{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return wi("not implemented")}_getIdTokenResponse(e){return wi("not implemented")}_linkToIdToken(e,n){return wi("not implemented")}_getReauthenticationResolver(e){return wi("not implemented")}}async function $j(t,e){return ko(t,"POST","/v1/accounts:signUp",e)}async function zj(t,e){return Nu(t,"POST","/v1/accounts:signInWithPassword",Ro(t,e))}async function qj(t,e){return Nu(t,"POST","/v1/accounts:signInWithEmailLink",Ro(t,e))}async function Wj(t,e){return Nu(t,"POST","/v1/accounts:signInWithEmailLink",Ro(t,e))}class fu extends ay{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new fu(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new fu(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xw(e,n,"signInWithPassword",zj);case"emailLink":return qj(e,{email:this._email,oobCode:this._password});default:us(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xw(e,r,"signUpPassword",$j);case"emailLink":return Wj(e,{idToken:n,email:this._email,oobCode:this._password});default:us(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function gl(t,e){return Nu(t,"POST","/v1/accounts:signInWithIdp",Ro(t,e))}const Hj="http://localhost";class ma extends ay{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ma(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):us("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...o}=n;if(!r||!s)return null;const l=new ma(r,s);return l.idToken=o.idToken||void 0,l.accessToken=o.accessToken||void 0,l.secret=o.secret,l.nonce=o.nonce,l.pendingToken=o.pendingToken||null,l}_getIdTokenResponse(e){const n=this.buildRequest();return gl(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,gl(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,gl(e,n)}buildRequest(){const e={requestUri:Hj,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Pu(n)}return e}}function Kj(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Gj(t){const e=Oc(Fc(t)).link,n=e?Oc(Fc(e)).deep_link_id:null,r=Oc(Fc(t)).deep_link_id;return(r?Oc(Fc(r)).link:null)||r||n||e||t}class ly{constructor(e){const n=Oc(Fc(e)),r=n.apiKey??null,s=n.oobCode??null,o=Kj(n.mode??null);tt(r&&s&&o,"argument-error"),this.apiKey=r,this.operation=o,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Gj(e);try{return new ly(n)}catch{return null}}}class wa{constructor(){this.providerId=wa.PROVIDER_ID}static credential(e,n){return fu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=ly.parseLink(n);return tt(r,"argument-error"),fu._fromEmailAndCode(e,r.code,r.tenantId)}}wa.PROVIDER_ID="password";wa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";wa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class cy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Mu extends cy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class so extends Mu{constructor(){super("facebook.com")}static credential(e){return ma._fromParams({providerId:so.PROVIDER_ID,signInMethod:so.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return so.credentialFromTaggedObject(e)}static credentialFromError(e){return so.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return so.credential(e.oauthAccessToken)}catch{return null}}}so.FACEBOOK_SIGN_IN_METHOD="facebook.com";so.PROVIDER_ID="facebook.com";class vi extends Mu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ma._fromParams({providerId:vi.PROVIDER_ID,signInMethod:vi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return vi.credentialFromTaggedObject(e)}static credentialFromError(e){return vi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return vi.credential(n,r)}catch{return null}}}vi.GOOGLE_SIGN_IN_METHOD="google.com";vi.PROVIDER_ID="google.com";class io extends Mu{constructor(){super("github.com")}static credential(e){return ma._fromParams({providerId:io.PROVIDER_ID,signInMethod:io.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return io.credentialFromTaggedObject(e)}static credentialFromError(e){return io.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return io.credential(e.oauthAccessToken)}catch{return null}}}io.GITHUB_SIGN_IN_METHOD="github.com";io.PROVIDER_ID="github.com";class oo extends Mu{constructor(){super("twitter.com")}static credential(e,n){return ma._fromParams({providerId:oo.PROVIDER_ID,signInMethod:oo.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return oo.credentialFromTaggedObject(e)}static credentialFromError(e){return oo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return oo.credential(n,r)}catch{return null}}}oo.TWITTER_SIGN_IN_METHOD="twitter.com";oo.PROVIDER_ID="twitter.com";async function Qj(t,e){return Nu(t,"POST","/v1/accounts:signUp",Ro(t,e))}class _o{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const o=await Es._fromIdTokenResponse(e,r,s),l=Jw(r);return new _o({user:o,providerId:l,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Jw(r);return new _o({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Jw(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}async function FE(t){if(Qr(t.app))return Promise.reject(Ti(t));const e=Po(t);if(await e._initializationPromise,e.currentUser?.isAnonymous)return new _o({user:e.currentUser,providerId:null,operationType:"signIn"});const n=await Qj(e,{returnSecureToken:!0}),r=await _o._fromIdTokenResponse(e,"signIn",n,!0);return await e._updateCurrentUser(r.user),r}class Nh extends Mi{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Nh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Nh(e,n,r,s)}}function BE(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?Nh._fromErrorAndOperation(t,o,e,r):o})}function Xj(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function UE(t,e,n=!1){const r=await du(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return _o._forOperation(t,"link",r)}async function Yj(t,e,n){await hu(e);const r=Xj(e.providerData);tt(r.has(n)===t,e.auth,"provider-already-linked")}async function Jj(t,e,n=!1){const{auth:r}=t;if(Qr(r.app))return Promise.reject(Ti(r));const s="reauthenticate";try{const o=await du(t,BE(r,s,e,t),n);tt(o.idToken,r,"internal-error");const l=iy(o.idToken);tt(l,r,"internal-error");const{sub:d}=l;return tt(t.uid===d,r,"user-mismatch"),_o._forOperation(t,s,o)}catch(o){throw o?.code==="auth/user-not-found"&&us(r,"user-mismatch"),o}}async function $E(t,e,n=!1){if(Qr(t.app))return Promise.reject(Ti(t));const r="signIn",s=await BE(t,r,e),o=await _o._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(o.user),o}async function Zj(t,e){return $E(Po(t),e)}async function eN(t,e){const n=un(t);return await Yj(!1,n,e.providerId),UE(n,e)}async function tN(t){const e=Po(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function nN(t,e,n){return Qr(t.app)?Promise.reject(Ti(t)):Zj(un(t),wa.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&tN(t),r})}function rN(t,e,n,r){return un(t).onIdTokenChanged(e,n,r)}function sN(t,e,n){return un(t).beforeAuthStateChanged(e,n)}function iN(t,e,n,r){return un(t).onAuthStateChanged(e,n,r)}function oN(t){return un(t).signOut()}const Mh="__sak";class zE{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Mh,"1"),this.storage.removeItem(Mh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const aN=1e3,lN=10;class qE extends zE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ME(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((l,d,h)=>{this.notifyListeners(l,h)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const l=this.storage.getItem(r);!n&&this.localCache[r]===l||this.notifyListeners(r,l)},o=this.storage.getItem(r);Tj()&&o!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,lN):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},aN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}qE.type="LOCAL";const cN=qE;class WE extends zE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}WE.type="SESSION";const HE=WE;function uN(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class pf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new pf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:o}=n.data,l=this.handlersMap[s];if(!l?.size)return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const d=Array.from(l).map(async f=>f(n.origin,o)),h=await uN(d);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:h})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}pf.receivers=[];function uy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}class dN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let o,l;return new Promise((d,h)=>{const f=uy("",20);s.port1.start();const g=setTimeout(()=>{h(new Error("unsupported_event"))},r);l={messageChannel:s,onMessage(y){const _=y;if(_.data.eventId===f)switch(_.data.status){case"ack":clearTimeout(g),o=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),d(_.data.response);break;default:clearTimeout(g),clearTimeout(o),h(new Error("invalid_response"));break}}},this.handlers.add(l),s.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:f,data:n},[s.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function Qs(){return window}function hN(t){Qs().location.href=t}function KE(){return typeof Qs().WorkerGlobalScope<"u"&&typeof Qs().importScripts=="function"}async function fN(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mN(){return navigator?.serviceWorker?.controller||null}function pN(){return KE()?self:null}const GE="firebaseLocalStorageDb",gN=1,Dh="firebaseLocalStorage",QE="fbase_key";class Du{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function gf(t,e){return t.transaction([Dh],e?"readwrite":"readonly").objectStore(Dh)}function yN(){const t=indexedDB.deleteDatabase(GE);return new Du(t).toPromise()}function lg(){const t=indexedDB.open(GE,gN);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Dh,{keyPath:QE})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Dh)?e(r):(r.close(),await yN(),e(await lg()))})})}async function Zw(t,e,n){const r=gf(t,!0).put({[QE]:e,value:n});return new Du(r).toPromise()}async function vN(t,e){const n=gf(t,!1).get(e),r=await new Du(n).toPromise();return r===void 0?null:r.value}function eb(t,e){const n=gf(t,!0).delete(e);return new Du(n).toPromise()}const _N=800,wN=3;class XE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await lg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>wN)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return KE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pf._getInstance(pN()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await fN(),!this.activeServiceWorker)return;this.sender=new dN(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await lg();return await Zw(e,Mh,"1"),await eb(e,Mh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Zw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>vN(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>eb(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const o=gf(s,!1).getAll();return new Du(o).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:o}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(o)&&(this.notifyListeners(s,o),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_N)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}XE.type="LOCAL";const bN=XE;new ju(3e4,6e4);function YE(t,e){return e?bi(e):(tt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class dy extends ay{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return gl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return gl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return gl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function xN(t){return $E(t.auth,new dy(t),t.bypassAuthState)}function TN(t){const{auth:e,user:n}=t;return tt(n,e,"internal-error"),Jj(n,new dy(t),t.bypassAuthState)}async function EN(t){const{auth:e,user:n}=t;return tt(n,e,"internal-error"),UE(n,new dy(t),t.bypassAuthState)}class JE{constructor(e,n,r,s,o=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:o,error:l,type:d}=e;if(l){this.reject(l);return}const h={auth:this.auth,requestUri:n,sessionId:r,tenantId:o||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xN;case"linkViaPopup":case"linkViaRedirect":return EN;case"reauthViaPopup":case"reauthViaRedirect":return TN;default:us(this.auth,"internal-error")}}resolve(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ai(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const IN=new ju(2e3,1e4);async function SN(t,e,n){if(Qr(t.app))return Promise.reject(Is(t,"operation-not-supported-in-this-environment"));const r=Po(t);rj(t,e,cy);const s=YE(r,n);return new aa(r,"signInViaPopup",e,s).executeNotNull()}class aa extends JE{constructor(e,n,r,s,o){super(e,n,s,o),this.provider=r,this.authWindow=null,this.pollId=null,aa.currentPopupAction&&aa.currentPopupAction.cancel(),aa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return tt(e,this.auth,"internal-error"),e}async onExecution(){Ai(this.filter.length===1,"Popup operations only handle one event");const e=uy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Is(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Is(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,aa.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Is(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,IN.get())};e()}}aa.currentPopupAction=null;const CN="pendingRedirect",gh=new Map;class AN extends JE{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=gh.get(this.auth._key());if(!e){try{const r=await RN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}gh.set(this.auth._key(),e)}return this.bypassAuthState||gh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RN(t,e){const n=jN(e),r=PN(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function kN(t,e){gh.set(t._key(),e)}function PN(t){return bi(t._redirectPersistence)}function jN(t){return ph(CN,t.config.apiKey,t.name)}async function NN(t,e,n=!1){if(Qr(t.app))return Promise.reject(Ti(t));const r=Po(t),s=YE(r,e),l=await new AN(r,s,n).execute();return l&&!n&&(delete l.user._redirectEventId,await r._persistUserIfCurrent(l.user),await r._setRedirectUser(null,e)),l}const MN=600*1e3;class DN{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!LN(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!ZE(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";n.onError(Is(this.auth,r))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=MN&&this.cachedEventUids.clear(),this.cachedEventUids.has(tb(e))}saveEventToCache(e){this.cachedEventUids.add(tb(e)),this.lastProcessedEventTime=Date.now()}}function tb(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function ZE({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function LN(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ZE(t);default:return!1}}async function VN(t,e={}){return ko(t,"GET","/v1/projects",e)}const ON=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,FN=/^https?/;async function BN(t){if(t.config.emulator)return;const{authorizedDomains:e}=await VN(t);for(const n of e)try{if(UN(n))return}catch{}us(t,"unauthorized-domain")}function UN(t){const e=og(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const l=new URL(t);return l.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&l.hostname===r}if(!FN.test(n))return!1;if(ON.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const $N=new ju(3e4,6e4);function nb(){const t=Qs().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function zN(t){return new Promise((e,n)=>{function r(){nb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nb(),n(Is(t,"network-request-failed"))},timeout:$N.get()})}if(Qs().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Qs().gapi?.load)r();else{const s=jj("iframefcb");return Qs()[s]=()=>{gapi.load?r():n(Is(t,"network-request-failed"))},LE(`${Pj()}?onload=${s}`).catch(o=>n(o))}}).catch(e=>{throw yh=null,e})}let yh=null;function qN(t){return yh=yh||zN(t),yh}const WN=new ju(5e3,15e3),HN="__/auth/iframe",KN="emulator/auth/iframe",GN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},QN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function XN(t){const e=t.config;tt(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?sy(e,KN):`https://${t.config.authDomain}/${HN}`,r={apiKey:e.apiKey,appName:t.name,v:Fl},s=QN.get(t.config.apiHost);s&&(r.eid=s);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Pu(r).slice(1)}`}async function YN(t){const e=await qN(t),n=Qs().gapi;return tt(n,t,"internal-error"),e.open({where:document.body,url:XN(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GN,dontclear:!0},r=>new Promise(async(s,o)=>{await r.restyle({setHideOnLeave:!1});const l=Is(t,"network-request-failed"),d=Qs().setTimeout(()=>{o(l)},WN.get());function h(){Qs().clearTimeout(d),s(r)}r.ping(h).then(h,()=>{o(l)})}))}const JN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},ZN=500,eM=600,tM="_blank",nM="http://localhost";class rb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rM(t,e,n,r=ZN,s=eM){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),l=Math.max((window.screen.availWidth-r)/2,0).toString();let d="";const h={...JN,width:r.toString(),height:s.toString(),top:o,left:l},f=Er().toLowerCase();n&&(d=RE(f)?tM:n),CE(f)&&(e=e||nM,h.scrollbars="yes");const g=Object.entries(h).reduce((_,[x,I])=>`${_}${x}=${I},`,"");if(xj(f)&&d!=="_self")return sM(e||"",d),new rb(null);const y=window.open(e||"",d,g);tt(y,t,"popup-blocked");try{y.focus()}catch{}return new rb(y)}function sM(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}const iM="__/auth/handler",oM="emulator/auth/handler",aM=encodeURIComponent("fac");async function sb(t,e,n,r,s,o){tt(t.config.authDomain,t,"auth-domain-config-required"),tt(t.config.apiKey,t,"invalid-api-key");const l={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Fl,eventId:s};if(e instanceof cy){e.setDefaultLanguage(t.languageCode),l.providerId=e.providerId||"",zk(e.getCustomParameters())||(l.customParameters=JSON.stringify(e.getCustomParameters()));for(const[g,y]of Object.entries({}))l[g]=y}if(e instanceof Mu){const g=e.getScopes().filter(y=>y!=="");g.length>0&&(l.scopes=g.join(","))}t.tenantId&&(l.tid=t.tenantId);const d=l;for(const g of Object.keys(d))d[g]===void 0&&delete d[g];const h=await t._getAppCheckToken(),f=h?`#${aM}=${encodeURIComponent(h)}`:"";return`${lM(t)}?${Pu(d).slice(1)}${f}`}function lM({config:t}){return t.emulator?sy(t,oM):`https://${t.authDomain}/${iM}`}const Ep="webStorageSupport";class cM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=HE,this._completeRedirectFn=NN,this._overrideRedirectResult=kN}async _openPopup(e,n,r,s){Ai(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const o=await sb(e,n,r,og(),s);return rM(e,o,uy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const o=await sb(e,n,r,og(),s);return hN(o),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:o}=this.eventManagers[n];return s?Promise.resolve(s):(Ai(o,"If manager is not set, promise should be"),o)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await YN(e),r=new DN(e);return n.register("authEvent",s=>(tt(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ep,{type:Ep},s=>{const o=s?.[0]?.[Ep];o!==void 0&&n(!!o),us(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=BN(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return ME()||AE()||oy()}}const uM=cM;var ib="@firebase/auth",ob="1.12.0";class dM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){tt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function hM(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fM(t){wl(new fa("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:d}=r.options;tt(l&&!l.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:l,authDomain:d,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:DE(t)},f=new Aj(r,s,o,h);return Oj(f,n),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),wl(new fa("auth-internal",e=>{const n=Po(e.getProvider("auth").getImmediate());return(r=>new dM(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),po(ib,ob,hM(t)),po(ib,ob,"esm2020")}const mM=300,pM=dE("authIdTokenMaxAge")||mM;let ab=null;const gM=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>pM)return;const s=n?.token;ab!==s&&(ab=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function yM(t=yE()){const e=ty(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Vj(t,{popupRedirectResolver:uM,persistence:[bN,cN,HE]}),r=dE("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const o=new URL(r,location.origin);if(location.origin===o.origin){const l=gM(o.toString());sN(n,l,()=>l(n.currentUser)),rN(n,d=>l(d))}}const s=cE("auth");return s&&Fj(n,`http://${s}`),n}function vM(){return document.getElementsByTagName("head")?.[0]??document}Rj({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const o=Is("internal-error");o.customData=s,n(o)},r.type="text/javascript",r.charset="UTF-8",vM().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fM("Browser");var lb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var go,eI;(function(){var t;function e(A,E){function P(){}P.prototype=E.prototype,A.F=E.prototype,A.prototype=new P,A.prototype.constructor=A,A.D=function(L,C,N){for(var M=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)M[ie-2]=arguments[ie];return E.prototype[C].apply(L,M)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,E,P){P||(P=0);const L=Array(16);if(typeof E=="string")for(var C=0;C<16;++C)L[C]=E.charCodeAt(P++)|E.charCodeAt(P++)<<8|E.charCodeAt(P++)<<16|E.charCodeAt(P++)<<24;else for(C=0;C<16;++C)L[C]=E[P++]|E[P++]<<8|E[P++]<<16|E[P++]<<24;E=A.g[0],P=A.g[1],C=A.g[2];let N=A.g[3],M;M=E+(N^P&(C^N))+L[0]+3614090360&4294967295,E=P+(M<<7&4294967295|M>>>25),M=N+(C^E&(P^C))+L[1]+3905402710&4294967295,N=E+(M<<12&4294967295|M>>>20),M=C+(P^N&(E^P))+L[2]+606105819&4294967295,C=N+(M<<17&4294967295|M>>>15),M=P+(E^C&(N^E))+L[3]+3250441966&4294967295,P=C+(M<<22&4294967295|M>>>10),M=E+(N^P&(C^N))+L[4]+4118548399&4294967295,E=P+(M<<7&4294967295|M>>>25),M=N+(C^E&(P^C))+L[5]+1200080426&4294967295,N=E+(M<<12&4294967295|M>>>20),M=C+(P^N&(E^P))+L[6]+2821735955&4294967295,C=N+(M<<17&4294967295|M>>>15),M=P+(E^C&(N^E))+L[7]+4249261313&4294967295,P=C+(M<<22&4294967295|M>>>10),M=E+(N^P&(C^N))+L[8]+1770035416&4294967295,E=P+(M<<7&4294967295|M>>>25),M=N+(C^E&(P^C))+L[9]+2336552879&4294967295,N=E+(M<<12&4294967295|M>>>20),M=C+(P^N&(E^P))+L[10]+4294925233&4294967295,C=N+(M<<17&4294967295|M>>>15),M=P+(E^C&(N^E))+L[11]+2304563134&4294967295,P=C+(M<<22&4294967295|M>>>10),M=E+(N^P&(C^N))+L[12]+1804603682&4294967295,E=P+(M<<7&4294967295|M>>>25),M=N+(C^E&(P^C))+L[13]+4254626195&4294967295,N=E+(M<<12&4294967295|M>>>20),M=C+(P^N&(E^P))+L[14]+2792965006&4294967295,C=N+(M<<17&4294967295|M>>>15),M=P+(E^C&(N^E))+L[15]+1236535329&4294967295,P=C+(M<<22&4294967295|M>>>10),M=E+(C^N&(P^C))+L[1]+4129170786&4294967295,E=P+(M<<5&4294967295|M>>>27),M=N+(P^C&(E^P))+L[6]+3225465664&4294967295,N=E+(M<<9&4294967295|M>>>23),M=C+(E^P&(N^E))+L[11]+643717713&4294967295,C=N+(M<<14&4294967295|M>>>18),M=P+(N^E&(C^N))+L[0]+3921069994&4294967295,P=C+(M<<20&4294967295|M>>>12),M=E+(C^N&(P^C))+L[5]+3593408605&4294967295,E=P+(M<<5&4294967295|M>>>27),M=N+(P^C&(E^P))+L[10]+38016083&4294967295,N=E+(M<<9&4294967295|M>>>23),M=C+(E^P&(N^E))+L[15]+3634488961&4294967295,C=N+(M<<14&4294967295|M>>>18),M=P+(N^E&(C^N))+L[4]+3889429448&4294967295,P=C+(M<<20&4294967295|M>>>12),M=E+(C^N&(P^C))+L[9]+568446438&4294967295,E=P+(M<<5&4294967295|M>>>27),M=N+(P^C&(E^P))+L[14]+3275163606&4294967295,N=E+(M<<9&4294967295|M>>>23),M=C+(E^P&(N^E))+L[3]+4107603335&4294967295,C=N+(M<<14&4294967295|M>>>18),M=P+(N^E&(C^N))+L[8]+1163531501&4294967295,P=C+(M<<20&4294967295|M>>>12),M=E+(C^N&(P^C))+L[13]+2850285829&4294967295,E=P+(M<<5&4294967295|M>>>27),M=N+(P^C&(E^P))+L[2]+4243563512&4294967295,N=E+(M<<9&4294967295|M>>>23),M=C+(E^P&(N^E))+L[7]+1735328473&4294967295,C=N+(M<<14&4294967295|M>>>18),M=P+(N^E&(C^N))+L[12]+2368359562&4294967295,P=C+(M<<20&4294967295|M>>>12),M=E+(P^C^N)+L[5]+4294588738&4294967295,E=P+(M<<4&4294967295|M>>>28),M=N+(E^P^C)+L[8]+2272392833&4294967295,N=E+(M<<11&4294967295|M>>>21),M=C+(N^E^P)+L[11]+1839030562&4294967295,C=N+(M<<16&4294967295|M>>>16),M=P+(C^N^E)+L[14]+4259657740&4294967295,P=C+(M<<23&4294967295|M>>>9),M=E+(P^C^N)+L[1]+2763975236&4294967295,E=P+(M<<4&4294967295|M>>>28),M=N+(E^P^C)+L[4]+1272893353&4294967295,N=E+(M<<11&4294967295|M>>>21),M=C+(N^E^P)+L[7]+4139469664&4294967295,C=N+(M<<16&4294967295|M>>>16),M=P+(C^N^E)+L[10]+3200236656&4294967295,P=C+(M<<23&4294967295|M>>>9),M=E+(P^C^N)+L[13]+681279174&4294967295,E=P+(M<<4&4294967295|M>>>28),M=N+(E^P^C)+L[0]+3936430074&4294967295,N=E+(M<<11&4294967295|M>>>21),M=C+(N^E^P)+L[3]+3572445317&4294967295,C=N+(M<<16&4294967295|M>>>16),M=P+(C^N^E)+L[6]+76029189&4294967295,P=C+(M<<23&4294967295|M>>>9),M=E+(P^C^N)+L[9]+3654602809&4294967295,E=P+(M<<4&4294967295|M>>>28),M=N+(E^P^C)+L[12]+3873151461&4294967295,N=E+(M<<11&4294967295|M>>>21),M=C+(N^E^P)+L[15]+530742520&4294967295,C=N+(M<<16&4294967295|M>>>16),M=P+(C^N^E)+L[2]+3299628645&4294967295,P=C+(M<<23&4294967295|M>>>9),M=E+(C^(P|~N))+L[0]+4096336452&4294967295,E=P+(M<<6&4294967295|M>>>26),M=N+(P^(E|~C))+L[7]+1126891415&4294967295,N=E+(M<<10&4294967295|M>>>22),M=C+(E^(N|~P))+L[14]+2878612391&4294967295,C=N+(M<<15&4294967295|M>>>17),M=P+(N^(C|~E))+L[5]+4237533241&4294967295,P=C+(M<<21&4294967295|M>>>11),M=E+(C^(P|~N))+L[12]+1700485571&4294967295,E=P+(M<<6&4294967295|M>>>26),M=N+(P^(E|~C))+L[3]+2399980690&4294967295,N=E+(M<<10&4294967295|M>>>22),M=C+(E^(N|~P))+L[10]+4293915773&4294967295,C=N+(M<<15&4294967295|M>>>17),M=P+(N^(C|~E))+L[1]+2240044497&4294967295,P=C+(M<<21&4294967295|M>>>11),M=E+(C^(P|~N))+L[8]+1873313359&4294967295,E=P+(M<<6&4294967295|M>>>26),M=N+(P^(E|~C))+L[15]+4264355552&4294967295,N=E+(M<<10&4294967295|M>>>22),M=C+(E^(N|~P))+L[6]+2734768916&4294967295,C=N+(M<<15&4294967295|M>>>17),M=P+(N^(C|~E))+L[13]+1309151649&4294967295,P=C+(M<<21&4294967295|M>>>11),M=E+(C^(P|~N))+L[4]+4149444226&4294967295,E=P+(M<<6&4294967295|M>>>26),M=N+(P^(E|~C))+L[11]+3174756917&4294967295,N=E+(M<<10&4294967295|M>>>22),M=C+(E^(N|~P))+L[2]+718787259&4294967295,C=N+(M<<15&4294967295|M>>>17),M=P+(N^(C|~E))+L[9]+3951481745&4294967295,A.g[0]=A.g[0]+E&4294967295,A.g[1]=A.g[1]+(C+(M<<21&4294967295|M>>>11))&4294967295,A.g[2]=A.g[2]+C&4294967295,A.g[3]=A.g[3]+N&4294967295}r.prototype.v=function(A,E){E===void 0&&(E=A.length);const P=E-this.blockSize,L=this.C;let C=this.h,N=0;for(;N<E;){if(C==0)for(;N<=P;)s(this,A,N),N+=this.blockSize;if(typeof A=="string"){for(;N<E;)if(L[C++]=A.charCodeAt(N++),C==this.blockSize){s(this,L),C=0;break}}else for(;N<E;)if(L[C++]=A[N++],C==this.blockSize){s(this,L),C=0;break}}this.h=C,this.o+=E},r.prototype.A=function(){var A=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);A[0]=128;for(var E=1;E<A.length-8;++E)A[E]=0;E=this.o*8;for(var P=A.length-8;P<A.length;++P)A[P]=E&255,E/=256;for(this.v(A),A=Array(16),E=0,P=0;P<4;++P)for(let L=0;L<32;L+=8)A[E++]=this.g[P]>>>L&255;return A};function o(A,E){var P=d;return Object.prototype.hasOwnProperty.call(P,A)?P[A]:P[A]=E(A)}function l(A,E){this.h=E;const P=[];let L=!0;for(let C=A.length-1;C>=0;C--){const N=A[C]|0;L&&N==E||(P[C]=N,L=!1)}this.g=P}var d={};function h(A){return-128<=A&&A<128?o(A,function(E){return new l([E|0],E<0?-1:0)}):new l([A|0],A<0?-1:0)}function f(A){if(isNaN(A)||!isFinite(A))return y;if(A<0)return S(f(-A));const E=[];let P=1;for(let L=0;A>=P;L++)E[L]=A/P|0,P*=4294967296;return new l(E,0)}function g(A,E){if(A.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(A.charAt(0)=="-")return S(g(A.substring(1),E));if(A.indexOf("-")>=0)throw Error('number format error: interior "-" character');const P=f(Math.pow(E,8));let L=y;for(let N=0;N<A.length;N+=8){var C=Math.min(8,A.length-N);const M=parseInt(A.substring(N,N+C),E);C<8?(C=f(Math.pow(E,C)),L=L.j(C).add(f(M))):(L=L.j(P),L=L.add(f(M)))}return L}var y=h(0),_=h(1),x=h(16777216);t=l.prototype,t.m=function(){if(k(this))return-S(this).m();let A=0,E=1;for(let P=0;P<this.g.length;P++){const L=this.i(P);A+=(L>=0?L:4294967296+L)*E,E*=4294967296}return A},t.toString=function(A){if(A=A||10,A<2||36<A)throw Error("radix out of range: "+A);if(I(this))return"0";if(k(this))return"-"+S(this).toString(A);const E=f(Math.pow(A,6));var P=this;let L="";for(;;){const C=$(P,E).g;P=O(P,C.j(E));let N=((P.g.length>0?P.g[0]:P.h)>>>0).toString(A);if(P=C,I(P))return N+L;for(;N.length<6;)N="0"+N;L=N+L}},t.i=function(A){return A<0?0:A<this.g.length?this.g[A]:this.h};function I(A){if(A.h!=0)return!1;for(let E=0;E<A.g.length;E++)if(A.g[E]!=0)return!1;return!0}function k(A){return A.h==-1}t.l=function(A){return A=O(this,A),k(A)?-1:I(A)?0:1};function S(A){const E=A.g.length,P=[];for(let L=0;L<E;L++)P[L]=~A.g[L];return new l(P,~A.h).add(_)}t.abs=function(){return k(this)?S(this):this},t.add=function(A){const E=Math.max(this.g.length,A.g.length),P=[];let L=0;for(let C=0;C<=E;C++){let N=L+(this.i(C)&65535)+(A.i(C)&65535),M=(N>>>16)+(this.i(C)>>>16)+(A.i(C)>>>16);L=M>>>16,N&=65535,M&=65535,P[C]=M<<16|N}return new l(P,P[P.length-1]&-2147483648?-1:0)};function O(A,E){return A.add(S(E))}t.j=function(A){if(I(this)||I(A))return y;if(k(this))return k(A)?S(this).j(S(A)):S(S(this).j(A));if(k(A))return S(this.j(S(A)));if(this.l(x)<0&&A.l(x)<0)return f(this.m()*A.m());const E=this.g.length+A.g.length,P=[];for(var L=0;L<2*E;L++)P[L]=0;for(L=0;L<this.g.length;L++)for(let C=0;C<A.g.length;C++){const N=this.i(L)>>>16,M=this.i(L)&65535,ie=A.i(C)>>>16,te=A.i(C)&65535;P[2*L+2*C]+=M*te,B(P,2*L+2*C),P[2*L+2*C+1]+=N*te,B(P,2*L+2*C+1),P[2*L+2*C+1]+=M*ie,B(P,2*L+2*C+1),P[2*L+2*C+2]+=N*ie,B(P,2*L+2*C+2)}for(A=0;A<E;A++)P[A]=P[2*A+1]<<16|P[2*A];for(A=E;A<2*E;A++)P[A]=0;return new l(P,0)};function B(A,E){for(;(A[E]&65535)!=A[E];)A[E+1]+=A[E]>>>16,A[E]&=65535,E++}function V(A,E){this.g=A,this.h=E}function $(A,E){if(I(E))throw Error("division by zero");if(I(A))return new V(y,y);if(k(A))return E=$(S(A),E),new V(S(E.g),S(E.h));if(k(E))return E=$(A,S(E)),new V(S(E.g),E.h);if(A.g.length>30){if(k(A)||k(E))throw Error("slowDivide_ only works with positive integers.");for(var P=_,L=E;L.l(A)<=0;)P=F(P),L=F(L);var C=H(P,1),N=H(L,1);for(L=H(L,2),P=H(P,2);!I(L);){var M=N.add(L);M.l(A)<=0&&(C=C.add(P),N=M),L=H(L,1),P=H(P,1)}return E=O(A,C.j(E)),new V(C,E)}for(C=y;A.l(E)>=0;){for(P=Math.max(1,Math.floor(A.m()/E.m())),L=Math.ceil(Math.log(P)/Math.LN2),L=L<=48?1:Math.pow(2,L-48),N=f(P),M=N.j(E);k(M)||M.l(A)>0;)P-=L,N=f(P),M=N.j(E);I(N)&&(N=_),C=C.add(N),A=O(A,M)}return new V(C,A)}t.B=function(A){return $(this,A).h},t.and=function(A){const E=Math.max(this.g.length,A.g.length),P=[];for(let L=0;L<E;L++)P[L]=this.i(L)&A.i(L);return new l(P,this.h&A.h)},t.or=function(A){const E=Math.max(this.g.length,A.g.length),P=[];for(let L=0;L<E;L++)P[L]=this.i(L)|A.i(L);return new l(P,this.h|A.h)},t.xor=function(A){const E=Math.max(this.g.length,A.g.length),P=[];for(let L=0;L<E;L++)P[L]=this.i(L)^A.i(L);return new l(P,this.h^A.h)};function F(A){const E=A.g.length+1,P=[];for(let L=0;L<E;L++)P[L]=A.i(L)<<1|A.i(L-1)>>>31;return new l(P,A.h)}function H(A,E){const P=E>>5;E%=32;const L=A.g.length-P,C=[];for(let N=0;N<L;N++)C[N]=E>0?A.i(N+P)>>>E|A.i(N+P+1)<<32-E:A.i(N+P);return new l(C,A.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,eI=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=g,go=l}).apply(typeof lb<"u"?lb:typeof self<"u"?self:typeof window<"u"?window:{});var Jd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var tI,Bc,nI,vh,cg,rI,sI,iI;(function(){var t,e=Object.defineProperty;function n(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof Jd=="object"&&Jd];for(var b=0;b<m.length;++b){var T=m[b];if(T&&T.Math==Math)return T}throw Error("Cannot find global object")}var r=n(this);function s(m,b){if(b)e:{var T=r;m=m.split(".");for(var D=0;D<m.length-1;D++){var Z=m[D];if(!(Z in T))break e;T=T[Z]}m=m[m.length-1],D=T[m],b=b(D),b!=D&&b!=null&&e(T,m,{configurable:!0,writable:!0,value:b})}}s("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(m){return m||function(b){var T=[],D;for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&T.push([D,b[D]]);return T}});var o=o||{},l=this||self;function d(m){var b=typeof m;return b=="object"&&m!=null||b=="function"}function h(m,b,T){return m.call.apply(m.bind,arguments)}function f(m,b,T){return f=h,f.apply(null,arguments)}function g(m,b){var T=Array.prototype.slice.call(arguments,1);return function(){var D=T.slice();return D.push.apply(D,arguments),m.apply(this,D)}}function y(m,b){function T(){}T.prototype=b.prototype,m.Z=b.prototype,m.prototype=new T,m.prototype.constructor=m,m.Ob=function(D,Z,ae){for(var Ce=Array(arguments.length-2),ut=2;ut<arguments.length;ut++)Ce[ut-2]=arguments[ut];return b.prototype[Z].apply(D,Ce)}}var _=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function x(m){const b=m.length;if(b>0){const T=Array(b);for(let D=0;D<b;D++)T[D]=m[D];return T}return[]}function I(m,b){for(let D=1;D<arguments.length;D++){const Z=arguments[D];var T=typeof Z;if(T=T!="object"?T:Z?Array.isArray(Z)?"array":T:"null",T=="array"||T=="object"&&typeof Z.length=="number"){T=m.length||0;const ae=Z.length||0;m.length=T+ae;for(let Ce=0;Ce<ae;Ce++)m[T+Ce]=Z[Ce]}else m.push(Z)}}class k{constructor(b,T){this.i=b,this.j=T,this.h=0,this.g=null}get(){let b;return this.h>0?(this.h--,b=this.g,this.g=b.next,b.next=null):b=this.i(),b}}function S(m){l.setTimeout(()=>{throw m},0)}function O(){var m=A;let b=null;return m.g&&(b=m.g,m.g=m.g.next,m.g||(m.h=null),b.next=null),b}class B{constructor(){this.h=this.g=null}add(b,T){const D=V.get();D.set(b,T),this.h?this.h.next=D:this.g=D,this.h=D}}var V=new k(()=>new $,m=>m.reset());class ${constructor(){this.next=this.g=this.h=null}set(b,T){this.h=b,this.g=T,this.next=null}reset(){this.next=this.g=this.h=null}}let F,H=!1,A=new B,E=()=>{const m=Promise.resolve(void 0);F=()=>{m.then(P)}};function P(){for(var m;m=O();){try{m.h.call(m.g)}catch(T){S(T)}var b=V;b.j(m),b.h<100&&(b.h++,m.next=b.g,b.g=m)}H=!1}function L(){this.u=this.u,this.C=this.C}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function C(m,b){this.type=m,this.g=this.target=b,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var N=(function(){if(!l.addEventListener||!Object.defineProperty)return!1;var m=!1,b=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const T=()=>{};l.addEventListener("test",T,b),l.removeEventListener("test",T,b)}catch{}return m})();function M(m){return/^[\s\xa0]*$/.test(m)}function ie(m,b){C.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,b)}y(ie,C),ie.prototype.init=function(m,b){const T=this.type=m.type,D=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=b,b=m.relatedTarget,b||(T=="mouseover"?b=m.fromElement:T=="mouseout"&&(b=m.toElement)),this.relatedTarget=b,D?(this.clientX=D.clientX!==void 0?D.clientX:D.pageX,this.clientY=D.clientY!==void 0?D.clientY:D.pageY,this.screenX=D.screenX||0,this.screenY=D.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&ie.Z.h.call(this)},ie.prototype.h=function(){ie.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var te="closure_listenable_"+(Math.random()*1e6|0),q=0;function W(m,b,T,D,Z){this.listener=m,this.proxy=null,this.src=b,this.type=T,this.capture=!!D,this.ha=Z,this.key=++q,this.da=this.fa=!1}function Y(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function ne(m,b,T){for(const D in m)b.call(T,m[D],D,m)}function se(m,b){for(const T in m)b.call(void 0,m[T],T,m)}function z(m){const b={};for(const T in m)b[T]=m[T];return b}const ee="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(m,b){let T,D;for(let Z=1;Z<arguments.length;Z++){D=arguments[Z];for(T in D)m[T]=D[T];for(let ae=0;ae<ee.length;ae++)T=ee[ae],Object.prototype.hasOwnProperty.call(D,T)&&(m[T]=D[T])}}function de(m){this.src=m,this.g={},this.h=0}de.prototype.add=function(m,b,T,D,Z){const ae=m.toString();m=this.g[ae],m||(m=this.g[ae]=[],this.h++);const Ce=fe(m,b,D,Z);return Ce>-1?(b=m[Ce],T||(b.fa=!1)):(b=new W(b,this.src,ae,!!D,Z),b.fa=T,m.push(b)),b};function Se(m,b){const T=b.type;if(T in m.g){var D=m.g[T],Z=Array.prototype.indexOf.call(D,b,void 0),ae;(ae=Z>=0)&&Array.prototype.splice.call(D,Z,1),ae&&(Y(b),m.g[T].length==0&&(delete m.g[T],m.h--))}}function fe(m,b,T,D){for(let Z=0;Z<m.length;++Z){const ae=m[Z];if(!ae.da&&ae.listener==b&&ae.capture==!!T&&ae.ha==D)return Z}return-1}var Re="closure_lm_"+(Math.random()*1e6|0),$e={};function Me(m,b,T,D,Z){if(Array.isArray(b)){for(let ae=0;ae<b.length;ae++)Me(m,b[ae],T,D,Z);return null}return T=Rt(T),m&&m[te]?m.J(b,T,d(D)?!!D.capture:!1,Z):At(m,b,T,!1,D,Z)}function At(m,b,T,D,Z,ae){if(!b)throw Error("Invalid event type");const Ce=d(Z)?!!Z.capture:!!Z;let ut=xe(m);if(ut||(m[Re]=ut=new de(m)),T=ut.add(b,T,D,Ce,ae),T.proxy)return T;if(D=Wt(),T.proxy=D,D.src=m,D.listener=T,m.addEventListener)N||(Z=Ce),Z===void 0&&(Z=!1),m.addEventListener(b.toString(),D,Z);else if(m.attachEvent)m.attachEvent(Ir(b.toString()),D);else if(m.addListener&&m.removeListener)m.addListener(D);else throw Error("addEventListener and attachEvent are unavailable.");return T}function Wt(){function m(T){return b.call(m.src,m.listener,T)}const b=ce;return m}function ur(m,b,T,D,Z){if(Array.isArray(b))for(var ae=0;ae<b.length;ae++)ur(m,b[ae],T,D,Z);else D=d(D)?!!D.capture:!!D,T=Rt(T),m&&m[te]?(m=m.i,ae=String(b).toString(),ae in m.g&&(b=m.g[ae],T=fe(b,T,D,Z),T>-1&&(Y(b[T]),Array.prototype.splice.call(b,T,1),b.length==0&&(delete m.g[ae],m.h--)))):m&&(m=xe(m))&&(b=m.g[b.toString()],m=-1,b&&(m=fe(b,T,D,Z)),(T=m>-1?b[m]:null)&&Ie(T))}function Ie(m){if(typeof m!="number"&&m&&!m.da){var b=m.src;if(b&&b[te])Se(b.i,m);else{var T=m.type,D=m.proxy;b.removeEventListener?b.removeEventListener(T,D,m.capture):b.detachEvent?b.detachEvent(Ir(T),D):b.addListener&&b.removeListener&&b.removeListener(D),(T=xe(b))?(Se(T,m),T.h==0&&(T.src=null,b[Re]=null)):Y(m)}}}function Ir(m){return m in $e?$e[m]:$e[m]="on"+m}function ce(m,b){if(m.da)m=!0;else{b=new ie(b,this);const T=m.listener,D=m.ha||m.src;m.fa&&Ie(m),m=T.call(D,b)}return m}function xe(m){return m=m[Re],m instanceof de?m:null}var De="__closure_events_fn_"+(Math.random()*1e9>>>0);function Rt(m){return typeof m=="function"?m:(m[De]||(m[De]=function(b){return m.handleEvent(b)}),m[De])}function Ze(){L.call(this),this.i=new de(this),this.M=this,this.G=null}y(Ze,L),Ze.prototype[te]=!0,Ze.prototype.removeEventListener=function(m,b,T,D){ur(this,m,b,T,D)};function pt(m,b){var T,D=m.G;if(D)for(T=[];D;D=D.G)T.push(D);if(m=m.M,D=b.type||b,typeof b=="string")b=new C(b,m);else if(b instanceof C)b.target=b.target||m;else{var Z=b;b=new C(D,m),Q(b,Z)}Z=!0;let ae,Ce;if(T)for(Ce=T.length-1;Ce>=0;Ce--)ae=b.g=T[Ce],Z=ye(ae,D,!0,b)&&Z;if(ae=b.g=m,Z=ye(ae,D,!0,b)&&Z,Z=ye(ae,D,!1,b)&&Z,T)for(Ce=0;Ce<T.length;Ce++)ae=b.g=T[Ce],Z=ye(ae,D,!1,b)&&Z}Ze.prototype.N=function(){if(Ze.Z.N.call(this),this.i){var m=this.i;for(const b in m.g){const T=m.g[b];for(let D=0;D<T.length;D++)Y(T[D]);delete m.g[b],m.h--}}this.G=null},Ze.prototype.J=function(m,b,T,D){return this.i.add(String(m),b,!1,T,D)},Ze.prototype.K=function(m,b,T,D){return this.i.add(String(m),b,!0,T,D)};function ye(m,b,T,D){if(b=m.i.g[String(b)],!b)return!0;b=b.concat();let Z=!0;for(let ae=0;ae<b.length;++ae){const Ce=b[ae];if(Ce&&!Ce.da&&Ce.capture==T){const ut=Ce.listener,En=Ce.ha||Ce.src;Ce.fa&&Se(m.i,Ce),Z=ut.call(En,D)!==!1&&Z}}return Z&&!D.defaultPrevented}function Ne(m,b){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=f(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(b)>2147483647?-1:l.setTimeout(m,b||0)}function Ke(m){m.g=Ne(()=>{m.g=null,m.i&&(m.i=!1,Ke(m))},m.l);const b=m.h;m.h=null,m.m.apply(null,b)}class kt extends L{constructor(b,T){super(),this.m=b,this.l=T,this.h=null,this.i=!1,this.g=null}j(b){this.h=arguments,this.g?this.i=!0:Ke(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function it(m){L.call(this),this.h=m,this.g={}}y(it,L);var _n=[];function Sr(m){ne(m.g,function(b,T){this.g.hasOwnProperty(T)&&Ie(b)},m),m.g={}}it.prototype.N=function(){it.Z.N.call(this),Sr(this)},it.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var gt=l.JSON.stringify,Yt=l.JSON.parse,Bt=class{stringify(m){return l.JSON.stringify(m,void 0)}parse(m){return l.JSON.parse(m,void 0)}};function tn(){}function tr(){}var Un={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Or(){C.call(this,"d")}y(Or,C);function Ht(){C.call(this,"c")}y(Ht,C);var Xe={},Kn=null;function Jt(){return Kn=Kn||new Ze}Xe.Ia="serverreachability";function Ee(m){C.call(this,Xe.Ia,m)}y(Ee,C);function nt(m){const b=Jt();pt(b,new Ee(b))}Xe.STAT_EVENT="statevent";function ht(m,b){C.call(this,Xe.STAT_EVENT,m),this.stat=b}y(ht,C);function dt(m){const b=Jt();pt(b,new ht(b,m))}Xe.Ja="timingevent";function Be(m,b){C.call(this,Xe.Ja,m),this.size=b}y(Be,C);function Le(m,b){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){m()},b)}function _t(){this.g=!0}_t.prototype.ua=function(){this.g=!1};function Pt(m,b,T,D,Z,ae){m.info(function(){if(m.g)if(ae){var Ce="",ut=ae.split("&");for(let Vt=0;Vt<ut.length;Vt++){var En=ut[Vt].split("=");if(En.length>1){const Ln=En[0];En=En[1];const Wr=Ln.split("_");Ce=Wr.length>=2&&Wr[1]=="type"?Ce+(Ln+"="+En+"&"):Ce+(Ln+"=redacted&")}}}else Ce=null;else Ce=ae;return"XMLHTTP REQ ("+D+") [attempt "+Z+"]: "+b+`
`+T+`
`+Ce})}function Lt(m,b,T,D,Z,ae,Ce){m.info(function(){return"XMLHTTP RESP ("+D+") [ attempt "+Z+"]: "+b+`
`+T+`
`+ae+" "+Ce})}function mt(m,b,T,D){m.info(function(){return"XMLHTTP TEXT ("+b+"): "+je(m,T)+(D?" "+D:"")})}function jn(m,b){m.info(function(){return"TIMEOUT: "+b})}_t.prototype.info=function(){};function je(m,b){if(!m.g)return b;if(!b)return null;try{const ae=JSON.parse(b);if(ae){for(m=0;m<ae.length;m++)if(Array.isArray(ae[m])){var T=ae[m];if(!(T.length<2)){var D=T[1];if(Array.isArray(D)&&!(D.length<1)){var Z=D[0];if(Z!="noop"&&Z!="stop"&&Z!="close")for(let Ce=1;Ce<D.length;Ce++)D[Ce]=""}}}}return gt(ae)}catch{return b}}var It={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Nn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Gn;function Mn(){}y(Mn,tn),Mn.prototype.g=function(){return new XMLHttpRequest},Gn=new Mn;function nn(m){return encodeURIComponent(String(m))}function fn(m){var b=1;m=m.split(":");const T=[];for(;b>0&&m.length;)T.push(m.shift()),b--;return m.length&&T.push(m.join(":")),T}function ft(m,b,T,D){this.j=m,this.i=b,this.l=T,this.S=D||1,this.V=new it(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ft}function Ft(){this.i=null,this.g="",this.h=!1}var wn={},mn={};function rn(m,b,T){m.M=1,m.A=si(ct(b)),m.u=T,m.R=!0,Fr(m,null)}function Fr(m,b){m.F=Date.now(),_e(m),m.B=ct(m.A);var T=m.B,D=m.S;Array.isArray(D)||(D=[String(D)]),nc(T.i,"t",D),m.C=0,T=m.j.L,m.h=new Ft,m.g=ed(m.j,T?b:null,!m.u),m.P>0&&(m.O=new kt(f(m.Y,m,m.g),m.P)),b=m.V,T=m.g,D=m.ba;var Z="readystatechange";Array.isArray(Z)||(Z&&(_n[0]=Z.toString()),Z=_n);for(let ae=0;ae<Z.length;ae++){const Ce=Me(T,Z[ae],D||b.handleEvent,!1,b.h||b);if(!Ce)break;b.g[Ce.key]=Ce}b=m.J?z(m.J):{},m.u?(m.v||(m.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,b)):(m.v="GET",m.g.ea(m.B,m.v,null,b)),nt(),Pt(m.i,m.v,m.B,m.l,m.S,m.u)}ft.prototype.ba=function(m){m=m.target;const b=this.O;b&&Ls(m)==3?b.j():this.Y(m)},ft.prototype.Y=function(m){try{if(m==this.g)e:{const ut=Ls(this.g),En=this.g.ya(),Vt=this.g.ca();if(!(ut<3)&&(ut!=3||this.g&&(this.h.h||this.g.la()||Ju(this.g)))){this.K||ut!=4||En==7||(En==8||Vt<=0?nt(3):nt(2)),We(this);var b=this.g.ca();this.X=b;var T=Br(this);if(this.o=b==200,Lt(this.i,this.v,this.B,this.l,this.S,ut,b),this.o){if(this.U&&!this.L){t:{if(this.g){var D,Z=this.g;if((D=Z.g?Z.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!M(D)){var ae=D;break t}}ae=null}if(m=ae)mt(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Pe(this,m);else{this.o=!1,this.m=3,dt(12),jt(this),St(this);break e}}if(this.R){m=!0;let Ln;for(;!this.K&&this.C<T.length;)if(Ln=le(this,T),Ln==mn){ut==4&&(this.m=4,dt(14),m=!1),mt(this.i,this.l,null,"[Incomplete Response]");break}else if(Ln==wn){this.m=4,dt(15),mt(this.i,this.l,T,"[Invalid Chunk]"),m=!1;break}else mt(this.i,this.l,Ln,null),Pe(this,Ln);if(X(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ut!=4||T.length!=0||this.h.h||(this.m=1,dt(16),m=!1),this.o=this.o&&m,!m)mt(this.i,this.l,T,"[Invalid Chunked Response]"),jt(this),St(this);else if(T.length>0&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.aa&&!Ce.P&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+T.length),Bo(Ce),Ce.P=!0,dt(11))}}else mt(this.i,this.l,T,null),Pe(this,T);ut==4&&jt(this),this.o&&!this.K&&(ut==4?Ma(this.j,this):(this.o=!1,_e(this)))}else sc(this.g),b==400&&T.indexOf("Unknown SID")>0?(this.m=3,dt(12)):(this.m=0,dt(13)),jt(this),St(this)}}}catch{}};function Br(m){if(!X(m))return m.g.la();const b=Ju(m.g);if(b==="")return"";let T="";const D=b.length,Z=Ls(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return jt(m),St(m),"";m.h.i=new l.TextDecoder}for(let ae=0;ae<D;ae++)m.h.h=!0,T+=m.h.i.decode(b[ae],{stream:!(Z&&ae==D-1)});return b.length=0,m.h.g+=T,m.C=0,m.h.g}function X(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function le(m,b){var T=m.C,D=b.indexOf(`
`,T);return D==-1?mn:(T=Number(b.substring(T,D)),isNaN(T)?wn:(D+=1,D+T>b.length?mn:(b=b.slice(D,D+T),m.C=D+T,b)))}ft.prototype.cancel=function(){this.K=!0,jt(this)};function _e(m){m.T=Date.now()+m.H,ke(m,m.H)}function ke(m,b){if(m.D!=null)throw Error("WatchDog timer not null");m.D=Le(f(m.aa,m),b)}function We(m){m.D&&(l.clearTimeout(m.D),m.D=null)}ft.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(jn(this.i,this.B),this.M!=2&&(nt(),dt(17)),jt(this),this.m=2,St(this)):ke(this,this.T-m)};function St(m){m.j.I==0||m.K||Ma(m.j,m)}function jt(m){We(m);var b=m.O;b&&typeof b.dispose=="function"&&b.dispose(),m.O=null,Sr(m.V),m.g&&(b=m.g,m.g=null,b.abort(),b.dispose())}function Pe(m,b){try{var T=m.j;if(T.I!=0&&(T.g==m||xn(T.h,m))){if(!m.L&&xn(T.h,m)&&T.I==3){try{var D=T.Ba.g.parse(b)}catch{D=null}if(Array.isArray(D)&&D.length==3){var Z=D;if(Z[0]==0){e:if(!T.v){if(T.g)if(T.g.F+3e3<m.F)Na(T),zr(T);else break e;Fs(T),dt(18)}}else T.xa=Z[1],0<T.xa-T.K&&Z[2]<37500&&T.F&&T.A==0&&!T.C&&(T.C=Le(f(T.Va,T),6e3));Dn(T.h)<=1&&T.ta&&(T.ta=void 0)}else qr(T,11)}else if((m.L||T.g==m)&&Na(T),!M(b))for(Z=T.Ba.g.parse(b),b=0;b<Z.length;b++){let Vt=Z[b];const Ln=Vt[0];if(!(Ln<=T.K))if(T.K=Ln,Vt=Vt[1],T.I==2)if(Vt[0]=="c"){T.M=Vt[1],T.ba=Vt[2];const Wr=Vt[3];Wr!=null&&(T.ka=Wr,T.j.info("VER="+T.ka));const ci=Vt[4];ci!=null&&(T.za=ci,T.j.info("SVER="+T.za));const Bs=Vt[5];Bs!=null&&typeof Bs=="number"&&Bs>0&&(D=1.5*Bs,T.O=D,T.j.info("backChannelRequestTimeoutMs_="+D)),D=T;const Us=m.g;if(Us){const Va=Us.g?Us.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Va){var ae=D.h;ae.g||Va.indexOf("spdy")==-1&&Va.indexOf("quic")==-1&&Va.indexOf("h2")==-1||(ae.j=ae.l,ae.g=new Set,ae.h&&(pe(ae,ae.h),ae.h=null))}if(D.G){const ac=Us.g?Us.g.getResponseHeader("X-HTTP-Session-Id"):null;ac&&(D.wa=ac,yt(D.J,D.G,ac))}}T.I=3,T.l&&T.l.ra(),T.aa&&(T.T=Date.now()-m.F,T.j.info("Handshake RTT: "+T.T+"ms")),D=T;var Ce=m;if(D.na=oc(D,D.L?D.ba:null,D.W),Ce.L){lt(D.h,Ce);var ut=Ce,En=D.O;En&&(ut.H=En),ut.D&&(We(ut),_e(ut)),D.g=Ce}else hr(D);T.i.length>0&&li(T)}else Vt[0]!="stop"&&Vt[0]!="close"||qr(T,7);else T.I==3&&(Vt[0]=="stop"||Vt[0]=="close"?Vt[0]=="stop"?qr(T,7):Pa(T):Vt[0]!="noop"&&T.l&&T.l.qa(Vt),T.A=0)}}nt(4)}catch{}}var pn=class{constructor(m,b){this.g=m,this.map=b}};function sn(m){this.l=m||10,l.PerformanceNavigationTiming?(m=l.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function bn(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function Dn(m){return m.h?1:m.g?m.g.size:0}function xn(m,b){return m.h?m.h==b:m.g?m.g.has(b):!1}function pe(m,b){m.g?m.g.add(b):m.h=b}function lt(m,b){m.h&&m.h==b?m.h=null:m.g&&m.g.has(b)&&m.g.delete(b)}sn.prototype.cancel=function(){if(this.i=Nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Nt(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let b=m.i;for(const T of m.g.values())b=b.concat(T.G);return b}return x(m.i)}var gn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zt(m,b){if(m){m=m.split("&");for(let T=0;T<m.length;T++){const D=m[T].indexOf("=");let Z,ae=null;D>=0?(Z=m[T].substring(0,D),ae=m[T].substring(D+1)):Z=m[T],b(Z,ae?decodeURIComponent(ae.replace(/\+/g," ")):"")}}}function Ut(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let b;m instanceof Ut?(this.l=m.l,Tn(this,m.j),this.o=m.o,this.g=m.g,dr(this,m.u),this.h=m.h,Ur(this,rc(m.i)),this.m=m.m):m&&(b=String(m).match(gn))?(this.l=!1,Tn(this,b[1]||"",!0),this.o=Do(b[2]||""),this.g=Do(b[3]||"",!0),dr(this,b[4]),this.h=Do(b[5]||"",!0),Ur(this,b[6]||"",!0),this.m=Do(b[7]||"")):(this.l=!1,this.i=new Tt(null,this.l))}Ut.prototype.toString=function(){const m=[];var b=this.j;b&&m.push(Lo(b,Yl,!0),":");var T=this.g;return(T||b=="file")&&(m.push("//"),(b=this.o)&&m.push(Lo(b,Yl,!0),"@"),m.push(nn(T).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),T=this.u,T!=null&&m.push(":",String(T))),(T=this.h)&&(this.g&&T.charAt(0)!="/"&&m.push("/"),m.push(Lo(T,T.charAt(0)=="/"?Vo:Jl,!0))),(T=this.i.toString())&&m.push("?",T),(T=this.m)&&m.push("#",Lo(T,Zl)),m.join("")},Ut.prototype.resolve=function(m){const b=ct(this);let T=!!m.j;T?Tn(b,m.j):T=!!m.o,T?b.o=m.o:T=!!m.g,T?b.g=m.g:T=m.u!=null;var D=m.h;if(T)dr(b,m.u);else if(T=!!m.h){if(D.charAt(0)!="/")if(this.g&&!this.h)D="/"+D;else{var Z=b.h.lastIndexOf("/");Z!=-1&&(D=b.h.slice(0,Z+1)+D)}if(Z=D,Z==".."||Z==".")D="";else if(Z.indexOf("./")!=-1||Z.indexOf("/.")!=-1){D=Z.lastIndexOf("/",0)==0,Z=Z.split("/");const ae=[];for(let Ce=0;Ce<Z.length;){const ut=Z[Ce++];ut=="."?D&&Ce==Z.length&&ae.push(""):ut==".."?((ae.length>1||ae.length==1&&ae[0]!="")&&ae.pop(),D&&Ce==Z.length&&ae.push("")):(ae.push(ut),D=!0)}D=ae.join("/")}else D=Z}return T?b.h=D:T=m.i.toString()!=="",T?Ur(b,rc(m.i)):T=!!m.m,T&&(b.m=m.m),b};function ct(m){return new Ut(m)}function Tn(m,b,T){m.j=T?Do(b,!0):b,m.j&&(m.j=m.j.replace(/:$/,""))}function dr(m,b){if(b){if(b=Number(b),isNaN(b)||b<0)throw Error("Bad port number "+b);m.u=b}else m.u=null}function Ur(m,b,T){b instanceof Tt?(m.i=b,Aa(m.i,m.l)):(T||(b=Lo(b,qf)),m.i=new Tt(b,m.l))}function yt(m,b,T){m.i.set(b,T)}function si(m){return yt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function Do(m,b){return m?b?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function Lo(m,b,T){return typeof m=="string"?(m=encodeURI(m).replace(b,Xl),T&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Xl(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var Yl=/[#\/\?@]/g,Jl=/[#\?:]/g,Vo=/[#\?]/g,qf=/[#\?@]/g,Zl=/#/g;function Tt(m,b){this.h=this.g=null,this.i=m||null,this.j=!!b}function js(m){m.g||(m.g=new Map,m.h=0,m.i&&Zt(m.i,function(b,T){m.add(decodeURIComponent(b.replace(/\+/g," ")),T)}))}t=Tt.prototype,t.add=function(m,b){js(this),this.i=null,m=Ns(this,m);let T=this.g.get(m);return T||this.g.set(m,T=[]),T.push(b),this.h+=1,this};function ec(m,b){js(m),b=Ns(m,b),m.g.has(b)&&(m.i=null,m.h-=m.g.get(b).length,m.g.delete(b))}function Ca(m,b){return js(m),b=Ns(m,b),m.g.has(b)}t.forEach=function(m,b){js(this),this.g.forEach(function(T,D){T.forEach(function(Z){m.call(b,Z,D,this)},this)},this)};function tc(m,b){js(m);let T=[];if(typeof b=="string")Ca(m,b)&&(T=T.concat(m.g.get(Ns(m,b))));else for(m=Array.from(m.g.values()),b=0;b<m.length;b++)T=T.concat(m[b]);return T}t.set=function(m,b){return js(this),this.i=null,m=Ns(this,m),Ca(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[b]),this.h+=1,this},t.get=function(m,b){return m?(m=tc(this,m),m.length>0?String(m[0]):b):b};function nc(m,b,T){ec(m,b),T.length>0&&(m.i=null,m.g.set(Ns(m,b),x(T)),m.h+=T.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],b=Array.from(this.g.keys());for(let D=0;D<b.length;D++){var T=b[D];const Z=nn(T);T=tc(this,T);for(let ae=0;ae<T.length;ae++){let Ce=Z;T[ae]!==""&&(Ce+="="+nn(T[ae])),m.push(Ce)}}return this.i=m.join("&")};function rc(m){const b=new Tt;return b.i=m.i,m.g&&(b.g=new Map(m.g),b.h=m.h),b}function Ns(m,b){return b=String(b),m.j&&(b=b.toLowerCase()),b}function Aa(m,b){b&&!m.j&&(js(m),m.i=null,m.g.forEach(function(T,D){const Z=D.toLowerCase();D!=Z&&(ec(this,D),nc(this,Z,T))},m)),m.j=b}function Ms(m,b){const T=new _t;if(l.Image){const D=new Image;D.onload=g(nr,T,"TestLoadImage: loaded",!0,b,D),D.onerror=g(nr,T,"TestLoadImage: error",!1,b,D),D.onabort=g(nr,T,"TestLoadImage: abort",!1,b,D),D.ontimeout=g(nr,T,"TestLoadImage: timeout",!1,b,D),l.setTimeout(function(){D.ontimeout&&D.ontimeout()},1e4),D.src=m}else b(!1)}function Ds(m,b){const T=new _t,D=new AbortController,Z=setTimeout(()=>{D.abort(),nr(T,"TestPingServer: timeout",!1,b)},1e4);fetch(m,{signal:D.signal}).then(ae=>{clearTimeout(Z),ae.ok?nr(T,"TestPingServer: ok",!0,b):nr(T,"TestPingServer: server error",!1,b)}).catch(()=>{clearTimeout(Z),nr(T,"TestPingServer: error",!1,b)})}function nr(m,b,T,D,Z){try{Z&&(Z.onload=null,Z.onerror=null,Z.onabort=null,Z.ontimeout=null),D(T)}catch{}}function Oo(){this.g=new Bt}function ii(m){this.i=m.Sb||null,this.h=m.ab||!1}y(ii,tn),ii.prototype.g=function(){return new $r(this.i,this.h)};function $r(m,b){Ze.call(this),this.H=m,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y($r,Ze),t=$r.prototype,t.open=function(m,b){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=b,this.readyState=1,hs(this)},t.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const b={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(b.body=m),(this.H||l).fetch(new Request(this.D,b)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Li(this)),this.readyState=0},t.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,hs(this)),this.g&&(this.readyState=3,hs(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Qu(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function Qu(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}t.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var b=m.value?m.value:new Uint8Array(0);(b=this.B.decode(b,{stream:!m.done}))&&(this.response=this.responseText+=b)}m.done?Li(this):hs(this),this.readyState==3&&Qu(this)}},t.Oa=function(m){this.g&&(this.response=this.responseText=m,Li(this))},t.Na=function(m){this.g&&(this.response=m,Li(this))},t.ga=function(){this.g&&Li(this)};function Li(m){m.readyState=4,m.l=null,m.j=null,m.B=null,hs(m)}t.setRequestHeader=function(m,b){this.A.append(m,b)},t.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],b=this.h.entries();for(var T=b.next();!T.done;)T=T.value,m.push(T[0]+": "+T[1]),T=b.next();return m.join(`\r
`)};function hs(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty($r.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function Xu(m){let b="";return ne(m,function(T,D){b+=D,b+=":",b+=T,b+=`\r
`}),b}function Ra(m,b,T){e:{for(D in T){var D=!1;break e}D=!0}D||(T=Xu(T),typeof m=="string"?T!=null&&nn(T):yt(m,b,T))}function $t(m){Ze.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y($t,Ze);var Yu=/^https?$/i,Wf=["POST","PUT"];t=$t.prototype,t.Fa=function(m){this.H=m},t.ea=function(m,b,T,D){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);b=b?b.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Gn.g(),this.g.onreadystatechange=_(f(this.Ca,this));try{this.B=!0,this.g.open(b,String(m),!0),this.B=!1}catch(ae){Vi(this,ae);return}if(m=T||"",T=new Map(this.headers),D)if(Object.getPrototypeOf(D)===Object.prototype)for(var Z in D)T.set(Z,D[Z]);else if(typeof D.keys=="function"&&typeof D.get=="function")for(const ae of D.keys())T.set(ae,D.get(ae));else throw Error("Unknown input type for opt_headers: "+String(D));D=Array.from(T.keys()).find(ae=>ae.toLowerCase()=="content-type"),Z=l.FormData&&m instanceof l.FormData,!(Array.prototype.indexOf.call(Wf,b,void 0)>=0)||D||Z||T.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ae,Ce]of T)this.g.setRequestHeader(ae,Ce);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(ae){Vi(this,ae)}};function Vi(m,b){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=b,m.o=5,Oi(m),ai(m)}function Oi(m){m.A||(m.A=!0,pt(m,"complete"),pt(m,"error"))}t.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,pt(this,"complete"),pt(this,"abort"),ai(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ai(this,!0)),$t.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?oi(this):this.Xa())},t.Xa=function(){oi(this)};function oi(m){if(m.h&&typeof o<"u"){if(m.v&&Ls(m)==4)setTimeout(m.Ca.bind(m),0);else if(pt(m,"readystatechange"),Ls(m)==4){m.h=!1;try{const ae=m.ca();e:switch(ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var T;if(!(T=b)){var D;if(D=ae===0){let Ce=String(m.D).match(gn)[1]||null;!Ce&&l.self&&l.self.location&&(Ce=l.self.location.protocol.slice(0,-1)),D=!Yu.test(Ce?Ce.toLowerCase():"")}T=D}if(T)pt(m,"complete"),pt(m,"success");else{m.o=6;try{var Z=Ls(m)>2?m.g.statusText:""}catch{Z=""}m.l=Z+" ["+m.ca()+"]",Oi(m)}}finally{ai(m)}}}}function ai(m,b){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const T=m.g;m.g=null,b||pt(m,"ready");try{T.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Ls(m){return m.g?m.g.readyState:0}t.ca=function(){try{return Ls(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(m){if(this.g){var b=this.g.responseText;return m&&b.indexOf(m)==0&&(b=b.substring(m.length)),Yt(b)}};function Ju(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function sc(m){const b={};m=(m.g&&Ls(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let D=0;D<m.length;D++){if(M(m[D]))continue;var T=fn(m[D]);const Z=T[0];if(T=T[1],typeof T!="string")continue;T=T.trim();const ae=b[Z]||[];b[Z]=ae,ae.push(T)}se(b,function(D){return D.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Vs(m,b,T){return T&&T.internalChannelParams&&T.internalChannelParams[m]||b}function ka(m){this.za=0,this.i=[],this.j=new _t,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Vs("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Vs("baseRetryDelayMs",5e3,m),this.Za=Vs("retryDelaySeedMs",1e4,m),this.Ta=Vs("forwardChannelMaxRetries",2,m),this.va=Vs("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new sn(m&&m.concurrentRequestLimit),this.Ba=new Oo,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=ka.prototype,t.ka=8,t.I=1,t.connect=function(m,b,T,D){dt(0),this.W=m,this.H=b||{},T&&D!==void 0&&(this.H.OSID=T,this.H.OAID=D),this.F=this.X,this.J=oc(this,null,this.W),li(this)};function Pa(m){if(ja(m),m.I==3){var b=m.V++,T=ct(m.J);if(yt(T,"SID",m.M),yt(T,"RID",b),yt(T,"TYPE","terminate"),Os(m,T),b=new ft(m,m.j,b),b.M=2,b.A=si(ct(T)),T=!1,l.navigator&&l.navigator.sendBeacon)try{T=l.navigator.sendBeacon(b.A.toString(),"")}catch{}!T&&l.Image&&(new Image().src=b.A,T=!0),T||(b.g=ed(b.j,null),b.g.ea(b.A)),b.F=Date.now(),_e(b)}Uo(m)}function zr(m){m.g&&(Bo(m),m.g.cancel(),m.g=null)}function ja(m){zr(m),m.v&&(l.clearTimeout(m.v),m.v=null),Na(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&l.clearTimeout(m.m),m.m=null)}function li(m){if(!bn(m.h)&&!m.m){m.m=!0;var b=m.Ea;F||E(),H||(F(),H=!0),A.add(b,m),m.D=0}}function Zu(m,b){return Dn(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=b.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=Le(f(m.Ea,m,b),Da(m,m.D)),m.D++,!0)}t.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const Z=new ft(this,this.j,m);let ae=this.o;if(this.U&&(ae?(ae=z(ae),Q(ae,this.U)):ae=this.U),this.u!==null||this.R||(Z.J=ae,ae=null),this.S)e:{for(var b=0,T=0;T<this.i.length;T++){t:{var D=this.i[T];if("__data__"in D.map&&(D=D.map.__data__,typeof D=="string")){D=D.length;break t}D=void 0}if(D===void 0)break;if(b+=D,b>4096){b=T;break e}if(b===4096||T===this.i.length-1){b=T+1;break e}}b=1e3}else b=1e3;b=ic(this,Z,b),T=ct(this.J),yt(T,"RID",m),yt(T,"CVER",22),this.G&&yt(T,"X-HTTP-Session-Id",this.G),Os(this,T),ae&&(this.R?b="headers="+nn(Xu(ae))+"&"+b:this.u&&Ra(T,this.u,ae)),pe(this.h,Z),this.Ra&&yt(T,"TYPE","init"),this.S?(yt(T,"$req",b),yt(T,"SID","null"),Z.U=!0,rn(Z,T,null)):rn(Z,T,b),this.I=2}}else this.I==3&&(m?Fo(this,m):this.i.length==0||bn(this.h)||Fo(this))};function Fo(m,b){var T;b?T=b.l:T=m.V++;const D=ct(m.J);yt(D,"SID",m.M),yt(D,"RID",T),yt(D,"AID",m.K),Os(m,D),m.u&&m.o&&Ra(D,m.u,m.o),T=new ft(m,m.j,T,m.D+1),m.u===null&&(T.J=m.o),b&&(m.i=b.G.concat(m.i)),b=ic(m,T,1e3),T.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),pe(m.h,T),rn(T,D,b)}function Os(m,b){m.H&&ne(m.H,function(T,D){yt(b,D,T)}),m.l&&ne({},function(T,D){yt(b,D,T)})}function ic(m,b,T){T=Math.min(m.i.length,T);const D=m.l?f(m.l.Ka,m.l,m):null;e:{var Z=m.i;let ut=-1;for(;;){const En=["count="+T];ut==-1?T>0?(ut=Z[0].g,En.push("ofs="+ut)):ut=0:En.push("ofs="+ut);let Vt=!0;for(let Ln=0;Ln<T;Ln++){var ae=Z[Ln].g;const Wr=Z[Ln].map;if(ae-=ut,ae<0)ut=Math.max(0,Z[Ln].g-100),Vt=!1;else try{ae="req"+ae+"_"||"";try{var Ce=Wr instanceof Map?Wr:Object.entries(Wr);for(const[ci,Bs]of Ce){let Us=Bs;d(Bs)&&(Us=gt(Bs)),En.push(ae+ci+"="+encodeURIComponent(Us))}}catch(ci){throw En.push(ae+"type="+encodeURIComponent("_badmap")),ci}}catch{D&&D(Wr)}}if(Vt){Ce=En.join("&");break e}}Ce=void 0}return m=m.i.splice(0,T),b.G=m,Ce}function hr(m){if(!m.g&&!m.v){m.Y=1;var b=m.Da;F||E(),H||(F(),H=!0),A.add(b,m),m.A=0}}function Fs(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=Le(f(m.Da,m),Da(m,m.A)),m.A++,!0)}t.Da=function(){if(this.v=null,Fi(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=Le(f(this.Wa,this),m)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,dt(10),zr(this),Fi(this))};function Bo(m){m.B!=null&&(l.clearTimeout(m.B),m.B=null)}function Fi(m){m.g=new ft(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var b=ct(m.na);yt(b,"RID","rpc"),yt(b,"SID",m.M),yt(b,"AID",m.K),yt(b,"CI",m.F?"0":"1"),!m.F&&m.ia&&yt(b,"TO",m.ia),yt(b,"TYPE","xmlhttp"),Os(m,b),m.u&&m.o&&Ra(b,m.u,m.o),m.O&&(m.g.H=m.O);var T=m.g;m=m.ba,T.M=1,T.A=si(ct(b)),T.u=null,T.R=!0,Fr(T,m)}t.Va=function(){this.C!=null&&(this.C=null,zr(this),Fs(this),dt(19))};function Na(m){m.C!=null&&(l.clearTimeout(m.C),m.C=null)}function Ma(m,b){var T=null;if(m.g==b){Na(m),Bo(m),m.g=null;var D=2}else if(xn(m.h,b))T=b.G,lt(m.h,b),D=1;else return;if(m.I!=0){if(b.o)if(D==1){T=b.u?b.u.length:0,b=Date.now()-b.F;var Z=m.D;D=Jt(),pt(D,new Be(D,T)),li(m)}else hr(m);else if(Z=b.m,Z==3||Z==0&&b.X>0||!(D==1&&Zu(m,b)||D==2&&Fs(m)))switch(T&&T.length>0&&(b=m.h,b.i=b.i.concat(T)),Z){case 1:qr(m,5);break;case 4:qr(m,10);break;case 3:qr(m,6);break;default:qr(m,2)}}}function Da(m,b){let T=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(T*=2),T*b}function qr(m,b){if(m.j.info("Error code "+b),b==2){var T=f(m.bb,m),D=m.Ua;const Z=!D;D=new Ut(D||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Tn(D,"https"),si(D),Z?Ms(D.toString(),T):Ds(D.toString(),T)}else dt(2);m.I=0,m.l&&m.l.pa(b),Uo(m),ja(m)}t.bb=function(m){m?(this.j.info("Successfully pinged google.com"),dt(2)):(this.j.info("Failed to ping google.com"),dt(1))};function Uo(m){if(m.I=0,m.ja=[],m.l){const b=Nt(m.h);(b.length!=0||m.i.length!=0)&&(I(m.ja,b),I(m.ja,m.i),m.h.i.length=0,x(m.i),m.i.length=0),m.l.oa()}}function oc(m,b,T){var D=T instanceof Ut?ct(T):new Ut(T);if(D.g!="")b&&(D.g=b+"."+D.g),dr(D,D.u);else{var Z=l.location;D=Z.protocol,b=b?b+"."+Z.hostname:Z.hostname,Z=+Z.port;const ae=new Ut(null);D&&Tn(ae,D),b&&(ae.g=b),Z&&dr(ae,Z),T&&(ae.h=T),D=ae}return T=m.G,b=m.wa,T&&b&&yt(D,T,b),yt(D,"VER",m.ka),Os(m,D),D}function ed(m,b,T){if(b&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return b=m.Aa&&!m.ma?new $t(new ii({ab:T})):new $t(m.ma),b.Fa(m.L),b}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function td(){}t=td.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function La(){}La.prototype.g=function(m,b){return new rr(m,b)};function rr(m,b){Ze.call(this),this.g=new ka(b),this.l=m,this.h=b&&b.messageUrlParams||null,m=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(m?m["X-WebChannel-Content-Type"]=b.messageContentType:m={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.sa&&(m?m["X-WebChannel-Client-Profile"]=b.sa:m={"X-WebChannel-Client-Profile":b.sa}),this.g.U=m,(m=b&&b.Qb)&&!M(m)&&(this.g.u=m),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!M(b)&&(this.g.G=b,m=this.h,m!==null&&b in m&&(m=this.h,b in m&&delete m[b])),this.j=new Bi(this)}y(rr,Ze),rr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},rr.prototype.close=function(){Pa(this.g)},rr.prototype.o=function(m){var b=this.g;if(typeof m=="string"){var T={};T.__data__=m,m=T}else this.v&&(T={},T.__data__=gt(m),m=T);b.i.push(new pn(b.Ya++,m)),b.I==3&&li(b)},rr.prototype.N=function(){this.g.l=null,delete this.j,Pa(this.g),delete this.g,rr.Z.N.call(this)};function nd(m){Or.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var b=m.__sm__;if(b){e:{for(const T in b){m=T;break e}m=void 0}(this.i=m)&&(m=this.i,b=b!==null&&m in b?b[m]:void 0),this.data=b}else this.data=m}y(nd,Or);function rd(){Ht.call(this),this.status=1}y(rd,Ht);function Bi(m){this.g=m}y(Bi,td),Bi.prototype.ra=function(){pt(this.g,"a")},Bi.prototype.qa=function(m){pt(this.g,new nd(m))},Bi.prototype.pa=function(m){pt(this.g,new rd)},Bi.prototype.oa=function(){pt(this.g,"b")},La.prototype.createWebChannel=La.prototype.g,rr.prototype.send=rr.prototype.o,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,iI=function(){return new La},sI=function(){return Jt()},rI=Xe,cg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},It.NO_ERROR=0,It.TIMEOUT=8,It.HTTP_ERROR=6,vh=It,Nn.COMPLETE="complete",nI=Nn,tr.EventType=Un,Un.OPEN="a",Un.CLOSE="b",Un.ERROR="c",Un.MESSAGE="d",Ze.prototype.listen=Ze.prototype.J,Bc=tr,$t.prototype.listenOnce=$t.prototype.K,$t.prototype.getLastError=$t.prototype.Ha,$t.prototype.getLastErrorCode=$t.prototype.ya,$t.prototype.getStatus=$t.prototype.ca,$t.prototype.getResponseJson=$t.prototype.La,$t.prototype.getResponseText=$t.prototype.la,$t.prototype.send=$t.prototype.ea,$t.prototype.setWithCredentials=$t.prototype.Fa,tI=$t}).apply(typeof Jd<"u"?Jd:typeof self<"u"?self:typeof window<"u"?window:{});const cb="@firebase/firestore",ub="4.9.3";class wr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}wr.UNAUTHENTICATED=new wr(null),wr.GOOGLE_CREDENTIALS=new wr("google-credentials-uid"),wr.FIRST_PARTY=new wr("first-party-uid"),wr.MOCK_USER=new wr("mock-user");let Bl="12.7.0";const pa=new Zg("@firebase/firestore");function sl(){return pa.logLevel}function Fe(t,...e){if(pa.logLevel<=wt.DEBUG){const n=e.map(hy);pa.debug(`Firestore (${Bl}): ${t}`,...n)}}function Ri(t,...e){if(pa.logLevel<=wt.ERROR){const n=e.map(hy);pa.error(`Firestore (${Bl}): ${t}`,...n)}}function bl(t,...e){if(pa.logLevel<=wt.WARN){const n=e.map(hy);pa.warn(`Firestore (${Bl}): ${t}`,...n)}}function hy(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Qe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,oI(t,r,n)}function oI(t,e,n){let r=`FIRESTORE (${Bl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ri(r),new Error(r)}function Et(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||oI(e,s,r)}function st(t,e){return t}const he={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ae extends Mi{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ss{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class aI{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _M{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(wr.UNAUTHENTICATED)))}shutdown(){}}class wM{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class bM{constructor(e){this.t=e,this.currentUser=wr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Et(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let o=new Ss;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ss,e.enqueueRetryable((()=>s(this.currentUser)))};const l=()=>{const h=o;e.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},d=h=>{Fe("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit((h=>d(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?d(h):(Fe("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ss)}}),0),l()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((r=>this.i!==e?(Fe("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Et(typeof r.accessToken=="string",31837,{l:r}),new aI(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Et(e===null||typeof e=="string",2055,{h:e}),new wr(e)}}class xM{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=wr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class TM{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new xM(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(wr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class db{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class EM{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Et(this.o===void 0,3512);const r=o=>{o.error!=null&&Fe("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,Fe("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?n(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>r(o)))};const s=o=>{Fe("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Fe("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new db(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(Et(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new db(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function IM(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class fy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=IM(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<n&&(r+=e.charAt(s[o]%62))}return r}}function bt(t,e){return t<e?-1:t>e?1:0}function ug(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),o=e.charAt(r);if(s!==o)return Ip(s)===Ip(o)?bt(s,o):Ip(s)?1:-1}return bt(t.length,e.length)}const SM=55296,CM=57343;function Ip(t){const e=t.charCodeAt(0);return e>=SM&&e<=CM}function xl(t,e,n){return t.length===e.length&&t.every(((r,s)=>n(r,e[s])))}const hb="__name__";class Hs{constructor(e,n,r){n===void 0?n=0:n>e.length&&Qe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Qe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Hs.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Hs?e.forEach((r=>{n.push(r)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const o=Hs.compareSegments(e.get(s),n.get(s));if(o!==0)return o}return bt(e.length,n.length)}static compareSegments(e,n){const r=Hs.isNumericId(e),s=Hs.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Hs.extractNumericId(e).compare(Hs.extractNumericId(n)):ug(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return go.fromString(e.substring(4,e.length-2))}}class Ot extends Hs{construct(e,n,r){return new Ot(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Ae(he.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter((s=>s.length>0)))}return new Ot(n)}static emptyPath(){return new Ot([])}}const AM=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lr extends Hs{construct(e,n,r){return new lr(e,n,r)}static isValidIdentifier(e){return AM.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hb}static keyField(){return new lr([hb])}static fromServerFormat(e){const n=[];let r="",s=0;const o=()=>{if(r.length===0)throw new Ae(he.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let l=!1;for(;s<e.length;){const d=e[s];if(d==="\\"){if(s+1===e.length)throw new Ae(he.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new Ae(he.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else d==="`"?(l=!l,s++):d!=="."||l?(r+=d,s++):(o(),s++)}if(o(),l)throw new Ae(he.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new lr(n)}static emptyPath(){return new lr([])}}class Ge{constructor(e){this.path=e}static fromPath(e){return new Ge(Ot.fromString(e))}static fromName(e){return new Ge(Ot.fromString(e).popFirst(5))}static empty(){return new Ge(Ot.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ot.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ot.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ge(new Ot(e.slice()))}}function my(t,e,n){if(!n)throw new Ae(he.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function RM(t,e,n,r){if(e===!0&&r===!0)throw new Ae(he.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function fb(t){if(!Ge.isDocumentKey(t))throw new Ae(he.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function mb(t){if(Ge.isDocumentKey(t))throw new Ae(he.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function lI(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function yf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Qe(12329,{type:typeof t})}function Tr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ae(he.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=yf(t);throw new Ae(he.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function kM(t,e){if(e<=0)throw new Ae(he.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}function Bn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Lu(t,e){if(!lI(t))throw new Ae(he.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const l=t[r];if(s&&typeof l!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){n=`Expected '${r}' field to equal '${o.value}'`;break}}if(n)throw new Ae(he.INVALID_ARGUMENT,n);return!0}const pb=-62135596800,gb=1e6;class qt{static now(){return qt.fromMillis(Date.now())}static fromDate(e){return qt.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*gb);return new qt(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Ae(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Ae(he.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<pb)throw new Ae(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ae(he.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/gb}_compareTo(e){return this.seconds===e.seconds?bt(this.nanoseconds,e.nanoseconds):bt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:qt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Lu(e,qt._jsonSchema))return new qt(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-pb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}qt._jsonSchemaVersion="firestore/timestamp/1.0",qt._jsonSchema={type:Bn("string",qt._jsonSchemaVersion),seconds:Bn("number"),nanoseconds:Bn("number")};class rt{static fromTimestamp(e){return new rt(e)}static min(){return new rt(new qt(0,0))}static max(){return new rt(new qt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const mu=-1;function PM(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=rt.fromTimestamp(r===1e9?new qt(n+1,0):new qt(n,r));return new wo(s,Ge.empty(),e)}function jM(t){return new wo(t.readTime,t.key,mu)}class wo{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wo(rt.min(),Ge.empty(),mu)}static max(){return new wo(rt.max(),Ge.empty(),mu)}}function NM(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Ge.comparator(t.documentKey,e.documentKey),n!==0?n:bt(t.largestBatchId,e.largestBatchId))}const MM="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class DM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ul(t){if(t.code!==he.FAILED_PRECONDITION||t.message!==MM)throw t;Fe("LocalStore","Unexpectedly lost primary lease")}class me{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Qe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new me(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(n,o).next(r,s)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof me?n:me.resolve(n)}catch(n){return me.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):me.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):me.reject(n)}static resolve(e){return new me(((n,r)=>{n(e)}))}static reject(e){return new me(((n,r)=>{r(e)}))}static waitFor(e){return new me(((n,r)=>{let s=0,o=0,l=!1;e.forEach((d=>{++s,d.next((()=>{++o,l&&o===s&&n()}),(h=>r(h)))})),l=!0,o===s&&n()}))}static or(e){let n=me.resolve(!1);for(const r of e)n=n.next((s=>s?me.resolve(s):r()));return n}static forEach(e,n){const r=[];return e.forEach(((s,o)=>{r.push(n.call(this,s,o))})),this.waitFor(r)}static mapArray(e,n){return new me(((r,s)=>{const o=e.length,l=new Array(o);let d=0;for(let h=0;h<o;h++){const f=h;n(e[f]).next((g=>{l[f]=g,++d,d===o&&r(l)}),(g=>s(g)))}}))}static doWhile(e,n){return new me(((r,s)=>{const o=()=>{e()===!0?n().next((()=>{o()}),s):r()};o()}))}}function LM(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function $l(t){return t.name==="IndexedDbTransactionError"}class vf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}vf.ce=-1;const py=-1;function Vu(t){return t==null}function Lh(t){return t===0&&1/t==-1/0}function VM(t){return typeof t=="number"&&Number.isInteger(t)&&!Lh(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const cI="";function OM(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=yb(e)),e=FM(t.get(n),e);return yb(e)}function FM(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const o=t.charAt(s);switch(o){case"\0":n+="";break;case cI:n+="";break;default:n+=o}}return n}function yb(t){return t+cI+""}function vb(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function jo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function BM(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function uI(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class dn{constructor(e,n){this.comparator=e,this.root=n||ar.EMPTY}insert(e,n){return new dn(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ar.BLACK,null,null))}remove(e){return new dn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ar.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,r)=>(e(n,r),!1)))}toString(){const e=[];return this.inorderTraversal(((n,r)=>(e.push(`${n}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Zd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Zd(this.root,e,this.comparator,!1)}getReverseIterator(){return new Zd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Zd(this.root,e,this.comparator,!0)}}class Zd{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=n?r(e.key,n):1,n&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ar{constructor(e,n,r,s,o){this.key=e,this.value=n,this.color=r??ar.RED,this.left=s??ar.EMPTY,this.right=o??ar.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,o){return new ar(e??this.key,n??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,n,r),null):o===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ar.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return ar.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Qe(27949);return e+(this.isRed()?0:1)}}ar.EMPTY=null,ar.RED=!0,ar.BLACK=!1;ar.EMPTY=new class{constructor(){this.size=0}get key(){throw Qe(57766)}get value(){throw Qe(16141)}get color(){throw Qe(16727)}get left(){throw Qe(29726)}get right(){throw Qe(36894)}copy(e,n,r,s,o){return this}insert(e,n,r){return new ar(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Wn{constructor(e){this.comparator=e,this.data=new dn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,r)=>(e(n),!1)))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new _b(this.data.getIterator())}getIteratorFrom(e){return new _b(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((r=>{n=n.add(r)})),n}isEqual(e){if(!(e instanceof Wn)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new Wn(this.comparator);return n.data=e,n}}class _b{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Yr{constructor(e){this.fields=e,e.sort(lr.comparator)}static empty(){return new Yr([])}unionWith(e){let n=new Wn(lr.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Yr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return xl(this.fields,e.fields,((n,r)=>n.isEqual(r)))}}class dI extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class cr{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new dI("Invalid base64 string: "+o):o}})(e);return new cr(n)}static fromUint8Array(e){const n=(function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o})(e);return new cr(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return bt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}cr.EMPTY_BYTE_STRING=new cr("");const UM=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bo(t){if(Et(!!t,39018),typeof t=="string"){let e=0;const n=UM.exec(t);if(Et(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:An(t.seconds),nanos:An(t.nanos)}}function An(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function xo(t){return typeof t=="string"?cr.fromBase64String(t):cr.fromUint8Array(t)}const hI="server_timestamp",fI="__type__",mI="__previous_value__",pI="__local_write_time__";function gy(t){return(t?.mapValue?.fields||{})[fI]?.stringValue===hI}function _f(t){const e=t.mapValue.fields[mI];return gy(e)?_f(e):e}function pu(t){const e=bo(t.mapValue.fields[pI].timestampValue);return new qt(e.seconds,e.nanos)}class $M{constructor(e,n,r,s,o,l,d,h,f,g){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=d,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=g}}const Vh="(default)";class gu{constructor(e,n){this.projectId=e,this.database=n||Vh}static empty(){return new gu("","")}get isDefaultDatabase(){return this.database===Vh}isEqual(e){return e instanceof gu&&e.projectId===this.projectId&&e.database===this.database}}const gI="__type__",zM="__max__",eh={mapValue:{}},yI="__vector__",Oh="value";function To(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?gy(t)?4:WM(t)?9007199254740991:qM(t)?10:11:Qe(28295,{value:t})}function ti(t,e){if(t===e)return!0;const n=To(t);if(n!==To(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return pu(t).isEqual(pu(e));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=bo(s.timestampValue),d=bo(o.timestampValue);return l.seconds===d.seconds&&l.nanos===d.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(s,o){return xo(s.bytesValue).isEqual(xo(o.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(s,o){return An(s.geoPointValue.latitude)===An(o.geoPointValue.latitude)&&An(s.geoPointValue.longitude)===An(o.geoPointValue.longitude)})(t,e);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return An(s.integerValue)===An(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=An(s.doubleValue),d=An(o.doubleValue);return l===d?Lh(l)===Lh(d):isNaN(l)&&isNaN(d)}return!1})(t,e);case 9:return xl(t.arrayValue.values||[],e.arrayValue.values||[],ti);case 10:case 11:return(function(s,o){const l=s.mapValue.fields||{},d=o.mapValue.fields||{};if(vb(l)!==vb(d))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(d[h]===void 0||!ti(l[h],d[h])))return!1;return!0})(t,e);default:return Qe(52216,{left:t})}}function yu(t,e){return(t.values||[]).find((n=>ti(n,e)))!==void 0}function Tl(t,e){if(t===e)return 0;const n=To(t),r=To(e);if(n!==r)return bt(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return bt(t.booleanValue,e.booleanValue);case 2:return(function(o,l){const d=An(o.integerValue||o.doubleValue),h=An(l.integerValue||l.doubleValue);return d<h?-1:d>h?1:d===h?0:isNaN(d)?isNaN(h)?0:-1:1})(t,e);case 3:return wb(t.timestampValue,e.timestampValue);case 4:return wb(pu(t),pu(e));case 5:return ug(t.stringValue,e.stringValue);case 6:return(function(o,l){const d=xo(o),h=xo(l);return d.compareTo(h)})(t.bytesValue,e.bytesValue);case 7:return(function(o,l){const d=o.split("/"),h=l.split("/");for(let f=0;f<d.length&&f<h.length;f++){const g=bt(d[f],h[f]);if(g!==0)return g}return bt(d.length,h.length)})(t.referenceValue,e.referenceValue);case 8:return(function(o,l){const d=bt(An(o.latitude),An(l.latitude));return d!==0?d:bt(An(o.longitude),An(l.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return bb(t.arrayValue,e.arrayValue);case 10:return(function(o,l){const d=o.fields||{},h=l.fields||{},f=d[Oh]?.arrayValue,g=h[Oh]?.arrayValue,y=bt(f?.values?.length||0,g?.values?.length||0);return y!==0?y:bb(f,g)})(t.mapValue,e.mapValue);case 11:return(function(o,l){if(o===eh.mapValue&&l===eh.mapValue)return 0;if(o===eh.mapValue)return 1;if(l===eh.mapValue)return-1;const d=o.fields||{},h=Object.keys(d),f=l.fields||{},g=Object.keys(f);h.sort(),g.sort();for(let y=0;y<h.length&&y<g.length;++y){const _=ug(h[y],g[y]);if(_!==0)return _;const x=Tl(d[h[y]],f[g[y]]);if(x!==0)return x}return bt(h.length,g.length)})(t.mapValue,e.mapValue);default:throw Qe(23264,{he:n})}}function wb(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return bt(t,e);const n=bo(t),r=bo(e),s=bt(n.seconds,r.seconds);return s!==0?s:bt(n.nanos,r.nanos)}function bb(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const o=Tl(n[s],r[s]);if(o)return o}return bt(n.length,r.length)}function El(t){return dg(t)}function dg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const r=bo(n);return`time(${r.seconds},${r.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return xo(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Ge.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let r="[",s=!0;for(const o of n.values||[])s?s=!1:r+=",",r+=dg(o);return r+"]"})(t.arrayValue):"mapValue"in t?(function(n){const r=Object.keys(n.fields||{}).sort();let s="{",o=!0;for(const l of r)o?o=!1:s+=",",s+=`${l}:${dg(n.fields[l])}`;return s+"}"})(t.mapValue):Qe(61005,{value:t})}function _h(t){switch(To(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_f(t);return e?16+_h(e):16;case 5:return 2*t.stringValue.length;case 6:return xo(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+_h(o)),0)})(t.arrayValue);case 10:case 11:return(function(r){let s=0;return jo(r.fields,((o,l)=>{s+=o.length+_h(l)})),s})(t.mapValue);default:throw Qe(13486,{value:t})}}function xb(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function hg(t){return!!t&&"integerValue"in t}function yy(t){return!!t&&"arrayValue"in t}function Tb(t){return!!t&&"nullValue"in t}function Eb(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function wh(t){return!!t&&"mapValue"in t}function qM(t){return(t?.mapValue?.fields||{})[gI]?.stringValue===yI}function Xc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return jo(t.mapValue.fields,((n,r)=>e.mapValue.fields[n]=Xc(r))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Xc(t.arrayValue.values[n]);return e}return{...t}}function WM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===zM}class Rr{constructor(e){this.value=e}static empty(){return new Rr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!wh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xc(n)}setAll(e){let n=lr.emptyPath(),r={},s=[];e.forEach(((l,d)=>{if(!n.isImmediateParentOf(d)){const h=this.getFieldsMap(n);this.applyChanges(h,r,s),r={},s=[],n=d.popLast()}l?r[d.lastSegment()]=Xc(l):s.push(d.lastSegment())}));const o=this.getFieldsMap(n);this.applyChanges(o,r,s)}delete(e){const n=this.field(e.popLast());wh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ti(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];wh(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){jo(n,((s,o)=>e[s]=o));for(const s of r)delete e[s]}clone(){return new Rr(Xc(this.value))}}function vI(t){const e=[];return jo(t.fields,((n,r)=>{const s=new lr([n]);if(wh(r)){const o=vI(r.mapValue).fields;if(o.length===0)e.push(s);else for(const l of o)e.push(s.child(l))}else e.push(s)})),new Yr(e)}class Zn{constructor(e,n,r,s,o,l,d){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=o,this.data=l,this.documentState=d}static newInvalidDocument(e){return new Zn(e,0,rt.min(),rt.min(),rt.min(),Rr.empty(),0)}static newFoundDocument(e,n,r,s){return new Zn(e,1,n,rt.min(),r,s,0)}static newNoDocument(e,n){return new Zn(e,2,n,rt.min(),rt.min(),Rr.empty(),0)}static newUnknownDocument(e,n){return new Zn(e,3,n,rt.min(),rt.min(),Rr.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(rt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Rr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Rr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Zn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Zn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Fh{constructor(e,n){this.position=e,this.inclusive=n}}function Ib(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const o=e[s],l=t.position[s];if(o.field.isKeyField()?r=Ge.comparator(Ge.fromName(l.referenceValue),n.key):r=Tl(l,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Sb(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ti(t.position[n],e.position[n]))return!1;return!0}class vu{constructor(e,n="asc"){this.field=e,this.dir=n}}function HM(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class _I{}class Fn extends _I{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new GM(e,n,r):n==="array-contains"?new YM(e,r):n==="in"?new JM(e,r):n==="not-in"?new ZM(e,r):n==="array-contains-any"?new eD(e,r):new Fn(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new QM(e,r):new XM(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Tl(n,this.value)):n!==null&&To(this.value)===To(n)&&this.matchesComparison(Tl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Cs extends _I{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Cs(e,n)}matches(e){return wI(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function wI(t){return t.op==="and"}function bI(t){return KM(t)&&wI(t)}function KM(t){for(const e of t.filters)if(e instanceof Cs)return!1;return!0}function fg(t){if(t instanceof Fn)return t.field.canonicalString()+t.op.toString()+El(t.value);if(bI(t))return t.filters.map((e=>fg(e))).join(",");{const e=t.filters.map((n=>fg(n))).join(",");return`${t.op}(${e})`}}function xI(t,e){return t instanceof Fn?(function(r,s){return s instanceof Fn&&r.op===s.op&&r.field.isEqual(s.field)&&ti(r.value,s.value)})(t,e):t instanceof Cs?(function(r,s){return s instanceof Cs&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,l,d)=>o&&xI(l,s.filters[d])),!0):!1})(t,e):void Qe(19439)}function TI(t){return t instanceof Fn?(function(n){return`${n.field.canonicalString()} ${n.op} ${El(n.value)}`})(t):t instanceof Cs?(function(n){return n.op.toString()+" {"+n.getFilters().map(TI).join(" ,")+"}"})(t):"Filter"}class GM extends Fn{constructor(e,n,r){super(e,n,r),this.key=Ge.fromName(r.referenceValue)}matches(e){const n=Ge.comparator(e.key,this.key);return this.matchesComparison(n)}}class QM extends Fn{constructor(e,n){super(e,"in",n),this.keys=EI("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class XM extends Fn{constructor(e,n){super(e,"not-in",n),this.keys=EI("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function EI(t,e){return(e.arrayValue?.values||[]).map((n=>Ge.fromName(n.referenceValue)))}class YM extends Fn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return yy(n)&&yu(n.arrayValue,this.value)}}class JM extends Fn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&yu(this.value.arrayValue,n)}}class ZM extends Fn{constructor(e,n){super(e,"not-in",n)}matches(e){if(yu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!yu(this.value.arrayValue,n)}}class eD extends Fn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!yy(n)||!n.arrayValue.values)&&n.arrayValue.values.some((r=>yu(this.value.arrayValue,r)))}}class tD{constructor(e,n=null,r=[],s=[],o=null,l=null,d=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=l,this.endAt=d,this.Te=null}}function Cb(t,e=null,n=[],r=[],s=null,o=null,l=null){return new tD(t,e,n,r,s,o,l)}function vy(t){const e=st(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((r=>fg(r))).join(","),n+="|ob:",n+=e.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),Vu(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((r=>El(r))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((r=>El(r))).join(",")),e.Te=n}return e.Te}function _y(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!HM(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!xI(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Sb(t.startAt,e.startAt)&&Sb(t.endAt,e.endAt)}function mg(t){return Ge.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class ba{constructor(e,n=null,r=[],s=[],o=null,l="F",d=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=l,this.startAt=d,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function nD(t,e,n,r,s,o,l,d){return new ba(t,e,n,r,s,o,l,d)}function wf(t){return new ba(t)}function Ab(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function II(t){return t.collectionGroup!==null}function Yc(t){const e=st(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),n.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let d=new Wn(lr.comparator);return l.filters.forEach((h=>{h.getFlattenedFilters().forEach((f=>{f.isInequality()&&(d=d.add(f.field))}))})),d})(e).forEach((o=>{n.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new vu(o,r))})),n.has(lr.keyField().canonicalString())||e.Ie.push(new vu(lr.keyField(),r))}return e.Ie}function Xs(t){const e=st(t);return e.Ee||(e.Ee=SI(e,Yc(t))),e.Ee}function rD(t){const e=st(t);return e.de||(e.de=SI(e,t.explicitOrderBy)),e.de}function SI(t,e){if(t.limitType==="F")return Cb(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new vu(s.field,o)}));const n=t.endAt?new Fh(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Fh(t.startAt.position,t.startAt.inclusive):null;return Cb(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function pg(t,e){const n=t.filters.concat([e]);return new ba(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Bh(t,e,n){return new ba(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function bf(t,e){return _y(Xs(t),Xs(e))&&t.limitType===e.limitType}function CI(t){return`${vy(Xs(t))}|lt:${t.limitType}`}function il(t){return`Query(target=${(function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map((s=>TI(s))).join(", ")}]`),Vu(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map((s=>(function(l){return`${l.field.canonicalString()} (${l.dir})`})(s))).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map((s=>El(s))).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map((s=>El(s))).join(",")),`Target(${r})`})(Xs(t))}; limitType=${t.limitType})`}function xf(t,e){return e.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):Ge.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(t,e)&&(function(r,s){for(const o of Yc(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(t,e)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(t,e)&&(function(r,s){return!(r.startAt&&!(function(l,d,h){const f=Ib(l,d,h);return l.inclusive?f<=0:f<0})(r.startAt,Yc(r),s)||r.endAt&&!(function(l,d,h){const f=Ib(l,d,h);return l.inclusive?f>=0:f>0})(r.endAt,Yc(r),s))})(t,e)}function sD(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function AI(t){return(e,n)=>{let r=!1;for(const s of Yc(t)){const o=iD(s,e,n);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function iD(t,e,n){const r=t.field.isKeyField()?Ge.comparator(e.key,n.key):(function(o,l,d){const h=l.data.field(o),f=d.data.field(o);return h!==null&&f!==null?Tl(h,f):Qe(42886)})(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Qe(19790,{direction:t.dir})}}class xa{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){jo(this.inner,((n,r)=>{for(const[s,o]of r)e(s,o)}))}isEmpty(){return uI(this.inner)}size(){return this.innerSize}}const oD=new dn(Ge.comparator);function ki(){return oD}const RI=new dn(Ge.comparator);function Uc(...t){let e=RI;for(const n of t)e=e.insert(n.key,n);return e}function kI(t){let e=RI;return t.forEach(((n,r)=>e=e.insert(n,r.overlayedDocument))),e}function la(){return Jc()}function PI(){return Jc()}function Jc(){return new xa((t=>t.toString()),((t,e)=>t.isEqual(e)))}const aD=new dn(Ge.comparator),lD=new Wn(Ge.comparator);function xt(...t){let e=lD;for(const n of t)e=e.add(n);return e}const cD=new Wn(bt);function uD(){return cD}function wy(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lh(e)?"-0":e}}function jI(t){return{integerValue:""+t}}function dD(t,e){return VM(e)?jI(e):wy(t,e)}class Tf{constructor(){this._=void 0}}function hD(t,e,n){return t instanceof _u?(function(s,o){const l={fields:{[fI]:{stringValue:hI},[pI]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&gy(o)&&(o=_f(o)),o&&(l.fields[mI]=o),{mapValue:l}})(n,e):t instanceof Il?MI(t,e):t instanceof Sl?DI(t,e):(function(s,o){const l=NI(s,o),d=Rb(l)+Rb(s.Ae);return hg(l)&&hg(s.Ae)?jI(d):wy(s.serializer,d)})(t,e)}function fD(t,e,n){return t instanceof Il?MI(t,e):t instanceof Sl?DI(t,e):n}function NI(t,e){return t instanceof Uh?(function(r){return hg(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}class _u extends Tf{}class Il extends Tf{constructor(e){super(),this.elements=e}}function MI(t,e){const n=LI(e);for(const r of t.elements)n.some((s=>ti(s,r)))||n.push(r);return{arrayValue:{values:n}}}class Sl extends Tf{constructor(e){super(),this.elements=e}}function DI(t,e){let n=LI(e);for(const r of t.elements)n=n.filter((s=>!ti(s,r)));return{arrayValue:{values:n}}}class Uh extends Tf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Rb(t){return An(t.integerValue||t.doubleValue)}function LI(t){return yy(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class by{constructor(e,n){this.field=e,this.transform=n}}function mD(t,e){return t.field.isEqual(e.field)&&(function(r,s){return r instanceof Il&&s instanceof Il||r instanceof Sl&&s instanceof Sl?xl(r.elements,s.elements,ti):r instanceof Uh&&s instanceof Uh?ti(r.Ae,s.Ae):r instanceof _u&&s instanceof _u})(t.transform,e.transform)}class pD{constructor(e,n){this.version=e,this.transformResults=n}}class er{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new er}static exists(e){return new er(void 0,e)}static updateTime(e){return new er(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ef{}function VI(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new If(t.key,er.none()):new Ou(t.key,t.data,er.none());{const n=t.data,r=Rr.empty();let s=new Wn(lr.comparator);for(let o of e.fields)if(!s.has(o)){let l=n.field(o);l===null&&o.length>1&&(o=o.popLast(),l=n.field(o)),l===null?r.delete(o):r.set(o,l),s=s.add(o)}return new No(t.key,r,new Yr(s.toArray()),er.none())}}function gD(t,e,n){t instanceof Ou?(function(s,o,l){const d=s.value.clone(),h=Pb(s.fieldTransforms,o,l.transformResults);d.setAll(h),o.convertToFoundDocument(l.version,d).setHasCommittedMutations()})(t,e,n):t instanceof No?(function(s,o,l){if(!bh(s.precondition,o))return void o.convertToUnknownDocument(l.version);const d=Pb(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(OI(s)),h.setAll(d),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()})(t,e,n):(function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()})(0,e,n)}function Zc(t,e,n,r){return t instanceof Ou?(function(o,l,d,h){if(!bh(o.precondition,l))return d;const f=o.value.clone(),g=jb(o.fieldTransforms,h,l);return f.setAll(g),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null})(t,e,n,r):t instanceof No?(function(o,l,d,h){if(!bh(o.precondition,l))return d;const f=jb(o.fieldTransforms,h,l),g=l.data;return g.setAll(OI(o)),g.setAll(f),l.convertToFoundDocument(l.version,g).setHasLocalMutations(),d===null?null:d.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((y=>y.field)))})(t,e,n,r):(function(o,l,d){return bh(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):d})(t,e,n)}function yD(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),o=NI(r.transform,s||null);o!=null&&(n===null&&(n=Rr.empty()),n.set(r.field,o))}return n||null}function kb(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&xl(r,s,((o,l)=>mD(o,l)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ou extends Ef{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class No extends Ef{constructor(e,n,r,s,o=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function OI(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Pb(t,e,n){const r=new Map;Et(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const o=t[s],l=o.transform,d=e.data.field(o.field);r.set(o.field,fD(l,d,n[s]))}return r}function jb(t,e,n){const r=new Map;for(const s of t){const o=s.transform,l=n.data.field(s.field);r.set(s.field,hD(o,l,e))}return r}class If extends Ef{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FI extends Ef{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class vD{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&gD(o,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Zc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Zc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=PI();return this.mutations.forEach((s=>{const o=e.get(s.key),l=o.overlayedDocument;let d=this.applyToLocalView(l,o.mutatedFields);d=n.has(s.key)?null:d;const h=VI(l,d);h!==null&&r.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(rt.min())})),r}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),xt())}isEqual(e){return this.batchId===e.batchId&&xl(this.mutations,e.mutations,((n,r)=>kb(n,r)))&&xl(this.baseMutations,e.baseMutations,((n,r)=>kb(n,r)))}}class xy{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Et(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return aD})();const o=e.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,r[l].version);return new xy(e,n,r,s)}}class _D{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class wD{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}class bD{constructor(e,n){this.count=e,this.unchangedNames=n}}var On,Ct;function BI(t){switch(t){case he.OK:return Qe(64938);case he.CANCELLED:case he.UNKNOWN:case he.DEADLINE_EXCEEDED:case he.RESOURCE_EXHAUSTED:case he.INTERNAL:case he.UNAVAILABLE:case he.UNAUTHENTICATED:return!1;case he.INVALID_ARGUMENT:case he.NOT_FOUND:case he.ALREADY_EXISTS:case he.PERMISSION_DENIED:case he.FAILED_PRECONDITION:case he.ABORTED:case he.OUT_OF_RANGE:case he.UNIMPLEMENTED:case he.DATA_LOSS:return!0;default:return Qe(15467,{code:t})}}function UI(t){if(t===void 0)return Ri("GRPC error has no .code"),he.UNKNOWN;switch(t){case On.OK:return he.OK;case On.CANCELLED:return he.CANCELLED;case On.UNKNOWN:return he.UNKNOWN;case On.DEADLINE_EXCEEDED:return he.DEADLINE_EXCEEDED;case On.RESOURCE_EXHAUSTED:return he.RESOURCE_EXHAUSTED;case On.INTERNAL:return he.INTERNAL;case On.UNAVAILABLE:return he.UNAVAILABLE;case On.UNAUTHENTICATED:return he.UNAUTHENTICATED;case On.INVALID_ARGUMENT:return he.INVALID_ARGUMENT;case On.NOT_FOUND:return he.NOT_FOUND;case On.ALREADY_EXISTS:return he.ALREADY_EXISTS;case On.PERMISSION_DENIED:return he.PERMISSION_DENIED;case On.FAILED_PRECONDITION:return he.FAILED_PRECONDITION;case On.ABORTED:return he.ABORTED;case On.OUT_OF_RANGE:return he.OUT_OF_RANGE;case On.UNIMPLEMENTED:return he.UNIMPLEMENTED;case On.DATA_LOSS:return he.DATA_LOSS;default:return Qe(39323,{code:t})}}(Ct=On||(On={}))[Ct.OK=0]="OK",Ct[Ct.CANCELLED=1]="CANCELLED",Ct[Ct.UNKNOWN=2]="UNKNOWN",Ct[Ct.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ct[Ct.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ct[Ct.NOT_FOUND=5]="NOT_FOUND",Ct[Ct.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ct[Ct.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ct[Ct.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ct[Ct.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ct[Ct.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ct[Ct.ABORTED=10]="ABORTED",Ct[Ct.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ct[Ct.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ct[Ct.INTERNAL=13]="INTERNAL",Ct[Ct.UNAVAILABLE=14]="UNAVAILABLE",Ct[Ct.DATA_LOSS=15]="DATA_LOSS";function xD(){return new TextEncoder}const TD=new go([4294967295,4294967295],0);function Nb(t){const e=xD().encode(t),n=new eI;return n.update(e),new Uint8Array(n.digest())}function Mb(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new go([n,r],0),new go([s,o],0)]}class Ty{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new $c(`Invalid padding: ${n}`);if(r<0)throw new $c(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new $c(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new $c(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=go.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(go.fromNumber(r)));return s.compare(TD)===1&&(s=new go([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Nb(e),[r,s]=Mb(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);if(!this.we(l))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new Ty(o,s,n);return r.forEach((d=>l.insert(d))),l}insert(e){if(this.ge===0)return;const n=Nb(e),[r,s]=Mb(n);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);this.Se(l)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class $c extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Sf{constructor(e,n,r,s,o){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Fu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Sf(rt.min(),s,new dn(bt),ki(),xt())}}class Fu{constructor(e,n,r,s,o){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Fu(r,n,xt(),xt(),xt())}}class xh{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class $I{constructor(e,n){this.targetId=e,this.Ce=n}}class zI{constructor(e,n,r=cr.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Db{constructor(){this.ve=0,this.Fe=Lb(),this.Me=cr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=xt(),n=xt(),r=xt();return this.Fe.forEach(((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Qe(38017,{changeType:o})}})),new Fu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=Lb()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Et(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ED{constructor(e){this.Ge=e,this.ze=new Map,this.je=ki(),this.Je=th(),this.He=th(),this.Ye=new dn(bt)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Qe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((r,s)=>{this.rt(s)&&n(s)}))}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const o=s.target;if(mg(o))if(r===0){const l=new Ge(o.path);this.et(n,l,Zn.newNoDocument(l,rt.min()))}else Et(r===1,20013,{expectedCount:r});else{const l=this._t(n);if(l!==r){const d=this.ut(e),h=d?this.ct(d,e,l):1;if(h!==0){this.it(n);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,f)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let l,d;try{l=xo(r).toUint8Array()}catch(h){if(h instanceof dI)return bl("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{d=new Ty(l,s,o)}catch(h){return bl(h instanceof $c?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return d.ge===0?null:d}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach((o=>{const l=this.Ge.ht(),d=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(d)||(this.et(n,o,null),s++)})),s}Tt(e){const n=new Map;this.ze.forEach(((o,l)=>{const d=this.ot(l);if(d){if(o.current&&mg(d.target)){const h=new Ge(d.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,Zn.newNoDocument(h,e))}o.Be&&(n.set(l,o.ke()),o.qe())}}));let r=xt();this.He.forEach(((o,l)=>{let d=!0;l.forEachWhile((h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)})),d&&(r=r.add(o))})),this.je.forEach(((o,l)=>l.setReadTime(e)));const s=new Sf(e,n,this.Ye,this.je,r);return this.je=ki(),this.Je=th(),this.He=th(),this.Ye=new dn(bt),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new Db,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Wn(bt),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Wn(bt),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Fe("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Db),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function th(){return new dn(Ge.comparator)}function Lb(){return new dn(Ge.comparator)}const ID={asc:"ASCENDING",desc:"DESCENDING"},SD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},CD={and:"AND",or:"OR"};class AD{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function gg(t,e){return t.useProto3Json||Vu(e)?e:{value:e}}function $h(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qI(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function RD(t,e){return $h(t,e.toTimestamp())}function Jr(t){return Et(!!t,49232),rt.fromTimestamp((function(n){const r=bo(n);return new qt(r.seconds,r.nanos)})(t))}function Ey(t,e){return yg(t,e).canonicalString()}function yg(t,e){const n=(function(s){return new Ot(["projects",s.projectId,"databases",s.database])})(t).child("documents");return e===void 0?n:n.child(e)}function WI(t){const e=Ot.fromString(t);return Et(JI(e),10190,{key:e.toString()}),e}function zh(t,e){return Ey(t.databaseId,e.path)}function eu(t,e){const n=WI(e);if(n.get(1)!==t.databaseId.projectId)throw new Ae(he.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ae(he.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ge(KI(n))}function HI(t,e){return Ey(t.databaseId,e)}function kD(t){const e=WI(t);return e.length===4?Ot.emptyPath():KI(e)}function vg(t){return new Ot(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function KI(t){return Et(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Vb(t,e,n){return{name:zh(t,e),fields:n.value.mapValue.fields}}function PD(t,e){return"found"in e?(function(r,s){Et(!!s.found,43571),s.found.name,s.found.updateTime;const o=eu(r,s.found.name),l=Jr(s.found.updateTime),d=s.found.createTime?Jr(s.found.createTime):rt.min(),h=new Rr({mapValue:{fields:s.found.fields}});return Zn.newFoundDocument(o,l,d,h)})(t,e):"missing"in e?(function(r,s){Et(!!s.missing,3894),Et(!!s.readTime,22933);const o=eu(r,s.missing),l=Jr(s.readTime);return Zn.newNoDocument(o,l)})(t,e):Qe(7234,{result:e})}function jD(t,e){let n;if("targetChange"in e){e.targetChange;const r=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:Qe(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=(function(f,g){return f.useProto3Json?(Et(g===void 0||typeof g=="string",58123),cr.fromBase64String(g||"")):(Et(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),cr.fromUint8Array(g||new Uint8Array))})(t,e.targetChange.resumeToken),l=e.targetChange.cause,d=l&&(function(f){const g=f.code===void 0?he.UNKNOWN:UI(f.code);return new Ae(g,f.message||"")})(l);n=new zI(r,s,o,d||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=eu(t,r.document.name),o=Jr(r.document.updateTime),l=r.document.createTime?Jr(r.document.createTime):rt.min(),d=new Rr({mapValue:{fields:r.document.fields}}),h=Zn.newFoundDocument(s,o,l,d),f=r.targetIds||[],g=r.removedTargetIds||[];n=new xh(f,g,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=eu(t,r.document),o=r.readTime?Jr(r.readTime):rt.min(),l=Zn.newNoDocument(s,o),d=r.removedTargetIds||[];n=new xh([],d,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=eu(t,r.document),o=r.removedTargetIds||[];n=new xh([],o,s,null)}else{if(!("filter"in e))return Qe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,l=new bD(s,o),d=r.targetId;n=new $I(d,l)}}return n}function GI(t,e){let n;if(e instanceof Ou)n={update:Vb(t,e.key,e.value)};else if(e instanceof If)n={delete:zh(t,e.key)};else if(e instanceof No)n={update:Vb(t,e.key,e.data),updateMask:UD(e.fieldMask)};else{if(!(e instanceof FI))return Qe(16599,{Vt:e.type});n={verify:zh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((r=>(function(o,l){const d=l.transform;if(d instanceof _u)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof Il)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof Sl)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof Uh)return{fieldPath:l.field.canonicalString(),increment:d.Ae};throw Qe(20930,{transform:l.transform})})(0,r)))),e.precondition.isNone||(n.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:RD(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Qe(27497)})(t,e.precondition)),n}function ND(t,e){return t&&t.length>0?(Et(e!==void 0,14353),t.map((n=>(function(s,o){let l=s.updateTime?Jr(s.updateTime):Jr(o);return l.isEqual(rt.min())&&(l=Jr(o)),new pD(l,s.transformResults||[])})(n,e)))):[]}function MD(t,e){return{documents:[HI(t,e.path)]}}function QI(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=HI(t,s);const o=(function(f){if(f.length!==0)return YI(Cs.create(f,"and"))})(e.filters);o&&(n.structuredQuery.where=o);const l=(function(f){if(f.length!==0)return f.map((g=>(function(_){return{field:ao(_.field),direction:OD(_.dir)}})(g)))})(e.orderBy);l&&(n.structuredQuery.orderBy=l);const d=gg(t,e.limit);return d!==null&&(n.structuredQuery.limit=d),e.startAt&&(n.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:n,parent:s}}function DD(t,e,n,r){const{ft:s,parent:o}=QI(t,e),l={},d=[];let h=0;return n.forEach((f=>{const g="aggregate_"+h++;l[g]=f.alias,f.aggregateType==="count"?d.push({alias:g,count:{}}):f.aggregateType==="avg"?d.push({alias:g,avg:{field:ao(f.fieldPath)}}):f.aggregateType==="sum"&&d.push({alias:g,sum:{field:ao(f.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:d,structuredQuery:s.structuredQuery},parent:s.parent},gt:l,parent:o}}function LD(t){let e=kD(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Et(r===1,65062);const g=n.from[0];g.allDescendants?s=g.collectionId:e=e.child(g.collectionId)}let o=[];n.where&&(o=(function(y){const _=XI(y);return _ instanceof Cs&&bI(_)?_.getFilters():[_]})(n.where));let l=[];n.orderBy&&(l=(function(y){return y.map((_=>(function(I){return new vu(ol(I.field),(function(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(I.direction))})(_)))})(n.orderBy));let d=null;n.limit&&(d=(function(y){let _;return _=typeof y=="object"?y.value:y,Vu(_)?null:_})(n.limit));let h=null;n.startAt&&(h=(function(y){const _=!!y.before,x=y.values||[];return new Fh(x,_)})(n.startAt));let f=null;return n.endAt&&(f=(function(y){const _=!y.before,x=y.values||[];return new Fh(x,_)})(n.endAt)),nD(e,s,l,o,d,"F",h,f)}function VD(t,e){const n=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qe(28987,{purpose:s})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function XI(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=ol(n.unaryFilter.field);return Fn.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ol(n.unaryFilter.field);return Fn.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=ol(n.unaryFilter.field);return Fn.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=ol(n.unaryFilter.field);return Fn.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qe(61313);default:return Qe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return Fn.create(ol(n.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qe(58110);default:return Qe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return Cs.create(n.compositeFilter.filters.map((r=>XI(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Qe(1026)}})(n.compositeFilter.op))})(t):Qe(30097,{filter:t})}function OD(t){return ID[t]}function FD(t){return SD[t]}function BD(t){return CD[t]}function ao(t){return{fieldPath:t.canonicalString()}}function ol(t){return lr.fromServerFormat(t.fieldPath)}function YI(t){return t instanceof Fn?(function(n){if(n.op==="=="){if(Eb(n.value))return{unaryFilter:{field:ao(n.field),op:"IS_NAN"}};if(Tb(n.value))return{unaryFilter:{field:ao(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Eb(n.value))return{unaryFilter:{field:ao(n.field),op:"IS_NOT_NAN"}};if(Tb(n.value))return{unaryFilter:{field:ao(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ao(n.field),op:FD(n.op),value:n.value}}})(t):t instanceof Cs?(function(n){const r=n.getFilters().map((s=>YI(s)));return r.length===1?r[0]:{compositeFilter:{op:BD(n.op),filters:r}}})(t):Qe(54877,{filter:t})}function UD(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function JI(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class co{constructor(e,n,r,s,o=rt.min(),l=rt.min(),d=cr.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=d,this.expectedCount=h}withSequenceNumber(e){return new co(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new co(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new co(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new co(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class $D{constructor(e){this.yt=e}}function zD(t){const e=LD({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Bh(e,e.limit,"L"):e}class qD{constructor(){this.Cn=new WD}addToCollectionParentIndex(e,n){return this.Cn.add(n),me.resolve()}getCollectionParents(e,n){return me.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return me.resolve()}deleteFieldIndex(e,n){return me.resolve()}deleteAllFieldIndexes(e){return me.resolve()}createTargetIndexes(e,n){return me.resolve()}getDocumentsMatchingTarget(e,n){return me.resolve(null)}getIndexType(e,n){return me.resolve(0)}getFieldIndexes(e,n){return me.resolve([])}getNextCollectionGroupToUpdate(e){return me.resolve(null)}getMinOffset(e,n){return me.resolve(wo.min())}getMinOffsetFromCollectionGroup(e,n){return me.resolve(wo.min())}updateCollectionGroup(e,n,r){return me.resolve()}updateIndexEntries(e,n){return me.resolve()}}class WD{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Wn(Ot.comparator),o=!s.has(r);return this.index[n]=s.add(r),o}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Wn(Ot.comparator)).toArray()}}const Ob={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ZI=41943040;class Vr{static withCacheSize(e){return new Vr(e,Vr.DEFAULT_COLLECTION_PERCENTILE,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}Vr.DEFAULT_COLLECTION_PERCENTILE=10,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vr.DEFAULT=new Vr(ZI,Vr.DEFAULT_COLLECTION_PERCENTILE,Vr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vr.DISABLED=new Vr(-1,0,0);class Cl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Cl(0)}static cr(){return new Cl(-1)}}const Fb="LruGarbageCollector",HD=1048576;function Bb([t,e],[n,r]){const s=bt(t,n);return s===0?bt(e,r):s}class KD{constructor(e){this.Ir=e,this.buffer=new Wn(Bb),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Bb(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class GD{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Fe(Fb,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){$l(n)?Fe(Fb,"Ignoring IndexedDB error during garbage collection: ",n):await Ul(n)}await this.Vr(3e5)}))}}class QD{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((r=>Math.floor(n/100*r)))}nthSequenceNumber(e,n){if(n===0)return me.resolve(vf.ce);const r=new KD(n);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Fe("LruGarbageCollector","Garbage collection skipped; disabled"),me.resolve(Ob)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(Fe("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ob):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,o,l,d,h,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((y=>(y>this.params.maximumSequenceNumbersToCollect?(Fe("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),s=this.params.maximumSequenceNumbersToCollect):s=y,l=Date.now(),this.nthSequenceNumber(e,s)))).next((y=>(r=y,d=Date.now(),this.removeTargets(e,r,n)))).next((y=>(o=y,h=Date.now(),this.removeOrphanedDocuments(e,r)))).next((y=>(f=Date.now(),sl()<=wt.DEBUG&&Fe("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-g}ms
	Determined least recently used ${s} in `+(d-l)+`ms
	Removed ${o} targets in `+(h-d)+`ms
	Removed ${y} documents in `+(f-h)+`ms
Total Duration: ${f-g}ms`),me.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:y}))))}}function XD(t,e){return new QD(t,e)}class YD{constructor(){this.changes=new xa((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Zn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?me.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class JD{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class ZD{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,n)))).next((s=>(r!==null&&Zc(r.mutation,s,Yr.empty(),qt.now()),s)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.getLocalViewOfDocuments(e,r,xt()).next((()=>r))))}getLocalViewOfDocuments(e,n,r=xt()){const s=la();return this.populateOverlays(e,s,n).next((()=>this.computeViews(e,n,s,r).next((o=>{let l=Uc();return o.forEach(((d,h)=>{l=l.insert(d,h.overlayedDocument)})),l}))))}getOverlayedDocuments(e,n){const r=la();return this.populateOverlays(e,r,n).next((()=>this.computeViews(e,n,r,xt())))}populateOverlays(e,n,r){const s=[];return r.forEach((o=>{n.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(e,s).next((o=>{o.forEach(((l,d)=>{n.set(l,d)}))}))}computeViews(e,n,r,s){let o=ki();const l=Jc(),d=(function(){return Jc()})();return n.forEach(((h,f)=>{const g=r.get(f.key);s.has(f.key)&&(g===void 0||g.mutation instanceof No)?o=o.insert(f.key,f):g!==void 0?(l.set(f.key,g.mutation.getFieldMask()),Zc(g.mutation,f,g.mutation.getFieldMask(),qt.now())):l.set(f.key,Yr.empty())})),this.recalculateAndSaveOverlays(e,o).next((h=>(h.forEach(((f,g)=>l.set(f,g))),n.forEach(((f,g)=>d.set(f,new JD(g,l.get(f)??null)))),d)))}recalculateAndSaveOverlays(e,n){const r=Jc();let s=new dn(((l,d)=>l-d)),o=xt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((l=>{for(const d of l)d.keys().forEach((h=>{const f=n.get(h);if(f===null)return;let g=r.get(h)||Yr.empty();g=d.applyToLocalView(f,g),r.set(h,g);const y=(s.get(d.batchId)||xt()).add(h);s=s.insert(d.batchId,y)}))})).next((()=>{const l=[],d=s.getReverseIterator();for(;d.hasNext();){const h=d.getNext(),f=h.key,g=h.value,y=PI();g.forEach((_=>{if(!o.has(_)){const x=VI(n.get(_),r.get(_));x!==null&&y.set(_,x),o=o.add(_)}})),l.push(this.documentOverlayCache.saveOverlays(e,f,y))}return me.waitFor(l)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,n,r,s){return(function(l){return Ge.isDocumentKey(l.path)&&l.collectionGroup===null&&l.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):II(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next((o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-o.size):me.resolve(la());let d=mu,h=o;return l.next((f=>me.forEach(f,((g,y)=>(d<y.largestBatchId&&(d=y.largestBatchId),o.get(g)?me.resolve():this.remoteDocumentCache.getEntry(e,g).next((_=>{h=h.insert(g,_)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,h,f,xt()))).next((g=>({batchId:d,changes:kI(g)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Ge(n)).next((r=>{let s=Uc();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const o=n.collectionGroup;let l=Uc();return this.indexManager.getCollectionParents(e,o).next((d=>me.forEach(d,(h=>{const f=(function(y,_){return new ba(_,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(n,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next((g=>{g.forEach(((y,_)=>{l=l.insert(y,_)}))}))})).next((()=>l))))}getDocumentsMatchingCollectionQuery(e,n,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next((l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,o,s)))).next((l=>{o.forEach(((h,f)=>{const g=f.getKey();l.get(g)===null&&(l=l.insert(g,Zn.newInvalidDocument(g)))}));let d=Uc();return l.forEach(((h,f)=>{const g=o.get(h);g!==void 0&&Zc(g.mutation,f,Yr.empty(),qt.now()),xf(n,f)&&(d=d.insert(h,f))})),d}))}}class e2{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return me.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(s){return{id:s.id,version:s.version,createTime:Jr(s.createTime)}})(n)),me.resolve()}getNamedQuery(e,n){return me.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(s){return{name:s.name,query:zD(s.bundledQuery),readTime:Jr(s.readTime)}})(n)),me.resolve()}}class t2{constructor(){this.overlays=new dn(Ge.comparator),this.qr=new Map}getOverlay(e,n){return me.resolve(this.overlays.get(n))}getOverlays(e,n){const r=la();return me.forEach(n,(s=>this.getOverlay(e,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(e,n,r){return r.forEach(((s,o)=>{this.St(e,n,o)})),me.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),me.resolve()}getOverlaysForCollection(e,n,r){const s=la(),o=n.length+1,l=new Ge(n.child("")),d=this.overlays.getIteratorFrom(l);for(;d.hasNext();){const h=d.getNext().value,f=h.getKey();if(!n.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return me.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let o=new dn(((f,g)=>f-g));const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===n&&f.largestBatchId>r){let g=o.get(f.largestBatchId);g===null&&(g=la(),o=o.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const d=la(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((f,g)=>d.set(f,g))),!(d.size()>=s)););return me.resolve(d)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const l=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new _D(n,r));let o=this.qr.get(n);o===void 0&&(o=xt(),this.qr.set(n,o)),this.qr.set(n,o.add(r.key))}}class n2{constructor(){this.sessionToken=cr.EMPTY_BYTE_STRING}getSessionToken(e){return me.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,me.resolve()}}class Iy{constructor(){this.Qr=new Wn(Jn.$r),this.Ur=new Wn(Jn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Jn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach((r=>this.addReference(r,n)))}removeReference(e,n){this.Gr(new Jn(e,n))}zr(e,n){e.forEach((r=>this.removeReference(r,n)))}jr(e){const n=new Ge(new Ot([])),r=new Jn(n,e),s=new Jn(n,e+1),o=[];return this.Ur.forEachInRange([r,s],(l=>{this.Gr(l),o.push(l.key)})),o}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Ge(new Ot([])),r=new Jn(n,e),s=new Jn(n,e+1);let o=xt();return this.Ur.forEachInRange([r,s],(l=>{o=o.add(l.key)})),o}containsKey(e){const n=new Jn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Jn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Ge.comparator(e.key,n.key)||bt(e.Yr,n.Yr)}static Kr(e,n){return bt(e.Yr,n.Yr)||Ge.comparator(e.key,n.key)}}class r2{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Wn(Jn.$r)}checkEmpty(e){return me.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new vD(o,n,r,s);this.mutationQueue.push(l);for(const d of s)this.Zr=this.Zr.add(new Jn(d.key,o)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return me.resolve(l)}lookupMutationBatch(e,n){return me.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),o=s<0?0:s;return me.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return me.resolve(this.mutationQueue.length===0?py:this.tr-1)}getAllMutationBatches(e){return me.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Jn(n,0),s=new Jn(n,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(l=>{const d=this.Xr(l.Yr);o.push(d)})),me.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Wn(bt);return n.forEach((s=>{const o=new Jn(s,0),l=new Jn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,l],(d=>{r=r.add(d.Yr)}))})),me.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let o=r;Ge.isDocumentKey(o)||(o=o.child(""));const l=new Jn(new Ge(o),0);let d=new Wn(bt);return this.Zr.forEachWhile((h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(d=d.add(h.Yr)),!0)}),l),me.resolve(this.ti(d))}ti(e){const n=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&n.push(s)})),n}removeMutationBatch(e,n){Et(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return me.forEach(n.mutations,(s=>{const o=new Jn(s.key,n.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,n){const r=new Jn(n,0),s=this.Zr.firstAfterOrEqual(r);return me.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,me.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class s2{constructor(e){this.ri=e,this.docs=(function(){return new dn(Ge.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),o=s?s.size:0,l=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return me.resolve(r?r.document.mutableCopy():Zn.newInvalidDocument(n))}getEntries(e,n){let r=ki();return n.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Zn.newInvalidDocument(s))})),me.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let o=ki();const l=n.path,d=new Ge(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(d);for(;h.hasNext();){const{key:f,value:{document:g}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||NM(jM(g),r)<=0||(s.has(g.key)||xf(n,g))&&(o=o.insert(g.key,g.mutableCopy()))}return me.resolve(o)}getAllFromCollectionGroup(e,n,r,s){Qe(9500)}ii(e,n){return me.forEach(this.docs,(r=>n(r)))}newChangeBuffer(e){return new i2(this)}getSize(e){return me.resolve(this.size)}}class i2 extends YD{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),me.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class o2{constructor(e){this.persistence=e,this.si=new xa((n=>vy(n)),_y),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.oi=0,this._i=new Iy,this.targetCount=0,this.ai=Cl.ur()}forEachTarget(e,n){return this.si.forEach(((r,s)=>n(s))),me.resolve()}getLastRemoteSnapshotVersion(e){return me.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return me.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),me.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),me.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Cl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,me.resolve()}updateTargetData(e,n){return this.Pr(n),me.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,me.resolve()}removeTargets(e,n,r){let s=0;const o=[];return this.si.forEach(((l,d)=>{d.sequenceNumber<=n&&r.get(d.targetId)===null&&(this.si.delete(l),o.push(this.removeMatchingKeysForTargetId(e,d.targetId)),s++)})),me.waitFor(o).next((()=>s))}getTargetCount(e){return me.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return me.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),me.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,o=[];return s&&n.forEach((l=>{o.push(s.markPotentiallyOrphaned(e,l))})),me.waitFor(o)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),me.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return me.resolve(r)}containsKey(e,n){return me.resolve(this._i.containsKey(n))}}class eS{constructor(e,n){this.ui={},this.overlays={},this.ci=new vf(0),this.li=!1,this.li=!0,this.hi=new n2,this.referenceDelegate=e(this),this.Pi=new o2(this),this.indexManager=new qD,this.remoteDocumentCache=(function(s){return new s2(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new $D(n),this.Ii=new e2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new t2,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new r2(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Fe("MemoryPersistence","Starting transaction:",e);const s=new a2(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(e,n){return me.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,n))))}}class a2 extends DM{constructor(e){super(),this.currentSequenceNumber=e}}class Sy{constructor(e){this.persistence=e,this.Ri=new Iy,this.Vi=null}static mi(e){return new Sy(e)}get fi(){if(this.Vi)return this.Vi;throw Qe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),me.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),me.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),me.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return me.forEach(this.fi,(r=>{const s=Ge.fromPath(r);return this.gi(e,s).next((o=>{o||n.removeEntry(s,rt.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return me.or([()=>me.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class qh{constructor(e,n){this.persistence=e,this.pi=new xa((r=>OM(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=XD(this,n)}static mi(e,n){return new qh(e,n)}Ei(){}di(e){return me.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>n.next((s=>r+s))))}wr(e){let n=0;return this.pr(e,(r=>{n++})).next((()=>n))}pr(e,n){return me.forEach(this.pi,((r,s)=>this.br(e,r,s).next((o=>o?me.resolve():n(s)))))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(e,(l=>this.br(e,l,n).next((d=>{d||(r++,o.removeEntry(l,rt.min()))})))).next((()=>o.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),me.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),me.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),me.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),me.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=_h(e.data.value)),n}br(e,n,r){return me.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return me.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Cy{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=xt(),s=xt();for(const o of n.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Cy(e,n.fromCache,r,s)}}class l2{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class c2{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Vk()?8:LM(Er())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const o={result:null};return this.ys(e,n).next((l=>{o.result=l})).next((()=>{if(!o.result)return this.ws(e,n,s,r).next((l=>{o.result=l}))})).next((()=>{if(o.result)return;const l=new l2;return this.Ss(e,n,l).next((d=>{if(o.result=d,this.Vs)return this.bs(e,n,l,d.size)}))})).next((()=>o.result))}bs(e,n,r,s){return r.documentReadCount<this.fs?(sl()<=wt.DEBUG&&Fe("QueryEngine","SDK will not create cache indexes for query:",il(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),me.resolve()):(sl()<=wt.DEBUG&&Fe("QueryEngine","Query:",il(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(sl()<=wt.DEBUG&&Fe("QueryEngine","The SDK decides to create cache indexes for query:",il(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xs(n))):me.resolve())}ys(e,n){if(Ab(n))return me.resolve(null);let r=Xs(n);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(n.limit!==null&&s===1&&(n=Bh(n,null,"F"),r=Xs(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next((o=>{const l=xt(...o);return this.ps.getDocuments(e,l).next((d=>this.indexManager.getMinOffset(e,r).next((h=>{const f=this.Ds(n,d);return this.Cs(n,f,l,h.readTime)?this.ys(e,Bh(n,null,"F")):this.vs(e,f,n,h)}))))})))))}ws(e,n,r,s){return Ab(n)||s.isEqual(rt.min())?me.resolve(null):this.ps.getDocuments(e,r).next((o=>{const l=this.Ds(n,o);return this.Cs(n,l,r,s)?me.resolve(null):(sl()<=wt.DEBUG&&Fe("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),il(n)),this.vs(e,l,n,PM(s,mu)).next((d=>d)))}))}Ds(e,n){let r=new Wn(AI(e));return n.forEach(((s,o)=>{xf(e,o)&&(r=r.add(o))})),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const o=e.limitType==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(e,n,r){return sl()<=wt.DEBUG&&Fe("QueryEngine","Using full collection scan to execute query:",il(n)),this.ps.getDocumentsMatchingQuery(e,n,wo.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((o=>(n.forEach((l=>{o=o.insert(l.key,l)})),o)))}}const Ay="LocalStore",u2=3e8;class d2{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new dn(bt),this.xs=new xa((o=>vy(o)),_y),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ZD(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function h2(t,e,n,r){return new d2(t,e,n,r)}async function tS(t,e){const n=st(t);return await n.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,n.Bs(e),n.mutationQueue.getAllMutationBatches(r)))).next((o=>{const l=[],d=[];let h=xt();for(const f of s){l.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}for(const f of o){d.push(f.batchId);for(const g of f.mutations)h=h.add(g.key)}return n.localDocuments.getDocuments(r,h).next((f=>({Ls:f,removedBatchIds:l,addedBatchIds:d})))}))}))}function f2(t,e){const n=st(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),o=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(d,h,f,g){const y=f.batch,_=y.keys();let x=me.resolve();return _.forEach((I=>{x=x.next((()=>g.getEntry(h,I))).next((k=>{const S=f.docVersions.get(I);Et(S!==null,48541),k.version.compareTo(S)<0&&(y.applyToRemoteDocument(k,f),k.isValidDocument()&&(k.setReadTime(f.commitVersion),g.addEntry(k)))}))})),x.next((()=>d.mutationQueue.removeMutationBatch(h,y)))})(n,r,e,o).next((()=>o.apply(r))).next((()=>n.mutationQueue.performConsistencyCheck(r))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(d){let h=xt();for(let f=0;f<d.mutationResults.length;++f)d.mutationResults[f].transformResults.length>0&&(h=h.add(d.batch.mutations[f].key));return h})(e)))).next((()=>n.localDocuments.getDocuments(r,s)))}))}function nS(t){const e=st(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function m2(t,e){const n=st(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const l=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const d=[];e.targetChanges.forEach(((g,y)=>{const _=s.get(y);if(!_)return;d.push(n.Pi.removeMatchingKeys(o,g.removedDocuments,y).next((()=>n.Pi.addMatchingKeys(o,g.addedDocuments,y))));let x=_.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?x=x.withResumeToken(cr.EMPTY_BYTE_STRING,rt.min()).withLastLimboFreeSnapshotVersion(rt.min()):g.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(g.resumeToken,r)),s=s.insert(y,x),(function(k,S,O){return k.resumeToken.approximateByteSize()===0||S.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=u2?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0})(_,x,g)&&d.push(n.Pi.updateTargetData(o,x))}));let h=ki(),f=xt();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&d.push(n.persistence.referenceDelegate.updateLimboDocument(o,g))})),d.push(p2(o,l,e.documentUpdates).next((g=>{h=g.ks,f=g.qs}))),!r.isEqual(rt.min())){const g=n.Pi.getLastRemoteSnapshotVersion(o).next((y=>n.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));d.push(g)}return me.waitFor(d).next((()=>l.apply(o))).next((()=>n.localDocuments.getLocalViewOfDocuments(o,h,f))).next((()=>h))})).then((o=>(n.Ms=s,o)))}function p2(t,e,n){let r=xt(),s=xt();return n.forEach((o=>r=r.add(o))),e.getEntries(t,r).next((o=>{let l=ki();return n.forEach(((d,h)=>{const f=o.get(d);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(d)),h.isNoDocument()&&h.version.isEqual(rt.min())?(e.removeEntry(d,h.readTime),l=l.insert(d,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(d,h)):Fe(Ay,"Ignoring outdated watch update for ",d,". Current version:",f.version," Watch version:",h.version)})),{ks:l,qs:s}}))}function g2(t,e){const n=st(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=py),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function y2(t,e){const n=st(t);return n.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return n.Pi.getTargetData(r,e).next((o=>o?(s=o,me.resolve(s)):n.Pi.allocateTargetId(r).next((l=>(s=new co(e,l,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r}))}async function _g(t,e,n){const r=st(t),s=r.Ms.get(e),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(l=>r.persistence.referenceDelegate.removeTarget(l,s)))}catch(l){if(!$l(l))throw l;Fe(Ay,`Failed to update sequence numbers for target ${e}: ${l}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Ub(t,e,n){const r=st(t);let s=rt.min(),o=xt();return r.persistence.runTransaction("Execute query","readwrite",(l=>(function(h,f,g){const y=st(h),_=y.xs.get(g);return _!==void 0?me.resolve(y.Ms.get(_)):y.Pi.getTargetData(f,g)})(r,l,Xs(e)).next((d=>{if(d)return s=d.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(l,d.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(l,e,n?s:rt.min(),n?o:xt()))).next((d=>(v2(r,sD(e),d),{documents:d,Qs:o})))))}function v2(t,e,n){let r=t.Os.get(e)||rt.min();n.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),t.Os.set(e,r)}class $b{constructor(){this.activeTargetIds=uD()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _2{constructor(){this.Mo=new $b,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new $b,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class w2{Oo(e){}shutdown(){}}const zb="ConnectivityMonitor";class qb{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Fe(zb,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Fe(zb,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let nh=null;function wg(){return nh===null?nh=(function(){return 268435456+Math.round(2147483648*Math.random())})():nh++,"0x"+nh.toString(16)}const Sp="RestConnection",b2={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class x2{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Vh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,o){const l=wg(),d=this.zo(e,n.toUriEncodedString());Fe(Sp,`Sending RPC '${e}' ${l}:`,d,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:f}=new URL(d),g=Ol(f);return this.Jo(e,d,h,r,g).then((y=>(Fe(Sp,`Received RPC '${e}' ${l}: `,y),y)),(y=>{throw bl(Sp,`RPC '${e}' ${l} failed with error: `,y,"url: ",d,"request:",r),y}))}Ho(e,n,r,s,o,l){return this.Go(e,n,r,s,o)}jo(e,n,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Bl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((s,o)=>e[o]=s)),r&&r.headers.forEach(((s,o)=>e[o]=s))}zo(e,n){const r=b2[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}class T2{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const yr="WebChannelConnection";class E2 extends x2{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,o){const l=wg();return new Promise(((d,h)=>{const f=new tI;f.setWithCredentials(!0),f.listenOnce(nI.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case vh.NO_ERROR:const y=f.getResponseJson();Fe(yr,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(y)),d(y);break;case vh.TIMEOUT:Fe(yr,`RPC '${e}' ${l} timed out`),h(new Ae(he.DEADLINE_EXCEEDED,"Request time out"));break;case vh.HTTP_ERROR:const _=f.getStatus();if(Fe(yr,`RPC '${e}' ${l} failed with status:`,_,"response text:",f.getResponseText()),_>0){let x=f.getResponseJson();Array.isArray(x)&&(x=x[0]);const I=x?.error;if(I&&I.status&&I.message){const k=(function(O){const B=O.toLowerCase().replace(/_/g,"-");return Object.values(he).indexOf(B)>=0?B:he.UNKNOWN})(I.status);h(new Ae(k,I.message))}else h(new Ae(he.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new Ae(he.UNAVAILABLE,"Connection failed."));break;default:Qe(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Fe(yr,`RPC '${e}' ${l} completed.`)}}));const g=JSON.stringify(s);Fe(yr,`RPC '${e}' ${l} sending request:`,s),f.send(n,"POST",g,r,15)}))}T_(e,n,r){const s=wg(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=iI(),d=sI(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const g=o.join("");Fe(yr,`Creating RPC '${e}' stream ${s}: ${g}`,h);const y=l.createWebChannel(g,h);this.I_(y);let _=!1,x=!1;const I=new T2({Yo:S=>{x?Fe(yr,`Not sending because RPC '${e}' stream ${s} is closed:`,S):(_||(Fe(yr,`Opening RPC '${e}' stream ${s} transport.`),y.open(),_=!0),Fe(yr,`RPC '${e}' stream ${s} sending:`,S),y.send(S))},Zo:()=>y.close()}),k=(S,O,B)=>{S.listen(O,(V=>{try{B(V)}catch($){setTimeout((()=>{throw $}),0)}}))};return k(y,Bc.EventType.OPEN,(()=>{x||(Fe(yr,`RPC '${e}' stream ${s} transport opened.`),I.o_())})),k(y,Bc.EventType.CLOSE,(()=>{x||(x=!0,Fe(yr,`RPC '${e}' stream ${s} transport closed`),I.a_(),this.E_(y))})),k(y,Bc.EventType.ERROR,(S=>{x||(x=!0,bl(yr,`RPC '${e}' stream ${s} transport errored. Name:`,S.name,"Message:",S.message),I.a_(new Ae(he.UNAVAILABLE,"The operation could not be completed")))})),k(y,Bc.EventType.MESSAGE,(S=>{if(!x){const O=S.data[0];Et(!!O,16349);const B=O,V=B?.error||B[0]?.error;if(V){Fe(yr,`RPC '${e}' stream ${s} received error:`,V);const $=V.status;let F=(function(E){const P=On[E];if(P!==void 0)return UI(P)})($),H=V.message;F===void 0&&(F=he.INTERNAL,H="Unknown error status: "+$+" with message "+V.message),x=!0,I.a_(new Ae(F,H)),y.close()}else Fe(yr,`RPC '${e}' stream ${s} received:`,O),I.u_(O)}})),k(d,rI.STAT_EVENT,(S=>{S.stat===cg.PROXY?Fe(yr,`RPC '${e}' stream ${s} detected buffering proxy`):S.stat===cg.NOPROXY&&Fe(yr,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{I.__()}),0),I}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function Cp(){return typeof document<"u"?document:null}function Cf(t){return new AD(t,!0)}class Ry{constructor(e,n,r=1e3,s=1.5,o=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&Fe("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Wb="PersistentStream";class rS{constructor(e,n,r,s,o,l,d,h){this.Mi=e,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=d,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ry(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===he.RESOURCE_EXHAUSTED?(Ri(n.toString()),Ri("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===he.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===n&&this.G_(r,s)}),(r=>{e((()=>{const s=new Ae(he.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Fe(Wb,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Fe(Wb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class I2 extends rS{constructor(e,n,r,s,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,l),this.serializer=o}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=jD(this.serializer,e),r=(function(o){if(!("targetChange"in o))return rt.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?rt.min():l.readTime?Jr(l.readTime):rt.min()})(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=vg(this.serializer),n.addTarget=(function(o,l){let d;const h=l.target;if(d=mg(h)?{documents:MD(o,h)}:{query:QI(o,h).ft},d.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){d.resumeToken=qI(o,l.resumeToken);const f=gg(o,l.expectedCount);f!==null&&(d.expectedCount=f)}else if(l.snapshotVersion.compareTo(rt.min())>0){d.readTime=$h(o,l.snapshotVersion.toTimestamp());const f=gg(o,l.expectedCount);f!==null&&(d.expectedCount=f)}return d})(this.serializer,e);const r=VD(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=vg(this.serializer),n.removeTarget=e,this.q_(n)}}class S2 extends rS{constructor(e,n,r,s,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,l),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Et(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Et(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Et(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=ND(e.writeResults,e.commitTime),r=Jr(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=vg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((r=>GI(this.serializer,r)))};this.q_(n)}}class C2{}class A2 extends C2{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Ae(he.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,l])=>this.connection.Go(e,yg(n,r),s,o,l))).catch((o=>{throw o.name==="FirebaseError"?(o.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Ae(he.UNKNOWN,o.toString())}))}Ho(e,n,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,d])=>this.connection.Ho(e,yg(n,r),s,l,d,o))).catch((l=>{throw l.name==="FirebaseError"?(l.code===he.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Ae(he.UNKNOWN,l.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class R2{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ri(n),this.aa=!1):Fe("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const ga="RemoteStore";class k2{constructor(e,n,r,s,o){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((l=>{r.enqueueAndForget((async()=>{Ta(this)&&(Fe(ga,"Restarting streams for network reachability change."),await(async function(h){const f=st(h);f.Ea.add(4),await Bu(f),f.Ra.set("Unknown"),f.Ea.delete(4),await Af(f)})(this))}))})),this.Ra=new R2(r,s)}}async function Af(t){if(Ta(t))for(const e of t.da)await e(!0)}async function Bu(t){for(const e of t.da)await e(!1)}function sS(t,e){const n=st(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Ny(n)?jy(n):zl(n).O_()&&Py(n,e))}function ky(t,e){const n=st(t),r=zl(n);n.Ia.delete(e),r.O_()&&iS(n,e),n.Ia.size===0&&(r.O_()?r.L_():Ta(n)&&n.Ra.set("Unknown"))}function Py(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}zl(t).Y_(e)}function iS(t,e){t.Va.Ue(e),zl(t).Z_(e)}function jy(t){t.Va=new ED({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),zl(t).start(),t.Ra.ua()}function Ny(t){return Ta(t)&&!zl(t).x_()&&t.Ia.size>0}function Ta(t){return st(t).Ea.size===0}function oS(t){t.Va=void 0}async function P2(t){t.Ra.set("Online")}async function j2(t){t.Ia.forEach(((e,n)=>{Py(t,e)}))}async function N2(t,e){oS(t),Ny(t)?(t.Ra.ha(e),jy(t)):t.Ra.set("Unknown")}async function M2(t,e,n){if(t.Ra.set("Online"),e instanceof zI&&e.state===2&&e.cause)try{await(async function(s,o){const l=o.cause;for(const d of o.targetIds)s.Ia.has(d)&&(await s.remoteSyncer.rejectListen(d,l),s.Ia.delete(d),s.Va.removeTarget(d))})(t,e)}catch(r){Fe(ga,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Wh(t,r)}else if(e instanceof xh?t.Va.Ze(e):e instanceof $I?t.Va.st(e):t.Va.tt(e),!n.isEqual(rt.min()))try{const r=await nS(t.localStore);n.compareTo(r)>=0&&await(function(o,l){const d=o.Va.Tt(l);return d.targetChanges.forEach(((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const g=o.Ia.get(f);g&&o.Ia.set(f,g.withResumeToken(h.resumeToken,l))}})),d.targetMismatches.forEach(((h,f)=>{const g=o.Ia.get(h);if(!g)return;o.Ia.set(h,g.withResumeToken(cr.EMPTY_BYTE_STRING,g.snapshotVersion)),iS(o,h);const y=new co(g.target,h,f,g.sequenceNumber);Py(o,y)})),o.remoteSyncer.applyRemoteEvent(d)})(t,n)}catch(r){Fe(ga,"Failed to raise snapshot:",r),await Wh(t,r)}}async function Wh(t,e,n){if(!$l(e))throw e;t.Ea.add(1),await Bu(t),t.Ra.set("Offline"),n||(n=()=>nS(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Fe(ga,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Af(t)}))}function aS(t,e){return e().catch((n=>Wh(t,n,e)))}async function Rf(t){const e=st(t),n=Eo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:py;for(;D2(e);)try{const s=await g2(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,L2(e,s)}catch(s){await Wh(e,s)}lS(e)&&cS(e)}function D2(t){return Ta(t)&&t.Ta.length<10}function L2(t,e){t.Ta.push(e);const n=Eo(t);n.O_()&&n.X_&&n.ea(e.mutations)}function lS(t){return Ta(t)&&!Eo(t).x_()&&t.Ta.length>0}function cS(t){Eo(t).start()}async function V2(t){Eo(t).ra()}async function O2(t){const e=Eo(t);for(const n of t.Ta)e.ea(n.mutations)}async function F2(t,e,n){const r=t.Ta.shift(),s=xy.from(r,e,n);await aS(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Rf(t)}async function B2(t,e){e&&Eo(t).X_&&await(async function(r,s){if((function(l){return BI(l)&&l!==he.ABORTED})(s.code)){const o=r.Ta.shift();Eo(r).B_(),await aS(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Rf(r)}})(t,e),lS(t)&&cS(t)}async function Hb(t,e){const n=st(t);n.asyncQueue.verifyOperationInProgress(),Fe(ga,"RemoteStore received new credentials");const r=Ta(n);n.Ea.add(3),await Bu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Af(n)}async function U2(t,e){const n=st(t);e?(n.Ea.delete(2),await Af(n)):e||(n.Ea.add(2),await Bu(n),n.Ra.set("Unknown"))}function zl(t){return t.ma||(t.ma=(function(n,r,s){const o=st(n);return o.sa(),new I2(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:P2.bind(null,t),t_:j2.bind(null,t),r_:N2.bind(null,t),H_:M2.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),Ny(t)?jy(t):t.Ra.set("Unknown")):(await t.ma.stop(),oS(t))}))),t.ma}function Eo(t){return t.fa||(t.fa=(function(n,r,s){const o=st(n);return o.sa(),new S2(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:V2.bind(null,t),r_:B2.bind(null,t),ta:O2.bind(null,t),na:F2.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await Rf(t)):(await t.fa.stop(),t.Ta.length>0&&(Fe(ga,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class My{constructor(e,n,r,s,o){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new Ss,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((l=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,o){const l=Date.now()+r,d=new My(e,n,l,s,o);return d.start(r),d}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ae(he.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Dy(t,e){if(Ri("AsyncQueue",`${e}: ${t}`),$l(t))return new Ae(he.UNAVAILABLE,`${e}: ${t}`);throw t}class yl{static emptySet(e){return new yl(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Ge.comparator(n.key,r.key):(n,r)=>Ge.comparator(n.key,r.key),this.keyedMap=Uc(),this.sortedSet=new dn(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,r)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof yl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new yl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}class Kb{constructor(){this.ga=new dn(Ge.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Qe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,r)=>{e.push(r)})),e}}class Al{constructor(e,n,r,s,o,l,d,h,f){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=d,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,n,r,s,o){const l=[];return n.forEach((d=>{l.push({type:0,doc:d})})),new Al(e,n,yl.emptySet(n),l,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}class $2{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class z2{constructor(){this.queries=Gb(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=st(n),o=s.queries;s.queries=Gb(),o.forEach(((l,d)=>{for(const h of d.Sa)h.onError(r)}))})(this,new Ae(he.ABORTED,"Firestore shutting down"))}}function Gb(){return new xa((t=>CI(t)),bf)}async function Ly(t,e){const n=st(t);let r=3;const s=e.query;let o=n.queries.get(s);o?!o.ba()&&e.Da()&&(r=2):(o=new $2,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await n.onListen(s,!0);break;case 1:o.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(l){const d=Dy(l,`Initialization of query '${il(e.query)}' failed`);return void e.onError(d)}n.queries.set(s,o),o.Sa.push(e),e.va(n.onlineState),o.wa&&e.Fa(o.wa)&&Oy(n)}async function Vy(t,e){const n=st(t),r=e.query;let s=3;const o=n.queries.get(r);if(o){const l=o.Sa.indexOf(e);l>=0&&(o.Sa.splice(l,1),o.Sa.length===0?s=e.Da()?0:1:!o.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function q2(t,e){const n=st(t);let r=!1;for(const s of e){const o=s.query,l=n.queries.get(o);if(l){for(const d of l.Sa)d.Fa(s)&&(r=!0);l.wa=s}}r&&Oy(n)}function W2(t,e,n){const r=st(t),s=r.queries.get(e);if(s)for(const o of s.Sa)o.onError(n);r.queries.delete(e)}function Oy(t){t.Ca.forEach((e=>{e.next()}))}var bg,Qb;(Qb=bg||(bg={})).Ma="default",Qb.Cache="cache";class Fy{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Al(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Al.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==bg.Cache}}class uS{constructor(e){this.key=e}}class dS{constructor(e){this.key=e}}class H2{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=xt(),this.mutatedKeys=xt(),this.eu=AI(e),this.tu=new yl(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new Kb,s=n?n.tu:this.tu;let o=n?n.mutatedKeys:this.mutatedKeys,l=s,d=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((g,y)=>{const _=s.get(g),x=xf(this.query,y)?y:null,I=!!_&&this.mutatedKeys.has(_.key),k=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let S=!1;_&&x?_.data.isEqual(x.data)?I!==k&&(r.track({type:3,doc:x}),S=!0):this.su(_,x)||(r.track({type:2,doc:x}),S=!0,(h&&this.eu(x,h)>0||f&&this.eu(x,f)<0)&&(d=!0)):!_&&x?(r.track({type:0,doc:x}),S=!0):_&&!x&&(r.track({type:1,doc:_}),S=!0,(h||f)&&(d=!0)),S&&(x?(l=l.add(x),o=k?o.add(g):o.delete(g)):(l=l.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;l.size>this.query.limit;){const g=this.query.limitType==="F"?l.last():l.first();l=l.delete(g.key),o=o.delete(g.key),r.track({type:1,doc:g})}return{tu:l,iu:r,Cs:d,mutatedKeys:o}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort(((g,y)=>(function(x,I){const k=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qe(20277,{Rt:S})}};return k(x)-k(I)})(g.type,y.type)||this.eu(g.doc,y.doc))),this.ou(r),s=s??!1;const d=n&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,f=h!==this.Za;return this.Za=h,l.length!==0||f?{snapshot:new Al(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Kb,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=xt(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const n=[];return e.forEach((r=>{this.Xa.has(r)||n.push(new dS(r))})),this.Xa.forEach((r=>{e.has(r)||n.push(new uS(r))})),n}cu(e){this.Ya=e.Qs,this.Xa=xt();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Al.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const By="SyncEngine";class K2{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class G2{constructor(e){this.key=e,this.hu=!1}}class Q2{constructor(e,n,r,s,o,l){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new xa((d=>CI(d)),bf),this.Iu=new Map,this.Eu=new Set,this.du=new dn(Ge.comparator),this.Au=new Map,this.Ru=new Iy,this.Vu={},this.mu=new Map,this.fu=Cl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function X2(t,e,n=!0){const r=yS(t);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await hS(r,e,n,!0),s}async function Y2(t,e){const n=yS(t);await hS(n,e,!0,!1)}async function hS(t,e,n,r){const s=await y2(t.localStore,Xs(e)),o=s.targetId,l=t.sharedClientState.addLocalQueryTarget(o,n);let d;return r&&(d=await J2(t,e,o,l==="current",s.resumeToken)),t.isPrimaryClient&&n&&sS(t.remoteStore,s),d}async function J2(t,e,n,r,s){t.pu=(y,_,x)=>(async function(k,S,O,B){let V=S.view.ru(O);V.Cs&&(V=await Ub(k.localStore,S.query,!1).then((({documents:A})=>S.view.ru(A,V))));const $=B&&B.targetChanges.get(S.targetId),F=B&&B.targetMismatches.get(S.targetId)!=null,H=S.view.applyChanges(V,k.isPrimaryClient,$,F);return Yb(k,S.targetId,H.au),H.snapshot})(t,y,_,x);const o=await Ub(t.localStore,e,!0),l=new H2(e,o.Qs),d=l.ru(o.documents),h=Fu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),f=l.applyChanges(d,t.isPrimaryClient,h);Yb(t,n,f.au);const g=new K2(e,n,l);return t.Tu.set(e,g),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),f.snapshot}async function Z2(t,e,n){const r=st(t),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((l=>!bf(l,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await _g(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&ky(r.remoteStore,s.targetId),xg(r,s.targetId)})).catch(Ul)):(xg(r,s.targetId),await _g(r.localStore,s.targetId,!0))}async function eL(t,e){const n=st(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ky(n.remoteStore,r.targetId))}async function tL(t,e,n){const r=lL(t);try{const s=await(function(l,d){const h=st(l),f=qt.now(),g=d.reduce(((x,I)=>x.add(I.key)),xt());let y,_;return h.persistence.runTransaction("Locally write mutations","readwrite",(x=>{let I=ki(),k=xt();return h.Ns.getEntries(x,g).next((S=>{I=S,I.forEach(((O,B)=>{B.isValidDocument()||(k=k.add(O))}))})).next((()=>h.localDocuments.getOverlayedDocuments(x,I))).next((S=>{y=S;const O=[];for(const B of d){const V=yD(B,y.get(B.key).overlayedDocument);V!=null&&O.push(new No(B.key,V,vI(V.value.mapValue),er.exists(!0)))}return h.mutationQueue.addMutationBatch(x,f,O,d)})).next((S=>{_=S;const O=S.applyToLocalDocumentSet(y,k);return h.documentOverlayCache.saveOverlays(x,S.batchId,O)}))})).then((()=>({batchId:_.batchId,changes:kI(y)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(l,d,h){let f=l.Vu[l.currentUser.toKey()];f||(f=new dn(bt)),f=f.insert(d,h),l.Vu[l.currentUser.toKey()]=f})(r,s.batchId,n),await Uu(r,s.changes),await Rf(r.remoteStore)}catch(s){const o=Dy(s,"Failed to persist write");n.reject(o)}}async function fS(t,e){const n=st(t);try{const r=await m2(n.localStore,e);e.targetChanges.forEach(((s,o)=>{const l=n.Au.get(o);l&&(Et(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?Et(l.hu,14607):s.removedDocuments.size>0&&(Et(l.hu,42227),l.hu=!1))})),await Uu(n,r,e)}catch(r){await Ul(r)}}function Xb(t,e,n){const r=st(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach(((o,l)=>{const d=l.view.va(e);d.snapshot&&s.push(d.snapshot)})),(function(l,d){const h=st(l);h.onlineState=d;let f=!1;h.queries.forEach(((g,y)=>{for(const _ of y.Sa)_.va(d)&&(f=!0)})),f&&Oy(h)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function nL(t,e,n){const r=st(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),o=s&&s.key;if(o){let l=new dn(Ge.comparator);l=l.insert(o,Zn.newNoDocument(o,rt.min()));const d=xt().add(o),h=new Sf(rt.min(),new Map,new dn(bt),l,d);await fS(r,h),r.du=r.du.remove(o),r.Au.delete(e),Uy(r)}else await _g(r.localStore,e,!1).then((()=>xg(r,e,n))).catch(Ul)}async function rL(t,e){const n=st(t),r=e.batch.batchId;try{const s=await f2(n.localStore,e);pS(n,r,null),mS(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Uu(n,s)}catch(s){await Ul(s)}}async function sL(t,e,n){const r=st(t);try{const s=await(function(l,d){const h=st(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let g;return h.mutationQueue.lookupMutationBatch(f,d).next((y=>(Et(y!==null,37113),g=y.keys(),h.mutationQueue.removeMutationBatch(f,y)))).next((()=>h.mutationQueue.performConsistencyCheck(f))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(f,g,d))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g))).next((()=>h.localDocuments.getDocuments(f,g)))}))})(r.localStore,e);pS(r,e,n),mS(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Uu(r,s)}catch(s){await Ul(s)}}function mS(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function pS(t,e,n){const r=st(t);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(n?o.reject(n):o.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function xg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((r=>{t.Ru.containsKey(r)||gS(t,r)}))}function gS(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(ky(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Uy(t))}function Yb(t,e,n){for(const r of n)r instanceof uS?(t.Ru.addReference(r.key,e),iL(t,r)):r instanceof dS?(Fe(By,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||gS(t,r.key)):Qe(19791,{wu:r})}function iL(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Fe(By,"New document in limbo: "+n),t.Eu.add(r),Uy(t))}function Uy(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Ge(Ot.fromString(e)),r=t.fu.next();t.Au.set(r,new G2(n)),t.du=t.du.insert(n,r),sS(t.remoteStore,new co(Xs(wf(n.path)),r,"TargetPurposeLimboResolution",vf.ce))}}async function Uu(t,e,n){const r=st(t),s=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach(((d,h)=>{l.push(r.pu(h,e,n).then((f=>{if((f||n)&&r.isPrimaryClient){const g=f?!f.fromCache:n?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(f){s.push(f);const g=Cy.As(h.targetId,f);o.push(g)}})))})),await Promise.all(l),r.Pu.H_(s),await(async function(h,f){const g=st(h);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(y=>me.forEach(f,(_=>me.forEach(_.Es,(x=>g.persistence.referenceDelegate.addReference(y,_.targetId,x))).next((()=>me.forEach(_.ds,(x=>g.persistence.referenceDelegate.removeReference(y,_.targetId,x)))))))))}catch(y){if(!$l(y))throw y;Fe(Ay,"Failed to update sequence numbers: "+y)}for(const y of f){const _=y.targetId;if(!y.fromCache){const x=g.Ms.get(_),I=x.snapshotVersion,k=x.withLastLimboFreeSnapshotVersion(I);g.Ms=g.Ms.insert(_,k)}}})(r.localStore,o))}async function oL(t,e){const n=st(t);if(!n.currentUser.isEqual(e)){Fe(By,"User change. New user:",e.toKey());const r=await tS(n.localStore,e);n.currentUser=e,(function(o,l){o.mu.forEach((d=>{d.forEach((h=>{h.reject(new Ae(he.CANCELLED,l))}))})),o.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Uu(n,r.Ls)}}function aL(t,e){const n=st(t),r=n.Au.get(e);if(r&&r.hu)return xt().add(r.key);{let s=xt();const o=n.Iu.get(e);if(!o)return s;for(const l of o){const d=n.Tu.get(l);s=s.unionWith(d.view.nu)}return s}}function yS(t){const e=st(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=fS.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aL.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nL.bind(null,e),e.Pu.H_=q2.bind(null,e.eventManager),e.Pu.yu=W2.bind(null,e.eventManager),e}function lL(t){const e=st(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rL.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=sL.bind(null,e),e}class Hh{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Cf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return h2(this.persistence,new c2,e.initialUser,this.serializer)}Cu(e){return new eS(Sy.mi,this.serializer)}Du(e){return new _2}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Hh.provider={build:()=>new Hh};class cL extends Hh{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Et(this.persistence.referenceDelegate instanceof qh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new GD(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Vr.withCacheSize(this.cacheSizeBytes):Vr.DEFAULT;return new eS((r=>qh.mi(r,n)),this.serializer)}}class Tg{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Xb(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=oL.bind(null,this.syncEngine),await U2(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new z2})()}createDatastore(e){const n=Cf(e.databaseInfo.databaseId),r=(function(o){return new E2(o)})(e.databaseInfo);return(function(o,l,d,h){return new A2(o,l,d,h)})(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return(function(r,s,o,l,d){return new k2(r,s,o,l,d)})(this.localStore,this.datastore,e.asyncQueue,(n=>Xb(this.syncEngine,n,0)),(function(){return qb.v()?new qb:new w2})())}createSyncEngine(e,n){return(function(s,o,l,d,h,f,g){const y=new Q2(s,o,l,d,h,f);return g&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const r=st(n);Fe(ga,"RemoteStore shutting down."),r.Ea.add(5),await Bu(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Tg.provider={build:()=>new Tg};class $y{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ri("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}class uL{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Ae(he.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await(async function(s,o){const l=st(s),d={documents:o.map((y=>zh(l.serializer,y)))},h=await l.Ho("BatchGetDocuments",l.serializer.databaseId,Ot.emptyPath(),d,o.length),f=new Map;h.forEach((y=>{const _=PD(l.serializer,y);f.set(_.key.toString(),_)}));const g=[];return o.forEach((y=>{const _=f.get(y.toString());Et(!!_,55234,{key:y}),g.push(_)})),g})(this.datastore,e);return n.forEach((r=>this.recordVersion(r))),n}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new If(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((n=>{e.delete(n.key.toString())})),e.forEach(((n,r)=>{const s=Ge.fromPath(r);this.mutations.push(new FI(s,this.precondition(s)))})),await(async function(r,s){const o=st(r),l={writes:s.map((d=>GI(o.serializer,d)))};await o.Go("Commit",o.serializer.databaseId,Ot.emptyPath(),l)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw Qe(50498,{Gu:e.constructor.name});n=rt.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new Ae(he.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){const n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(rt.min())?er.exists(!1):er.updateTime(n):er.none()}preconditionForUpdate(e){const n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(rt.min()))throw new Ae(he.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return er.updateTime(n)}return er.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class dL{constructor(e,n,r,s,o){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=s,this.deferred=o,this.zu=r.maxAttempts,this.M_=new Ry(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_((async()=>{const e=new uL(this.datastore),n=this.Hu(e);n&&n.then((r=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(r)})).catch((s=>{this.Yu(s)}))))})).catch((r=>{this.Yu(r)}))}))}Hu(e){try{const n=this.updateFunction(e);return!Vu(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget((()=>(this.Ju(),Promise.resolve())))):this.deferred.reject(e)}Zu(e){if(e?.name==="FirebaseError"){const n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!BI(n)}return!1}}const Io="FirestoreClient";class hL{constructor(e,n,r,s,o){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=wr.UNAUTHENTICATED,this.clientId=fy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async l=>{Fe(Io,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l})),this.appCheckCredentials.start(r,(l=>(Fe(Io,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ss;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Dy(n,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Ap(t,e){t.asyncQueue.verifyOperationInProgress(),Fe(Io,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async s=>{r.isEqual(s)||(await tS(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Jb(t,e){t.asyncQueue.verifyOperationInProgress();const n=await fL(t);Fe(Io,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((r=>Hb(e.remoteStore,r))),t.setAppCheckTokenChangeListener(((r,s)=>Hb(e.remoteStore,s))),t._onlineComponents=e}async function fL(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Fe(Io,"Using user provided OfflineComponentProvider");try{await Ap(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(s){return s.name==="FirebaseError"?s.code===he.FAILED_PRECONDITION||s.code===he.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(n))throw n;bl("Error using user provided cache. Falling back to memory cache: "+n),await Ap(t,new Hh)}}else Fe(Io,"Using default OfflineComponentProvider"),await Ap(t,new cL(void 0));return t._offlineComponents}async function zy(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Fe(Io,"Using user provided OnlineComponentProvider"),await Jb(t,t._uninitializedComponentsProvider._online)):(Fe(Io,"Using default OnlineComponentProvider"),await Jb(t,new Tg))),t._onlineComponents}function mL(t){return zy(t).then((e=>e.syncEngine))}function vS(t){return zy(t).then((e=>e.datastore))}async function Kh(t){const e=await zy(t),n=e.eventManager;return n.onListen=X2.bind(null,e.syncEngine),n.onUnlisten=Z2.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Y2.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=eL.bind(null,e.syncEngine),n}function pL(t,e,n={}){const r=new Ss;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const g=new $y({next:_=>{g.Nu(),l.enqueueAndForget((()=>Vy(o,y)));const x=_.docs.has(d);!x&&_.fromCache?f.reject(new Ae(he.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&_.fromCache&&h&&h.source==="server"?f.reject(new Ae(he.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),y=new Fy(wf(d.path),g,{includeMetadataChanges:!0,qa:!0});return Ly(o,y)})(await Kh(t),t.asyncQueue,e,n,r))),r.promise}function gL(t,e,n={}){const r=new Ss;return t.asyncQueue.enqueueAndForget((async()=>(function(o,l,d,h,f){const g=new $y({next:_=>{g.Nu(),l.enqueueAndForget((()=>Vy(o,y))),_.fromCache&&h.source==="server"?f.reject(new Ae(he.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),y=new Fy(d,g,{includeMetadataChanges:!0,qa:!0});return Ly(o,y)})(await Kh(t),t.asyncQueue,e,n,r))),r.promise}function yL(t,e,n){const r=new Ss;return t.asyncQueue.enqueueAndForget((async()=>{try{const s=await vS(t);r.resolve((async function(l,d,h){const f=st(l),{request:g,gt:y,parent:_}=DD(f.serializer,rD(d),h);f.connection.$o||delete g.parent;const x=(await f.Ho("RunAggregationQuery",f.serializer.databaseId,_,g,1)).filter((k=>!!k.result));Et(x.length===1,64727);const I=x[0].result?.aggregateFields;return Object.keys(I).reduce(((k,S)=>(k[y[S]]=I[S],k)),{})})(s,e,n))}catch(s){r.reject(s)}})),r.promise}function _S(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const Zb=new Map;const wS="firestore.googleapis.com",ex=!0;class tx{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Ae(he.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wS,this.ssl=ex}else this.host=e.host,this.ssl=e.ssl??ex;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ZI;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<HD)throw new Ae(he.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}RM("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_S(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Ae(he.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $u{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tx({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ae(he.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ae(he.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tx(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new _M;switch(r.type){case"firstParty":return new TM(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Ae(he.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const r=Zb.get(n);r&&(Fe("ComponentProvider","Removing Datastore"),Zb.delete(n),r.terminate())})(this),Promise.resolve()}}function vL(t,e,n,r={}){t=Tr(t,$u);const s=Ol(e),o=t._getSettings(),l={...o,emulatorOptions:t._getEmulatorOptions()},d=`${e}:${n}`;s&&(hE(`https://${d}`),fE("Firestore",!0)),o.host!==wS&&o.host!==d&&bl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:d,ssl:s,emulatorOptions:r};if(!Si(h,l)&&(t._setSettings(h),r.mockUserToken)){let f,g;if(typeof r.mockUserToken=="string")f=r.mockUserToken,g=wr.MOCK_USER;else{f=Ak(r.mockUserToken,t._app?.options.projectId);const y=r.mockUserToken.sub||r.mockUserToken.user_id;if(!y)throw new Ae(he.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new wr(y)}t._authCredentials=new wM(new aI(f,g))}}class ri{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ri(this.firestore,e,this._query)}}class cn{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cn(this.firestore,e,this._key)}toJSON(){return{type:cn._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Lu(n,cn._jsonSchema))return new cn(e,r||null,new Ge(Ot.fromString(n.referencePath)))}}cn._jsonSchemaVersion="firestore/documentReference/1.0",cn._jsonSchema={type:Bn("string",cn._jsonSchemaVersion),referencePath:Bn("string")};class yo extends ri{constructor(e,n,r){super(e,n,wf(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cn(this.firestore,null,new Ge(e))}withConverter(e){return new yo(this.firestore,e,this._path)}}function Rn(t,e,...n){if(t=un(t),my("collection","path",e),t instanceof $u){const r=Ot.fromString(e,...n);return mb(r),new yo(t,null,r)}{if(!(t instanceof cn||t instanceof yo))throw new Ae(he.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ot.fromString(e,...n));return mb(r),new yo(t.firestore,null,r)}}function _L(t,e){if(t=Tr(t,$u),my("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ae(he.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ri(t,null,(function(r){return new ba(Ot.emptyPath(),r)})(e))}function Oe(t,e,...n){if(t=un(t),arguments.length===1&&(e=fy.newId()),my("doc","path",e),t instanceof $u){const r=Ot.fromString(e,...n);return fb(r),new cn(t,null,new Ge(r))}{if(!(t instanceof cn||t instanceof yo))throw new Ae(he.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ot.fromString(e,...n));return fb(r),new cn(t.firestore,t instanceof yo?t.converter:null,new Ge(r))}}const nx="AsyncQueue";class rx{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ry(this,"async_queue_retry"),this._c=()=>{const r=Cp();r&&Fe(nx,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Cp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Cp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Ss;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!$l(e))throw e;Fe(nx,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,Ri("INTERNAL UNHANDLED ERROR: ",sx(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=My.createAndSchedule(this,e,n,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&Qe(47125,{Pc:sx(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,r)=>n.targetTimeMs-r.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function sx(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}function ix(t){return(function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(t,["next","error","complete"])}class ni extends $u{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new rx,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new rx(e),this._firestoreClient=void 0,await e}}}function wL(t,e){const n=typeof t=="object"?t:yE(),r=typeof t=="string"?t:Vh,s=ty(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Sk("firestore");o&&vL(s,...o)}return s}function Ea(t){if(t._terminated)throw new Ae(he.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||bL(t),t._firestoreClient}function bL(t){const e=t._freezeSettings(),n=(function(s,o,l,d){return new $M(s,o,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,_S(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new hL(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(t._componentsProvider))}class xL{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class TL{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class Xr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Xr(cr.fromBase64String(e))}catch(n){throw new Ae(he.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Xr(cr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Xr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Lu(e,Xr._jsonSchema))return Xr.fromBase64String(e.bytes)}}Xr._jsonSchemaVersion="firestore/bytes/1.0",Xr._jsonSchema={type:Bn("string",Xr._jsonSchemaVersion),bytes:Bn("string")};class ql{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Ae(he.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Wl{constructor(e){this._methodName=e}}class Ys{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Ae(he.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Ae(he.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return bt(this._lat,e._lat)||bt(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ys._jsonSchemaVersion}}static fromJSON(e){if(Lu(e,Ys._jsonSchema))return new Ys(e.latitude,e.longitude)}}Ys._jsonSchemaVersion="firestore/geoPoint/1.0",Ys._jsonSchema={type:Bn("string",Ys._jsonSchemaVersion),latitude:Bn("number"),longitude:Bn("number")};class Js{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Js._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Lu(e,Js._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new Js(e.vectorValues);throw new Ae(he.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Js._jsonSchemaVersion="firestore/vectorValue/1.0",Js._jsonSchema={type:Bn("string",Js._jsonSchemaVersion),vectorValues:Bn("object")};const EL=/^__.*__$/;class IL{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new No(e,this.data,this.fieldMask,n,this.fieldTransforms):new Ou(e,this.data,n,this.fieldTransforms)}}class bS{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new No(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function xS(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qe(40011,{Ac:t})}}class kf{constructor(e,n,r,s,o,l){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new kf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){const n=this.path?.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Gh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(xS(this.Ac)&&EL.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class SL{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Cf(e)}Cc(e,n,r,s=!1){return new kf({Ac:e,methodName:n,Dc:r,path:lr.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function zu(t){const e=t._freezeSettings(),n=Cf(t._databaseId);return new SL(t._databaseId,!!e.ignoreUndefinedProperties,n)}function qy(t,e,n,r,s,o={}){const l=t.Cc(o.merge||o.mergeFields?2:0,e,n,s);Xy("Data must be an object, but it was:",l,r);const d=ES(r,l);let h,f;if(o.merge)h=new Yr(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const g=[];for(const y of o.mergeFields){const _=Eg(e,y,n);if(!l.contains(_))throw new Ae(he.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);SS(g,_)||g.push(_)}h=new Yr(g),f=l.fieldTransforms.filter((y=>h.covers(y.field)))}else h=null,f=l.fieldTransforms;return new IL(new Rr(d),h,f)}class Pf extends Wl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Pf}}function TS(t,e,n){return new kf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Wy extends Wl{_toFieldTransform(e){return new by(e.path,new _u)}isEqual(e){return e instanceof Wy}}class Hy extends Wl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=TS(this,e,!0),r=this.vc.map((o=>Ia(o,n))),s=new Il(r);return new by(e.path,s)}isEqual(e){return e instanceof Hy&&Si(this.vc,e.vc)}}class Ky extends Wl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=TS(this,e,!0),r=this.vc.map((o=>Ia(o,n))),s=new Sl(r);return new by(e.path,s)}isEqual(e){return e instanceof Ky&&Si(this.vc,e.vc)}}function Gy(t,e,n,r){const s=t.Cc(1,e,n);Xy("Data must be an object, but it was:",s,r);const o=[],l=Rr.empty();jo(r,((h,f)=>{const g=Yy(e,h,n);f=un(f);const y=s.yc(g);if(f instanceof Pf)o.push(g);else{const _=Ia(f,y);_!=null&&(o.push(g),l.set(g,_))}}));const d=new Yr(o);return new bS(l,d,s.fieldTransforms)}function Qy(t,e,n,r,s,o){const l=t.Cc(1,e,n),d=[Eg(e,r,n)],h=[s];if(o.length%2!=0)throw new Ae(he.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<o.length;_+=2)d.push(Eg(e,o[_])),h.push(o[_+1]);const f=[],g=Rr.empty();for(let _=d.length-1;_>=0;--_)if(!SS(f,d[_])){const x=d[_];let I=h[_];I=un(I);const k=l.yc(x);if(I instanceof Pf)f.push(x);else{const S=Ia(I,k);S!=null&&(f.push(x),g.set(x,S))}}const y=new Yr(f);return new bS(g,y,l.fieldTransforms)}function CL(t,e,n,r=!1){return Ia(n,t.Cc(r?4:3,e))}function Ia(t,e){if(IS(t=un(t)))return Xy("Unsupported field value:",e,t),ES(t,e);if(t instanceof Wl)return(function(r,s){if(!xS(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let l=0;for(const d of r){let h=Ia(d,s.wc(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}})(t,e)}return(function(r,s){if((r=un(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dD(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=qt.fromDate(r);return{timestampValue:$h(s.serializer,o)}}if(r instanceof qt){const o=new qt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$h(s.serializer,o)}}if(r instanceof Ys)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Xr)return{bytesValue:qI(s.serializer,r._byteString)};if(r instanceof cn){const o=s.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw s.Sc(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ey(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Js)return(function(l,d){return{mapValue:{fields:{[gI]:{stringValue:yI},[Oh]:{arrayValue:{values:l.toArray().map((f=>{if(typeof f!="number")throw d.Sc("VectorValues must only contain numeric values.");return wy(d.serializer,f)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${yf(r)}`)})(t,e)}function ES(t,e){const n={};return uI(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jo(t,((r,s)=>{const o=Ia(s,e.mc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function IS(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof qt||t instanceof Ys||t instanceof Xr||t instanceof cn||t instanceof Wl||t instanceof Js)}function Xy(t,e,n){if(!IS(n)||!lI(n)){const r=yf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Eg(t,e,n){if((e=un(e))instanceof ql)return e._internalPath;if(typeof e=="string")return Yy(t,e);throw Gh("Field path arguments must be of type string or ",t,!1,void 0,n)}const AL=new RegExp("[~\\*/\\[\\]]");function Yy(t,e,n){if(e.search(AL)>=0)throw Gh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new ql(...e.split("."))._internalPath}catch{throw Gh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Gh(t,e,n,r,s){const o=r&&!r.isEmpty(),l=s!==void 0;let d=`Function ${e}() called with invalid data`;n&&(d+=" (via `toFirestore()`)"),d+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${s}`),h+=")"),new Ae(he.INVALID_ARGUMENT,d+t+h)}function SS(t,e){return t.some((n=>n.isEqual(e)))}class Qh{constructor(e,n,r,s,o){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new cn(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new RL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(jf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class RL extends Qh{data(){return super.data()}}function jf(t,e){return typeof e=="string"?Yy(t,e):e instanceof ql?e._internalPath:e._delegate._internalPath}function CS(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ae(he.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jy{}class Zy extends Jy{}function kr(t,e,...n){let r=[];e instanceof Jy&&r.push(e),r=r.concat(n),(function(o){const l=o.filter((h=>h instanceof ev)).length,d=o.filter((h=>h instanceof Nf)).length;if(l>1||l>0&&d>0)throw new Ae(he.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)t=s._apply(t);return t}class Nf extends Zy{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Nf(e,n,r)}_apply(e){const n=this._parse(e);return AS(e._query,n),new ri(e.firestore,e.converter,pg(e._query,n))}_parse(e){const n=zu(e.firestore);return(function(o,l,d,h,f,g,y){let _;if(f.isKeyField()){if(g==="array-contains"||g==="array-contains-any")throw new Ae(he.INVALID_ARGUMENT,`Invalid Query. You can't perform '${g}' queries on documentId().`);if(g==="in"||g==="not-in"){ax(y,g);const I=[];for(const k of y)I.push(ox(h,o,k));_={arrayValue:{values:I}}}else _=ox(h,o,y)}else g!=="in"&&g!=="not-in"&&g!=="array-contains-any"||ax(y,g),_=CL(d,l,y,g==="in"||g==="not-in");return Fn.create(f,g,_)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function qn(t,e,n){const r=e,s=jf("where",t);return Nf._create(s,r,n)}class ev extends Jy{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new ev(e,n)}_parse(e){const n=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return n.length===1?n[0]:Cs.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(s,o){let l=s;const d=o.getFlattenedFilters();for(const h of d)AS(l,h),l=pg(l,h)})(e._query,n),new ri(e.firestore,e.converter,pg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class tv extends Zy{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new tv(e,n)}_apply(e){const n=(function(s,o,l){if(s.startAt!==null)throw new Ae(he.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Ae(he.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vu(o,l)})(e._query,this._field,this._direction);return new ri(e.firestore,e.converter,(function(s,o){const l=s.explicitOrderBy.concat([o]);return new ba(s.path,s.collectionGroup,l,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,n))}}function nv(t,e="asc"){const n=e,r=jf("orderBy",t);return tv._create(r,n)}class rv extends Zy{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new rv(e,n,r)}_apply(e){return new ri(e.firestore,e.converter,Bh(e._query,this._limit,this._limitType))}}function Hl(t){return kM("limit",t),rv._create("limit",t,"F")}function ox(t,e,n){if(typeof(n=un(n))=="string"){if(n==="")throw new Ae(he.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!II(e)&&n.indexOf("/")!==-1)throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ot.fromString(n));if(!Ge.isDocumentKey(r))throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xb(t,new Ge(r))}if(n instanceof cn)return xb(t,n._key);throw new Ae(he.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${yf(n)}.`)}function ax(t,e){if(!Array.isArray(t)||t.length===0)throw new Ae(he.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function AS(t,e){const n=(function(s,o){for(const l of s)for(const d of l.getFlattenedFilters())if(o.indexOf(d.op)>=0)return d.op;return null})(t.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Ae(he.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ae(he.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class RS{convertValue(e,n="none"){switch(To(e)){case 0:return null;case 1:return e.booleanValue;case 2:return An(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(xo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Qe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return jo(e,((s,o)=>{r[s]=this.convertValue(o,n)})),r}convertVectorValue(e){const n=e.fields?.[Oh].arrayValue?.values?.map((r=>An(r.doubleValue)));return new Js(n)}convertGeoPoint(e){return new Ys(An(e.latitude),An(e.longitude))}convertArray(e,n){return(e.values||[]).map((r=>this.convertValue(r,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const r=_f(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(pu(e));default:return null}}convertTimestamp(e){const n=bo(e);return new qt(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ot.fromString(e);Et(JI(r),9688,{name:e});const s=new gu(r.get(1),r.get(3)),o=new Ge(r.popFirst(5));return s.isEqual(n)||Ri(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),o}}function sv(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class kL extends RS{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,n)}}function PL(){return new xL("count")}class ll{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vo extends Qh{constructor(e,n,r,s,o,l){super(e,n,r,s,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Th(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(jf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ae(he.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=vo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}vo._jsonSchemaVersion="firestore/documentSnapshot/1.0",vo._jsonSchema={type:Bn("string",vo._jsonSchemaVersion),bundleSource:Bn("string","DocumentSnapshot"),bundleName:Bn("string"),bundle:Bn("string")};class Th extends vo{data(e={}){return super.data(e)}}class da{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new ll(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((r=>{e.call(n,new Th(this._firestore,this._userDataWriter,r.key,r,new ll(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Ae(he.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map((d=>{const h=new Th(s._firestore,s._userDataWriter,d.doc.key,d.doc,new ll(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);return d.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}}))}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((d=>o||d.type!==3)).map((d=>{const h=new Th(s._firestore,s._userDataWriter,d.doc.key,d.doc,new ll(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,g=-1;return d.type!==0&&(f=l.indexOf(d.doc.key),l=l.delete(d.doc.key)),d.type!==1&&(l=l.add(d.doc),g=l.indexOf(d.doc.key)),{type:jL(d.type),doc:h,oldIndex:f,newIndex:g}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ae(he.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=da._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=fy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(n.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function jL(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qe(61501,{type:t})}}function hn(t){t=Tr(t,cn);const e=Tr(t.firestore,ni);return pL(Ea(e),t._key).then((n=>PS(e,t,n)))}da._jsonSchemaVersion="firestore/querySnapshot/1.0",da._jsonSchema={type:Bn("string",da._jsonSchemaVersion),bundleSource:Bn("string","QuerySnapshot"),bundleName:Bn("string"),bundle:Bn("string")};class qu extends RS{constructor(e){super(),this.firestore=e}convertBytes(e){return new Xr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new cn(this.firestore,null,n)}}function br(t){t=Tr(t,ri);const e=Tr(t.firestore,ni),n=Ea(e),r=new qu(e);return CS(t._query),gL(n,t._query).then((s=>new da(e,r,t,s)))}function ds(t,e,n){t=Tr(t,cn);const r=Tr(t.firestore,ni),s=sv(t.converter,e,n);return iv(r,[qy(zu(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,er.none())])}function Mf(t,e,n,...r){t=Tr(t,cn);const s=Tr(t.firestore,ni),o=zu(s);let l;return l=typeof(e=un(e))=="string"||e instanceof ql?Qy(o,"updateDoc",t._key,e,n,r):Gy(o,"updateDoc",t._key,e),iv(s,[l.toMutation(t._key,er.exists(!0))])}function kS(t,...e){t=un(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||ix(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(ix(e[r])){const h=e[r];e[r]=h.next?.bind(h),e[r+1]=h.error?.bind(h),e[r+2]=h.complete?.bind(h)}let o,l,d;if(t instanceof cn)l=Tr(t.firestore,ni),d=wf(t._key.path),o={next:h=>{e[r]&&e[r](PS(l,t,h))},error:e[r+1],complete:e[r+2]};else{const h=Tr(t,ri);l=Tr(h.firestore,ni),d=h._query;const f=new qu(l);o={next:g=>{e[r]&&e[r](new da(l,f,h,g))},error:e[r+1],complete:e[r+2]},CS(t._query)}return(function(f,g,y,_){const x=new $y(_),I=new Fy(g,x,y);return f.asyncQueue.enqueueAndForget((async()=>Ly(await Kh(f),I))),()=>{x.Nu(),f.asyncQueue.enqueueAndForget((async()=>Vy(await Kh(f),I)))}})(Ea(l),d,s,o)}function iv(t,e){return(function(r,s){const o=new Ss;return r.asyncQueue.enqueueAndForget((async()=>tL(await mL(r),s,o))),o.promise})(Ea(t),e)}function PS(t,e,n){const r=n.docs.get(e._key),s=new qu(t);return new vo(t,s,e._key,r,new ll(n.hasPendingWrites,n.fromCache),e.converter)}function jS(t){return NL(t,{count:PL()})}function NL(t,e){const n=Tr(t.firestore,ni),r=Ea(n),s=BM(e,((o,l)=>new wD(l,o.aggregateType,o._internalFieldPath)));return yL(r,t._query,s).then((o=>(function(d,h,f){const g=new qu(d);return new TL(h,g,f)})(n,t,o)))}const ML={maxAttempts:5};class DL{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=zu(e)}set(e,n,r){this._verifyNotCommitted();const s=uo(e,this._firestore),o=sv(s.converter,n,r),l=qy(this._dataReader,"WriteBatch.set",s._key,o,s.converter!==null,r);return this._mutations.push(l.toMutation(s._key,er.none())),this}update(e,n,r,...s){this._verifyNotCommitted();const o=uo(e,this._firestore);let l;return l=typeof(n=un(n))=="string"||n instanceof ql?Qy(this._dataReader,"WriteBatch.update",o._key,n,r,s):Gy(this._dataReader,"WriteBatch.update",o._key,n),this._mutations.push(l.toMutation(o._key,er.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=uo(e,this._firestore);return this._mutations=this._mutations.concat(new If(n._key,er.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ae(he.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function uo(t,e){if((t=un(t)).firestore!==e)throw new Ae(he.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}class LL{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=zu(e)}get(e){const n=uo(e,this._firestore),r=new kL(this._firestore);return this._transaction.lookup([n._key]).then((s=>{if(!s||s.length!==1)return Qe(24041);const o=s[0];if(o.isFoundDocument())return new Qh(this._firestore,r,o.key,o,n.converter);if(o.isNoDocument())return new Qh(this._firestore,r,n._key,null,n.converter);throw Qe(18433,{doc:o})}))}set(e,n,r){const s=uo(e,this._firestore),o=sv(s.converter,n,r),l=qy(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,r);return this._transaction.set(s._key,l),this}update(e,n,r,...s){const o=uo(e,this._firestore);let l;return l=typeof(n=un(n))=="string"||n instanceof ql?Qy(this._dataReader,"Transaction.update",o._key,n,r,s):Gy(this._dataReader,"Transaction.update",o._key,n),this._transaction.update(o._key,l),this}delete(e){const n=uo(e,this._firestore);return this._transaction.delete(n._key),this}}class VL extends LL{constructor(e,n){super(e,n),this._firestore=e}get(e){const n=uo(e,this._firestore),r=new qu(this._firestore);return super.get(e).then((s=>new vo(this._firestore,r,n._key,s._document,new ll(!1,!1),n.converter)))}}function Di(t,e,n){t=Tr(t,ni);const r={...ML,...n};return(function(o){if(o.maxAttempts<1)throw new Ae(he.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(o,l,d){const h=new Ss;return o.asyncQueue.enqueueAndForget((async()=>{const f=await vS(o);new dL(o.asyncQueue,f,d,l,h).ju()})),h.promise})(Ea(t),(s=>e(new VL(t,s))),r)}function at(){return new Wy("serverTimestamp")}function wu(...t){return new Hy("arrayUnion",t)}function lx(...t){return new Ky("arrayRemove",t)}function ov(t){return Ea(t=Tr(t,ni)),new DL(t,(e=>iv(t,e)))}(function(e,n=!0){(function(s){Bl=s})(Fl),wl(new fa("firestore",((r,{instanceIdentifier:s,options:o})=>{const l=r.getProvider("app").getImmediate(),d=new ni(new bM(r.getProvider("auth-internal")),new EM(l,r.getProvider("app-check-internal")),(function(f,g){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new Ae(he.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gu(f.options.projectId,g)})(l,s),l);return o={useFetchStreams:n,...o},d._setSettings(o),d}),"PUBLIC").setMultipleInstances(!0)),po(cb,ub,e),po(cb,ub,"esm2020")})();var OL="firebase",FL="12.7.0";po(OL,FL,"app");const BL={apiKey:"AIzaSyA-TURVnsMyyBOWreei2jGLcuXmOzyr_DQ",authDomain:"gamificationcollege.firebaseapp.com",projectId:"gamificationcollege",storageBucket:"gamificationcollege.firebasestorage.app",messagingSenderId:"237003198772",appId:"1:237003198772:web:37fc8130a083377a115561"},NS=gE(BL),Ks=yM(NS),UL=new vi,we=wL(NS),$L=10,zL=8,Rp="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";class vl extends Error{code;constructor(e,n){super(n||e),this.code=e}}function MS(t){return(t||"").trim().replace(/[^a-zA-Z0-9]/g,"").toUpperCase()}function qL(t=Math.random){let e="";for(let n=0;n<zL;n++){const r=Math.floor(t()*Rp.length)%Rp.length;e+=Rp[r]}return e}function WL(t=new Date,e=$L){return qt.fromDate(new Date(t.getTime()+e*60*1e3))}function HL(t,e=new Date){if(!t)throw new vl("code_not_found","Code introuvable ou expir");if(t.used)throw new vl("code_used","Code dj utilis");const n=t.expiresAt;if(n&&n.toDate().getTime()<=e.getTime())throw new vl("code_expired","Code expir")}function DS(t,e){return`${t}_${e}`}async function KL(t,e=new Date){const n=qL(),r=WL(e),s=Oe(we,"pairingCodes",n);return await ds(s,{code:n,childUid:t,createdAt:at(),expiresAt:r,used:!1,usedBy:null,consumedAt:null}),{code:n,expiresAt:r}}async function GL(t,e,n=new Date){const r=MS(t);if(!r)throw new vl("code_not_found","Code introuvable ou expir");const s=Oe(we,"pairingCodes",r);return await Di(we,async l=>{const d=await l.get(s),h=d.exists()?{...d.data()}:null;HL(h,n);const f=h.childUid,g=Oe(we,"familyLinks",DS(e,f));if((await l.get(g)).exists())throw new vl("already_linked","Enfant dj rattach");l.update(s,{used:!0,usedBy:e,consumedAt:at()}),l.set(g,{parentId:e,childId:f,pairingCode:r,createdAt:at()});const _=Oe(we,"users",e);l.set(_,{childrenIds:wu(f)},{merge:!0});const x=Oe(we,"users",f);return l.set(x,{parents:wu(e)},{merge:!0}),{childUid:f}})}async function QL(t){const e=await br(kr(Rn(we,"familyLinks"),qn("parentId","==",t))),n=[];for(const r of e.docs){const s=r.data().childId,l=(await hn(Oe(we,"users",s))).data();n.push({id:s,displayName:l?.displayName||"Enfant",role:l?.role||"child"})}return n}async function XL(t,e){const n=Oe(we,"familyLinks",DS(t,e));await Di(we,async r=>{const s=await r.get(n);if(!s.exists())return;const o=s.data();if(o.parentId!==t||o.childId!==e)return;r.delete(n);const l=Oe(we,"users",t),d=Oe(we,"users",e);r.set(l,{childrenIds:lx(e)},{merge:!0}),r.set(d,{parents:lx(t)},{merge:!0})})}const YL=20,kp="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",JL=720*3600*1e3;function ZL(t=Math.random){let e="";for(let n=0;n<YL;n++){const r=Math.floor(t()*kp.length)%kp.length;e+=kp[r]}return e}function LS(t){return`child-${t}@child.malocraft`}async function VS(t){const e=Oe(we,"users",t.uid,"meta","recovery"),n=await hn(e),r=n.exists()?n.data().code:null;if(r){const h=await hn(Oe(we,"childRecoveryCodes",r)),f=h.exists()?h.data():null,g=f?.expiresAt?.toDate?f.expiresAt.toDate():f?.expiresAt;if(f&&f.revoked!==!0&&g&&g.getTime()>Date.now())return r}const s=ZL();await ds(Oe(we,"childRecoveryCodes",s),{childUid:t.uid,createdAt:at(),expiresAt:new Date(Date.now()+JL),revoked:!1});const o=LS(t.uid),l=wa.credential(o,s);if(!(t.providerData||[]).some(h=>h?.providerId==="password"))try{await eN(t,l)}catch{}return await ds(e,{code:s,email:o},{merge:!0}),s}async function eV(t){const e=Oe(we,"users",t.uid,"meta","recovery"),n=await hn(e),r=n.exists()?n.data().code:null;return r&&await ds(Oe(we,"childRecoveryCodes",r),{revoked:!0,revokedAt:at()},{merge:!0}),VS(t)}function tV(t,e=new Date){if(!t)throw new Error("Code invalide ou inconnu");if(t.revoked)throw new Error("Code rvoqu");const n=t.expiresAt?.toDate?t.expiresAt.toDate():t?.expiresAt;if(!n||n.getTime()<=e.getTime())throw new Error("Code expir")}async function nV(t){const e=MS(t);if(!e)throw new Error("Code requis");Ks.currentUser||await FE(Ks);const n=await hn(Oe(we,"childRecoveryCodes",e));if(!n.exists())throw new Error("Code invalide ou inconnu");const r=n.data();tV(r);const s=r.childUid;if(!s)throw new Error("Code invalide");const o=LS(s);return await nN(Ks,o,e)}async function rV(t){const e=Oe(we,"users",t,"meta","recovery"),n=await hn(e);if(!n.exists())return null;const r=n.data().code;if(typeof r!="string")return null;const s=await hn(Oe(we,"childRecoveryCodes",r)),o=s.exists()?s.data():null,l=o?.expiresAt?.toDate?o.expiresAt.toDate():o?.expiresAt;return o&&o.revoked!==!0&&l&&l.getTime()>Date.now()?r:null}const OS=j.createContext(null);function rh(t){return`malo.activeChild:${t}`}const Ig="malo.childName";async function sV(){return(await br(kr(Rn(we,"users"),qn("role","==","child")))).docs.map(e=>({id:e.id,displayName:e.data().displayName||"Enfant",role:"child"}))}function iV(t,e){const n="johann.bourcier@gmail.com".split(",").map(s=>s.trim().toLowerCase()).filter(Boolean);return!t.isAnonymous&&n.includes((t.email||"").toLowerCase())?"admin":e||(t.isAnonymous?"child":"parent")}async function oV(t,e){const n=Oe(we,"users",t.uid),r=await hn(n),s=r.exists()?r.data():null,o=iV(t,s?.role),l=e||(typeof localStorage<"u"?localStorage.getItem(Ig):null),d=t.displayName||l||s?.displayName||(o==="child"?"Enfant":"Parent"),h={uid:t.uid,role:o,email:t.email||s?.email||null,displayName:d,parents:Array.isArray(s?.parents)?s.parents:[],childrenIds:Array.isArray(s?.childrenIds)?s.childrenIds:[]};return await ds(n,{displayName:h.displayName,role:o,email:h.email||null,createdAt:s?.createdAt||at(),lastLoginAt:at()},{merge:!0}),h}function aV({children:t}){const[e,n]=j.useState(null),[r,s]=j.useState(null),[o,l]=j.useState(null),[d,h]=j.useState([]),[f,g]=j.useState(null),[y,_]=j.useState(null),[x,I]=j.useState(!0),k=j.useRef(null),[S,O]=j.useState(null),[B,V]=j.useState(null),$=j.useCallback(async(q,W)=>{if(!q){V(null);return}try{if(W&&Ks.currentUser&&Ks.currentUser.uid===q){const ne=await VS(Ks.currentUser);V(ne);return}const Y=await rV(q);V(Y)}catch{V(null)}},[]),F=j.useCallback(async()=>{if(!e||o==="child"||!o){h([]),g(e?.uid||null);return}const q=o==="admin"?await sV():await QL(e.uid);h(q);const W=localStorage.getItem(rh(e.uid)),Y=q.find(ne=>ne.id===W)||q[0]||null;g(Y?.id||null),_(Y||null),Y?.id&&localStorage.setItem(rh(e.uid),Y.id)},[o,e?.uid]),H=j.useCallback(q=>{g(q),e&&o&&o!=="child"&&(q?localStorage.setItem(rh(e.uid),q):localStorage.removeItem(rh(e.uid)));const W=d.find(Y=>Y.id===q)||null;_(W)},[d,o,e]);j.useEffect(()=>{let q=!1;const W=iN(Ks,async Y=>{if(!q){if(!Y){n(null),s(null),l(null),h([]),_(null),g(null),I(!1);return}I(!0),n(Y);try{const ne=await oV(Y,k.current);if(k.current=null,q)return;if(s(ne),l(ne.role),O(null),ne.role==="child"){const se={id:Y.uid,displayName:ne.displayName,role:ne.role};h([]),_(se),g(Y.uid),await $(Y.uid,!0);const z=Array.isArray(ne.parents)?ne.parents[0]:null;if(z)try{const ee=await hn(Oe(we,"users",z));ee.exists()&&O(ee.data().displayName||z)}catch{O(z)}}else await F(),V(null)}finally{q||I(!1)}}});return()=>{q=!0,W()}},[F]);const A=async()=>{await SN(Ks,UL)},E=async q=>{const W=q.trim();if(!W)throw new Error("Prnom requis");typeof localStorage<"u"&&localStorage.setItem(Ig,W),k.current=W,I(!0),await FE(Ks)},P=async()=>{await oN(Ks)},L=async()=>{if(!e||o!=="child")throw new Error("Rserv aux comptes enfant");return KL(e.uid)},C=async q=>{if(!e||o!=="parent"&&o!=="admin")throw new Error("Rserv aux comptes parent/admin");const W=await GL(q,e.uid);return await F(),W},N=async q=>{if(!e||!r)throw new Error("Aucun utilisateur connect");const W=q.trim();if(!W)throw new Error("Prnom requis");await ds(Oe(we,"users",e.uid),{displayName:W},{merge:!0}),r.role==="child"&&typeof localStorage<"u"&&localStorage.setItem(Ig,W),s(Y=>Y&&{...Y,displayName:W}),o==="child"&&(_({id:e.uid,displayName:W,role:"child"}),g(e.uid))},M=async q=>{await nV(q)},ie=async()=>{if(!e||o!=="child")throw new Error("Rserv  lenfant connect");const q=await eV(e);V(q),await ds(Oe(we,"users",e.uid,"meta","recovery"),{code:q},{merge:!0})};j.useEffect(()=>{o==="child"&&e?.uid&&!B&&$(e.uid,!0).catch(()=>{})},[o,e?.uid,B,$]),j.useEffect(()=>{(async()=>{if(!y?.id){V(null);return}await $(y.id)})()},[y?.id,$]);const te=async q=>{if(!e||o!=="parent"&&o!=="admin")throw new Error("Rserv aux comptes parent/admin");await XL(e.uid,q),await F()};return c.jsx(OS.Provider,{value:{user:e,profile:r,role:o,loading:x,linkedChildren:d,activeChildId:f,activeChild:y,signInGoogle:A,startAnonymousWithName:E,signOutUser:P,setActiveChildId:H,refreshLinkedChildren:F,generatePairingCode:L,redeemPairingCode:C,updateDisplayName:N,linkedParentName:S,resumeChildWithRecovery:M,recoveryCode:B,unlinkChild:te,refreshRecoveryCode:async(q,W)=>$(q||f||null,W),regenerateRecoveryCode:ie},children:t})}function Hn(){const t=j.useContext(OS);if(!t)throw new Error("useAuth doit tre utilis sous <AuthProvider>");return t}function _s({children:t}){const{user:e,loading:n}=Hn();return n?c.jsx("div",{className:"card",children:"Chargement"}):e?c.jsx(c.Fragment,{children:t}):c.jsx(cu,{to:"/connexion",replace:!0})}function lV({children:t}){const{user:e,role:n,loading:r}=Hn();return r?c.jsx("div",{className:"card",children:"Chargement"}):e?n!=="parent"?c.jsx(cu,{to:"/",replace:!0}):c.jsx(c.Fragment,{children:t}):c.jsx(cu,{to:"/connexion",replace:!0})}function Nc({children:t}){const{user:e,role:n,loading:r}=Hn();return r?c.jsx("div",{className:"card",children:"Chargement"}):e?n!=="parent"&&n!=="admin"?c.jsx(cu,{to:"/",replace:!0}):c.jsx(c.Fragment,{children:t}):c.jsx(cu,{to:"/connexion",replace:!0})}const cV="malo.childName";function cx(){const t=ts(),{user:e,profile:n,role:r,loading:s,signInGoogle:o,startAnonymousWithName:l,resumeChildWithRecovery:d,signOutUser:h,redeemPairingCode:f,linkedChildren:g,updateDisplayName:y}=Hn(),[_,x]=j.useState(""),[I,k]=j.useState(""),[S,O]=j.useState(!1),B=j.useRef(!1),[V,$]=j.useState(""),[F,H]=j.useState(""),[A,E]=j.useState(""),[P,L]=j.useState("");j.useEffect(()=>{const W=typeof localStorage<"u"?localStorage.getItem(cV):"";W&&k(W)},[]),j.useEffect(()=>{n?.role==="child"&&n.displayName&&k(n.displayName)},[n?.displayName,n?.role]),j.useEffect(()=>{B.current||e&&r==="child"&&(B.current=!0,t("/hub",{replace:!0}))},[e,r,t]);const C=async()=>{x(""),H("");try{await f(V),H("Enfant rattach avec succs."),$("")}catch(W){W instanceof vl?W.code==="code_expired"?x("Code expir. Demandez un nouveau code  votre enfant."):W.code==="code_used"?x("Ce code a dj t utilis."):W.code==="already_linked"?x("Cet enfant est dj rattach."):x(W.message||"Code invalide."):x(W?.message||"Erreur pendant le rattachement.")}},N=async()=>{x(""),O(!0);try{await l(I)}catch(W){x(W?.message||"Impossible de dmarrer.")}finally{O(!1)}},M=async()=>{x(""),O(!0);try{await y(I)}catch(W){x(W?.message||"Erreur de mise  jour du prnom.")}finally{O(!1)}},ie=!e||r==="child",te=!e||r==="parent"||r==="admin",q=async()=>{x(""),L("");try{await d(A),L("Connexion russie."),t("/hub",{replace:!0})}catch(W){x(W?.message||"Code de reprise invalide.")}};return c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"grid",children:[ie&&c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Espace enfant"}),c.jsx("p",{className:"small",children:"Entre ton prnom pour commencer (connexion anonyme)."}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("input",{className:"input",placeholder:"Prnom",value:I,onChange:W=>k(W.target.value)}),e&&r==="child"?c.jsx("button",{className:"btn secondary",onClick:M,disabled:S||!I.trim(),children:"Mettre  jour"}):c.jsx("button",{className:"btn secondary",onClick:N,disabled:S||!I.trim(),children:"Commencer"})]}),e&&r==="child"&&c.jsxs("div",{className:"small",style:{marginTop:8},children:["Connect en tant que ",c.jsx("strong",{children:n?.displayName||"Enfant"}),".",c.jsx("button",{className:"btn secondary",style:{marginLeft:8},onClick:h,children:"Se dconnecter"})]}),c.jsx("hr",{}),c.jsx("h3",{children:"Reprendre ma partie"}),c.jsx("p",{className:"small",children:"Saisis le code de reprise (donn dans la top bar ou par le parent) pour rcuprer ta progression sur cet appareil."}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("input",{className:"input",placeholder:"Code de reprise",value:A,onChange:W=>E(W.target.value)}),c.jsx("button",{className:"btn secondary",onClick:q,disabled:!A.trim()||s,children:"Reprendre"})]}),P&&c.jsx("div",{className:"small success",style:{marginTop:6},children:P})]}),te&&c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Parent / Admin"}),c.jsx("p",{className:"small",children:"Connexion Google recommande (parents + admins)."}),c.jsx("button",{className:"btn",onClick:o,disabled:s,children:e&&r!=="child"?"Reconnecter Google":"Se connecter avec Google"}),(r==="parent"||r==="admin")&&c.jsxs(c.Fragment,{children:[c.jsx("hr",{}),c.jsx("h3",{children:"Rattacher un enfant"}),c.jsx("p",{className:"small",children:"Saisis le code gnr sur lapp enfant (valide 10 min)."}),c.jsxs("div",{className:"row",style:{gap:8},children:[c.jsx("input",{className:"input",value:V,placeholder:"Code  8 caractres",onChange:W=>$(W.target.value)}),c.jsx("button",{className:"btn secondary",onClick:C,disabled:!V,children:"Rattacher"})]}),F&&c.jsx("div",{className:"small success",children:F}),c.jsxs("div",{className:"small",style:{marginTop:10},children:["Enfants rattachs : ",g.length?g.map(W=>W.displayName).join(", "):"aucun pour le moment"]}),c.jsx("div",{className:"small",style:{marginTop:6},children:"Pour lier un enfant : demande-lui de gnrer un code dans sa section enfant, puis saisis-le ici."})]})]})]}),_&&c.jsx("div",{className:"card",style:{marginTop:12,background:"rgba(255,0,0,0.08)"},children:_})]})}function Rl(t){return(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[]/g,"'").replace(/\s+/g," ").trim()}function vr(t){return typeof t=="string"&&t.trim().length>0}function uV(t){const e=new Set;if(!t||typeof t!="string")return e;const n=/{#([a-zA-Z0-9_-]+)}/g;let r;for(;(r=n.exec(t))!==null;)e.add(r[1]);return e}function dV(t,e,n){const r=[],s=[],o=typeof t.lessonRef=="string"?t.lessonRef.trim().replace(/^#/,""):t.lessonRef;t.schemaVersion!==1&&r.push(`question[${e}].schemaVersion doit valoir 1`),vr(t.taxonomyVersion)||r.push(`question[${e}].taxonomyVersion requis`),vr(t.id)||r.push(`question[${e}].id manquant ou vide`),vr(t.blockId)||r.push(`question[${e}].blockId manquant ou vide`),vr(t.grade)||r.push(`question[${e}].grade manquant ou vide`),vr(t.lang)||r.push(`question[${e}].lang manquant ou vide`),vr(t.primaryTag)||r.push(`question[${e}].primaryTag manquant ou vide`),vr(t.type)||r.push(`question[${e}].type manquant ou vide`),Number.isFinite(t.difficulty)||s.push(`question[${e}].difficulty manquante ou invalide (dfaut = 2)`),vr(t.statement)||r.push(`question[${e}].statement manquant ou vide`),vr(t.answer)||r.push(`question[${e}].answer manquant ou vide`);const l=["MCQ","FILL_BLANK","TRUE_FALSE","ERROR_SPOTTING"];if(t.type&&!l.includes(t.type)&&r.push(`question[${e}].type invalide (${t.type})`),!t.quality||!t.quality.status?r.push(`question[${e}].quality.status manquant`):["draft","reviewed","published","rejected","archived"].includes(t.quality.status)||r.push(`question[${e}].quality.status invalide (${t.quality.status})`),t.type==="MCQ"&&(!Array.isArray(t.choices)||t.choices.length<2?r.push(`question[${e}].choices requis pour MCQ (au moins 2)`):(t.choices.includes(t.answer)||r.push(`question[${e}].answer doit appartenir  choices pour MCQ`),new Set(t.choices).size!==t.choices.length&&r.push(`question[${e}].choices doit contenir des rponses distinctes (MCQ)`))),t.type==="TRUE_FALSE"&&(["true","false"].includes(String(t.answer))||r.push(`question[${e}].answer doit tre "true" ou "false" pour TRUE_FALSE`)),t.type==="FILL_BLANK"&&t.choices!==null&&t.choices!==void 0&&!Array.isArray(t.choices)&&r.push(`question[${e}].choices doit tre null ou string[] pour FILL_BLANK`),t.lessonRef!==void 0&&t.lessonRef!==null&&!vr(t.lessonRef)&&r.push(`question[${e}].lessonRef doit tre une string non vide ou null`),vr(o)&&(n.has(o)||s.push(`question[${e}].lessonRef "${t.lessonRef}" introuvable dans la leon (ancre {#...})`)),Array.isArray(t.metaTags)){const d=t.metaTags.filter(h=>!vr(h)||!h.startsWith("meta_"));d.length&&r.push(`question[${e}].metaTags doivent commencer par "meta_" (${d.join(", ")})`)}return t.explanation&&t.explanation.trim().length>0&&t.explanation.trim().length<20&&s.push(`question[${e}].explanation trop courte (<20 caractres)`),{errors:r,warnings:s}}function FS(t){const e=[],n=[];if(!t||typeof t!="object")return{ok:!1,errors:["Pack inexistant ou non-objet"],warnings:n};!t.pack||typeof t.pack!="object"?e.push("Section pack manquante"):(t.pack.schemaVersion!==1&&e.push("pack.schemaVersion requis et doit valoir 1"),vr(t.pack.taxonomyVersion)||e.push('pack.taxonomyVersion requis (ex: "5e-1.0")'),vr(t.pack.setId)||e.push("pack.setId requis"),vr(t.pack.grade)||e.push("pack.grade requis"),vr(t.pack.lang)||e.push("pack.lang requis"),t.pack.lesson!==void 0&&typeof t.pack.lesson!="string"&&e.push("pack.lesson doit tre une string si prsent"),t.pack.lessonTitle!==void 0&&typeof t.pack.lessonTitle!="string"&&e.push("pack.lessonTitle doit tre une string si prsent"));const r=uV(t.pack?.lesson);return!Array.isArray(t.questions)||t.questions.length===0?e.push("questions[] manquant ou vide"):t.questions.forEach((s,o)=>{const{errors:l,warnings:d}=dV(s,o,r);t.pack?.taxonomyVersion&&s.taxonomyVersion&&s.taxonomyVersion!==t.pack.taxonomyVersion&&l.push(`question[${o}].taxonomyVersion doit galer pack.taxonomyVersion`),e.push(...l),n.push(...d)}),{ok:e.length===0,errors:e,warnings:n}}async function hV(t,e){const n=FS(t);if(!n.ok)return n;const r=Array.isArray(t.questions)?t.questions.map(_=>_.id):[],s=new Set,o=[];if(r.forEach(_=>{s.has(_)?o.push(_):s.add(_)}),o.length)return{ok:!1,errors:[`IDs en double dans le pack: ${Array.from(new Set(o)).join(", ")}`],warnings:n.warnings||[],report:{packImported:!1,questions:{created:0,updated:0,ignored:r.length}}};const l=[];if(await Promise.all(Array.from(new Set(r)).map(async _=>{(await hn(Oe(we,"questions",_))).exists()&&l.push(_)})),l.length)return{ok:!1,errors:[`Questions dj prsentes en base (ids): ${l.join(", ")}`],warnings:n.warnings||[],report:{packImported:!1,questions:{created:0,updated:0,ignored:l.length}}};const d={packImported:!e?.dryRun,questions:{created:t.questions.length,updated:0,ignored:0}};if(e?.dryRun)return{ok:!0,errors:[],warnings:n.warnings||[],report:d};const h=ov(we),f=new Date().toISOString(),g=Oe(we,"questionPacks",t.pack.setId),y={...t.pack,totalQuestions:Array.isArray(t.questions)?t.questions.length:0,updatedAt:at(),createdAt:at()};return h.set(g,y,{merge:!0}),t.questions.forEach(_=>{const x=Array.isArray(_.quality?.history)?_.quality.history:[],I=Oe(we,"questions",_.id),k=Number.isFinite(_.difficulty)?_.difficulty:2,S={..._,setId:t.pack.setId,difficulty:k,quality:{..._.quality,status:"draft",history:[...x,{at:f,by:"import",action:"created",status:"draft",details:`pack:${t.pack.setId}`}],review:_.quality?.review||{reviewedAt:null,reviewedBy:null,decision:null,notes:null},deletedAt:null,deletedBy:null},createdAt:_.createdAt||at(),updatedAt:at()};h.set(I,S,{merge:!0})}),await h.commit(),{ok:!0,errors:[],warnings:n.warnings||[],report:d}}async function fV(t){const e=[];t.status&&e.push(qn("quality.status","==",t.status)),t.primaryTag&&e.push(qn("primaryTag","==",t.primaryTag)),t.blockId&&e.push(qn("blockId","==",t.blockId)),t.setId&&e.push(qn("setId","==",t.setId));let n=kr(Rn(we,"questions"),...e,nv("updatedAt","desc"),Hl(200)),s=(await br(n)).docs.map(o=>({id:o.id,...o.data()}));if(t.includeDeleted||(s=s.filter(o=>!o.quality?.deletedAt)),t.difficulty&&(s=s.filter(o=>Number(o.difficulty)===Number(t.difficulty))),t.text){const o=t.text.toLowerCase();s=s.filter(l=>(l.statement||"").toLowerCase().includes(o)||(l.answer||"").toLowerCase().includes(o))}return s}async function mV(t,e){const n=[qn("quality.status","==","published"),qn("primaryTag","==",t)];e?.difficulty&&n.push(qn("difficulty","==",e.difficulty));const r=kr(Rn(we,"questions"),...n,Hl(e?.limitTo||200));return(await br(r)).docs.map(d=>({id:d.id,...d.data()})).filter(d=>!d.quality?.deletedAt)}function pV(t){const e=Math.min(3,Math.max(1,Math.round(Number(t.difficulty)||1))),n=[t.primaryTag,...Array.isArray(t.secondaryTags)?t.secondaryTags:[]].slice(0,3);if(t.type==="MCQ"||t.type==="TRUE_FALSE"){const o=t.type==="TRUE_FALSE"?["Vrai","Faux"]:Array.isArray(t.choices)?t.choices:[],l=t.type==="TRUE_FALSE"?String(t.answer)==="true"?"Vrai":"Faux":t.answer;let d=Math.max(0,o.findIndex(f=>f===l));return d===-1&&(d=0),{id:t.id,themeId:t.blockId||t.primaryTag,type:"mcq",prompt:t.statement,choices:o,answerIndex:d,difficulty:e,tags:n}}if(t.type==="FILL_BLANK"){const o=Rl(String(t.answer||""));return{id:t.id,themeId:t.blockId||t.primaryTag,type:"fill_blank",prompt:t.statement,text:t.statement,expected:[o],difficulty:e,tags:n}}const r=Rl(String(t.answer||""));return{id:t.id,themeId:t.blockId||t.primaryTag,type:"short_text",prompt:t.statement,expected:[r],difficulty:e,tags:n}}async function gV(t,e){const n=await mV(t,{limitTo:e?.limitTo});let r={};{const s=Array.from(new Set(n.map(l=>l.setId).filter(Boolean))),o=await Promise.all(s.map(async l=>{try{const d=await hn(Oe(we,"questionPacks",l));return[l,d.exists()?d.data():null]}catch{return[l,null]}}));r=Object.fromEntries(o)}return n.map(s=>{const o=pV(s);if(o.setId=s.setId,o.lessonRef=s.lessonRef||null,o.explanation=s.explanation||null,s.setId){const l=r[s.setId];o.packLesson=l?.lesson,o.packLessonTitle=l?.lessonTitle}return o})}async function ux(t,e){const n=Oe(we,"questions",t),s={at:new Date().toISOString(),by:e?.by||"moderator",action:"deleted",status:"archived"};e?.notes&&(s.notes=e.notes),await Mf(n,{"quality.deletedAt":at(),"quality.deletedBy":e?.by||null,"quality.status":"archived","quality.history":wu(s),updatedAt:at()})}async function yV(t,e){const n=Oe(we,"questions",t),r={updatedAt:at()};["statement","choices","answer","explanation","commonMistake","difficulty","secondaryTags","metaTags","primaryTag","blockId"].forEach(l=>{e[l]!==void 0&&(r[l]=e[l])}),e.updatedBy&&(r["quality.lastEditedBy"]=e.updatedBy);const o={at:new Date().toISOString(),by:e.updatedBy||"moderator",action:"updated",notes:e.note||void 0};await Mf(n,{...r,"quality.history":wu(o)})}async function Sg(t,e,n){const r=Oe(we,"questions",t);if(e==="published"){const l=await hn(r);if(l.exists()){const h=l.data().explanation||"";if(!h||h.trim().length<20)throw new Error("Explication obligatoire (>= 20 caractres) pour publier.")}}const s={at:new Date().toISOString(),by:n?.reviewerId||"moderator",action:e,status:e};n?.notes&&(s.notes=n.notes);const o={reviewedBy:n?.reviewerId||null,reviewedAt:at(),decision:n?.decision??(e==="published"?"approved":e==="rejected"?"rejected":null),notes:n?.notes??null};await Mf(r,{"quality.status":e,"quality.review":o,"quality.history":wu(s),updatedAt:at()})}async function vV(t,e){await Sg(t,"archived",{reviewerId:e?.by,notes:e?.notes})}async function _V(t,e){const{uid:n,includeHidden:r=!1,includeOverrides:s=!1}=e||{},o=kr(Rn(we,"exercises"),qn("themeId","==",t)),d=(await br(o)).docs.map(g=>({id:g.id,...g.data()}));let h=new Map;if(n)try{const g=await br(Rn(we,"users",n,"visibilityExercises"));h=new Map(g.docs.map(y=>[y.id,!!y.data().visible]))}catch{h=new Map}const f=d.filter(g=>{const y=h.get(g.id);return!(!r&&g.hidden||!r&&y===!1)});return s?f.map(g=>({...g,visibleOverride:h.get(g.id)})):f}async function wV(t){const e=kr(Rn(we,"readings"),qn("themeId","==",t));try{return(await br(e)).docs.map(r=>({id:r.id,...r.data()}))}catch{return[]}}async function tu(t,e){const{includeHidden:n=!1}=e||{},r=await gV(t,{});return r}function dx(t){return t.toISOString().slice(0,10)}function bV(t,e){return t===1?e?3:-1:t===2?e?5:-2:e?7:-3}function xV(t){return Math.max(0,Math.min(100,t))}function TV(t){return t>=80?"mastered":t>=60?"nearly":t>=30?"developing":"weak"}async function EV(t){const{uid:e,items:n,existingAttemptId:r}=t,s=new Date,o=dx(s),l=n.length,d=n.filter(x=>x.correct).length;if(l===0)return{xpGain:0,coinsGain:0,streakDays:0,badges:[],score:0,outOf:0};const h=new Map;n.forEach(x=>{const I=Array.isArray(x.tags)?x.tags.slice(0,3):[],k=bV(x.difficulty,x.correct);I.forEach(S=>{const O=h.get(S)||{delta:0,correct:0,wrong:0};h.set(S,{delta:O.delta+k,correct:O.correct+(x.correct?1:0),wrong:O.wrong+(x.correct?0:1)})})});const f=d*10,g=Math.max(0,d);let y=null;const _=r?Oe(we,"users",e,"attempts",r):Oe(Rn(we,"users",e,"attempts"));return n.map(()=>Oe(Rn(_,"items"))),await Di(we,async x=>{const I=Oe(we,"users",e,"stats","main"),k=Oe(we,"users",e,"progressSummary","main"),S=Array.from(h.keys()).map(C=>Oe(we,"users",e,"tagProgress",C)),[O,B,V]=await Promise.all([x.get(I),x.get(k),Promise.all(S.map(C=>x.get(C)))]),$=O.exists()?O.data():{xp:0,coins:0,streakDays:0,lastDoneDate:null,badges:[]};let F=$.streakDays||0;const H=$.lastDoneDate;if(H!==o){const C=dx(new Date(s.getTime()-864e5));F=H===C?F+1:1}const A=new Set(Array.isArray($.badges)?$.badges:[]);F>=3&&A.add("3 jours daffile"),F>=7&&A.add("7 jours daffile"),d===l&&l>=10&&A.add("Zro faute (10+)");const E=B.exists()?B.data():null,P={weak:0,developing:0,nearly:0,mastered:0};for(let C=0;C<S.length;C++){const N=S[C],M=V[C],ie=N.id,te=h.get(ie),q=M.exists()?M.data():null,W=typeof q?.mastery=="number"?q.mastery:0,Y=q?.bucket,ne=xV(W+te.delta),se=TV(ne);Y&&E&&(P[Y]-=1),P[se]+=1,x.set(N,{mastery:ne,bucket:se,correctAnswers:(q?.correctAnswers||0)+te.correct,wrongAnswers:(q?.wrongAnswers||0)+te.wrong,lastDelta:te.delta,updatedAt:at()},{merge:!0})}const L=E?.masteryBuckets||{weak:0,developing:0,nearly:0,mastered:0};x.set(I,{xp:($.xp||0)+f,coins:($.coins||0)+g,streakDays:F,lastDoneDate:o,badges:Array.from(A),updatedAt:at()},{merge:!0}),x.set(k,{totalAnswers:(E?.totalAnswers||0)+l,correctAnswers:(E?.correctAnswers||0)+d,totalAttempts:(E?.totalAttempts||0)+1,masteryBuckets:{weak:(L.weak||0)+P.weak,developing:(L.developing||0)+P.developing,nearly:(L.nearly||0)+P.nearly,mastered:(L.mastered||0)+P.mastered},lastAttemptId:_.id,lastDate:o,updatedAt:at()},{merge:!0}),y={xpGain:f,coinsGain:g,streakDays:F,badges:Array.from(A)}}),{...y||{xpGain:0,coinsGain:0,streakDays:0,badges:[]},score:d,outOf:l}}function IV(t,e){return t.type==="mcq"?e===t.answerIndex:t.type==="short_text"||t.type==="fill_blank"?t.expected.includes(Rl(e||"")):!1}function SV(t,e){return t===1?e?3:-1:t===2?e?5:-2:e?7:-3}function CV(t){return Math.max(0,Math.min(100,t))}function AV(t){return t>=80?"mastered":t>=60?"nearly":t>=30?"developing":"weak"}function BS(t){return t.toISOString().slice(0,10)}function RV(t,e){const n=new Date(t+"T00:00:00");return n.setDate(n.getDate()+e),BS(n)}function kV(t,e,n){const r=Math.max(0,Math.min(100,t));let s=1;return r>=81||e==="mastered"?s=10:r>=61||e==="nearly"?s=4:r>=31||e==="developing"?s=2:s=1,RV(n,s)}async function PV(t){const{uid:e,subjectId:n,themeId:r,answers:s,exercises:o,durationSec:l}=t,h=BS(new Date),f=Oe(Rn(we,"users",e,"attempts")),g=Rn(we,"users",e,"attemptItems"),y=Oe(we,"users",e,"progressSummary","main"),_=o.map((ie,te)=>{const q=IV(ie,s[ie.id]);return{exerciseId:ie.id,questionId:ie.id,subjectId:n,themeId:r,difficulty:ie.difficulty,tags:ie.tags?.slice(0,3)||[],correct:q,index:te,prompt:ie.prompt,choices:Array.isArray(ie.choices)?ie.choices:null,readingContext:ie.readingContext||null}}),x=_.filter(ie=>ie.correct).length,I=_.length,k=new Map;_.forEach(ie=>{const te=SV(ie.difficulty,ie.correct);ie.tags.forEach(q=>{const W=k.get(q)||{delta:0,correct:0,wrong:0,results:[]};W.delta+=te,W.correct+=ie.correct?1:0,W.wrong+=ie.correct?0:1,W.results.push(ie.correct),k.set(q,W)})});const S=Array.from(k.keys()),O=await Promise.all(S.map(ie=>hn(Oe(we,"users",e,"tagProgress",ie)))),B=ov(we),V={subjectId:n,themeId:r,score:x,outOf:I,durationSec:l,itemsCount:_.length,date:h,createdAt:at()};B.set(f,V),_.forEach(ie=>{const te=Oe(g);B.set(te,{...ie,createdAt:at(),answer:s[ie.exerciseId]??null})});const $={weak:0,developing:0,nearly:0,mastered:0},F={};S.forEach((ie,te)=>{const q=O[te],W=q.exists()?q.data():null,Y=k.get(ie),se=[...Array.isArray(W?.last7Results)?W.last7Results:[],...Y.results].slice(-7),z={correct:se.filter(Wt=>Wt).length,wrong:se.filter(Wt=>!Wt).length};let ee=W?.streakCorrect||0,Q=W?.streakWrong||0;Y.results.forEach(Wt=>{Wt?(ee+=1,Q=0):(Q+=1,ee=0)});const de=typeof W?.mastery=="number"?W.mastery:0,Se=CV(de+Y.delta),fe=AV(Se),Re=W?.bucket;Re&&($[Re]-=1),$[fe]+=1;const $e=kV(Se,fe,h),Me=Oe(we,"users",e,"tagProgress",ie),At={tagId:ie,mastery:Se,bucket:fe,attempts:(W?.attempts||0)+Y.results.length,correctAnswers:(W?.correctAnswers||0)+Y.correct,wrongAnswers:(W?.wrongAnswers||0)+Y.wrong,last7Results:se,last7:z,lastSeenAt:at(),lastCorrectAt:Y.correct>0?at():W?.lastCorrectAt||null,streakCorrect:ee,streakWrong:Q,lastDelta:Y.delta,nextDueDate:$e,updatedAt:at()};F[ie]=At,B.set(Me,At,{merge:!0})});const H=await hn(y),A=H.exists()?H.data():null,E=A?.masteryBuckets||{weak:0,developing:0,nearly:0,mastered:0},P={weak:(E.weak||0)+$.weak,developing:(E.developing||0)+$.developing,nearly:(E.nearly||0)+$.nearly,mastered:(E.mastered||0)+$.mastered},L=Object.values(F).sort((ie,te)=>ie.mastery-te.mastery).map(ie=>ie.tagId),C=Array.isArray(A?.topWeakTags)?A.topWeakTags:[],N=Array.from(new Set([...L,...C])).slice(0,3),M={totalAnswers:(A?.totalAnswers||0)+I,correctAnswers:(A?.correctAnswers||0)+x,totalAttempts:(A?.totalAttempts||0)+1,masteryBuckets:P,lastAttemptId:f.id,lastDate:h,updatedAt:at(),topWeakTags:N};return B.set(y,M,{merge:!0}),await B.commit(),{attemptId:f.id,score:x,outOf:I,summary:M,tagsUpdated:F}}const jV=["wrong_answer","ambiguous","typo","too_hard","off_topic","other"],NV=240;function MV(t,e){return`${t}_${e}`}function DV(t,e){if(!jV.includes(t))throw new Error("Raison invalide.");const n=(e??"").toString().trim();if(n.length>NV)throw new Error("Le message doit faire moins de 240 caractres.");return{reason:t,message:n||void 0}}function LV(t){const e={};return t&&(t.setId&&(e.setId=t.setId),t.primaryTag&&(e.primaryTag=t.primaryTag),t.blockId&&(e.blockId=t.blockId),t.sessionId&&(e.sessionId=t.sessionId),t.grade&&(e.grade=t.grade)),e}async function VV(t){const{questionId:e,uid:n,reason:r,message:s,context:o}=t,l=MV(e,n),d=DV(r,s),h=Oe(we,"questionReports",l);try{const f=LV(o),g={questionId:e,uid:n,createdAt:at(),reason:d.reason,context:f,status:"open",admin:{notes:null,resolvedBy:null,resolvedAt:null}};return d.message!==void 0&&(g.message=d.message),await ds(h,g),{created:!0,alreadyExists:!1,id:l}}catch(f){if(f?.code==="already-exists"||f?.code==="permission-denied")return{created:!1,alreadyExists:!0,id:l};throw f}}async function OV(t){const e=kr(Rn(we,"questionReports"),nv("createdAt","desc"),Hl(t?.limitTo||400)),r=(await br(e)).docs.map(o=>({id:o.id,...o.data()})),s=t?.sinceDays?Date.now()-t.sinceDays*24*60*60*1e3:null;return r.filter(o=>!(t?.status&&o.status!==t.status||t?.reason&&o.reason!==t.reason||t?.questionId&&o.questionId!==t.questionId||t?.primaryTag&&o.context?.primaryTag!==t.primaryTag||t?.blockId&&o.context?.blockId!==t.blockId||s&&o.createdAt?.toDate&&o.createdAt.toDate().getTime()<s))}function FV(t,e=20){const n=new Map;return t.forEach(r=>{const s=n.get(r.questionId)||{count:0,latest:0,sample:r},o=typeof r.createdAt?.toDate=="function"?r.createdAt.toDate().getTime():Date.now();s.count+=1,s.latest=Math.max(s.latest||0,o),s.sample=s.sample||r,n.set(r.questionId,s)}),Array.from(n.entries()).sort((r,s)=>s[1].count-r[1].count).slice(0,e).map(([r,s])=>({questionId:r,count:s.count,latestAt:s.latest?new Date(s.latest):null,sample:s.sample}))}async function BV(t,e,n){const r={status:e};n?.notes!==void 0&&(r["admin.notes"]=n.notes),e==="resolved"&&(r["admin.resolvedBy"]=n?.resolvedBy||null,r["admin.resolvedAt"]=at()),await Mf(Oe(we,"questionReports",t),r)}async function sh(t,e,n=!1){const r=[qn(t,"==",e)];return n&&r.push(qn("correct","==",!1)),(await jS(kr(_L(we,"attemptItems"),...r))).data().count||0}async function UV(t){let e=0,n=0;try{e=await sh("questionId",t,!1),n=await sh("questionId",t,!0),e===0&&n===0&&(e=await sh("exerciseId",t,!1),n=await sh("exerciseId",t,!0))}catch(s){return console.warn("aggregate counts unavailable",s),{total:0,wrong:0,wrongRate:0}}const r=e>0?Math.round(n/e*1e3)/10:0;return{total:e,wrong:n,wrongRate:r}}async function US(t){try{return(await jS(kr(Rn(we,"questionReports"),qn("questionId","==",t)))).data().count||0}catch(e){return console.warn("report count unavailable",e),0}}function Pp(t){const e=[];return Array.isArray(t.exercises)&&e.push(...t.exercises),Array.isArray(t.readings)&&t.readings.forEach(n=>{Array.isArray(n.questions)&&n.questions.forEach(r=>{e.push({...r,readingContext:{readingId:n.id,title:n.title,text:n.text}})})}),e}function $V(t){return 100+(Math.max(1,Math.floor(t))-1)*50}function ya(t){let e=Math.max(0,Math.floor(t)),n=1;for(;;){const r=$V(n);if(e<r)return{level:n,xpIntoLevel:e,xpForNext:r};e-=r,n+=1}}const Mc={basePerCorrect:4,fallbackPerAnswer:2,completionBonus:10,streakBonusPerExtra:1,comebackBonus:2};function zV(t){const e=Math.max(0,t.answeredCount),n=typeof t.correctCount=="number"?Math.max(0,Math.min(e,t.correctCount)):null,r=n!==null?n*Mc.basePerCorrect:e*Mc.fallbackPerAnswer,s=t.isCompleted?Mc.completionBonus:0;let o=0;Array.isArray(t.streaks)&&t.streaks.forEach(h=>{h>=3&&(o+=(h-2)*Mc.streakBonusPerExtra)});const l=Math.max(0,t.comebackCount||0)*Mc.comebackBonus;return{total:Math.max(0,Math.round(r+s+o+l)),breakdown:{base:r,completion:s,streakBonus:o,comebackBonus:l}}}function qV(t){return t>=70?"mastered":t>=30?"progressing":"discovering"}function $S(t){const e={...t.masteryByTag||{}},n=t.isCorrect?8:2;return t.questionTags.forEach(r=>{const s=e[r]?.score||0,o=Math.max(0,Math.min(100,s+n));e[r]={score:o,state:qV(o),updatedAt:t.timestamp}}),e}function Kl(){return{createTimestamp:()=>at(),async runTransaction(t){return Di(we,async e=>t({async getRewards(r){const s=Oe(we,"users",r,"meta","rewards"),o=await e.get(s);return o.exists()?o.data():null},setRewards(r,s){const o=Oe(we,"users",r,"meta","rewards");e.set(o,s,{merge:!0})},async getRewardEvent(r,s){const o=Oe(we,"users",r,"rewardEvents",s),l=await e.get(o);return l.exists()?l.data():null},setRewardEvent(r,s,o){const l=Oe(we,"users",r,"rewardEvents",s);e.set(l,o)}}))}}}async function WV(t){const e=Oe(we,"users",t,"meta","rewards"),n=await hn(e);if(n.exists()){const s=n.data();return{xp:s.xp||0,level:s.level||1,coins:s.coins||0,badges:Array.isArray(s.badges)?s.badges:[],masteryByTag:typeof s.masteryByTag=="object"&&s.masteryByTag?s.masteryByTag:{},blockProgress:typeof s.blockProgress=="object"&&s.blockProgress?s.blockProgress:{},collectibles:s.collectibles&&Array.isArray(s.collectibles.owned)?{owned:s.collectibles.owned,equippedAvatarId:s.collectibles.equippedAvatarId??null}:{owned:[],equippedAvatarId:null},ownedCosmetics:typeof s.ownedCosmetics=="object"&&s.ownedCosmetics?s.ownedCosmetics:{},equippedCosmetics:typeof s.equippedCosmetics=="object"&&s.equippedCosmetics?s.equippedCosmetics:{},malocraft:s.malocraft&&Array.isArray(s.malocraft.ownedLootIds)?{ownedLootIds:s.malocraft.ownedLootIds,equippedAvatarId:s.malocraft.equippedAvatarId??null,biomeMilestones:s.malocraft.biomeMilestones||{}}:{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},zoneRebuildProgress:typeof s.zoneRebuildProgress=="object"&&s.zoneRebuildProgress?s.zoneRebuildProgress:{},biomeRebuildProgress:typeof s.biomeRebuildProgress=="object"&&s.biomeRebuildProgress?s.biomeRebuildProgress:{},updatedAt:s.updatedAt}}const r={xp:0,level:1,coins:0,badges:[],masteryByTag:{},blockProgress:{},collectibles:{owned:[],equippedAvatarId:null},ownedCosmetics:{},equippedCosmetics:{},malocraft:{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},zoneRebuildProgress:{},biomeRebuildProgress:{},updatedAt:at()};return await ds(e,r),r}async function HV(t,e,n,r=0,s=Kl()){if(n<=0&&r<=0)return await WV(t);let o=null;return await s.runTransaction(async l=>{const d=await l.getRewards(t),h=e?await l.getRewardEvent(t,e):null;if(e&&h){o=d?{...d,coins:d.coins||0}:{xp:0,level:1,coins:0};return}const f={xp:d?.xp||0,level:d?.level||1,coins:d?.coins||0,badges:Array.isArray(d?.badges)?d.badges:[],masteryByTag:typeof d?.masteryByTag=="object"&&d?.masteryByTag?d.masteryByTag:{},blockProgress:typeof d?.blockProgress=="object"&&d?.blockProgress?d.blockProgress:{},collectibles:d?.collectibles&&Array.isArray(d.collectibles.owned)?{owned:d.collectibles.owned,equippedAvatarId:d.collectibles.equippedAvatarId??null}:{owned:[],equippedAvatarId:null},ownedCosmetics:typeof d?.ownedCosmetics=="object"&&d.ownedCosmetics?d.ownedCosmetics:{},equippedCosmetics:typeof d?.equippedCosmetics=="object"&&d.equippedCosmetics?d.equippedCosmetics:{},malocraft:d?.malocraft&&Array.isArray(d.malocraft.ownedLootIds)?{ownedLootIds:d.malocraft.ownedLootIds,equippedAvatarId:d.malocraft.equippedAvatarId??null,biomeMilestones:d.malocraft.biomeMilestones||{}}:{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},zoneRebuildProgress:typeof d?.zoneRebuildProgress=="object"&&d.zoneRebuildProgress?d.zoneRebuildProgress:{},biomeRebuildProgress:typeof d?.biomeRebuildProgress=="object"&&d.biomeRebuildProgress?d.biomeRebuildProgress:{},updatedAt:d?.updatedAt},g=Math.max(0,(f.xp||0)+n),y=Math.max(0,(f.coins||0)+Math.max(0,r)),_=ya(g),x={xp:g,level:_.level,coins:y,badges:f.badges||[],masteryByTag:f.masteryByTag||{},blockProgress:f.blockProgress||{},collectibles:{owned:f.collectibles?.owned||[],equippedAvatarId:f.collectibles?.equippedAvatarId??null},ownedCosmetics:f.ownedCosmetics||{},equippedCosmetics:f.equippedCosmetics||{},malocraft:f.malocraft||{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},zoneRebuildProgress:f.zoneRebuildProgress||{},biomeRebuildProgress:f.biomeRebuildProgress||{},updatedAt:s.createTimestamp()};l.setRewards(t,x),e&&l.setRewardEvent(t,e,{sessionId:e,deltaXp:n,coinsEarned:r,awardedAt:s.createTimestamp()}),o=x}),o||{xp:0,level:1,coins:0}}async function KV(t,e=Kl()){const{uid:n,sessionId:r,items:s}=t,o=e.createTimestamp();await e.runTransaction(async l=>{const d=await l.getRewards(n),h={xp:d?.xp||0,level:d?.level||1,coins:d?.coins||0,badges:Array.isArray(d?.badges)?d.badges:[],masteryByTag:typeof d?.masteryByTag=="object"&&d?.masteryByTag?d.masteryByTag:{},blockProgress:typeof d?.blockProgress=="object"&&d?.blockProgress?d.blockProgress:{},collectibles:d?.collectibles,ownedCosmetics:d?.ownedCosmetics,equippedCosmetics:d?.equippedCosmetics,malocraft:d?.malocraft,zoneRebuildProgress:d?.zoneRebuildProgress,biomeRebuildProgress:d?.biomeRebuildProgress,updatedAt:d?.updatedAt},f=s.map(x=>({item:x,id:`${r}_${x.exerciseId}`})),g=await Promise.all(f.map(x=>l.getRewardEvent(n,x.id)));let y=h.masteryByTag||{},_=h.blockProgress||{};f.forEach((x,I)=>{if(g[I])return;const S=Array.isArray(x.item.tags)?x.item.tags:[];y=$S({masteryByTag:y,questionTags:S,isCorrect:x.item.correct,timestamp:o}),S.forEach(O=>{const B=_?.[O]||{attempts:0,correct:0,score:y?.[O]?.score||0},V=y?.[O]?.state||"discovering",$=y?.[O]?.score??B.score??0,F=(B.attempts||0)+1,H=(B.correct||0)+(x.item.correct?1:0),A=F>0?Math.round(H/F*100):0;_={..._,[O]:{state:V,score:$,attempts:F,correct:H,successRate:A,updatedAt:o}}})}),f.forEach((x,I)=>{if(g[I])return;const S=Array.isArray(x.item.tags)?x.item.tags:[];l.setRewardEvent(n,x.id,{sessionId:r,exerciseId:x.item.exerciseId,correct:x.item.correct,tags:S,createdAt:o})}),l.setRewards(n,{...h,masteryByTag:y,blockProgress:_,ownedCosmetics:h.ownedCosmetics||{},equippedCosmetics:h.equippedCosmetics||{},zoneRebuildProgress:h.zoneRebuildProgress||{},biomeRebuildProgress:h.biomeRebuildProgress||{},updatedAt:e.createTimestamp()})})}async function GV(t){const{uid:e,rewards:n}=t,r=[],s=Array.isArray(n.badges)?n.badges:[],o=await hn(Oe(we,"users",e,"stats","main")),l=await hn(Oe(we,"users",e,"progressSummary","main")),d=o.exists()?o.data():{},h=l.exists()?l.data():{},f=d.streakDays||0,g=h.totalAttempts||0,y=n.masteryByTag||{},_=Object.entries(y).filter(([,B])=>B?.state==="mastered").map(([B])=>B),I=(await br(kr(Rn(we,"users",e,"rewardEvents"),qn("correct","==",!1),Hl(5)))).size,k=B=>s.includes(B)||r.includes(B);!k("streak_3")&&f>=3&&r.push("streak_3"),!k("streak_7")&&f>=7&&r.push("streak_7"),!k("sessions_10")&&g>=10&&r.push("sessions_10"),!k("retry_5")&&I>=5&&r.push("retry_5");const S=_.length;if(!k("tag_master_3")&&S>=3&&r.push("tag_master_3"),!k("tag_master_10")&&S>=10&&r.push("tag_master_10"),!k("fractions_first_mastery")&&_.some(B=>B.startsWith("math_fractions"))&&r.push("fractions_first_mastery"),!k("grammar_first_mastery")&&_.some(B=>B.startsWith("fr_grammaire"))&&r.push("grammar_first_mastery"),!r.length)return[];const O=Oe(we,"users",e,"meta","rewards");return await Di(we,async B=>{const V=await B.get(O),$=V.exists()?V.data():{},F=Array.isArray($.badges)?$.badges:[],H=r.filter(A=>!F.includes(A));H.length&&(B.set(O,{badges:[...F,...H],updatedAt:at()},{merge:!0}),H.forEach(A=>{B.set(Oe(we,"users",e,"rewardEvents",`badge_${A}`),{type:"badge",badgeId:A,createdAt:at()})}))}),r}const ws={xp:0,level:1,coins:0,badges:[],masteryByTag:{},blockProgress:{},collectibles:{owned:[],equippedAvatarId:null},ownedCosmetics:{},equippedCosmetics:{},malocraft:{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},zoneRebuildProgress:{},biomeRebuildProgress:{}};function Ps(t){const[e,n]=j.useState(ws),[r,s]=j.useState(!!t);return j.useEffect(()=>{if(!t){n(ws),s(!1);return}const o=Oe(we,"users",t,"meta","rewards"),l=kS(o,d=>{if(d.exists()){const h=d.data();n({...ws,...h,blockProgress:h.blockProgress||ws.blockProgress,collectibles:h.collectibles||ws.collectibles,ownedCosmetics:h.ownedCosmetics||ws.ownedCosmetics,equippedCosmetics:h.equippedCosmetics||ws.equippedCosmetics,malocraft:h.malocraft||ws.malocraft,zoneRebuildProgress:h.zoneRebuildProgress||ws.zoneRebuildProgress,biomeRebuildProgress:h.biomeRebuildProgress||ws.biomeRebuildProgress})}else n(ws);s(!1)},()=>s(!1));return()=>l()},[t]),{rewards:e,loading:r}}function QV({rewards:t}){const{xp:e,level:n}=t||{xp:0,level:1},r=ya(e||0),s=Math.min(100,Math.max(0,Math.round(r.xpIntoLevel/r.xpForNext*100)));return c.jsxs("div",{className:"card",style:{display:"flex",flexDirection:"column",gap:6},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{fontWeight:800,fontSize:"1.05rem"},children:["Niveau ",r.level]}),c.jsxs("div",{className:"small",children:["XP total : ",e||0]})]}),c.jsxs("div",{className:"small",children:["Prochain niveau : ",r.xpIntoLevel,"/",r.xpForNext," XP"]}),c.jsx("div",{style:{height:12,background:"rgba(255,255,255,0.08)",borderRadius:999,overflow:"hidden"},children:c.jsx("div",{style:{height:"100%",width:`${s}%`,background:"linear-gradient(90deg,#7aa2ff,#2ecc71)",transition:"width 0.6s ease"}})})]})}const zS=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function qS(t){let e=t;return e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/`(.*?)`/g,"<code>$1</code>"),e}function XV(t){const e=t.match(/^(\#{1,6})\s+(.*)$/);if(!e)return null;const n=e[1].length;let r=e[2]||"";const s=r.match(/\s*\{#([^\}]+)\}\s*$/);let o=null;s&&(o=s[1],r=r.replace(/\s*\{#([^\}]+)\}\s*$/,""));const l=qS(zS(r.trim()));return`<h${n}${o?` id="${o}"`:""}>${l}</h${n}>`}function ra(t){return t?t.split(`
`).map(r=>{const s=XV(r);if(s)return s;const o=zS(r);return qS(o)}).join("<br />"):""}function Cg(t,e){if(!t||!e)return null;const n=e.replace(/^#/,"").trim();if(!n)return null;const r=t.split(`
`);let s=-1,o=0,l;for(let f=0;f<r.length;f++){const g=r[f].match(/^(\#{1,6})\s+(.*)$/);if(!g)continue;const y=g[2].match(/\{#([^\}]+)\}\s*$/);if(y&&y[1]===n){s=f,o=g[1].length,l=g[2].replace(/\s*\{#([^\}]+)\}\s*$/,"").trim();break}}if(s===-1)return null;const d=[r[s]];for(let f=s+1;f<r.length;f++){const g=r[f].match(/^(\#{1,6})\s+(.*)$/);if(g&&g[1].length<=o)break;d.push(r[f])}const h=d.join(`
`).trim();return h?{title:l,markdown:h}:null}function hx({title:t,content:e,lessonRef:n,mode:r="full",npcGuide:s}){const[o,l]=j.useState(r==="full");if(j.useEffect(()=>{l(r==="full")},[r,n]),!e)return null;const d=r==="contextual"&&n?Cg(e,n):null,h=!o&&d?d.markdown:e,f=!o&&!!d,g=d?.title,y=r==="contextual"&&!!d;return c.jsxs("div",{className:"card",style:{background:"rgba(122,162,255,0.08)",border:"1px solid rgba(122,162,255,0.35)"},children:[s?c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"flex-start",gap:10},children:[c.jsxs("div",{className:"row",style:{gap:10,alignItems:"flex-start"},children:[c.jsx("div",{style:{fontSize:"1.6rem"},children:s.avatar}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:s.name}),c.jsx("div",{style:{fontWeight:900},children:s.line||"Petit rappel disponible si tu en as besoin."}),n&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Section : ",g||n]})]})]}),c.jsxs("div",{className:"row",style:{gap:6,flexShrink:0},children:[y&&o&&c.jsx("button",{className:"btn secondary",onClick:()=>l(!1),children:"Voir la section"}),y&&!o&&c.jsx("button",{className:"btn secondary",onClick:()=>l(!0),children:"Voir toute la leon"}),s.ctaLabel&&c.jsx("button",{className:"btn secondary",onClick:s.onCta,children:s.ctaLabel})]})]}):c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:f?"Section cible":"Rappel de leon"}),c.jsx("div",{style:{fontWeight:900},children:f&&g?g:t||"Leon associe"}),n&&c.jsxs("div",{className:"small",children:["Section : ",g||n]})]}),c.jsxs("div",{className:"row",style:{gap:6},children:[y&&o&&c.jsx("button",{className:"btn secondary",onClick:()=>l(!1),children:"Voir la section"}),y&&!o&&c.jsx("button",{className:"btn secondary",onClick:()=>l(!0),children:"Voir toute la leon"}),c.jsx("span",{className:"badge",children:""})]})]}),c.jsx("div",{className:"small",style:{marginTop:8},dangerouslySetInnerHTML:{__html:ra(h||"")}})]})}function YV(t){const{accuracy:e,weakestTag:n,improvedTag:r}=t,s=n||r||"ce tag";return e<50?`On avance : demain, on reprend ${s} avec 5 minutes de rvision.`:e<80?`Bien jou : encore un effort sur ${s} et a passe.`:`Super : tu matrises bien ${r||s}, on peut monter dun cran.`}const Pi=[{id:"sticker_star",type:"sticker",title:"toile",description:"Une toile brillante",rarity:"common",icon:""},{id:"sticker_book",type:"sticker",title:"Livre",description:"Pour les champions de lecture",rarity:"common",icon:""},{id:"sticker_rocket",type:"sticker",title:"Fuse",description:"Dcollage vers la russite",rarity:"common",icon:""},{id:"sticker_pencil",type:"sticker",title:"Crayon",description:"Toujours prt  crire",rarity:"common",icon:""},{id:"sticker_thumbs",type:"sticker",title:"Bravo",description:"Pouce en lair",rarity:"common",icon:""},{id:"sticker_smile",type:"sticker",title:"Sourire",description:"Bonne humeur garantie",rarity:"common",icon:""},{id:"sticker_music",type:"sticker",title:"Musique",description:"Rythme et rvisions",rarity:"common",icon:""},{id:"sticker_leaf",type:"sticker",title:"Feuille",description:"Nature et calme",rarity:"common",icon:""},{id:"sticker_dragon",type:"sticker",title:"Dragon",description:"Gardien des savoirs",rarity:"rare",icon:""},{id:"sticker_moon",type:"sticker",title:"Lune",description:"Veille dtude",rarity:"rare",icon:""},{id:"sticker_robot",type:"sticker",title:"Robot",description:"Logique au top",rarity:"rare",icon:""},{id:"sticker_trophy",type:"sticker",title:"Trophe",description:"Petite victoire",rarity:"rare",icon:""},{id:"sticker_paint",type:"sticker",title:"Palette",description:"Crativit",rarity:"rare",icon:""},{id:"sticker_comet",type:"sticker",title:"Comte",description:"Vise toile",rarity:"rare",icon:""},{id:"sticker_camera",type:"sticker",title:"Camra",description:"Souvenir de russite",rarity:"rare",icon:""},{id:"sticker_ship",type:"sticker",title:"Navire",description:"Cap sur le savoir",rarity:"rare",icon:""},{id:"sticker_crown",type:"sticker",title:"Couronne",description:"Roi/Reine des rvisions",rarity:"epic",icon:""},{id:"sticker_phoenix",type:"sticker",title:"Phnix",description:"Toujours se relever",rarity:"epic",icon:""},{id:"sticker_unicorn",type:"sticker",title:"Licorne",description:"Magie de la russite",rarity:"epic",icon:""},{id:"sticker_saturn",type:"sticker",title:"Saturne",description:"Orbitant autour du savoir",rarity:"epic",icon:""},{id:"sticker_mountain",type:"sticker",title:"Montagne",description:"Sommet atteint",rarity:"epic",icon:""},{id:"sticker_aurora",type:"sticker",title:"Aurore",description:"Lumire des ides",rarity:"epic",icon:""},{id:"sticker_magic",type:"sticker",title:"Magicien",description:"Tour de matrise",rarity:"epic",icon:""},{id:"sticker_dragon_gold",type:"sticker",title:"Dragon dor",description:"Gloire ultime",rarity:"epic",icon:""},{id:"avatar_basic_boy",type:"avatar",title:"Aventurier",description:"Prt  apprendre",rarity:"common",icon:""},{id:"avatar_basic_girl",type:"avatar",title:"Exploratrice",description:"Curieuse et motive",rarity:"common",icon:""},{id:"avatar_scientist",type:"avatar",title:"Scientifique",description:"Fan dexpriences",rarity:"rare",icon:""},{id:"avatar_astronaut",type:"avatar",title:"Astronaute",description:"Toujours plus haut",rarity:"rare",icon:""},{id:"avatar_artist",type:"avatar",title:"Artiste",description:"Crativit au max",rarity:"common",icon:""},{id:"avatar_knight",type:"avatar",title:"Chevalier",description:"Protge ses progrs",rarity:"rare",icon:""},{id:"avatar_ninja",type:"avatar",title:"Ninja",description:"Rapide et prcis",rarity:"epic",icon:""},{id:"avatar_robot",type:"avatar",title:"Robot",description:"Logique imparable",rarity:"rare",icon:""},{id:"avatar_dragon_tamer",type:"avatar",title:"Dompte-dragon",description:"Matrise totale",rarity:"epic",icon:""},{id:"avatar_pirate",type:"avatar",title:"Pirate",description:"Cap sur les objectifs",rarity:"common",icon:""},{id:"avatar_superhero",type:"avatar",title:"Hros",description:"Sauveur des devoirs",rarity:"epic",icon:""},{id:"avatar_bard",type:"avatar",title:"Barde",description:"Chante ses progrs",rarity:"rare",icon:""}],JV=[{rarity:"common",weight:.8},{rarity:"rare",weight:.18},{rarity:"epic",weight:.02}];function ZV(t){const e=t();let n=0;for(const{rarity:r,weight:s}of JV)if(n+=s,e<=n)return r;return"common"}function eO(t=[],e={}){const n=e.rng||Math.random,r=new Set(t||[]);let s=null,o=0;for(;o<4&&s===null;){const d=ZV(n),h=Pi.filter(f=>f.rarity===d&&!r.has(f.id));if(h.length){s=h[Math.floor(n()*h.length)].id;break}o++}if(s)return s;const l=Pi.filter(d=>d.rarity==="common"&&!r.has(d.id));return l.length?l[Math.floor((e.rng||Math.random)()*l.length)].id:null}async function av(t,e,n){const r=Pi.find(l=>l.id===e);if(!r)throw new Error("Collectible inconnu");const s=Oe(we,"users",t,"meta","rewards"),o=n?Oe(we,"users",t,"rewardEvents",n):null;await Di(we,async l=>{const[d,h]=await Promise.all([l.get(s),o?l.get(o):Promise.resolve(null)]);if(h&&h.exists())return;const f=d.exists()?d.data():null,g={xp:f?.xp||0,level:f?.level||1,badges:Array.isArray(f?.badges)?f.badges:[],masteryByTag:typeof f?.masteryByTag=="object"&&f?.masteryByTag?f.masteryByTag:{},collectibles:f?.collectibles&&Array.isArray(f.collectibles.owned)?f.collectibles:{owned:[],equippedAvatarId:null},updatedAt:f?.updatedAt},y=new Set(g.collectibles?.owned||[]);y.add(e);const _=r.type==="avatar"&&!g.collectibles?.equippedAvatarId;l.set(s,{collectibles:{owned:Array.from(y),equippedAvatarId:_?e:g.collectibles?.equippedAvatarId??null},updatedAt:at()},{merge:!0}),o&&l.set(o,{type:"collectible",collectibleId:e,createdAt:at()})})}async function lv(t,e){if(!Pi.find(s=>s.id===e&&s.type==="avatar"))throw new Error("Avatar inconnu");const r=Oe(we,"users",t,"meta","rewards");await Di(we,async s=>{const o=await s.get(r),l=o.exists()?o.data():null,d=new Set(l?.collectibles?.owned||[]);if(!d.has(e))throw new Error("Avatar non possd");s.set(r,{collectibles:{owned:Array.from(d),equippedAvatarId:e},updatedAt:at()},{merge:!0})})}const ca={fr:"Franais",math:"Mathmatiques",en:"Anglais",es:"Espagnol",hist:"Histoire-Gographie"},tO={discovering:"En dcouverte",progressing:"En progrs",mastered:"Matris"},nO={discovering:"Tu commences",progressing:"Tu consolides",mastered:"Cest acquis"};function rO(t){return t.replace(/^(fr|math|en|es|hist)_/i,"").replace(/_/g," ").replace(/\s+/g," ").trim().replace(/^./,e=>e.toUpperCase())}function Ag(t){const e=t.toLowerCase();return e.startsWith("math_")?"math":e.startsWith("en_")?"en":e.startsWith("es_")?"es":e.startsWith("hist_")?"hist":"fr"}function Qt(t){return As[t]??{id:t,label:rO(t),subject:Ag(t),theme:"Autres",order:9999,description:"Tag non catalogu (affichage automatique)."}}const As={fr_comprehension_idee_principale:{id:"fr_comprehension_idee_principale",label:"Ide principale",description:"Trouver le message global du texte.",subject:"fr",theme:"Comprhension",order:10},fr_comprehension_detail:{id:"fr_comprehension_detail",label:"Informations explicites",description:"Reprer une info donne directement.",subject:"fr",theme:"Comprhension",order:20},fr_comprehension_inference:{id:"fr_comprehension_inference",label:"Infrences",description:"Dduire une info implicite.",subject:"fr",theme:"Comprhension",order:30},fr_comprehension_vocabulaire_contexte:{id:"fr_comprehension_vocabulaire_contexte",label:"Vocabulaire en contexte",description:"Comprendre un mot grce au contexte.",subject:"fr",theme:"Comprhension",order:40},fr_comprehension_pronom_referent:{id:"fr_comprehension_pronom_referent",label:"Rfrents des pronoms",description:"Identifier  qui/quoi renvoie un pronom.",subject:"fr",theme:"Comprhension",order:50},fr_comprehension_connecteurs_logiques:{id:"fr_comprehension_connecteurs_logiques",label:"Connecteurs logiques",description:"Comprendre le lien entre les ides (cause, consquence).",subject:"fr",theme:"Comprhension",order:60},fr_comprehension_chronologie:{id:"fr_comprehension_chronologie",label:"Chronologie",description:"Reconstituer lordre des vnements.",subject:"fr",theme:"Comprhension",order:70},fr_comprehension_point_de_vue:{id:"fr_comprehension_point_de_vue",label:"Point de vue / narrateur",description:"Identifier qui parle et comment.",subject:"fr",theme:"Comprhension",order:80},fr_comprehension_intention_auteur:{id:"fr_comprehension_intention_auteur",label:"Intention du texte",description:"Informer, convaincre, raconter, expliquer",subject:"fr",theme:"Comprhension",order:90},fr_lexique_synonyme:{id:"fr_lexique_synonyme",label:"Synonymes",description:"Choisir le mot de sens proche.",subject:"fr",theme:"Lexique",order:110},fr_lexique_antonyme:{id:"fr_lexique_antonyme",label:"Antonymes",description:"Trouver le mot de sens contraire.",subject:"fr",theme:"Lexique",order:120},fr_lexique_famille_mots:{id:"fr_lexique_famille_mots",label:"Familles de mots",description:"Reconnatre des mots de mme famille.",subject:"fr",theme:"Lexique",order:130},fr_lexique_niveaux_langue:{id:"fr_lexique_niveaux_langue",label:"Niveaux de langue",description:"Soutenu, courant, familier.",subject:"fr",theme:"Lexique",order:140},fr_lexique_sens_propre_figure:{id:"fr_lexique_sens_propre_figure",label:"Sens propre / figur",description:"Distinguer sens littral et image.",subject:"fr",theme:"Lexique",order:150},fr_grammaire_classes_mots:{id:"fr_grammaire_classes_mots",label:"Classes de mots",description:"Nom, verbe, adjectif, pronom, dterminant",subject:"fr",theme:"Grammaire",order:210},fr_grammaire_fonctions:{id:"fr_grammaire_fonctions",label:"Fonctions",description:"Sujet, COD/COI, complments, attribut",subject:"fr",theme:"Grammaire",order:220},fr_grammaire_fonction_cod:{id:"fr_grammaire_fonction_cod",label:"Fonction : COD",description:"Reprer le complment dobjet direct (quoi/qui).",subject:"fr",theme:"Grammaire",order:225},fr_grammaire_gn_gv:{id:"fr_grammaire_gn_gv",label:"Groupe nominal / verbal",description:"Identifier GN et GV.",subject:"fr",theme:"Grammaire",order:230},fr_grammaire_phrase_simple_complexe:{id:"fr_grammaire_phrase_simple_complexe",label:"Phrase simple / complexe",description:"Nombre de verbes conjugus, propositions.",subject:"fr",theme:"Grammaire",order:240},fr_grammaire_propositions:{id:"fr_grammaire_propositions",label:"Propositions",description:"Identifier proposition principale et subordonne.",subject:"fr",theme:"Grammaire",order:250},fr_grammaire_coordination_juxtaposition:{id:"fr_grammaire_coordination_juxtaposition",label:"Coordination / juxtaposition",description:"Et/mais/donc ou virgules/point-virgule.",subject:"fr",theme:"Grammaire",order:260},fr_grammaire_subordination:{id:"fr_grammaire_subordination",label:"Subordination",description:"Introduite par une conjonction / pronom relatif.",subject:"fr",theme:"Grammaire",order:270},fr_grammaire_proposition_relative:{id:"fr_grammaire_proposition_relative",label:"Proposition relative",description:"Relative introduite par qui/que/dont/o",subject:"fr",theme:"Grammaire",order:280},fr_grammaire_completive:{id:"fr_grammaire_completive",label:"Subordonne compltive",description:"Introduite par que/si, complte un verbe.",subject:"fr",theme:"Grammaire",order:290},fr_grammaire_circonstancielle:{id:"fr_grammaire_circonstancielle",label:"Subordonne circonstancielle",description:"Temps, cause, consquence, but, condition",subject:"fr",theme:"Grammaire",order:300},fr_grammaire_negation:{id:"fr_grammaire_negation",label:"Ngation",description:"Ne pas / jamais / plus / rien / personne",subject:"fr",theme:"Grammaire",order:310},fr_grammaire_interrogation:{id:"fr_grammaire_interrogation",label:"Interrogation",description:"Totale / partielle, formes et mots interrogatifs.",subject:"fr",theme:"Grammaire",order:320},fr_grammaire_voix_active_passive:{id:"fr_grammaire_voix_active_passive",label:"Voix active / passive",description:"Transformer une phrase.",subject:"fr",theme:"Grammaire",order:330},fr_grammaire_discours_direct_indirect:{id:"fr_grammaire_discours_direct_indirect",label:"Discours direct / indirect",description:"Transformer une parole rapporte.",subject:"fr",theme:"Grammaire",order:340},fr_conjugaison_present:{id:"fr_conjugaison_present",label:"Prsent",subject:"fr",theme:"Conjugaison",order:410},fr_conjugaison_imparfait:{id:"fr_conjugaison_imparfait",label:"Imparfait",subject:"fr",theme:"Conjugaison",order:420},fr_conjugaison_passe_simple:{id:"fr_conjugaison_passe_simple",label:"Pass simple",subject:"fr",theme:"Conjugaison",order:430},fr_conjugaison_futur_simple:{id:"fr_conjugaison_futur_simple",label:"Futur simple",subject:"fr",theme:"Conjugaison",order:440},fr_conjugaison_passe_compose:{id:"fr_conjugaison_passe_compose",label:"Pass compos",subject:"fr",theme:"Conjugaison",order:450},fr_conjugaison_plus_que_parfait:{id:"fr_conjugaison_plus_que_parfait",label:"Plus-que-parfait",subject:"fr",theme:"Conjugaison",order:460},fr_conjugaison_conditionnel_present:{id:"fr_conjugaison_conditionnel_present",label:"Conditionnel prsent",subject:"fr",theme:"Conjugaison",order:470},fr_conjugaison_imperatif:{id:"fr_conjugaison_imperatif",label:"Impratif",subject:"fr",theme:"Conjugaison",order:480},fr_conjugaison_subjonctif_present:{id:"fr_conjugaison_subjonctif_present",label:"Subjonctif prsent",subject:"fr",theme:"Conjugaison",order:490},fr_conjugaison_valeurs_temps:{id:"fr_conjugaison_valeurs_temps",label:"Valeurs des temps",description:"Imparfait (description/habitude), pass simple (actions)",subject:"fr",theme:"Conjugaison",order:500},fr_conjugaison_accord_participe_passe:{id:"fr_conjugaison_accord_participe_passe",label:"Accord du participe pass",description:"Avec tre/avoir (rgles de base).",subject:"fr",theme:"Conjugaison",order:510},fr_orthographe_accord_gn:{id:"fr_orthographe_accord_gn",label:"Accords dans le GN",description:"Dterminant/nom/adjectif.",subject:"fr",theme:"Orthographe",order:610},fr_orthographe_accord_sujet_verbe:{id:"fr_orthographe_accord_sujet_verbe",label:"Accord sujet-verbe",subject:"fr",theme:"Orthographe",order:620},fr_orthographe_homophones_grammaticaux:{id:"fr_orthographe_homophones_grammaticaux",label:"Homophones grammaticaux",description:"a/, et/est, son/sont, ces/ses",subject:"fr",theme:"Orthographe",order:630},fr_orthographe_punctuation:{id:"fr_orthographe_punctuation",label:"Ponctuation",subject:"fr",theme:"Orthographe",order:640},math_fractions_vocabulaire:{id:"math_fractions_vocabulaire",label:"Vocabulaire des fractions",description:"Numrateur/dnominateur, fraction dune quantit",subject:"math",theme:"Fractions",order:10},math_fractions_representer:{id:"math_fractions_representer",label:"Reprsenter une fraction",description:"Sur une figure / droite gradue.",subject:"math",theme:"Fractions",order:20},math_fractions_equivalentes:{id:"math_fractions_equivalentes",label:"Fractions quivalentes",subject:"math",theme:"Fractions",order:30},math_fractions_simplifier:{id:"math_fractions_simplifier",label:"Simplifier une fraction",subject:"math",theme:"Fractions",order:40},math_fractions_comparer:{id:"math_fractions_comparer",label:"Comparer des fractions",subject:"math",theme:"Fractions",order:50},math_fractions_ordonner:{id:"math_fractions_ordonner",label:"Ordonner des fractions",subject:"math",theme:"Fractions",order:60},math_fractions_addition:{id:"math_fractions_addition",label:"Addition de fractions",subject:"math",theme:"Fractions",order:70},math_fractions_soustraction:{id:"math_fractions_soustraction",label:"Soustraction de fractions",subject:"math",theme:"Fractions",order:80},math_fractions_multiplication:{id:"math_fractions_multiplication",label:"Multiplication de fractions",subject:"math",theme:"Fractions",order:90},math_fractions_division:{id:"math_fractions_division",label:"Division par une fraction",subject:"math",theme:"Fractions",order:100},math_fractions_problemes:{id:"math_fractions_problemes",label:"Problmes avec fractions",subject:"math",theme:"Fractions",order:110},math_nombres_entiers:{id:"math_nombres_entiers",label:"Nombres entiers",subject:"math",theme:"Nombres & calcul",order:210},math_nombres_decimaux:{id:"math_nombres_decimaux",label:"Nombres dcimaux",subject:"math",theme:"Nombres & calcul",order:220},math_priorites_operatoires:{id:"math_priorites_operatoires",label:"Priorits opratoires",subject:"math",theme:"Nombres & calcul",order:230},math_calcul_mental:{id:"math_calcul_mental",label:"Calcul mental",subject:"math",theme:"Nombres & calcul",order:240},math_puissances_base:{id:"math_puissances_base",label:"Puissances (bases)",subject:"math",theme:"Nombres & calcul",order:250},math_geometrie_angles:{id:"math_geometrie_angles",label:"Angles",subject:"math",theme:"Gomtrie",order:310},math_geometrie_triangles:{id:"math_geometrie_triangles",label:"Triangles",subject:"math",theme:"Gomtrie",order:320},math_geometrie_paralleles:{id:"math_geometrie_paralleles",label:"Droites parallles/perpendiculaires",subject:"math",theme:"Gomtrie",order:330},math_geometrie_symetrie_axiale:{id:"math_geometrie_symetrie_axiale",label:"Symtrie axiale",subject:"math",theme:"Gomtrie",order:340},math_geometrie_cercle:{id:"math_geometrie_cercle",label:"Cercle",subject:"math",theme:"Gomtrie",order:350},math_mesures_perimetre:{id:"math_mesures_perimetre",label:"Primtre",subject:"math",theme:"Grandeurs & mesures",order:410},math_mesures_aire:{id:"math_mesures_aire",label:"Aire",subject:"math",theme:"Grandeurs & mesures",order:420},math_mesures_volumes:{id:"math_mesures_volumes",label:"Volumes (bases)",subject:"math",theme:"Grandeurs & mesures",order:430},math_mesures_unites_conversions:{id:"math_mesures_unites_conversions",label:"Conversions dunits",subject:"math",theme:"Grandeurs & mesures",order:440},math_proportionnalite_tableaux:{id:"math_proportionnalite_tableaux",label:"Tableaux de proportionnalit",subject:"math",theme:"Proportionnalit",order:510},math_proportionnalite_pourcentages:{id:"math_proportionnalite_pourcentages",label:"Pourcentages (bases)",subject:"math",theme:"Proportionnalit",order:520},math_proportionnalite_echelles:{id:"math_proportionnalite_echelles",label:"chelles (bases)",subject:"math",theme:"Proportionnalit",order:530},en_vocab_daily_life:{id:"en_vocab_daily_life",label:"Vocabulaire du quotidien",subject:"en",theme:"Vocabulaire",order:10},en_vocab_school:{id:"en_vocab_school",label:"Vocabulaire de lcole",subject:"en",theme:"Vocabulaire",order:20},en_grammar_pronouns:{id:"en_grammar_pronouns",label:"Pronoms",subject:"en",theme:"Grammaire",order:110},en_grammar_present_simple:{id:"en_grammar_present_simple",label:"Present simple",subject:"en",theme:"Grammaire",order:120},en_grammar_present_continuous:{id:"en_grammar_present_continuous",label:"Present continuous",subject:"en",theme:"Grammaire",order:130},en_grammar_past_simple:{id:"en_grammar_past_simple",label:"Past simple",subject:"en",theme:"Grammaire",order:140},en_grammar_future:{id:"en_grammar_future",label:"Future (will / be going to)",subject:"en",theme:"Grammaire",order:150},en_comprehension_short_text:{id:"en_comprehension_short_text",label:"Comprhension de texte court",subject:"en",theme:"Comprhension",order:210},en_comprehension_inference:{id:"en_comprehension_inference",label:"Infrences (anglais)",subject:"en",theme:"Comprhension",order:220},es_vocab_daily_life:{id:"es_vocab_daily_life",label:"Vocabulaire du quotidien",subject:"es",theme:"Vocabulaire",order:10},es_vocab_school:{id:"es_vocab_school",label:"Vocabulaire de lcole",subject:"es",theme:"Vocabulaire",order:20},es_grammar_pronouns:{id:"es_grammar_pronouns",label:"Pronoms",subject:"es",theme:"Grammaire",order:110},es_grammar_present:{id:"es_grammar_present",label:"Prsent de lindicatif",subject:"es",theme:"Grammaire",order:120},es_grammar_past:{id:"es_grammar_past",label:"Pass (bases)",subject:"es",theme:"Grammaire",order:130},es_comprehension_short_text:{id:"es_comprehension_short_text",label:"Comprhension de texte court",subject:"es",theme:"Comprhension",order:210},hist_methodes_chronologie:{id:"hist_methodes_chronologie",label:"Chronologie",description:"Situer et ordonner des vnements.",subject:"hist",theme:"Mthodes",order:10},hist_methodes_documents:{id:"hist_methodes_documents",label:"Lire un document",description:"Identifier nature, auteur, contexte, intention.",subject:"hist",theme:"Mthodes",order:20},hist_geo_cartes:{id:"hist_geo_cartes",label:"Lire une carte",description:"Lgende, chelle, orientation.",subject:"hist",theme:"Gographie",order:110},hist_geo_paysages:{id:"hist_geo_paysages",label:"tudier un paysage",subject:"hist",theme:"Gographie",order:120},hist_reperes_ancien_regime:{id:"hist_reperes_ancien_regime",label:"Repres historiques (bases)",description:"Placer quelques priodes/sicles.",subject:"hist",theme:"Repres",order:210},hist_reperes_moyen_age:{id:"hist_reperes_moyen_age",label:"Moyen ge (repres)",subject:"hist",theme:"Repres",order:220},hist_reperes_islam_moyen_age:{id:"hist_reperes_islam_moyen_age",label:"Islam mdival (repres)",subject:"hist",theme:"Repres",order:230},hist_reperes_renaissance:{id:"hist_reperes_renaissance",label:"Renaissance (repres)",subject:"hist",theme:"Repres",order:240},meta_transfert:{id:"meta_transfert",label:"Transfert de mthode",description:"Rutiliser une stratgie dans un autre contexte.",subject:"fr",theme:"Mthode",order:900}},al=Object.keys(As);async function kl(t){if(!t)return al;try{const e=Oe(we,"users",t,"meta","npcPriorities"),n=await hn(e);if(!n.exists())return al;const r=n.data(),s=Array.isArray(r?.tags)?r.tags:[],o=new Set(al),l=s.filter(d=>typeof d=="string"&&o.has(d));return l.length?l:al}catch{return al}}async function WS(t,e){if(!t)return;const n=new Set(al),r=e.filter(s=>n.has(s));await ds(Oe(we,"users",t,"meta","npcPriorities"),{tags:r},{merge:!0})}const xs={targets:{session:1,remediation:3,progress:5},xpRewards:{session:10,remediation:20,progress:15,dailyBonus:30},sticker:{enabled:!0,rarity:"common"}};function Xh(){const t=new Date,n=new Intl.DateTimeFormat("fr-FR",{timeZone:"Europe/Paris",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),r=n.find(l=>l.type==="year")?.value,s=n.find(l=>l.type==="month")?.value,o=n.find(l=>l.type==="day")?.value;return`${r}-${s}-${o}`}function sO(t,e){if(!t)return null;const n=Object.entries(t).filter(([s,o])=>typeof o?.score=="number"&&!!Qt(s)&&(!e||e.has(s)));if(!n.length)return null;const r=n.filter(([,s])=>(s?.score??0)<50);return r.length&&r.sort((s,o)=>(s[1].score??0)-(o[1].score??0))[0]?.[0]||null}function iO(t,e,n){if(!t)return null;const r=Object.entries(t).filter(([o,l])=>typeof l?.score=="number"&&!!Qt(o)&&o!==e&&(!n||n.has(o)));if(!r.length)return null;const s=r.filter(([,o])=>(o?.score??0)>=30&&(o?.score??0)<80);return s.length&&s.sort((o,l)=>(l[1].score??0)-(o[1].score??0))[0]?.[0]||null}function ih(t){return t?Qt(t)?.label||t:null}function HS(t,e){const n=e?.priorityTags,r=sO(t,n),s=iO(t,r,n),o={id:"session",type:"session",title:"Session du jour",description:"Fais au moins une session complte aujourdhui.",target:xs.targets.session,progress:0,completed:!1},l={id:r?`remediation:${r}`:"remediation",type:"remediation",title:"Remdiation cible",description:r?`Renforce ${ih(r)} avec des rponses correctes.`:"On sentrane un peu aujourdhui, puis on reviendra sur des notions plus cibles.",target:xs.targets.remediation,progress:0,completed:!1,tagId:r||null,tagHint:r?ih(r):null},d={id:s?`progress:${s}`:"progress",type:"progress",title:"Valorisation / amlioration",description:s?`Amliore ${ih(s)} en enchanant des bonnes rponses.`:"On sentrane un peu aujourdhui, puis on reviendra sur des notions plus cibles.",target:xs.targets.progress,progress:0,completed:!1,tagId:s||null,tagHint:s?ih(s):null};return[o,l,d]}async function KS(t){const e=Xh(),n=Oe(we,"users",t,"meta","daily"),[r,s,o]=await Promise.all([hn(n),hn(Oe(we,"users",t,"meta","rewards")),kl(t)]),l=new Set(o||[]),d=r.exists()?r.data():null;if(!d||d.dateKey!==e){const h=s.exists()?s.data():void 0,f=HS(h?.masteryByTag||{},{priorityTags:l}),g={dateKey:e,quests:f,bonusAwarded:!1,updatedAt:at()};return await ds(n,g),g}return d}async function oO(t){const{uid:e,sessionId:n,answeredCount:r,tagsUsed:s,tagStats:o={}}=t,l=Oe(we,"users",e,"meta","daily"),d=Oe(we,"users",e,"meta","rewards"),h=Oe(we,"users",e,"rewardEvents",`daily_${n}`),f=Oe(we,"users",e,"rewardEvents",`daily_bonus_${Xh()}`),g=Xh();await KS(e);let y=null,_=!1;if(await Di(we,async x=>{const[I,k,S,O]=await Promise.all([x.get(l),x.get(h),x.get(d),x.get(f)]);if(k.exists())return;const B=I.exists()?I.data():null;if(!B||B.dateKey!==g){const C=S.exists()?S.data():void 0,N=new Set(await kl(e));x.set(l,{dateKey:g,quests:HS(C?.masteryByTag||{},{priorityTags:N}),bonusAwarded:!1,updatedAt:at()});return}const V=s||[],$=V.filter(C=>C.includes("grammaire")||C.includes("grammar")).length,F=V.filter(C=>C.startsWith("math_fractions")).length,H={...o};!Object.keys(H).length&&V.length&&V.forEach(C=>{const N=H[C]||{answered:0,correct:0};N.answered+=1,N.correct+=1,H[C]=N});let A=0,E=!1,P=B.bonusAwarded||!1;const L=B.quests.map(C=>{let N=0;if(C.id==="session_one"&&(N=1),C.id==="answer_ten"&&(N=r),C.id==="grammar_one"&&(N=$>0?1:0),C.id==="fractions_five"&&(N=F),C.type==="session"&&(N=1),C.type==="remediation"){const q=C.tagId||V.find(W=>W.includes("grammar")||W.includes("math_fractions"))||null;q?N=(H[q]||{correct:0}).correct||0:N=r>0?Math.min(3,r):0}if(C.type==="progress"){const q=C.tagId||V[0]||null;q?N=(H[q]||{correct:0}).correct||0:N=r>0?Math.min(5,r):0}const M=Math.min(C.target,(C.progress||0)+N),ie=C.completed,te=M>=C.target;if(te&&!ie){E=!0;const q=C.type||(C.id==="session_one"?"session":C.id==="grammar_one"?"remediation":"progress");A+=xs.xpRewards[q]||xs.xpRewards.progress}return{...C,progress:M,completed:te}});if(E&&xs.sticker.enabled){const C=S.exists()?S.data():{},M=(C?.xp||0)+A,ie=ya(M);x.set(d,{xp:M,level:ie.level,badges:C?.badges||[],masteryByTag:C?.masteryByTag||{},collectibles:C?.collectibles?{owned:C.collectibles.owned||[],equippedAvatarId:C.collectibles.equippedAvatarId??null}:{owned:[],equippedAvatarId:null},updatedAt:at()},{merge:!0});const te=new Set(C?.collectibles?.owned||[]),q=Pi.filter(W=>W.rarity===xs.sticker.rarity&&W.type==="sticker"&&!te.has(W.id));q.length&&(y=q[Math.floor(Math.random()*q.length)].id)}if(_=L.every(C=>C.completed),_&&!O.exists()&&!P){const C=S.exists()?S.data():{},N=C?.xp||0,M=C?.coins||0;A+=xs.xpRewards.dailyBonus;const ie=10,te=N+A,q=ya(te);x.set(d,{xp:te,level:q.level,coins:M+ie,badges:C?.badges||[],masteryByTag:C?.masteryByTag||{},collectibles:C?.collectibles?{owned:C.collectibles.owned||[],equippedAvatarId:C.collectibles.equippedAvatarId??null}:{owned:[],equippedAvatarId:null},updatedAt:at()},{merge:!0}),x.set(f,{dateKey:g,type:"daily_bonus",coinsAwarded:ie,createdAt:at()}),P=!0}x.set(l,{dateKey:g,quests:L,bonusAwarded:P,updatedAt:at()},{merge:!0}),x.set(h,{sessionId:n,createdAt:at()})}),y)try{await av(e,y,`daily_sticker_${n}`)}catch(x){console.error("unlockCollectible daily",x)}return{allCompleted:_}}async function fx(t){const{uid:e}=t,n=t.dateKey||Xh(),r=t.sessionsDelta??0,s=t.xpDelta??0,o=Oe(we,"users",e,"statsDays",n);await ds(o,{dateKey:n,sessions:r,xp:s,updatedAt:at()},{merge:!0})}async function aO(t){const e=Rn(we,"users",t,"statsDays");return(await br(kr(e,nv("dateKey","desc"),Hl(7)))).docs.map(s=>s.data()).sort((s,o)=>s.dateKey.localeCompare(o.dateKey))}const lO="mine",mx={discovering:[1,2],progressing:[1,2,3],mastered:[2,3,4]};function Df(t,e){const n=[...e].filter(s=>s.tagIds?.includes(t)).sort((s,o)=>(o.ts||0)-(s.ts||0)).slice(0,10);if(n.filter(s=>!s.correct).length>=4)return!0;for(let s=0;s<n.length-1;s++)if(!n[s].correct&&!n[s+1].correct)return!0;return!1}function cO(t,e,n,r){const s=t.tags||t.tagIds||[],o=t.id||t.questionId;let l=0;const d=Date.now(),h=r.filter(k=>k.questionId===o).sort((k,S)=>(S.ts||0)-(k.ts||0)),f=h.length,g=h[0]?.ts;s.includes(e.targetTagId)&&(l+=100),(e.secondaryTagIds||[]).some(k=>s.includes(k))&&(l+=30),f||(l+=20),f>0&&f<3&&(l+=10);const y=h.filter(k=>!k.correct),_=d-1800*1e3;y.some(k=>(k.ts||0)<_)&&(l+=15),[...r].sort((k,S)=>(S.ts||0)-(k.ts||0)).slice(0,10).some(k=>k.questionId===o)&&(l-=50);const I=d-1440*60*1e3;return g&&g>I&&(l-=20),n==="repair"&&s.includes(e.targetTagId)&&y.length&&(l+=25),l}function uO(t,e){const n=new Set(e);return t.filter(r=>{const s=typeof r.difficulty=="number"?r.difficulty:1;return n.has(s)||n.has(4)&&s===3})}function dO(t,e){if(!Array.isArray(t)||t.length===0)return[];const n=e.masteryByTag?.[e.targetTagId]?.state||"discovering",r=mx[n]||mx.discovering,s=e.expedition||lO,o=Df(e.targetTagId,e.history||[]),l=s==="mine"&&o?"repair":s,d=uO(t,r);if(!d.length)return[];const h={};d.forEach(V=>{const $=V.id||V.questionId;h[$]=V});const g=Object.values(h).map(V=>({question:V,score:cO(V,e,l,e.history||[])})).sort((V,$)=>$.score-V.score),y=g.filter(({question:V})=>(V.tags||V.tagIds||[]).includes(e.targetTagId)),_=new Set(e.secondaryTagIds||[]),x=g.filter(({question:V})=>(V.tags||V.tagIds||[]).some($=>_.has($))),I=g.filter(({question:V})=>{const $=V.tags||V.tagIds||[];return!$.includes(e.targetTagId)&&!$.some(F=>_.has(F))}),k=(V,$,F)=>{const H=[];for(const A of V){const E=A.question.id||A.question.questionId;if(!F.has(E)&&(H.push(A.question),F.add(E),H.length>=$))break}return H},S=Math.max(1,e.desiredCount),O=new Set;let B=[];if(l==="craft"){const V=g.filter(({question:A})=>{const E=A.tags||A.tagIds||[];return E.includes(e.targetTagId)&&E.some(P=>_.has(P))}),$=[];let F=0;for(;$.length<S&&F<Math.max(y.length,x.length);)y[F]&&$.push(y[F]),x[F]&&$.push(x[F]),F++;const H=[...V,...$,...g];for(const A of H){const E=A.question.id||A.question.questionId;if(!O.has(E)&&(B.push(A.question),O.add(E),B.length>=S))break}}else{const V=l==="repair"?Math.max(1,Math.round(S*.9)):Math.max(1,Math.round(S*.8));B=[...k(y,V,O),...k(I,S-V,O)],B.length<S&&(B=[...B,...k(g,S-B.length,O)])}return B.slice(0,S)}const bu=[{id:"sticker_foret_feuille",type:"sticker",rarity:"common",title:"Feuille de la Fort",description:"Un souvenir de la Fort de la Langue.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"sticker_foret_ecorce",type:"sticker",rarity:"common",title:"corce runique",description:"Rune grave en franais.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"sticker_mines_gemme",type:"sticker",rarity:"common",title:"Gemme des Mines",description:"Fragment mathmatique scintillant.",icon:"",biomeId:"biome_math_mines"},{id:"sticker_mines_pelle",type:"sticker",rarity:"common",title:"Pelle robuste",description:"Pour creuser des nombres.",icon:"",biomeId:"biome_math_mines"},{id:"sticker_en_drapeau",type:"sticker",rarity:"common",title:"Village Anglais",description:"Blason du village.",icon:"",biomeId:"biome_en_village"},{id:"sticker_en_thatch",type:"sticker",rarity:"common",title:"Chaumire cosy",description:"Toit de paille du village.",icon:"",biomeId:"biome_en_village"},{id:"sticker_es_guitarra",type:"sticker",rarity:"common",title:"Guitarra",description:"Cordes vibrantes dEspagne.",icon:"",biomeId:"biome_es_village"},{id:"sticker_es_fiesta",type:"sticker",rarity:"common",title:"Fiesta",description:"Confettis du village espagnol.",icon:"",biomeId:"biome_es_village"},{id:"sticker_hist_boussole",type:"sticker",rarity:"common",title:"Boussole des Plaines",description:"Toujours orient.",icon:"",biomeId:"biome_hist_plaines"},{id:"sticker_hist_parchemin",type:"sticker",rarity:"common",title:"Parchemin",description:"Repre historique cl.",icon:"",biomeId:"biome_hist_plaines"},{id:"sticker_meta_pickaxe",type:"sticker",rarity:"common",title:"Pioche Malo",description:"Outil fidle.",icon:""},{id:"sticker_meta_tocha",type:"sticker",rarity:"common",title:"Torche",description:"claire les donjons.",icon:""},{id:"sticker_meta_map",type:"sticker",rarity:"common",title:"Carte",description:"Toujours savoir o aller.",icon:""},{id:"sticker_meta_marteau",type:"sticker",rarity:"common",title:"Marteau",description:"Rparer les blocs fissurs.",icon:""},{id:"sticker_meta_sac",type:"sticker",rarity:"common",title:"Sac  dos",description:"Tout emporter.",icon:""},{id:"fragment_langue",type:"fragment",rarity:"rare",title:"Fragment Linguistique",description:"Augmente la brillance des blocs de langue.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"fragment_math",type:"fragment",rarity:"rare",title:"Fragment Numrique",description:"Pure nergie mathmatique.",icon:"",biomeId:"biome_math_mines"},{id:"fragment_en",type:"fragment",rarity:"rare",title:"Fragment Anglais",description:"Accent parfait.",icon:"",biomeId:"biome_en_village"},{id:"fragment_es",type:"fragment",rarity:"rare",title:"Fragment Espagnol",description:"Rythme et couleur.",icon:"",biomeId:"biome_es_village"},{id:"fragment_hist",type:"fragment",rarity:"rare",title:"Fragment Chronique",description:"Temps et cartes fusionns.",icon:"",biomeId:"biome_hist_plaines"},{id:"fragment_meta_focus",type:"fragment",rarity:"rare",title:"Fragment de Focalisation",description:"Rend les sessions plus prcises.",icon:""},{id:"fragment_meta_vitesse",type:"fragment",rarity:"rare",title:"Fragment de Vitesse",description:"Acclre tes rponses.",icon:""},{id:"fragment_meta_chance",type:"fragment",rarity:"rare",title:"Fragment de Chance",description:"Boost de loot.",icon:""},{id:"trophy_foret_bronze",type:"trophy",rarity:"rare",title:"Trophe Fort Bronze",description:"3 blocs matriss en Fort.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"trophy_foret_argent",type:"trophy",rarity:"rare",title:"Trophe Fort Argent",description:"6 blocs matriss en Fort.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"trophy_foret_or",type:"trophy",rarity:"epic",title:"Trophe Fort Or",description:"10 blocs matriss en Fort.",icon:"",biomeId:"biome_fr_foret_langue"},{id:"trophy_mines_or",type:"trophy",rarity:"epic",title:"Trophe Mines Or",description:"10 blocs matriss dans les Mines.",icon:"",biomeId:"biome_math_mines"},{id:"trophy_plaines_or",type:"trophy",rarity:"epic",title:"Trophe Plaines Or",description:"10 blocs matriss dans les Plaines.",icon:"",biomeId:"biome_hist_plaines"},{id:"avatar_malo_explorateur",type:"avatar",rarity:"epic",title:"Malo Explorateur",description:"Hros des biomes.",icon:""},{id:"avatar_malo_mineur",type:"avatar",rarity:"epic",title:"Malo Mineur",description:"Spcialiste des nombres.",icon:""},{id:"avatar_malo_mage",type:"avatar",rarity:"epic",title:"Malo Mage",description:"Matrise magique.",icon:""},{id:"avatar_malo_architecte",type:"avatar",rarity:"epic",title:"Malo Architecte",description:"Btisseur de blocs.",icon:""}];function hO(t,e){let{common:n,rare:r,epic:s}=t;const o=e.correctRate??0;o>=.85&&(r+=5),o>=.9&&(s+=1),e.levelUp&&(r+=5,s+=2),e.expedition==="craft"&&(r+=4,s+=1);const l=n+r+s,d=Math.random()*l;return d<s?"epic":d<s+r?"rare":"common"}function fO(t){const e=hO({common:80,rare:18,epic:2},{correctRate:t.correctRate,levelUp:t.levelUp,expedition:t.expedition}),n=bu.filter(l=>l.rarity===e);if(!n.length)return null;const r=n.filter(l=>!t.biomeId||!l.biomeId||l.biomeId===t.biomeId),s=r.length?r:n;let o=null;for(let l=0;l<3;l++){const d=s[Math.floor(Math.random()*s.length)];if(!t.owned.has(d.id)){o=d;break}}return o||(o=bu.filter(d=>d.rarity==="common"&&(!t.biomeId||!d.biomeId||d.biomeId===t.biomeId)).filter(d=>!t.owned.has(d.id))[0]||s[0]),o}function mO(t,e){const n=t.masteryByTag||{};return Object.entries(n).filter(([,s])=>s?.state==="mastered").filter(([s])=>s.includes(e.split("_")[1]||"")).length}const pO=[3,6,10];function gO(t,e,n){let r=n||0;for(const o of pO)e>=o&&o>r&&(r=o);return r===n?null:bu.find(o=>o.type==="trophy"&&o.biomeId===t&&o.title.includes(r>=10?"Or":r>=6?"Argent":"Bronze"))||null}async function yO(t){const{uid:e,sessionId:n,biomeId:r,sessionStats:s,expedition:o}=t,l=`malocraftLoot:${n}`,d=Oe(we,"users",e,"meta","rewards"),h=Oe(we,"users",e,"rewardEvents",l);let f=null;if(await Di(we,async g=>{const[y,_]=await Promise.all([g.get(h),g.get(d)]);if(y.exists())return;const x=_.exists()?_.data():null,I={xp:x?.xp||0,level:x?.level||1,badges:x?.badges||[],masteryByTag:x?.masteryByTag||{},collectibles:x?.collectibles||{owned:[],equippedAvatarId:null},malocraft:x?.malocraft||{ownedLootIds:[],equippedAvatarId:null,biomeMilestones:{}},updatedAt:x?.updatedAt},k=new Set(I.malocraft?.ownedLootIds||[]),S=mO(I,r),O=I.malocraft?.biomeMilestones?.[r]||0,B=gO(r,S,O);if(B&&!k.has(B.id)){f=B,k.add(B.id),g.set(d,{malocraft:{ownedLootIds:Array.from(k),biomeMilestones:{...I.malocraft?.biomeMilestones||{},[r]:Math.max(O,S)},equippedAvatarId:I.malocraft?.equippedAvatarId??null},updatedAt:at()},{merge:!0}),g.set(h,{type:"malocraft",sessionId:n,awardedId:B.id,milestone:!0,createdAt:at()});return}if(!((s.deltaXp||0)>=10||(s.correctRate||0)>=.5))return;const $=fO({owned:k,biomeId:r,correctRate:s.correctRate,levelUp:s.levelUp,expedition:o});if(!$)return;f=$,k.add($.id);const F={...I.malocraft?.biomeMilestones||{}};g.set(d,{malocraft:{ownedLootIds:Array.from(k),biomeMilestones:F,equippedAvatarId:I.malocraft?.equippedAvatarId??null},collectibles:$.type==="avatar"?{owned:Array.from(new Set([...I.collectibles?.owned||[],$.id])),equippedAvatarId:I.collectibles?.equippedAvatarId??$.id}:I.collectibles||{owned:[],equippedAvatarId:null},updatedAt:at()},{merge:!0}),g.set(h,{type:"malocraft",sessionId:n,awardedId:$.id,milestone:!1,createdAt:at()})}),f&&f.type==="avatar")try{await av(t.uid,f.id,`collectible_${l}`)}catch{}return{awarded:f}}const GS={biome_fr_foret_langue:{id:"biome_fr_foret_langue",name:"Fort de la Langue",description:"Lecture, grammaire, conjugaison : renforce tes blocs de franais.",icon:"",subject:"fr",order:10},biome_math_mines:{id:"biome_math_mines",name:"Mines des Nombres",description:"Fractions, calcul et problmes : mine des ressources de maths.",icon:"",subject:"math",order:20},biome_en_village:{id:"biome_en_village",name:"Village Anglais",description:"Vocabulaire et grammaire : parle et comprends langlais.",icon:"",subject:"en",order:30},biome_es_village:{id:"biome_es_village",name:"Village Espagnol",description:"Vocabulaire et grammaire : progresse en espagnol.",icon:"",subject:"es",order:40},biome_hist_plaines:{id:"biome_hist_plaines",name:"Plaines des Repres",description:"Repres, cartes et chronologie : explore lhistoire-go.",icon:"",subject:"hist",order:50}},Eh=Object.values(GS).sort((t,e)=>t.order-e.order);function xi(t){return GS[t]}function Pl(t){switch(t){case"math":return"biome_math_mines";case"en":return"biome_en_village";case"es":return"biome_es_village";case"hist":return"biome_hist_plaines";default:return"biome_fr_foret_langue"}}const va={scout:{id:"scout",name:"Le Scout",avatar:"",shortTagline:"Je repre la meilleure mission du jour.",tone:"adventure"},robot:{id:"robot",name:"Le Robot Prof",avatar:"",shortTagline:"Je te propose un plan simple et efficace.",tone:"rational"},goblin:{id:"goblin",name:"Le Gobelin Malin",avatar:"",shortTagline:"Je te lance des dfis mais je taide aussi.",tone:"fun"}},vO={scout:{repair:["Ton bloc craque. On le rpare ensemble ?","Je vois une fissure ici. On retourne l solidifier.","Un pas en arrire pour repartir plus fort : mission rparation.","On revient sur ce bloc : je taccompagne, cest rapide.","Rafistolage express : on comble les brches.","Revoir calmement, cest la cl. Partons rparer.","On renforce les bases : mission rparation en vue.","Je trace la route vers un bloc fissur. On y va ?","On rebouche les trous, puis on reprendra lascension.","Une courte halte pour ajuster ce bloc.","Je dtecte un bloc fragile. On sen occupe dabord.","Rparer, puis repartir : cest notre plan du jour.","Mission soin : on remet ce bloc en forme.","On revisite ce point faible avec mthode.","On resserre les boulons et on passe  la suite.","Une rparation vaut mieux quun effondrement. Prt ?","On vrifie, on corrige, on scurise. En avant.","Rappel express, puis on grimpe : mission rparation."],priority:["Mission prioritaire repre : cest le moment.","Je pointe un bloc cl pour aujourdhui.","Ce bloc touvrira la suite. On y va.","Objectif du jour : consolider ce bloc essentiel.","Je te propose la voie rapide vers le prochain palier.","Ce bloc doit passer devant. Je temmne.","Cap sur un bloc important pour tes progrs.","On prend litinraire optimal : ce bloc dabord.","Je privilgie ce bloc pour taider  avancer.","Un bloc dcisif tattend. Partons.","Cible prioritaire, effort concentr.","Je te guide sur le meilleur gain du jour.","On choisit la piste la plus rentable.","Ce bloc dbloquera la suite : fonons.","Slection du jour : ce bloc mrite ton focus.","Je rduis le chemin : ce bloc est la cl.","Mission directe sur un bloc stratgique.","On scurise ce point, puis on explorera plus loin."],spaced:["On revisite un bloc oubli depuis quelques jours.","Petit rappel lointain : on remet ce bloc en tte.","Je ressors une balise ancienne, on la ractive.","Un peu de rvision espace pour rester solide.","On dpoussire ce bloc. a sera vite fait.","Rappel doux : ce bloc mrite un coup dil.","On renforce la mmoire : passage clair ici.","Retour  un bloc crois il y a quelque temps.","Je propose une session courte sur un ancien bloc.","On ractive ce savoir, sans stress.","Un flashback utile pour rester au top.","On refait surface sur ce bloc discret.","Mission rappel : on vrifie que tout tient.","Rvision espace : juste ce quil faut.","On ancre durablement en repassant ici.","On fait un tour sur ce bloc en sommeil.","Je temmne revoir un repre loign.","Courte escale mmoire sur ce bloc."],craft:["On combine deux blocs, prt  crafter ?","Atelier express : on mlange deux notions.","Dfi cration : assembler deux blocs solides.","On tisse un lien entre ces blocs, faon craft.","On fabrique une avance avec deux lments.","Je propose un duo de blocs pour progresser.","On fusionne les comptences : mission craft.","Construisons un pont entre ces blocs.","On forge une nouvelle matrise avec ce duo.","Mlange malin : deux blocs, une mission.","Je te guide pour assembler ces savoirs.","On cre un combo gagnant aujourdhui.","Deux blocs allis pour une expdition.","On passe en mode atelier : craft rapide.","On sculpte une mission  deux blocs.","On associe, on consolide, on avance.","Laboratoire du jour : fusion de blocs.","Recette du jour : craft efficace."]},robot:{repair:["Analyse : bloc instable. Correction recommande.","Protocole rparation : cible dtecte.","Priorit systme : combler les erreurs.","Retour sur un chec rcent pour stabiliser.","Rglage fin requis. Lancement correction.","On patch le bloc avant nouvelle monte.","Erreur repre. Squence de rparation.","Module rparation actif pour ce bloc.","On rduit le risque en corrigeant ici.","Cycle court de correction conseill.","Stabilisation ncessaire : bloc fissur.","Plan : corriger, vrifier, valider.","On ferme la faille et on continue.","Bloc fragile identifi. Fix en cours.","Process rapide : correction cible.","On limine cette faiblesse maintenant.","Rparer avant dajouter de la complexit.","Calibration du bloc en priorit."],priority:["Priorit calcule : ce bloc maximise ton gain.","Slection optimise : travaille ce bloc.","Chemin le plus court : ce bloc dabord.","Optimisation : focus sur ce bloc cl.","Je te dirige vers le meilleur ROI du jour.","Bloc stratgique identifi pour progresser.","Plan efficace : ce bloc en premire position.","Priorit systme : renforcer ce bloc.","Squence optimale : ce bloc avant les autres.","Ce bloc dbloquera plus de points. Excutons.","Je choisis la cible la plus rentable.","Cible prioritaire : gain attendu maximal.","Ce bloc est ton acclrateur du jour.","Alignement optimal : commence ici.","Je simplifie : un bloc, un progrs net.","Route minimale : ce bloc au centre.","Paramtrage : mission sur ce bloc cl.","Processus : priorit haute sur ce bloc."],spaced:["Rvision espace programme : bloc oubli.","Rappel mmoire : revisitons ce bloc.","Intervalle dtect >5 jours. Rafrachissons.","On relit ce bloc pour consolider.","Maintenance mmoire : passage rapide ici.","Ractivation ncessaire : bloc ancien.","Boucle de rappel : courte session.","Je dclenche une vrification priodique.","On recharge ce savoir pour viter la perte.","Sance courte : renforcement espac.","Ancrage long terme : revoir ce bloc.","Routine spaced repetition : ce bloc.","On valide que ce bloc reste stable.","Ping mmoire : ce bloc en attente.","Refresh programm pour ce bloc.","Cycle espac : contrle rapide.","Stabilit mmoire : test sur ce bloc.","Rvision chronologique : on y retourne."],craft:["Fusion de comptences : mission craft.","Assemblage logique : deux blocs, une cible.","On combine deux notions pour crer un lien.","Atelier synthse : craft calcul.","Je propose un binme de blocs complmentaires.","Construction avance : fusion de savoirs.","On mixe ces blocs pour renforcer la structure.","Plan duo : mission craft  deux blocs.","On tablit une passerelle entre deux notions.","Craft contrl : assembler et vrifier.","On teste une combinaison pour progresser.","Synthse : deux blocs, progression unique.","On code une mission craft prcise.","Exprience combinatoire : allons-y.","Deux blocs corrls, une mission claire.","On structure un combo pour tlever.","Mlange optimis : craft de prcision.","On valide un duo de blocs matriss."]},goblin:{repair:["Oups, un bloc fissur ! On va le rafistoler.","Je chipote, mais a craque ici. On rpare ?","Gobelin dtecte une btise : on la corrige vite.","On repart sur ce bloc pour le rendre costaud.","Petit soin gobelin : on bouche les trous.","Revenons sur cet chec, sans panique.","Je taide  recoller les morceaux de ce bloc.","On tire sur ce fil, puis on le renforce.","Un bloc caboss ? On le polit ensemble.","On efface les griffures : mission rparation.","Je fais une grimace, mais on va y arriver.","Pause bricolage : on consolide ce bloc.","Je tpaule pour rparer cette faille.","Rparer maintenant, fanfaronner aprs.","On corrige, on rigole, on repart.","Mission rustine : rapide et indolore.","On remet ce bloc en forme avec malice.","Une rparation gobeline, et on continue."],priority:["Je parie que ce bloc te fera gagner vite.","Celui-ci est juteux : on fonce !","Bloc prioritaire repr par le gobelin malin.","Je mise sur ce bloc : jackpot dapprentissage.","On attaque ce bloc, il en vaut la peine.","Prends ce raccourci : ce bloc dabord.","Je pointe mon doigt gobelin : commence ici.","Ce bloc va te propulser, promis.","Focus gobelin : ce bloc est la cl.","Cible dore repre. On y va ?","On grille la file : ce bloc passe en priorit.","Je te chuchote : cest le bon choix du jour.","Un bloc vip tattend. Prt ?","Jai flair le meilleur coup : ce bloc.","On saute dessus, il est top pour toi.","Plan malin : ce bloc, puis le reste.","Ce bloc ouvre la porte. On le dbloque.","Priorit gobeline active sur ce bloc."],spaced:["H, on na pas vu ce bloc depuis longtemps !","Petit rappel malin : revisitons ce bloc.","On dpoussire un vieux bloc. Rapide !","Un saut dans le pass : ce bloc revient.","Je remets ce bloc sur la table. Go !","Rappel malin : on va le rendre frais.","On rveille ce bloc qui dormait.","Le gobelin aime les surprises : retour ici.","On refait un tour sur ce bloc ancien.","Rvision clair pour garder la main.","On ranime ce bloc, sans stress.","Piqre de rappel : ce bloc a besoin damour.","On fait un coucou  ce bloc oubli.","Un clin dil au pass : on repasse l.","Rappel gobelin : ce bloc veut revenir.","On vrifie que ce bloc tient toujours.","Ractivation rapide : on samuse aussi.","On revisite ce bloc, version malice."],craft:["On mlange deux blocs, faon potion gobeline.","Atelier bricolage : on combine des notions.","Je te propose un duo tonnant. Prt ?","On tisse deux blocs pour un truc gnial.","Dfi : fusionner ces deux blocs solides.","On assemble et on cre, easy.","Recette gobeline : deux blocs, une mission.","On fait un mix malin : craft du jour.","On associe ces blocs pour briller.","Combo fun : deux blocs main dans la main.","On bidouille un craft efficace.","On cre un pont entre ces deux ides.","Mission atelier : on teste ce mlange.","On bricole un duo gagnant.","Deux blocs, double fun, une mission.","On fait danser deux blocs ensemble.","On invente un craft rapide et malin.","On combine et on samuse : mission craft."]}};function QS(t,e){return`malocraft.npc.lastLines.${t}.${e}`}function _O(t,e){if(typeof localStorage>"u")return[];try{const n=localStorage.getItem(QS(t,e));if(!n)return[];const r=JSON.parse(n);return Array.isArray(r)?r.filter(s=>typeof s=="number"):[]}catch{return[]}}function wO(t,e,n){typeof localStorage>"u"||localStorage.setItem(QS(t,e),JSON.stringify(n.slice(-5)))}function bO(t){const e=vO[t.npcId][t.reason];if(!e.length)return"";const n=_O(t.npcId,t.reason);let r=0;for(let s=0;s<6;s++){const o=Math.floor(Math.random()*e.length);if(!n.includes(o)||s===5){r=o;break}}return wO(t.npcId,t.reason,[...n,r]),e[r]}const xO="malocraft.npc.dialogue",TO={scout:{session_start:[t=>`On vise ${t.blockLabel||"le bloc du jour"}. Objectif rapide, je reste  ct si tu veux un rappel.`,t=>`Je trace le chemin vers ${t.blockLabel||"le bloc cible"}. On dmarre tranquille et on ajuste.`,()=>"On commence calmement, tu peux ouvrir le rappel ds que tu sens un doute.",()=>"Briefing express : on avance, on observe, on corrige vite si besoin."],wrong_answer:[t=>`Pas grave, on note ce point sur ${t.blockLabel||"le bloc"} et on repart.`,()=>"On ajuste et on retente. Regarde lastuce si tu bloques.",()=>"On cale le bon rflexe et on continue. Tu peux ouvrir le rappel.",()=>"Petite embche, on la contourne ensemble. Un coup dil au rappel ?"],session_end:[t=>{const e=t.successRate!=null?`${t.successRate}%`:null;return`Session termine${e?` (${e})`:""}. On consolide ${t.blockLabel||"le bloc cibl"} et on garde llan.`},t=>{const e=t.xpBreakdown?.base??null;return`Bilan rapide : ${t.blockLabel||"bloc"} en cours, ${e!=null?`${e} XP base`:"XP gagn"}. On continue demain.`},()=>"Fin de session note. On debrief et on repartira plus haut la prochaine fois."],streak_praise:[()=>"Belle srie ! On garde ce rythme.",()=>"Trois bonnes rponses daffile, on continue sur cette lance."]},robot:{session_start:[t=>`Chargement du plan sur ${t.blockLabel||"le bloc cible"}. Je garde le rappel prt au besoin.`,()=>"Squence dmarrage : questions courtes, validation rapide.",t=>`Objectif clair : scuriser ${t.blockLabel||"le bloc"}. On mesure et on ajuste.`,()=>"Checklist prte. Si un doute, on ouvre le rappel contextualis."],wrong_answer:[()=>"cart dtect. Consulter lastuce peut corriger la trajectoire.",()=>"Correction applique. Un rappel rapide est disponible.",()=>"On stabilise : lis lexplication puis lastuce si besoin.",()=>"Erreur note, on met  jour le modle et on continue."],session_end:[t=>{const e=t.successRate!=null?`${t.successRate}%`:"";return`Session clture. ${t.blockLabel?`${t.blockLabel} stabilis`:"Bloc stabilis"} ${e?`(${e})`:""}.`},t=>{const e=t.xpBreakdown?.completion??null;return`Rsultat : progression enregistre${e!=null?`, +${e} XP session`:""}. Prochaine tape planifie.`},()=>"Fin du cycle. Les donnes de progression sont  jour."],streak_praise:[()=>"Srie valide. Continuer sur ce pattern est optimal.",()=>"Trois succs conscutifs : modle stable."]},goblin:{session_start:[t=>`On saute sur ${t.blockLabel||"le bloc du jour"} ! Si tu coinces, jai une astuce prte.`,()=>"Allez, on dmarre. Je glisse un rappel si a bloque.",t=>`On attaque ${t.blockLabel||"ce bloc"} en mode malin. Tu peux appeler lastuce  tout moment.`,()=>"On teste, on rigole, on corrige vite si a drape."],wrong_answer:[()=>"Oups ! Lis lexplication et je te montre lastuce si tu veux.",()=>"Pas de panique, on ajuste. Lastuce est juste l.",()=>"On rebondit ! Clique sur lastuce et on repart.",()=>"Erreur gobeline repre, on la retourne avec le rappel."],session_end:[t=>{const e=t.successRate!=null?`${t.successRate}%`:null;return`Session plie${e?` (${e})`:""} ! ${t.blockLabel?`${t.blockLabel} avance`:"Le bloc avance"}.`},t=>{const e=t.xpBreakdown?.base??null;return`XP en poche${e!=null?` (+${e} base)`:""}. On fte a et on revient demain.`},()=>"Fin de run. On garde lnergie pour la suite !"],streak_praise:[()=>"Belle srie, tu crames la piste !",()=>"Tripl russi. On enchane ?"]}};function XS(t,e){return`${xO}.${t}.${e}`}function EO(t,e){if(typeof localStorage>"u")return[];try{const n=localStorage.getItem(XS(t,e));if(!n)return[];const r=JSON.parse(n);return Array.isArray(r)?r.filter(s=>typeof s=="number"):[]}catch{return[]}}function IO(t,e,n){typeof localStorage>"u"||localStorage.setItem(XS(t,e),JSON.stringify(n.slice(-3)))}function SO(t){const{npcId:e,event:n,pool:r}=t;if(!r.length)return null;const s=EO(e,n);let o=0;for(let l=0;l<5;l++){const d=Math.floor(Math.random()*r.length);if(!s.includes(d)||l===4){o=d;break}}return IO(e,n,[...s,o]),r[o]}function ro(t,e,n={}){if(e==="daily_quest"){const d=n.reasonCode||"priority";return{text:bO({npcId:t,reason:d,dateKey:new Date().toISOString().slice(0,10)}),tone:va[t].tone}}const r=TO[t]?.[e]||[],s=SO({npcId:t,event:e,pool:r}),o=s?s(n):"Je reste dispo si tu veux un rappel.",l=e==="wrong_answer"&&n.lessonAvailable?{label:"Voir lastuce",action:"open_lesson"}:void 0;return{text:o,tone:va[t].tone,cta:l}}const CO={fr_comprehension_inference:{blockName:"Bloc Dduction",icon:""},math_fractions_addition:{blockName:"Bloc Somme",icon:""}};function AO(t){const e=Qt(t),n=`Bloc ${e.label}`;return{tagId:t,blockName:n,biomeId:Pl(e.subject),icon:"",theme:e.theme}}function YS(t){const e=AO(t),n=CO[t];return{...e,...n||{}}}function Gs(t){return Object.keys(As).map(e=>YS(e)).filter(e=>e.biomeId===t).sort((e,n)=>{const r=e.theme.localeCompare(n.theme);return r!==0?r:e.blockName.localeCompare(n.blockName)})}const JS="malocraft.npc.preferredId";function xu(){if(typeof localStorage>"u")return"scout";const t=localStorage.getItem(JS);return t==="robot"||t==="goblin"||t==="scout"?t:"scout"}function cv(t){typeof localStorage>"u"||localStorage.setItem(JS,t)}function jl(t,e){return`${t}__${e}`}async function RO(t){const{uid:e,sessionId:n,subject:r,theme:s,tagStats:o}=t,l=t.target??35,d=t.store||Kl(),h=jl(r,s),f=`zone_rebuild_${h}_${n}`;let g=0,y=null;return await d.runTransaction(async _=>{const x=await _.getRewardEvent(e,f),I=await _.getRewards(e),k=d.createTimestamp(),S=I?.zoneRebuildProgress||{};if(x){y=S[h]||null,g=0;return}const B=Object.entries(o).filter(([A])=>{const E=Qt(A);return E.subject===r&&E.theme===s}).reduce((A,[,E])=>A+Math.max(0,E.correct||0),0),V=S[h]||{correctCount:0,target:l},$=Math.min(l,(V.correctCount||0)+B),F=V.rebuiltAt||($>=l?k:void 0),H={correctCount:$,target:V.target||l,updatedAt:k};F&&(H.rebuiltAt=F),S[h]=H,_.setRewards(e,{zoneRebuildProgress:S}),_.setRewardEvent(e,f,{type:"zone_rebuild",zoneKey:h,sessionId:n,delta:$-(V.correctCount||0),createdAt:k}),g=$-(V.correctCount||0),y=H}),{deltaApplied:g,progress:y}}async function kO(t){const{uid:e,sessionId:n,subject:r,tagStats:s}=t,o=t.target??100,l=t.store||Kl(),d=r,h=`biome_rebuild_${d}_${n}`;let f=0,g=null;return await l.runTransaction(async y=>{const _=await y.getRewardEvent(e,h),x=await y.getRewards(e),I=l.createTimestamp(),k=x?.biomeRebuildProgress||{};if(_){g=k[d]||null,f=0;return}const S=Object.entries(s||{}).filter(([F])=>Qt(F).subject===r).reduce((F,[,H])=>F+Math.max(0,H.correct||0),0),O=k[d]||{correctCount:0,target:o},B=Math.min(o,(O.correctCount||0)+S),V=O.rebuiltAt||(B>=o?I:void 0),$={correctCount:B,target:O.target||o,updatedAt:I};V&&($.rebuiltAt=V),k[d]=$,y.setRewards(e,{biomeRebuildProgress:k}),y.setRewardEvent(e,h,{type:"biome_rebuild",biomeKey:d,sessionId:n,delta:B-(O.correctCount||0),createdAt:I}),f=B-(O.correctCount||0),g=$}),{deltaApplied:f,progress:g}}const ZS=[{id:"biome_skin_stone",type:"monument_skin_biome",label:"Pierre polie",description:"Contours nets et liser clair pour les grands monuments.",unlockLevel:3},{id:"biome_skin_mossy",type:"monument_skin_biome",label:"Lierre ancien",description:"Des veines vertes qui donnent du relief aux structures.",unlockLevel:6},{id:"biome_skin_goldtrim",type:"monument_skin_biome",label:"Filets dors",description:"Bordures dores discrtes pour les temples du biome.",unlockLevel:10},{id:"zone_skin_slate",type:"monument_skin_zone",label:"Ardoise sombre",description:"Effet ardoise avec reflets bleuts sur les zones.",unlockLevel:2},{id:"zone_skin_brass",type:"monument_skin_zone",label:"Brassage cuivre",description:"Teinte cuivre et rivets faon atelier.",unlockLevel:5},{id:"zone_skin_crystal",type:"monument_skin_zone",label:"Cristaux prismatiques",description:"Reflets pastel et facettes lgres.",unlockLevel:8},{id:"tile_effect_glow",type:"tile_effect",label:"Halo azur",description:"Lger halo lumineux autour des tuiles actives.",costCoins:40},{id:"tile_effect_spark",type:"tile_effect",label:"tincelles",description:"Petites tincelles animes sur les blocs stabiliss.",costCoins:80},{id:"npc_style_forge",type:"npc_style",label:"Forge",description:"Bulles anguleuses, badges mtal.",costCoins:60},{id:"npc_style_scribe",type:"npc_style",label:"Scribe",description:"Contours encre et cartouche parchemin.",unlockLevel:7}],PO=new Map(ZS.map(t=>[t.id,t]));function eC(t){return PO.get(t)}const jO={monument_skin_biome:"biomeMonumentSkin",monument_skin_zone:"zoneMonumentSkin",tile_effect:"tileEffect",npc_style:"npcStyle"};function NO(t){return Math.max(0,Math.floor(t))}function uv(t,e){if(!t)return!1;const n=e?.level||1;return!!((e?.ownedCosmetics||{})[t.id]||t.unlockLevel&&n>=t.unlockLevel)}async function MO(t,e,n=Kl()){const r=eC(e);if(!r)throw new Error("Cosmtique introuvable");const s=r.costCoins||0;let o=null;return await n.runTransaction(async l=>{const[d,h]=await Promise.all([l.getRewards(t),l.getRewardEvent(t,`purchase_${e}`)]),f={xp:d?.xp||0,level:d?.level||1,coins:d?.coins||0,badges:d?.badges||[],masteryByTag:d?.masteryByTag||{},blockProgress:d?.blockProgress||{},collectibles:d?.collectibles||{owned:[],equippedAvatarId:null},ownedCosmetics:d?.ownedCosmetics||{},equippedCosmetics:d?.equippedCosmetics||{},malocraft:d?.malocraft,zoneRebuildProgress:d?.zoneRebuildProgress,biomeRebuildProgress:d?.biomeRebuildProgress,updatedAt:d?.updatedAt};if(h||uv(r,f)){const _={...f.ownedCosmetics||{},[e]:!0};l.setRewards(t,{ownedCosmetics:_}),o={...f,ownedCosmetics:_};return}if(s>(f.coins||0))throw new Error("Coins insuffisants");const g={...f.ownedCosmetics||{},[e]:!0},y=Math.max(0,(f.coins||0)-s);l.setRewards(t,{coins:y,ownedCosmetics:g,equippedCosmetics:f.equippedCosmetics||{},updatedAt:n.createTimestamp()}),l.setRewardEvent(t,`purchase_${e}`,{type:"cosmetic_purchase",cosmeticId:e,costCoins:s,createdAt:n.createTimestamp()}),o={...f,coins:y,ownedCosmetics:g}}),o||{xp:0,level:1,coins:0,ownedCosmetics:{},equippedCosmetics:{}}}async function DO(t,e,n=Kl()){const r=eC(e);if(!r)throw new Error("Cosmtique introuvable");const s=jO[r.type];let o=null;return await n.runTransaction(async l=>{const d=await l.getRewards(t),h={xp:d?.xp||0,level:d?.level||1,coins:d?.coins||0,badges:d?.badges||[],masteryByTag:d?.masteryByTag||{},blockProgress:d?.blockProgress||{},collectibles:d?.collectibles||{owned:[],equippedAvatarId:null},ownedCosmetics:d?.ownedCosmetics||{},equippedCosmetics:d?.equippedCosmetics||{},malocraft:d?.malocraft,zoneRebuildProgress:d?.zoneRebuildProgress,biomeRebuildProgress:d?.biomeRebuildProgress,updatedAt:d?.updatedAt};if(!uv(r,h))throw new Error("Cosmtique non dbloqu");const f={...h.ownedCosmetics||{},[e]:!0},g={...h.equippedCosmetics||{}};g[s]=e,l.setRewards(t,{ownedCosmetics:f,equippedCosmetics:g,updatedAt:n.createTimestamp()}),o={...h,ownedCosmetics:f,equippedCosmetics:g}}),o||{xp:0,level:1,coins:0,ownedCosmetics:{},equippedCosmetics:{}}}let oh=0;function LO(){const[t,e]=j.useState(()=>typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia("(min-width: 900px)").matches);return j.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const n=window.matchMedia("(min-width: 900px)"),r=s=>e(s.matches);return n.addEventListener("change",r),e(n.matches),()=>n.removeEventListener("change",r)},[]),t}function sa({open:t,title:e,children:n,onClose:r,onBack:s,width:o=880,zIndex:l=900}){const d=j.useRef(null),h=j.useRef(null),f=LO(),[g,y]=j.useState(()=>typeof localStorage>"u"?!1:localStorage.getItem("mc_drawer_collapsed")==="true");if(j.useEffect(()=>{try{localStorage.setItem("mc_drawer_collapsed",g?"true":"false")}catch{}},[g]),j.useEffect(()=>{if(!t)return;oh+=1,h.current=document.activeElement||null;const O=d.current;O&&O.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')?.focus();const B=V=>{V.key==="Escape"&&(V.stopPropagation(),r())};return document.addEventListener("keydown",B),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",B),oh=Math.max(0,oh-1),oh===0&&(document.body.style.overflow=""),h.current?.focus()}},[t,r]),!t)return null;const _=O=>{O.target===O.currentTarget&&r()},x=f?"linear-gradient(90deg, rgba(8,10,20,0.05), rgba(8,10,20,0.15))":"rgba(0,0,0,0.45)",I=g&&f?72:f?"clamp(360px, 34vw, 520px)":Math.min(o,880),k=g&&f?12:16,S=!(g&&f);return c.jsx("div",{onClick:_,style:{position:"fixed",inset:0,background:x,display:"flex",alignItems:"stretch",justifyContent:"flex-end",zIndex:l},"aria-modal":"true",role:"dialog",children:c.jsxs("div",{ref:d,className:"card mc-card",style:{width:I,maxWidth:"80vw",height:"100%",borderRadius:0,overflowY:"auto",padding:k,boxShadow:"-6px 0 18px rgba(0,0,0,0.45)",background:f?"rgba(10,14,24,0.7)":void 0,backdropFilter:f?"blur(8px)":void 0,borderLeft:f?"1px solid rgba(255,255,255,0.12)":void 0,display:"flex",flexDirection:"column"},onClick:O=>O.stopPropagation(),children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[c.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s&&c.jsx("button",{className:"mc-button secondary",onClick:s,"aria-label":"Retour",children:""}),e?c.jsx("div",{style:{fontWeight:900},children:e}):null]}),c.jsxs("div",{className:"row",style:{gap:6,alignItems:"center"},children:[f&&c.jsx("button",{className:"mc-button secondary",onClick:()=>y(!g),"aria-label":g?"R-ouvrir le panneau":"Rduire le panneau",children:g?" R-ouvrir":" Rduire"}),c.jsx("button",{className:"mc-button secondary",onClick:r,"aria-label":"Fermer",children:""})]})]}),S?c.jsx("div",{children:n}):c.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Panneau rduit"}),c.jsx("button",{className:"mc-button",onClick:()=>y(!1),"aria-label":"R-ouvrir le panneau",children:"R-ouvrir"})]})]})})}const VO={wrong_answer:"Mauvaise correction",ambiguous:"nonc ambigu",typo:"Faute ou typo",too_hard:"Trop difficile",off_topic:"Hors sujet",other:"Autre"};function jp(t,e){return t.type==="mcq"?e===t.answerIndex:t.type==="short_text"||t.type==="fill_blank"?t.expected.includes(Rl(e||"")):!1}function Np(t,e){return!t||!e?[]:Object.values(As).filter(n=>n.subject===t&&n.theme===e).map(n=>n.id)}function Mp(t){if(!t)return{};const e={};return Object.values(As).forEach(n=>{n.subject===t&&(e[n.theme]||(e[n.theme]=[]),e[n.theme].push(n.id))}),e}function px(t){const e=[...t];for(let n=e.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[e[n],e[r]]=[e[r],e[n]]}return e}function gx(t,e,n,r){const s=new Map;t.forEach(y=>{const _=(y.tags||[]).find(x=>e.includes(x));_&&(s.has(_)||s.set(_,[]),s.get(_).push(y))}),e.forEach(y=>{s.has(y)&&s.set(y,px(s.get(y)))});const o=new Set,l=[],d=r?Math.max(2,Math.floor(n*.2)):0;let h=0,f=0;const g=e.filter(y=>s.get(y)?.length);for(;l.length<n&&g.length;){const y=g[f%g.length],_=s.get(y)||[];let x=_.shift();for(;x&&o.has(x.id);)x=_.shift();if(x){const I=x.difficulty||1;I>2&&h>=d?_.push(x):(l.push(x),o.add(x.id||x.questionId),I>2&&(h+=1))}if(_.length)s.set(y,_);else{const I=g.indexOf(y);I>=0&&g.splice(I,1)}if(f++,!g.length||f>n*5)break}if(l.length<n){const y=Array.from(s.values()).flat();px(y).forEach(_=>{if(l.length>=n)return;const x=_.difficulty||1;if(x>2&&h>=d)return;const I=_.id||_.questionId;o.has(I)||(l.push(_),o.add(I),x>2&&(h+=1))})}return l.slice(0,n)}function OO(){const{themeId:t}=Ru(),{user:e,activeChild:n}=Hn(),r=n?.id||e?.uid||null,{rewards:s}=Ps(r),[o,l]=j.useState(null),[d,h]=j.useState([]),[f,g]=j.useState({}),[y]=j.useState(()=>Date.now()),[_,x]=j.useState(null),[I,k]=j.useState([]),[S,O]=j.useState(null),[B,V]=j.useState("mine"),[$,F]=j.useState([]),[H,A]=j.useState(!1),[E,P]=j.useState(null),[L,C]=j.useState(null),[N,M]=j.useState(!1),ie=ts(),[te,q]=j.useState(""),[W,Y]=j.useState(""),[ne]=iE(),[se,z]=j.useState(!1),[ee,Q]=j.useState(null),[de,Se]=j.useState(null),[fe,Re]=j.useState("wrong_answer"),[$e,Me]=j.useState(""),[At,Wt]=j.useState({}),[ur,Ie]=j.useState(""),[Ir,ce]=j.useState(!1),[xe,De]=j.useState(null),[Rt,Ze]=j.useState({}),[pt,ye]=j.useState(xu()),[Ne,Ke]=j.useState(null),[kt,it]=j.useState(null),[_n,Sr]=j.useState(null),[gt,Yt]=j.useState({subject:null,theme:null}),Bt=va[pt],tn=j.useRef(!1),tr=j.useRef(!1);j.useEffect(()=>{ye(xu())},[]),j.useEffect(()=>{tn.current=!1,tr.current=!1,Ke(null),it(null)},[t]),j.useEffect(()=>{(async()=>{if(!t||H||se)return;const Ee=ne.get("targetTagId")||ne.get("tagId"),nt=ne.get("expeditionType")||"mine",ht=ne.get("sessionKind"),dt=ne.get("subjectId")||null,Be=ne.get("theme")||null;Sr(ht),Yt({subject:dt,theme:Be}),V(nt);const Le=ht==="reconstruction_theme"?null:await hn(Oe(we,"themes",t)),_t=Le&&Le.exists()?{id:t,...Le.data()}:null;let Pt=[],Lt=[];if(ht==="reconstruction_theme"){const ft=dt||_t?.subjectId||null,Ft=Np(ft,Be);if(!Ft.length){Y("Aucun bloc pour cette zone."),h([]),F([]),A(!1),Ze({}),De(null);return}Pt=(await Promise.all(Ft.map(ke=>tu(ke,{})))).flat();const mn=ft||Ag(Ft[0]);Yt({subject:mn,theme:Be});const rn={id:t,subjectId:mn,title:`Reconstruction  ${Be||"Zone"}`};l(rn);const Fr=Pp({exercises:Pt,readings:Lt}),Br=Ft.some(ke=>(s?.masteryByTag||{})?.[ke]?.score>=70),X=Br?Fr.filter(ke=>(ke.difficulty||1)<=3):Fr.filter(ke=>(ke.difficulty||1)<=2),le=18;if(X.length)Y("");else{Y("Aucune question publie pour cette zone pour le moment."),h([]),F([]),A(!1),Ze({}),De(null);return}const _e=gx(X,Ft,le,Br);O(Ft[0]||null),h(_e.slice(0,le)),De(null),g({}),x(null),F([]),Ze({});return}else if(ht==="reconstruction_biome"){const ft=dt||_t?.subjectId||null;if(!ft){Y("Biome introuvable."),h([]),F([]),A(!1),Ze({}),De(null);return}const Ft=Mp(ft),wn=Object.entries(Ft);if(!wn.length){Y("Aucune zone pour ce biome."),h([]),F([]),A(!1),Ze({}),De(null);return}const mn=s?.zoneRebuildProgress||{};if(!(wn.filter(([bn])=>{const Dn=`${ft}__${bn}`,xn=mn[Dn],pe=xn?.target||35;return(xn?.correctCount||0)>=pe}).length/wn.length>=.6)){Y("Reconstruis au moins 60% des zones avant de lancer le biome."),h([]),F([]),A(!1),Ze({}),De(null);return}Yt({subject:ft,theme:null});const le=[...wn].sort((bn,Dn)=>{const xn=`${ft}__${bn[0]}`,pe=`${ft}__${Dn[0]}`,lt=mn[xn]?.correctCount||0;return(mn[pe]?.correctCount||0)-lt}).flatMap(([,bn])=>bn).slice(0,12),ke=(await Promise.all(le.map(bn=>tu(bn,{})))).flat(),We=le.some(bn=>(s?.masteryByTag||{})?.[bn]?.score>=70),jt=Pp({exercises:ke,readings:[]}).filter(bn=>(bn.difficulty||1)<=(We?3:2)),Pe=22;if(jt.length)Y("");else{Y("Aucune question disponible pour ce biome."),h([]),F([]),A(!1),Ze({}),De(null);return}const pn=gx(jt,le,Pe,We),sn={id:t,subjectId:ft,title:"Reconstruction du biome"};O(le[0]||null),l(sn),h(pn.slice(0,Pe)),De(null),g({}),x(null),F([]),Ze({});return}if(Pt=await _V(t,{uid:r}),Lt=Array.isArray(_t?.readings)?_t.readings:[],(!Pt.length||!_t)&&Ee)Pt=await tu(Ee,{}),Lt=[];else try{const ft=await wV(t);ft.length&&(Lt=ft)}catch{}const jn=_t||(Ee?{id:t,subjectId:Ag(Ee),title:"Expdition MaloCraft"}:null);l(jn);const je=Pp({exercises:Pt,readings:Lt}),It=10;if(je.length)Y("");else{h([]),Y("Aucune question publie pour ce bloc pour le moment."),F([]),A(!1),Ze({}),De(null);return}const Nn={};je.forEach(ft=>(ft.tags||[]).forEach(Ft=>{Nn[Ft]=(Nn[Ft]||0)+1}));const Gn=Object.entries(Nn).sort((ft,Ft)=>Ft[1]-ft[1])[0]?.[0],Mn=Ee||Gn;O(Mn||null);let nn=je;if(Mn){const ft=s?.masteryByTag||{},Ft=[],wn=B==="mine"&&Df(Mn,Ft)?"repair":B;nn=dO(je,{expedition:wn,targetTagId:Mn,desiredCount:It,masteryByTag:ft,history:Ft})}nn.length||(nn=[...je].sort(()=>Math.random()-.5).slice(0,It)),h(nn.slice(0,It));const fn=nn.find(ft=>ft.packLesson);fn&&fn.packLesson?De({title:fn.packLessonTitle||null,content:fn.packLesson,lessonRef:fn.lessonRef||null,mode:"full"}):De(null),g({}),x(null),F([]),Ze({}),A(!1)})()},[t,e,ne,s]),j.useEffect(()=>{if(!S||!d.length||tn.current||H)return;const Ee=Qt(S),nt=ro(pt,"session_start",{blockId:S,blockLabel:Ee?.label||null,lessonAvailable:!!xe?.content,lessonRef:xe?.lessonRef||null});Ke(nt),tn.current=!0},[S,d.length,pt,xe?.content,xe?.lessonRef,H]);const Un=async()=>{if(!r||!t||!o)return;z(!0),Y("");const Ee=Math.max(1,Math.round((Date.now()-y)/1e3));try{const nt=new Set;d.forEach(pe=>{const lt=f[pe.id];lt!=null&&(typeof lt=="string"&&lt.trim()===""||nt.add(pe.id))});const ht=nt.size,dt=ht>0&&ht===d.length,Be=d.map(pe=>{const lt=nt.has(pe.id);return{exerciseId:pe.id,questionId:pe.id,difficulty:pe.difficulty,tags:pe.tags||[],correct:lt?jp(pe,f[pe.id]):!1,answered:lt}}),Le=await PV({uid:r,subjectId:o.subjectId,themeId:t,answers:f,exercises:d,durationSec:Ee});Q(Le.attemptId||null);const _t=await EV({uid:r,subjectId:o.subjectId,themeId:t,items:Be,durationSec:Ee,existingAttemptId:Le.attemptId,skipAttemptWrite:!0}),Pt=Be.filter(pe=>pe.answered&&pe.correct).length,Lt=NO(Pt),mt=[];let jn=0,je=0,It=!1;const Nn=_n==="reconstruction_theme"&&gt.subject&&gt.theme?Np(gt.subject,gt.theme):_n==="reconstruction_biome"&&gt.subject?Object.values(Mp(gt.subject)).flat():[],Gn={};Be.forEach(pe=>{((pe.tags&&pe.tags.length?pe.tags:Nn)||[]).forEach(Nt=>{const gn=Gn[Nt]||{answered:0,correct:0};gn.answered+=pe.answered?1:0,gn.correct+=pe.answered&&pe.correct?1:0,Gn[Nt]=gn})}),Be.forEach(pe=>{if(!pe.answered){jn>=2&&mt.push(jn),jn=0,It=!1;return}pe.correct?(jn+=1,It&&(je+=1),It=!1):(jn>=2&&mt.push(jn),jn=0,It=!0)}),jn>=2&&mt.push(jn);const Mn=s?.masteryByTag||{};let nn=Mn;Be.forEach(pe=>{nn=$S({masteryByTag:nn,questionTags:pe.tags||[],isCorrect:pe.correct,timestamp:new Date})});const fn=Object.entries(nn).filter(([pe,lt])=>lt?.state==="mastered"&&Mn?.[pe]?.state!=="mastered").length,ft=mt.length?Math.max(...mt):0;if(!tr.current&&ft>=3){const pe=ro(pt,"streak_praise",{streak:ft,sessionId:Le.attemptId||t});it(lt=>lt??pe),tr.current=!0}const Ft=zV({answeredCount:ht,correctCount:Pt,streaks:mt,comebackCount:je,isCompleted:dt}),wn=Ft.total,mn=S||Be.find(pe=>Array.isArray(pe.tags)&&pe.tags.length)?.tags?.[0]||null,rn=mn?(()=>{const pe=Be.filter(Ut=>Ut.answered&&(Ut.tags||[]).includes(mn)),lt=pe.length,Nt=pe.filter(Ut=>Ut.correct).length,gn=lt?Math.round(Nt/lt*100):0,Zt=nn?.[mn]?.state||Mn?.[mn]?.state;return{tagId:mn,attempts:lt,successRate:gn,state:Zt}})():void 0,Fr=s;let Br=null,X=!1,le=[],_e=null;try{const pe=await HV(r,Le.attemptId||null,wn,Lt);if(Br=pe,X=(pe?.level||1)>(s?.level||1),await KV({uid:r,sessionId:Le.attemptId||t,items:Be}),le=await GV({uid:r,rewards:pe||s})||[],wn>=20||X||fn>0){const ct=pe?.collectibles?.owned||s?.collectibles?.owned||[];if(_e=eO(ct),_e){const Tn=Le.attemptId?`collectible_${Le.attemptId}`:void 0;await av(r,_e,Tn)}}try{const ct=Be.length?Be.filter(yt=>yt.correct).length/Be.length:0,Tn=Be[0]?.tags?.[0]||S||"",dr=Pl(o.subjectId),Ur=await yO({uid:r,sessionId:Le.attemptId||t,biomeId:dr,targetTagId:Tn,expedition:B,sessionStats:{deltaXp:wn,correctRate:ct,levelUp:X}});Ur.awarded?.id&&C(Ur.awarded.id)}catch(ct){console.warn("awardMalocraftLoot failed",ct)}(await oO({uid:r,sessionId:Le.attemptId||t,answeredCount:ht,tagsUsed:Be.flatMap(ct=>ct.tags||[]),tagStats:Gn}).catch(ct=>(console.error("updateDailyProgress failed",ct),{allCompleted:!1})))?.allCompleted?fx({uid:r,sessionsDelta:1,xpDelta:wn}).catch(ct=>console.error("upsertDayStat failed",ct)):fx({uid:r,sessionsDelta:0,xpDelta:wn}).catch(ct=>console.error("upsertDayStat failed",ct));const gn=_n==="reconstruction_theme"&&gt.subject&&gt.theme?Np(gt.subject,gt.theme):_n==="reconstruction_biome"&&gt.subject?Object.values(Mp(gt.subject)).flat():[],Zt=gn.length?Object.entries(Gn).reduce((ct,[Tn,dr])=>gn.includes(Tn)?ct+(dr.correct||0):ct,0):0,Ut=(()=>{if(Object.keys(Gn).length&&Zt>0||!gn.length||!Pt)return Gn;const ct={},Tn=gn[0];return ct[Tn]={answered:Pt,correct:Pt},ct})();if(_n==="reconstruction_theme"&&gt.subject&&gt.theme)try{const ct=await RO({uid:r,sessionId:Le.attemptId||t,subject:gt.subject,theme:gt.theme,tagStats:Ut});ct.progress?.rebuiltAt&&it(Tn=>Tn??ro(pt,"streak_praise",{sessionId:Le.attemptId||t,streak:ct.progress.correctCount}))}catch(ct){console.warn("applyZoneRebuildProgress failed",ct)}else if(_n==="reconstruction_biome"&&gt.subject)try{const ct=await kO({uid:r,sessionId:Le.attemptId||t,subject:gt.subject,tagStats:Ut});ct.progress?.rebuiltAt&&it(Tn=>Tn??ro(pt,"streak_praise",{sessionId:Le.attemptId||t,streak:ct.progress.correctCount}))}catch(ct){console.warn("applyBiomeRebuildProgress failed",ct)}}catch(pe){console.error("awardSessionRewards failed",pe)}P({deltaXp:wn,levelUp:X,coinsEarned:Lt,newRewards:Br,prevRewards:Fr,unlockedBadges:le,collectibleId:_e,xpBreakdown:Ft.breakdown,blockProgress:rn});const ke=rn?.tagId?Qt(rn.tagId)?.label||null:S&&Qt(S)?.label||null;it(pe=>{const lt=ro(pt,"session_end",{blockId:rn?.tagId||S,blockLabel:ke,successRate:rn?.successRate??null,masteryState:rn?.state??null,xpBreakdown:Ft.breakdown,sessionId:Le.attemptId||t});return pe&&pe.text?{...lt,text:`${lt.text} ${pe.text}`}:lt});const We=new Set(d.flatMap(pe=>pe.tags||[])),St=Object.values(Le.tagsUpdated||{}).filter(pe=>pe&&We.has(pe.tagId||"")).sort((pe,lt)=>(pe.mastery??0)-(lt.mastery??0)).slice(0,3).map(pe=>pe.tagId);k(St),x({score:_t.score,outOf:_t.outOf,durationSec:Ee,..._t,coinsGain:Lt});const jt=Be.filter(pe=>!pe.correct).flatMap(pe=>pe.tags||[]),Pe=new Map;Be.forEach(pe=>{const lt=pe.correct?8:2;(pe.tags||[]).forEach(Nt=>{Pe.set(Nt,(Pe.get(Nt)||0)+lt)})});let pn;Pe.size&&(pn=Array.from(Pe.entries()).sort((pe,lt)=>lt[1]-pe[1])[0]?.[0]);const sn=_t.outOf?_t.score/_t.outOf*100:0,bn=YV({accuracy:sn,weakestTag:jt[0]||I[0],improvedTag:pn}),Dn=d.map((pe,lt)=>{const Nt=f[pe.id],gn=jp(pe,Nt);let Zt="",Ut="";const ct=pe.packLesson||xe?.content||null,Tn=pe.packLessonTitle||xe?.title||null;if(pe.type==="mcq"){const yt=pe;Zt=yt.choices[yt.answerIndex]||"",Ut=typeof Nt=="number"&&yt.choices[Nt]||""}else(pe.type==="short_text"||pe.type==="fill_blank")&&(Zt=pe.expected[0]||"",Ut=Nt||"");const dr=(pe.tags||[]).map(yt=>Qt(yt)?.label).find(Boolean)||(S?Qt(S)?.label:null),Ur=gn?null:ro(pt,"wrong_answer",{blockId:(pe.tags||[])[0]||S,blockLabel:dr||null,lessonRef:pe.lessonRef||xe?.lessonRef||null,lessonAvailable:!!ct,sessionId:Le.attemptId||t,questionId:pe.id});return{id:pe.id,prompt:pe.prompt,correct:gn,expected:Zt||"",userAnswer:(Ut??"").toString()||"",idx:lt+1,explanation:pe.explanation||null,lessonRef:pe.lessonRef||null,packLesson:ct,packLessonTitle:Tn,npcLine:Ur}}),xn=d.find((pe,lt)=>{const Nt=f[pe.id];return!jp(pe,Nt)&&pe.lessonRef});if(xn){const pe=xn.packLesson||xe?.content;pe&&De(lt=>({title:xn.packLessonTitle||lt?.title||null,content:pe,lessonRef:xn.lessonRef||lt?.lessonRef||null,mode:"contextual"}))}q(bn),F(Dn),A(!0),M(!0)}catch(nt){console.error("submit session failed",nt),Y(nt?.message||"Enregistrement impossible. Vrifie la connexion ou les droits.")}z(!1)},Or=()=>{A(!1),F([]),x(null),g({}),Ze({}),Wt({}),Se(null),Me(""),Re("wrong_answer"),Ie(""),Q(null),tn.current=!1,tr.current=!1,Ke(null),it(null)},Ht=j.useCallback(Ee=>{const nt=d.find(ht=>ht.id===Ee);return{setId:nt?.setId,primaryTag:nt?.primaryTag||(Array.isArray(nt?.tags)?nt.tags[0]:void 0),blockId:nt?.blockId||nt?.themeId,sessionId:ee||void 0,grade:o?.grade||void 0}},[ee,d,o]),Xe=Ee=>{Se(Ee),Re("wrong_answer"),Me(""),Ie("")},Kn=()=>{Se(null),Me(""),Ie("")},Jt=async()=>{if(!r||!de)return;ce(!0),Ie("");const Ee=de.id;try{const nt=await VV({questionId:Ee,uid:r,reason:fe,message:$e,context:Ht(Ee)});Wt(ht=>({...ht,[Ee]:nt.alreadyExists?"already":"sent"})),Kn()}catch(nt){nt?.code==="already-exists"?(Wt(ht=>({...ht,[Ee]:"already"})),Kn()):Ie(nt?.message||"Impossible denvoyer le signalement.")}finally{ce(!1)}};if(!t)return c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Thme introuvable."})});if(!r)return c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Slectionnez un enfant rattach pour lancer une session."})});if(H&&$.length){const Ee=E?.prevRewards?.xp??s?.xp??0,nt=E?.newRewards?.xp??Ee,ht=Ee,dt=nt;E?.deltaXp;const Be=_?(()=>{const je=_.outOf?_.score/_.outOf*100:0;return je>=80?"Super ! Continue comme a.":je>=50?"Bien jou ! On consolide et a va monter.":"Bien essay. On progresse en sentranant."})():"",Le=E?.blockProgress?.tagId?Qt(E.blockProgress.tagId):null,_t=E?.blockProgress?(()=>{const je=E.blockProgress.successRate;return je>=80?"Bloc presque rpar":je>=50?"Bloc en bonne voie":je>0?"Premiers pas sur ce bloc":""})():"",Pt=E?.collectibleId?Pi.find(je=>je.id===E?.collectibleId):null,Lt=Pt?.rarity==="epic"?"pique":Pt?.rarity==="rare"?"Rare":"Commun",mt=L?bu.find(je=>je.id===L):null,jn=async()=>{if(!(!e||!Pt||Pt.type!=="avatar")){try{r&&await lv(r,Pt.id)}catch(je){console.error("equipAvatar failed",je)}M(!1)}};return c.jsxs("div",{className:"container grid",style:{position:"relative"},children:[c.jsx(sa,{open:!!de,onClose:Kn,title:"Signaler une question",width:520,children:de&&c.jsxs("div",{children:[c.jsxs("div",{className:"small",style:{marginBottom:6},children:["Question ",de.idx]}),c.jsx("div",{style:{fontWeight:700},children:de.prompt}),c.jsx("div",{style:{marginTop:12},children:Object.entries(VO).map(([je,It])=>c.jsxs("label",{className:"small row",style:{gap:8,alignItems:"center",marginBottom:6},children:[c.jsx("input",{type:"radio",name:"report-reason",value:je,checked:fe===je,onChange:()=>Re(je)}),c.jsx("span",{children:It})]},je))}),c.jsxs("label",{className:"small",style:{display:"block",marginTop:10},children:["Commentaire (optionnel)",c.jsx("textarea",{className:"input",value:$e,onChange:je=>Me(je.target.value),maxLength:240,placeholder:"Dtaille le problme (240 caractres max)"}),c.jsxs("div",{className:"small",style:{textAlign:"right"},children:[$e.length,"/240"]})]}),ur&&c.jsx("div",{className:"small",style:{color:"#ff5a6f",marginTop:6},children:ur}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:12},children:[c.jsx("button",{className:"btn secondary",onClick:Kn,children:"Annuler"}),c.jsx("button",{className:"btn",onClick:Jt,disabled:Ir,children:"Envoyer"})]})]})}),N&&c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999},children:c.jsxs("div",{className:"card",style:{maxWidth:460},children:[c.jsxs("h3",{style:{marginTop:0},children:["Bravo ",e?.displayName?.split(" ")[0]||"!"]}),c.jsxs("div",{className:"small",children:["Score ",_?.score,"/",_?.outOf]}),c.jsxs("div",{className:"small",style:{marginTop:6},children:["+",E?.deltaXp??0," XP"]}),E?.coinsEarned!==void 0&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["+",E.coinsEarned," coins"]}),E?.xpBreakdown&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Base ",E.xpBreakdown.base,"  srie +",E.xpBreakdown.streakBonus,"  retour +",E.xpBreakdown.comebackBonus,"  session +",E.xpBreakdown.completion]}),E?.levelUp&&c.jsxs("div",{className:"small",style:{marginTop:6},children:[" Niveau ",E?.newRewards?.level]}),E?.blockProgress&&Le&&c.jsxs("div",{className:"small",style:{marginTop:6},children:[Le.label," : ",E.blockProgress.successRate,"% (",E.blockProgress.attempts," q.) ",_t?` ${_t}`:""]}),Pt&&c.jsxs("div",{className:"pill",style:{marginTop:10,display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"1.6rem"},children:Pt.icon}),c.jsxs("div",{children:[c.jsxs("div",{style:{fontWeight:800},children:[" Nouveau ! ",Pt.title]}),c.jsxs("div",{className:"small",children:[Pt.type==="avatar"?"Avatar":"Sticker","  ",Lt]})]})]}),mt&&c.jsxs("div",{className:"pill",style:{marginTop:10,display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"1.6rem"},children:mt.icon}),c.jsxs("div",{children:[c.jsxs("div",{style:{fontWeight:800},children:["Butin MaloCraft : ",mt.title]}),c.jsxs("div",{className:"small",children:[mt.type,"  ",mt.rarity==="epic"?"pique":mt.rarity==="rare"?"Rare":"Commun"]})]})]}),E?.unlockedBadges?.length?c.jsxs("div",{className:"small",style:{marginTop:8},children:["Nouveau badge : ",E.unlockedBadges.map(je=>c.jsx("span",{className:"badge",children:je},je))]}):null,Be&&c.jsx("div",{className:"small",style:{marginTop:8},children:Be}),c.jsxs("div",{className:"row",style:{marginTop:12,flexWrap:"wrap",gap:8},children:[Pt?.type==="avatar"&&c.jsx("button",{className:"btn",onClick:jn,children:"quiper"}),c.jsx("button",{className:"btn",onClick:()=>M(!1),children:"Voir la correction"})]})]})}),c.jsxs("div",{className:"card",children:[c.jsxs("h2",{style:{margin:0},children:["Corrections  ",o?.title]}),_&&c.jsxs("div",{className:"small",children:["Score ",c.jsxs("strong",{children:[_.score,"/",_.outOf]}),"  ",_.durationSec,"s  +",_.xpGain," XP  +",_.coinsGain," pices"]}),E&&c.jsxs("div",{className:"small",style:{marginTop:8},children:["+",E.deltaXp," XP ",E.levelUp?`  Niveau ${E.newRewards?.level}`:""]}),E?.coinsEarned!==void 0&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["+",E.coinsEarned," coins gagns"]}),E?.xpBreakdown&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Dtail XP : base ",E.xpBreakdown.base,"  srie +",E.xpBreakdown.streakBonus,"  retour +",E.xpBreakdown.comebackBonus,"  session +",E.xpBreakdown.completion]}),E?.blockProgress&&Le&&c.jsxs("div",{className:"small",style:{marginTop:6},children:[Le.label," : ",E.blockProgress.successRate,"% (",E.blockProgress.attempts," q.) ",_t?` ${_t}`:""]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:10,flexWrap:"wrap"},children:[mt&&c.jsx("button",{className:"btn secondary",onClick:()=>ie("/chest"),children:"Voir mon coffre"}),Pt&&c.jsx("button",{className:"btn secondary",onClick:()=>ie("/collection"),children:"Voir ma collection"})]}),Be&&c.jsx("div",{className:"small",style:{marginTop:8},children:Be})]}),kt&&c.jsxs("div",{className:"card mc-card",style:{display:"flex",gap:10,alignItems:"flex-start"},children:[c.jsx("div",{style:{fontSize:"2rem"},children:Bt.avatar}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Bt.name}),c.jsx("div",{style:{fontWeight:800},children:kt.text})]})]}),xe?.content&&c.jsx(hx,{title:xe.title,content:xe.content,lessonRef:xe.lessonRef,mode:xe.mode||"full"}),c.jsxs("div",{className:"card",children:[c.jsx("div",{className:"grid",children:$.map(je=>c.jsxs("div",{className:"pill",style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:6,background:je.correct?"rgba(46, 204, 113, 0.12)":"rgba(255, 90, 111, 0.12)",border:je.correct?"1px solid rgba(46, 204, 113, 0.4)":"1px solid rgba(255, 90, 111, 0.4)"},children:[c.jsxs("div",{className:"small",children:["Question ",je.idx,"  ",je.correct?c.jsx("span",{className:"badge",style:{borderColor:"rgba(46,204,113,.6)",color:"#7fffb2"},children:" Bonne rponse"}):c.jsx("span",{className:"badge",style:{borderColor:"rgba(255,90,111,.6)",color:"#ff9fb0"},children:" Mauvaise rponse"})]}),c.jsx("div",{style:{fontWeight:700},children:je.prompt}),c.jsxs("div",{className:"small",children:["Ta rponse : ",c.jsx("strong",{children:je.userAnswer})]}),!je.correct&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"small",children:["Correction : ",c.jsx("strong",{children:je.expected})]}),je.explanation&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Explication : ",je.explanation]}),je.npcLine&&c.jsxs("div",{className:"pill",style:{marginTop:6,display:"flex",gap:8,alignItems:"flex-start",background:"rgba(122,162,255,0.08)",border:"1px solid rgba(122,162,255,0.35)"},children:[c.jsx("div",{style:{fontSize:"1.4rem"},children:Bt.avatar}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Bt.name}),c.jsx("div",{className:"small",style:{fontWeight:700},children:je.npcLine.text}),je.npcLine.cta?.action==="open_lesson"&&je.packLesson&&c.jsx("button",{className:"mc-button secondary",style:{marginTop:6,padding:"4px 8px",fontSize:"0.8rem"},onClick:()=>Ze(It=>({...It,[je.id]:!0})),children:je.npcLine.cta.label})]})]}),je.packLesson&&c.jsxs("div",{className:"small",style:{marginTop:6},children:[c.jsx("button",{className:"btn secondary",style:{padding:"4px 8px",fontSize:"0.8rem"},onClick:()=>Ze(It=>({...It,[je.id]:!It[je.id]})),children:Rt[je.id]?"Masquer le rappel":"Voir le rappel de leon"}),Rt[je.id]&&c.jsxs("div",{className:"pill",style:{marginTop:6},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:je.packLessonTitle||"Leon"}),(()=>{const It=je.lessonRef?Cg(je.packLesson||"",je.lessonRef):null,Nn=ra(It?.markdown||je.packLesson||"");return c.jsxs(c.Fragment,{children:[It?.title&&c.jsx("div",{style:{fontWeight:700},children:It.title}),c.jsx("div",{className:"small",dangerouslySetInnerHTML:{__html:Nn}})]})})()]})]})]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:8,flexWrap:"wrap"},children:[c.jsx("button",{className:"btn secondary",onClick:()=>Xe(je),disabled:!!At[je.id],children:At[je.id]==="sent"?"Signale ":At[je.id]==="already"?"Dj signale ":"Signaler"}),At[je.id]&&c.jsx("span",{className:"small",style:{color:"var(--mc-muted)"},children:"Merci pour ton aide !"})]})]},je.id))}),c.jsxs("div",{className:"row",style:{marginTop:16},children:[c.jsx("button",{className:"btn",onClick:()=>ie("/"),children:"Retour  laccueil"}),c.jsx("button",{className:"btn secondary",onClick:Or,children:"Refaire une session"})]})]}),E&&c.jsxs("div",{className:"card",children:[c.jsx("h3",{style:{marginTop:0},children:"Progression XP"}),c.jsxs("div",{className:"small",children:["XP : ",ht,"  ",dt]}),E.blockProgress&&Le&&c.jsxs("div",{className:"small",style:{marginTop:6},children:["Bloc cible : ",Le.label,"  ",E.blockProgress.successRate,"% (",E.blockProgress.attempts," q.) ",_t?` ${_t}`:""]}),(()=>{const je=ya(ht),It=ya(dt),Nn=Math.min(100,Math.max(0,Math.round(It.xpIntoLevel/It.xpForNext*100)));return c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"small",children:["Niveau : ",je.level,"  ",It.level]}),c.jsx("div",{style:{height:12,background:"rgba(255,255,255,0.08)",borderRadius:999,overflow:"hidden",marginTop:8},children:c.jsx("div",{style:{height:"100%",width:`${Nn}%`,background:"linear-gradient(90deg,#7aa2ff,#2ecc71)",transition:"width 0.6s ease"}})})]})})()]})]})}return c.jsxs("div",{className:"container grid",children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{margin:0},children:o?.title||"Session"}),c.jsx("div",{className:"small",children:"Fais de ton mieux. Objectif : rgularit "})]}),c.jsx(QV,{rewards:s}),Ne&&!xe?.content&&c.jsxs("div",{className:"card mc-card",style:{display:"flex",gap:10,alignItems:"flex-start"},children:[c.jsx("div",{style:{fontSize:"2rem"},children:Bt.avatar}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Bt.name}),c.jsx("div",{style:{fontWeight:800},children:Ne.text})]})]}),xe?.content&&c.jsx(hx,{title:xe.title,content:xe.content,lessonRef:xe.lessonRef,mode:xe.mode||"full",npcGuide:Ne?{avatar:Bt.avatar,name:Bt.name,line:Ne.text,ctaLabel:Ne.cta?.action==="open_lesson"?Ne.cta.label:void 0,onCta:Ne.cta?.action==="open_lesson"?()=>De(Ee=>Ee&&{...Ee,mode:"contextual"}):void 0}:null}),W&&c.jsx("div",{className:"card",style:{background:"rgba(255,90,111,0.08)",border:"1px solid rgba(255,90,111,0.4)"},children:c.jsx("div",{className:"small",children:W})}),d.length===0&&c.jsx("div",{className:"card",children:c.jsx("div",{className:"small",children:"Aucune question publie pour ce bloc. Essaie un autre bloc ou reviens aprs la modration."})}),d.map((Ee,nt)=>{const ht=Ee.readingContext,dt=ht&&(nt===0||d[nt-1].readingContext?.readingId!==ht.readingId);return c.jsxs("div",{className:"card",children:[dt&&ht&&c.jsxs("div",{style:{marginBottom:10},children:[c.jsxs("div",{className:"small",style:{marginBottom:4},children:["Lecture : ",ht.title]}),c.jsx("div",{className:"small",dangerouslySetInnerHTML:{__html:ra(ht.text||"")}}),c.jsx("hr",{})]}),c.jsxs("div",{className:"small",children:["Question ",nt+1," / ",d.length," ",c.jsxs("span",{className:"badge",children:["Difficult ",Ee.difficulty]})]}),c.jsx("div",{style:{fontWeight:800,marginTop:6},dangerouslySetInnerHTML:{__html:ra(Ee.prompt||"")}}),Ee.type==="mcq"&&c.jsx("div",{className:"grid",style:{marginTop:10},children:Ee.choices.map((Be,Le)=>c.jsx("button",{type:"button",className:"btn "+(f[Ee.id]===Le?"":"secondary"),onClick:()=>g(_t=>({..._t,[Ee.id]:Le})),style:{textAlign:"left",opacity:f[Ee.id]===Le?1:.85},"aria-pressed":f[Ee.id]===Le,children:c.jsx("span",{dangerouslySetInnerHTML:{__html:ra(Be||"")}})},Le))}),Ee.type==="short_text"&&c.jsx("div",{style:{marginTop:10},children:c.jsx("input",{className:"input",placeholder:"Ta rponse",value:f[Ee.id]??"",onChange:Be=>g(Le=>({...Le,[Ee.id]:Be.target.value}))})}),Ee.type==="fill_blank"&&c.jsxs("div",{style:{marginTop:10},children:[c.jsx("div",{className:"small",dangerouslySetInnerHTML:{__html:ra(Ee.text||"")}}),c.jsx("input",{className:"input",placeholder:"Le mot manquant",value:f[Ee.id]??"",onChange:Be=>g(Le=>({...Le,[Ee.id]:Be.target.value}))})]})]},Ee.id)}),c.jsxs("div",{className:"card",children:[c.jsxs("div",{className:"row",children:[c.jsx("button",{className:"btn",onClick:Un,children:"Corriger et enregistrer"}),_&&c.jsxs("div",{className:"small",children:["Score ",c.jsxs("strong",{children:[_.score,"/",_.outOf]}),"  ",_.durationSec,"s"]})]}),_?.badges?.length?c.jsx("div",{className:"row",style:{marginTop:10},children:_.badges.map(Ee=>c.jsx("span",{className:"badge",children:Ee},Ee))}):null,I.length?c.jsxs("div",{className:"small",style:{marginTop:10},children:["Tags  renforcer (thme) : ",I.map(Ee=>c.jsx("span",{className:"badge",children:Ee},Ee))]}):null]}),$.length?c.jsxs("div",{className:"card",children:[c.jsx("h3",{style:{marginTop:0},children:"Corrections"}),W&&c.jsx("div",{className:"small",style:{color:"#ff5a6f",marginBottom:8},children:W}),c.jsx("div",{className:"grid",children:$.map(Ee=>c.jsxs("div",{className:"pill",style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:6},children:[c.jsxs("div",{className:"small",children:["Question ",Ee.idx,"  ",Ee.correct?c.jsx("span",{className:"badge",children:" Bonne rponse"}):c.jsx("span",{className:"badge",children:" Mauvaise rponse"})]}),c.jsx("div",{style:{fontWeight:700},children:Ee.prompt}),c.jsxs("div",{className:"small",children:["Ta rponse : ",c.jsx("strong",{children:Ee.userAnswer})]}),!Ee.correct&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"small",children:["Correction : ",c.jsx("strong",{children:Ee.expected})]}),Ee.npcLine&&c.jsxs("div",{className:"pill",style:{marginTop:6,display:"flex",gap:8,alignItems:"flex-start",background:"rgba(122,162,255,0.08)",border:"1px solid rgba(122,162,255,0.35)"},children:[c.jsx("div",{style:{fontSize:"1.4rem"},children:Bt.avatar}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Bt.name}),c.jsx("div",{className:"small",style:{fontWeight:700},children:Ee.npcLine.text}),Ee.npcLine.cta?.action==="open_lesson"&&Ee.packLesson&&c.jsx("button",{className:"mc-button secondary",style:{marginTop:6,padding:"4px 8px",fontSize:"0.8rem"},onClick:()=>Ze(nt=>({...nt,[Ee.id]:!0})),children:Ee.npcLine.cta.label})]})]}),Ee.explanation&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Explication : ",Ee.explanation]}),Ee.packLesson&&c.jsxs("div",{className:"small",style:{marginTop:6},children:[c.jsx("button",{className:"btn secondary",style:{padding:"4px 8px",fontSize:"0.8rem"},onClick:()=>Ze(nt=>({...nt,[Ee.id]:!nt[Ee.id]})),children:Rt[Ee.id]?"Masquer le rappel":"Voir le rappel de leon"}),Rt[Ee.id]&&c.jsxs("div",{className:"pill",style:{marginTop:6},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Ee.packLessonTitle||"Leon"}),(()=>{const nt=Ee.lessonRef?Cg(Ee.packLesson||"",Ee.lessonRef):null,ht=ra(nt?.markdown||Ee.packLesson||"");return c.jsxs(c.Fragment,{children:[nt?.title&&c.jsx("div",{style:{fontWeight:700},children:nt.title}),c.jsx("div",{className:"small",dangerouslySetInnerHTML:{__html:ht}})]})})()]})]})]})]},Ee.id))})]}):null]})}function FO(){const[t,e]=j.useState(""),[n,r]=j.useState([]),[s,o]=j.useState([]),[l,d]=j.useState(null),[h,f]=j.useState(null),[g,y]=j.useState("idle"),[_,x]=j.useState(!1),[I,k]=j.useState(!1),S=async V=>{if(!V)return;e("Lecture du fichier"),r([]);const $=await V.text();let F;try{F=JSON.parse($)}catch{e(" JSON invalide"),f(null);return}const H=FS(F);if(!H.ok){e(" Erreurs de validation"),r(H.errors),o(H.warnings||[]),d(null),f(null);return}f(F);const A=H.warnings||[];o(A),d(null);const E=A.length?`  ${A.length} avertissement(s)`:"";e(` Pack prt : ${F.pack.setId} (${F.questions.length} questions${E})`)},O=V=>{V.preventDefault(),y("idle");const $=V.dataTransfer.files?.[0];$&&S($)},B=async()=>{if(!(!h||I)){k(!0),e(_?"Validation (dry-run)":"Import en cours");try{const V=await hV(h,{dryRun:_}),$=V?.report||{packImported:V?.ok&&!_,questions:{created:V?.ok?h.questions.length:0,updated:0,ignored:V?.ok?0:h.questions.length}},F=V?.warnings||[];if(!V?.ok){const E=F.length?`  ${F.length} avertissement(s)`:"";e(` Erreurs dtectes${E}`),r(V?.errors||["Import chou (rponse vide)"]),o(F),d($);return}const H=F.length?` avec ${F.length} avertissement(s)`:"",A=`  cres ${$.questions.created}  mises  jour ${$.questions.updated}  ignores ${$.questions.ignored}`;e(_?` Validation OK (aucune criture${H}${A})`:` Import termin${H}${A}`),r([]),o(F),d($)}catch(V){e(" Erreur inattendue pendant limport"),r([V?.message||String(V)]),o([]),d({packImported:!1,questions:{created:0,updated:0,ignored:h.questions.length}})}finally{k(!1)}}};return c.jsx("div",{className:"container",children:c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Import de pack de questions"}),c.jsxs("p",{className:"small",children:["Glisse ton fichier JSON (QuestionPackV1). Les questions sont importes en ",c.jsx("strong",{children:"draft"})," dans Firestore (collections ",c.jsx("code",{children:"questionPacks"})," et ",c.jsx("code",{children:"questions"}),")."]}),c.jsxs("div",{onDragOver:V=>{V.preventDefault(),y("dragging")},onDragLeave:()=>y("idle"),onDrop:O,style:{border:g==="dragging"?"2px solid var(--accent)":"2px dashed rgba(255,255,255,0.3)",padding:16,borderRadius:8,marginBottom:10,background:"rgba(255,255,255,0.03)"},children:[c.jsx("div",{className:"small",children:"Glisse ton fichier ici ou slectionne-le :"}),c.jsx("input",{className:"input",type:"file",accept:".json,application/json",onChange:V=>S(V.target.files?.[0]||null)})]}),h&&c.jsxs("div",{className:"pill",style:{marginTop:6},children:["Pack ",h.pack.setId,"  ",h.pack.grade,"/",h.pack.lang,"  ",h.questions.length," questions"]}),c.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center",marginTop:10},children:[c.jsx("input",{type:"checkbox",checked:_,onChange:V=>x(V.target.checked)}),c.jsx("span",{className:"small",children:"Dry-run (validation sans crire)"})]}),c.jsx("button",{className:"btn",style:{marginTop:10},onClick:B,disabled:!h||I,children:_?"Valider le pack":"Importer le pack"}),t&&c.jsx("p",{className:"small",style:{marginTop:10},children:t}),s.length>0&&c.jsxs("div",{className:"card",style:{marginTop:10,background:"rgba(255,196,0,0.05)",border:"1px solid rgba(255,196,0,0.4)"},children:[c.jsx("div",{style:{fontWeight:700},children:"Avertissements"}),c.jsx("ul",{className:"small",children:s.map((V,$)=>c.jsx("li",{children:V},$))})]}),l&&c.jsxs("div",{className:"card",style:{marginTop:10,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.1)"},children:[c.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"Rapport dimport"}),c.jsxs("ul",{className:"small",children:[c.jsxs("li",{children:["Pack import : ",l.packImported?"oui":"non"," ",_?"(dry-run)":""]}),c.jsxs("li",{children:["Questions cres : ",l.questions.created]}),c.jsxs("li",{children:["Questions mises  jour : ",l.questions.updated]}),c.jsxs("li",{children:["Questions ignores : ",l.questions.ignored]}),s.length>0?c.jsxs("li",{children:["Avertissements : ",s.length]}):null,n.length>0?c.jsxs("li",{children:["Erreurs : ",n.length]}):null]})]}),n.length>0&&c.jsxs("div",{className:"card",style:{marginTop:10,background:"rgba(255,0,0,0.05)",border:"1px solid rgba(255,0,0,0.2)"},children:[c.jsx("div",{style:{fontWeight:700},children:"Erreurs"}),c.jsx("ul",{className:"small",children:n.map((V,$)=>c.jsx("li",{children:V},$))})]}),c.jsx("hr",{style:{marginTop:16,marginBottom:10}}),c.jsxs("p",{className:"small",children:["Rappel : ",c.jsx("code",{children:"quality.status"})," est forc  ",c.jsx("code",{children:"draft"}),"  limport. Tu publies ensuite dans longlet  Modration questions ."]})]})})}const BO=[{id:"all",label:"Toutes"},{id:"fr",label:"Franais"},{id:"math",label:"Maths"},{id:"en",label:"Anglais"},{id:"es",label:"Espagnol"},{id:"hist",label:"Histoire"}];function UO(t){if(!t)return null;const e=t.split("_")[0];return e==="fr"||e==="math"||e==="en"||e==="es"||e==="hist"?e:null}function yx(t){return t.last7?t.last7:Array.isArray(t.last7Results)?{correct:t.last7Results.filter(Boolean).length,wrong:t.last7Results.filter(e=>!e).length}:{correct:0,wrong:0}}function $O(){const{user:t,role:e,linkedChildren:n,activeChild:r,setActiveChildId:s}=Hn(),o=r?.id||t?.uid||"",[l,d]=j.useState([]),[h,f]=j.useState(""),[g,y]=j.useState([]),[_,x]=j.useState(!1),[I,k]=j.useState("fr"),[S,O]=j.useState(null),[B,V]=j.useState(""),[$,F]=j.useState({});j.useEffect(()=>{e==="parent"||e==="admin"?(d(n),n.length?f(r?.id||n[0].id):f("")):t&&(d([{id:o,displayName:t.displayName||"Enfant"}]),f(o))},[r?.id,n,o,e,t]);const H=j.useCallback(async C=>{x(!0);const M=(await br(Rn(we,"users",C,"tagProgress"))).docs.map(q=>({id:q.id,tagId:q.id,...q.data()}));y(M);const te=(await br(Rn(we,"users",C,"progressSummary"))).docs.find(q=>q.id==="main");O(te?.data()||null),x(!1)},[]);j.useEffect(()=>{h&&H(h)},[h,H]);const A=async C=>{if(!h||(B!==C&&V(C),$[C]?.items?.length||$[C]?.loading))return;F(q=>({...q,[C]:{loading:!0,items:[]}}));let N;try{N=await br(kr(Rn(we,"users",h,"attemptItems"),qn("tags","array-contains",C),Hl(100)))}catch{N=await br(kr(Rn(we,"users",h,"attemptItems"),qn("tags","array-contains",C)))}const M=N.docs.map(q=>({id:q.id,...q.data()})),ie={};await Promise.all(Array.from(new Set(M.map(q=>q.exerciseId))).map(async q=>{const W=await hn(Oe(we,"exercises",q));W.exists()?ie[q]=W.data():ie[q]={prompt:q}}));const te=M.map(q=>({...q,prompt:q.prompt||ie[q.exerciseId]?.prompt||q.exerciseId,choices:q.choices||ie[q.exerciseId]?.choices||null,readingContext:q.readingContext})).sort((q,W)=>{const Y=q.createdAt?.toMillis?q.createdAt.toMillis():0;return(W.createdAt?.toMillis?W.createdAt.toMillis():0)-Y});F(q=>({...q,[C]:{loading:!1,items:te}}))},E=C=>{if(B===C){V("");return}A(C)},P=g.filter(C=>I==="all"?!0:UO(C.tagId)===I).sort((C,N)=>(C.mastery||0)-(N.mastery||0)).slice(0,20),L=()=>{const C=[["tagId","mastery","bucket","attempts","correct","wrong","last7_correct","last7_wrong","nextDueDate"]];g.forEach(q=>{const W=yx(q);C.push([q.tagId||q.id,String(q.mastery??0),q.bucket||"",String(q.attempts??0),String(q.correctAnswers??0),String(q.wrongAnswers??0),String(W.correct),String(W.wrong),q.nextDueDate||""])});const N=C.map(q=>q.map(W=>`"${(W??"").toString().replace(/"/g,'""')}"`).join(",")).join(`
`),M=new Blob([N],{type:"text/csv;charset=utf-8;"}),ie=URL.createObjectURL(M),te=document.createElement("a");te.href=ie,te.download=`progress-${h||"user"}.csv`,te.click(),URL.revokeObjectURL(ie)};return c.jsxs("div",{className:"container",children:[!h&&c.jsx("div",{className:"card",children:"Aucun enfant rattach. Gnre un code dans lapp enfant puis rattache-le."}),c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Progression par tag"}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(e==="parent"||e==="admin")&&c.jsxs(c.Fragment,{children:[c.jsx("label",{className:"small",children:"Enfant"}),c.jsx("select",{className:"input",value:h,onChange:C=>{f(C.target.value),s(C.target.value)},children:l.map(C=>c.jsx("option",{value:C.id,children:C.displayName},C.id))})]}),c.jsx("label",{className:"small",children:"Matire"}),c.jsx("select",{className:"input",value:I,onChange:C=>k(C.target.value),children:BO.map(C=>c.jsx("option",{value:C.id,children:C.label},C.id))}),c.jsx("button",{className:"btn secondary",onClick:L,disabled:!g.length,children:"Tlcharger CSV"})]}),S&&c.jsxs("div",{className:"kpi",style:{marginTop:10},children:[c.jsxs("div",{className:"pill",children:["Rponses: ",c.jsx("strong",{children:S.totalAnswers||0})]}),c.jsxs("div",{className:"pill",children:["Taux: ",c.jsxs("strong",{children:[S.totalAnswers?Math.round((S.correctAnswers||0)/S.totalAnswers*100):0,"%"]})]}),c.jsxs("div",{className:"pill",children:["Tentatives: ",c.jsx("strong",{children:S.totalAttempts||0})]})]})]}),_?c.jsx("div",{className:"card",children:"Chargement"}):c.jsxs("div",{className:"card",children:[c.jsx("h3",{style:{marginTop:0},children:"Top 20 faibles"}),P.length===0?c.jsx("div",{className:"small",children:"Aucun tag pour le moment."}):c.jsx("div",{className:"grid",children:P.map(C=>{const N=yx(C),M=Qt(C.tagId||C.id),ie=B===(C.tagId||C.id),te=$[C.tagId||C.id]||{loading:!1,items:[]};return c.jsxs("div",{className:"card",style:{padding:12},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{onClick:()=>E(C.tagId||C.id),style:{cursor:"pointer",flex:1},children:[c.jsx("div",{style:{fontWeight:700},children:M.label}),c.jsxs("div",{className:"small",children:[M.theme,"  ",ca[M.subject]]}),c.jsxs("div",{className:"small",children:[C.mastery??0,"/100  ",C.bucket,"  ",N.correct,"/",N.correct+N.wrong," sur 7  Prochaine: ",C.nextDueDate||""]}),c.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.08)",borderRadius:999,marginTop:6,width:"100%"},children:c.jsx("div",{style:{height:8,borderRadius:999,width:`${Math.min(100,Math.max(0,C.mastery||0))}%`,background:"linear-gradient(90deg,#ff5a6f,#7aa2ff)"}})}),c.jsx("div",{className:"row",style:{marginTop:6,gap:4},children:(C.last7Results||[]).map((q,W)=>c.jsx("span",{style:{width:10,height:10,borderRadius:"50%",background:q?"#2ecc71":"#ff5a6f",opacity:.9}},W))})]}),c.jsx("button",{className:"btn secondary",style:{width:36,height:36},onClick:()=>E(C.tagId||C.id),children:ie?"":"+"})]}),ie&&c.jsx("div",{className:"card",style:{marginTop:10,background:"rgba(255,255,255,0.03)"},children:te.loading?c.jsx("div",{className:"small",children:"Chargement"}):te.items.length===0?c.jsx("div",{className:"small",children:"Aucune question trouve pour ce tag."}):c.jsx("div",{className:"grid",children:te.items.map(q=>c.jsxs("div",{className:"pill",style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:6},children:[c.jsxs("div",{className:"small",children:[q.createdAt?.toDate?q.createdAt.toDate().toLocaleString():"","  Diff ",q.difficulty,"  ",q.correct?"":""]}),c.jsx("div",{style:{fontWeight:700},children:q.prompt}),q.readingContext&&c.jsxs("div",{className:"small",style:{whiteSpace:"pre-wrap"},children:[c.jsxs("div",{style:{fontWeight:600,marginBottom:4},children:["Lecture : ",q.readingContext.title]}),q.readingContext.text]}),Array.isArray(q.choices)&&typeof q.answer=="number"?c.jsxs("div",{className:"small",children:["Rponse : ",c.jsx("strong",{children:q.choices[q.answer]||q.answer})]}):c.jsxs("div",{className:"small",children:["Rponse : ",c.jsx("strong",{children:q.answer??""})]})]},q.id))})})]},C.id)})})]})]})}const zO=["draft","reviewed","published","rejected","archived"];function Dp(t){return t==="draft"?"Draft":t==="reviewed"?"Revu":t==="published"?"Publi":t==="rejected"?"Rejet":"Archiv"}function qO(){const{user:t}=Hn(),e=ts(),n=ks(),[r,s]=j.useState({status:"draft",includeDeleted:!1}),[o,l]=j.useState([]),[d,h]=j.useState(!1),[f,g]=j.useState(null),[y,_]=j.useState(null),[x,I]=j.useState(""),[k,S]=j.useState(""),[O,B]=j.useState(""),V=!1,[$,F]=j.useState(new Set),[H,A]=j.useState(!1),[E,P]=j.useState([]),[L,C]=j.useState(""),[N,M]=j.useState([]),[ie,te]=j.useState("default"),[q,W]=j.useState(null),[Y,ne]=j.useState(!1),se=j.useRef(null);j.useEffect(()=>{const ce=n.state?.focusQuestionId,xe=new URLSearchParams(n.search).get("questionId"),De=ce||xe;De&&De!==se.current&&(se.current=De,s(Rt=>({...Rt,status:void 0,includeDeleted:!0})),g(De))},[n]);const z=j.useCallback(async()=>{h(!0);try{let ce=await fV(r);if(se.current&&!ce.find(xe=>xe.id===se.current))try{const xe=await hn(Oe(we,"questions",se.current));xe.exists()&&(ce=[{id:xe.id,...xe.data()},...ce])}catch(xe){console.warn("focus question fetch failed",xe)}if(l(ce),F(xe=>{const De=new Set;return ce.forEach(Rt=>{xe.has(Rt.id)&&De.add(Rt.id)}),De}),f){const xe=ce.find(De=>De.id===f);xe&&_(xe),F(De=>{const Rt=new Set;return ce.forEach(Ze=>{(De.has(Ze.id)||Ze.id===f)&&Rt.add(Ze.id)}),Rt})}}finally{h(!1)}},[r,f]);j.useEffect(()=>{z()},[z]),j.useEffect(()=>{(async()=>{try{const xe=(await br(kr(Rn(we,"users"),qn("role","==","child")))).docs.map(De=>({id:De.id,displayName:De.data().displayName||De.id}));M(xe)}catch{M([])}})(),(async()=>{const ce=await kl(null);P(ce)})()},[]),j.useEffect(()=>{(async()=>{const ce=await kl(ie==="default"?null:ie);P(ce)})()},[ie]),j.useEffect(()=>{W(null)},[f]);const ee=ce=>{g(ce.id),_(ce),I("")},Q=ce=>{F(xe=>{const De=new Set(xe);return De.has(ce)?De.delete(ce):De.add(ce),De})},de=()=>F(new Set(o.map(ce=>ce.id))),Se=()=>F(new Set),fe=(ce,xe)=>{y&&_({...y,[ce]:xe})},Re=async()=>{if(y){ne(!0);try{const ce=await US(y.id);W(ce)}catch(ce){alert(ce?.message||"Impossible de charger les reports.")}finally{ne(!1)}}},$e=async()=>{y&&(await yV(y.id,{statement:y.statement,choices:y.choices??null,answer:y.answer,explanation:y.explanation,commonMistake:y.commonMistake,difficulty:y.difficulty,secondaryTags:y.secondaryTags,metaTags:y.metaTags,blockId:y.blockId,primaryTag:y.primaryTag,updatedBy:t?.uid,note:x}),I(""),await z())},Me=async(ce,xe)=>{if(y){if(xe?.requireNote&&!x.trim()){alert("Une note est requise pour cette action.");return}try{await Sg(y.id,ce,{reviewerId:t?.uid||void 0,notes:x||void 0}),I(""),await z()}catch(De){alert(De?.message||"Impossible de changer le statut.")}}},At=async()=>{y&&window.confirm("Supprimer (soft delete) cette question ?")&&(await ux(y.id,{by:t?.uid||void 0,notes:x||void 0}),I(""),await z())},Wt=async()=>{y&&window.confirm("Archiver cette question ?")&&(await vV(y.id,{by:t?.uid||void 0,notes:x||void 0}),I(""),await z())},ur=async()=>{if($.size!==0&&window.confirm(`Supprimer (soft) ${$.size} question(s) ?`)){A(!0);try{for(const ce of Array.from($))try{await ux(ce,{by:t?.uid||void 0,notes:x||void 0})}catch(xe){console.warn(`chec delete sur ${ce}:`,xe?.message||xe)}I(""),await z()}finally{A(!1)}}},Ie=async(ce,xe)=>{if($.size!==0){if(xe?.requireNote&&!x.trim()){alert("Une note est requise pour cette action.");return}A(!0);try{for(const De of Array.from($))try{await Sg(De,ce,{reviewerId:t?.uid||void 0,notes:x||void 0})}catch(Rt){console.warn(`chec sur ${De}:`,Rt?.message||Rt)}I(""),await z()}finally{A(!1)}}},Ir=async()=>{if(!k.trim()||!window.confirm(`Supprimer les anciennes questions (collection exercises) avec le tag ${k} ?`))return;B("Nettoyage en cours");const ce=await br(kr(Rn(we,"exercises"),qn("tags","array-contains",k.trim())));if(!ce.size){B("Aucune question legacy trouve.");return}const xe=ov(we);ce.docs.forEach(De=>xe.delete(De.ref)),await xe.commit(),B(`Supprim ${ce.size} questions legacy.`)};return c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Modration questions"}),c.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[c.jsxs("label",{className:"small",children:["Statut",c.jsxs("select",{className:"input",value:r.status||"",onChange:ce=>{const xe=ce.target.value;s(De=>({...De,status:xe||void 0}))},children:[c.jsx("option",{value:"",children:"Tous"}),zO.map(ce=>c.jsx("option",{value:ce,children:Dp(ce)},ce))]})]}),c.jsxs("label",{className:"small",children:["Tag",c.jsx("input",{className:"input",value:r.primaryTag||"",onChange:ce=>s(xe=>({...xe,primaryTag:ce.target.value||void 0})),placeholder:"primaryTag"})]}),c.jsxs("label",{className:"small",children:["Bloc",c.jsx("input",{className:"input",value:r.blockId||"",onChange:ce=>s(xe=>({...xe,blockId:ce.target.value||void 0})),placeholder:"blockId"})]}),c.jsxs("label",{className:"small",children:["Set ID",c.jsx("input",{className:"input",value:r.setId||"",onChange:ce=>s(xe=>({...xe,setId:ce.target.value||void 0})),placeholder:"setId"})]}),c.jsxs("label",{className:"small",children:["Difficult",c.jsx("input",{className:"input",type:"number",min:1,max:5,value:r.difficulty||"",onChange:ce=>s(xe=>({...xe,difficulty:ce.target.value?Number(ce.target.value):void 0}))})]}),c.jsxs("label",{className:"small",children:["Recherche",c.jsx("input",{className:"input",value:r.text||"",onChange:ce=>s(xe=>({...xe,text:ce.target.value||void 0})),placeholder:"statement/answer"})]}),c.jsxs("label",{className:"small row",style:{alignItems:"center",gap:6,marginTop:4},children:[c.jsx("input",{type:"checkbox",checked:!!r.includeDeleted,onChange:ce=>s(xe=>({...xe,includeDeleted:ce.target.checked}))}),c.jsx("span",{children:"Afficher supprimes"})]}),c.jsx("button",{className:"btn secondary",onClick:z,disabled:d,children:"Recharger"})]}),c.jsxs("div",{className:"small",style:{marginTop:6},children:[d?"Chargement":`${o.length} questions`,"  slection : ",$.size]}),c.jsxs("div",{className:"card",style:{marginTop:10},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:700},children:"Priorits PNJ"}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Ordre de priorit local pour les missions PNJ (par enfant)."})]}),c.jsxs("div",{className:"row",style:{gap:6},children:[c.jsx("button",{className:"btn secondary",onClick:()=>P(Object.keys(As)),children:"Tout slectionner"}),c.jsx("button",{className:"btn secondary",onClick:()=>P([]),children:"Vider"}),c.jsx("button",{className:"btn secondary",disabled:ie==="default",onClick:async()=>{ie!=="default"&&await WS(ie,E)},children:"Enregistrer"})]})]}),c.jsx("div",{className:"row",style:{gap:8,marginTop:8,flexWrap:"wrap"},children:c.jsxs("label",{className:"small",children:["Enfant cible",c.jsxs("select",{className:"input",value:ie,onChange:ce=>te(ce.target.value),children:[c.jsx("option",{value:"default",children:"Tous (dfaut local)"}),N.map(ce=>c.jsx("option",{value:ce.id,children:ce.displayName},ce.id))]})]})}),c.jsxs("label",{className:"small",style:{display:"block",marginTop:8},children:["Recherche tag",c.jsx("input",{className:"input",value:L,onChange:ce=>C(ce.target.value),placeholder:"id ou label"})]}),c.jsx("div",{className:"grid",style:{marginTop:8,maxHeight:220,overflowY:"auto"},children:Object.keys(As).filter(ce=>{const xe=Qt(ce),De=L.toLowerCase();return xe.id.toLowerCase().includes(De)||xe.label.toLowerCase().includes(De)}).map(ce=>{const xe=Qt(ce),De=E.includes(ce);return c.jsxs("label",{className:"small row",style:{gap:6,alignItems:"center"},children:[c.jsx("input",{type:"checkbox",checked:De,onChange:Rt=>{P(Ze=>{const pt=new Set(Ze);return Rt.target.checked?pt.add(ce):pt.delete(ce),Array.from(pt)})}}),c.jsx("span",{children:xe.label}),c.jsx("span",{className:"small",style:{color:"var(--mc-muted)"},children:xe.id})]},ce)})})]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:6,flexWrap:"wrap"},children:[c.jsx("button",{className:"btn secondary",onClick:de,disabled:d,children:"Slectionner tout"}),c.jsx("button",{className:"btn secondary",onClick:Se,disabled:d||$.size===0,children:"Vider la slection"}),c.jsx("button",{className:"btn secondary",disabled:$.size===0||H,onClick:()=>Ie("reviewed"),children:"Mark reviewed (slection)"}),c.jsx("button",{className:"btn secondary",disabled:$.size===0||H,onClick:()=>Ie("published"),children:"Publier (slection)"}),c.jsx("button",{className:"btn secondary",disabled:$.size===0||H,onClick:()=>Ie("rejected",{requireNote:!0}),children:"Rejeter (slection)"}),c.jsx("button",{className:"btn secondary",disabled:$.size===0||H,onClick:ur,children:"Delete (soft, slection)"})]})]}),c.jsxs("div",{className:"grid",style:{gridTemplateColumns:"1.4fr 1fr",gap:12},children:[c.jsxs("div",{className:"card",style:{maxHeight:"70vh",overflow:"auto"},children:[c.jsx("div",{className:"small",style:{marginBottom:6},children:"Liste"}),o.length===0&&c.jsx("div",{className:"small",children:"Aucune question."}),o.map(ce=>c.jsx("div",{className:"pill",style:{padding:10,marginBottom:6,cursor:"pointer",border:f===ce.id?"2px solid var(--accent)":"1px solid rgba(255,255,255,0.12)"},onClick:()=>ee(ce),children:c.jsxs("div",{className:"row",style:{justifyContent:"space-between",gap:8},children:[c.jsxs("div",{className:"row",style:{alignItems:"flex-start",gap:8},children:[c.jsx("input",{type:"checkbox",checked:$.has(ce.id),onChange:xe=>{xe.stopPropagation(),Q(ce.id)}}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:700},children:ce.statement?.slice(0,80)||ce.id}),c.jsxs("div",{className:"small",children:[ce.primaryTag,"  ",ce.blockId,"  diff ",ce.difficulty]})]})]}),c.jsx("span",{className:"badge",children:Dp(ce.quality?.status||"draft")})]})},ce.id))]}),c.jsxs("div",{className:"card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",children:"dition"}),c.jsx("div",{style:{fontWeight:900},children:y?.id||"Slectionne une question"})]}),y&&c.jsx("span",{className:"badge",children:Dp(y.quality?.status||"draft")})]}),y&&c.jsxs("div",{className:"small",style:{marginTop:4},children:["Reports : ",c.jsx("strong",{children:q!==null?q:""}),c.jsx("button",{className:"btn secondary",style:{marginLeft:8,padding:"2px 8px",fontSize:"0.8rem"},onClick:Re,disabled:Y,children:Y?"...":"Charger"})]}),y?c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"small",style:{marginTop:10},children:["Enonc",c.jsx("textarea",{className:"input",value:y.statement||"",onChange:ce=>fe("statement",ce.target.value)})]}),(y.type==="MCQ"||y.type==="TRUE_FALSE")&&c.jsxs("label",{className:"small",children:["Choix (1 par ligne)",c.jsx("textarea",{className:"input",value:(y.choices||[]).join(`
`),onChange:ce=>fe("choices",ce.target.value.split(`
`).filter(xe=>xe.trim().length))})]}),c.jsxs("label",{className:"small",children:["Rponse attendue",c.jsx("input",{className:"input",value:y.answer||"",onChange:ce=>fe("answer",ce.target.value)})]}),c.jsxs("label",{className:"small",children:["Explication",c.jsx("textarea",{className:"input",value:y.explanation||"",onChange:ce=>fe("explanation",ce.target.value)})]}),c.jsxs("label",{className:"small",children:["Pige frquent",c.jsx("textarea",{className:"input",value:y.commonMistake||"",onChange:ce=>fe("commonMistake",ce.target.value)})]}),c.jsxs("div",{className:"row",style:{gap:8},children:[c.jsxs("label",{className:"small",children:["Difficult",c.jsx("input",{className:"input",type:"number",min:1,max:5,value:y.difficulty||1,onChange:ce=>fe("difficulty",Number(ce.target.value))})]}),c.jsxs("label",{className:"small",children:["PrimaryTag",c.jsx("input",{className:"input",value:y.primaryTag||"",onChange:ce=>fe("primaryTag",ce.target.value)})]}),c.jsxs("label",{className:"small",children:["BlockId",c.jsx("input",{className:"input",value:y.blockId||"",onChange:ce=>fe("blockId",ce.target.value)})]})]}),c.jsxs("label",{className:"small",children:["Secondary tags (comma)",c.jsx("input",{className:"input",value:(y.secondaryTags||[]).join(","),onChange:ce=>fe("secondaryTags",ce.target.value.split(",").map(xe=>xe.trim()).filter(Boolean))})]}),c.jsxs("label",{className:"small",children:["Meta tags (meta_x, comma)",c.jsx("input",{className:"input",value:(y.metaTags||[]).join(","),onChange:ce=>fe("metaTags",ce.target.value.split(",").map(xe=>xe.trim()).filter(Boolean))})]}),c.jsxs("label",{className:"small",children:["Note modration",c.jsx("textarea",{className:"input",value:x,onChange:ce=>I(ce.target.value),placeholder:"Ex: corrig lnonc, prt pour review"})]}),c.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap",marginTop:8},children:[c.jsx("button",{className:"btn secondary",onClick:$e,children:"Save"}),c.jsx("button",{className:"btn secondary",onClick:()=>e(`/admin/reports?questionId=${y.id}`),children:"Voir reports"}),c.jsx("button",{className:"btn secondary",onClick:()=>Me("reviewed"),children:"Mark reviewed"}),c.jsx("button",{className:"btn secondary",onClick:()=>Me("published",{requireNote:!1}),children:"Publish"}),c.jsx("button",{className:"btn secondary",onClick:()=>Me("rejected",{requireNote:!0}),children:"Reject"}),c.jsx("button",{className:"btn secondary",onClick:Wt,children:"Archive"}),c.jsx("button",{className:"btn secondary",onClick:At,children:"Delete (soft)"}),V]}),c.jsxs("div",{style:{marginTop:12},children:[c.jsx("div",{style:{fontWeight:700},children:"Historique"}),c.jsxs("div",{className:"small",children:[(y.quality?.history||[]).length===0&&"Aucun historique.",(y.quality?.history||[]).slice().reverse().map((ce,xe)=>c.jsxs("div",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",padding:"4px 0"},children:[c.jsxs("div",{children:[ce.action,"  ",ce.status||"","  ",ce.by]}),c.jsxs("div",{className:"small",style:{opacity:.8},children:[ce.at||""," ",ce.notes&&` ${ce.notes}`]})]},xe))]})]})]}):c.jsx("div",{className:"small",children:"Slectionne une question pour diter."})]})]}),c.jsxs("div",{className:"card",style:{marginTop:12},children:[c.jsx("h3",{style:{marginTop:0},children:"Nettoyage ancien format"}),c.jsxs("p",{className:"small",children:["Supprime les questions legacy (collection ",c.jsx("code",{children:"exercises"}),") par tag pour viter les doublons avec le nouveau flux."]}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("input",{className:"input",placeholder:"ex: fr_grammaire_phrase_simple",value:k,onChange:ce=>S(ce.target.value)}),c.jsx("button",{className:"btn secondary",onClick:Ir,children:"Supprimer legacy"}),O&&c.jsx("span",{className:"small",children:O})]})]})]})}const WO=["all","fr","math","en","es","hist"];function HO(){const t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}${n}${r}`}function KO(){const[t,e]=j.useState("fr"),[n,r]=j.useState(""),[s,o]=j.useState(""),[l,d]=j.useState(120),[h,f]=j.useState("balanced"),[g,y]=j.useState("standard"),[_,x]=j.useState(!0),[I,k]=j.useState(!0),[S,O]=j.useState("from_block_reference"),[B,V]=j.useState(""),[$,F]=j.useState(""),[H,A]=j.useState(""),P=j.useMemo(()=>{if(t==="all")return Object.keys(As).map(Y=>YS(Y));const W=Pl(t);return Gs(W)},[t]).filter(W=>{const Y=Qt(W.tagId),ne=n.toLowerCase();return Y.id.toLowerCase().includes(ne)||Y.label.toLowerCase().includes(ne)});j.useEffect(()=>{P.length&&!P.find(W=>W.tagId===s)&&o(P[0].tagId)},[P,s]);const L=s?Qt(s):null,C=L?.subject||(t!=="all"?t:"fr"),N=Pl(C),M=C==="en"?"en":C==="es"?"es":"fr",ie=j.useMemo(()=>{if(!s||!L)return"";const W=S==="manual_override"?"manual_override":"from_block_reference",Y=S==="manual_override"&&B.trim().length?`## lessonOverride
${B.trim()}
`:"";return["# Demande de gnration de pack riche","","Tag (blockId / primaryTag) :",s,"","Sujet (subject) :",C,"","WorldBiomeId (optionnel) :",N,"","Niveau :","5e","","Langue :",M,"","Nombre de questions :",String(l),"","Profil difficult :",h,"","Profil mix :",g,"","Rgles globales :","- Conformes  GENERATION_STRATEGY.md","- Stratgie par thme issue de THEME_STRATEGIES.md","- Import = status draft",`- Pas de texte  trou ambige : ${_}`,`- Inclure lesson + ancres : ${I}`,"","Leon :",`- Source : ${W}`,`- Rfrence : docs/question-generation/block-references/${C}/${s}.md`,"",Y,"Notes :",$||"",""].join(`
`)},[s,L,C,N,M,l,h,g,_,I,S,B,$]),te=async()=>{try{await navigator.clipboard.writeText(ie),A("Copi !"),setTimeout(()=>A(""),1500)}catch{A("Impossible de copier"),setTimeout(()=>A(""),2e3)}},q=()=>{const W=`pack_request_${s||"block"}_${HO()}.md`,Y=new Blob([ie],{type:"text/markdown"}),ne=URL.createObjectURL(Y),se=document.createElement("a");se.href=ne,se.download=W,se.click(),URL.revokeObjectURL(ne)};return c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Gnrer un brief de pack"}),c.jsxs("div",{className:"small",style:{marginBottom:8},children:["Les rgles pdagogiques sont dfinies dans ",c.jsx("code",{children:"GENERATION_STRATEGY.md"})," et ",c.jsx("code",{children:"THEME_STRATEGIES.md"}),"."]}),c.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[c.jsxs("label",{className:"small",children:["Biome",c.jsx("select",{className:"input",value:t,onChange:W=>e(W.target.value),children:WO.map(W=>c.jsx("option",{value:W,children:W==="all"?"Tous":ca[W]},W))})]}),c.jsxs("label",{className:"small",style:{flex:1,minWidth:220},children:["Recherche bloc",c.jsx("input",{className:"input",value:n,onChange:W=>r(W.target.value),placeholder:"label ou id"})]})]}),c.jsx("div",{style:{marginTop:10},children:P.length===0?c.jsx("div",{className:"small",children:"Aucun bloc pour ce filtre."}):c.jsxs("label",{className:"small",style:{display:"block"},children:["Bloc (tagId)",c.jsx("select",{className:"input",size:Math.min(10,Math.max(4,P.length)),value:s,onChange:W=>o(W.target.value),style:{width:"100%",marginTop:6},children:P.map(W=>{const Y=Qt(W.tagId);return c.jsxs("option",{value:W.tagId,children:[Y.label,"  ",Y.id]},W.tagId)})})]})})]}),c.jsxs("div",{className:"card",children:[c.jsx("h3",{style:{marginTop:0},children:"Options"}),c.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[c.jsxs("label",{className:"small",children:["Taille du pack",c.jsx("input",{className:"input",type:"number",min:1,value:l,onChange:W=>d(Number(W.target.value)||0)})]}),c.jsxs("label",{className:"small",children:["Profil difficult",c.jsxs("select",{className:"input",value:h,onChange:W=>f(W.target.value),children:[c.jsx("option",{value:"balanced",children:"balanced"}),c.jsx("option",{value:"easy",children:"easy"}),c.jsx("option",{value:"hard",children:"hard"})]})]}),c.jsxs("label",{className:"small",children:["Profil mix",c.jsxs("select",{className:"input",value:g,onChange:W=>y(W.target.value),children:[c.jsx("option",{value:"standard",children:"standard"}),c.jsx("option",{value:"mcq_only",children:"mcq_only"}),c.jsx("option",{value:"mcq_heavy",children:"mcq_heavy"}),c.jsx("option",{value:"with_error_spotting",children:"with_error_spotting"})]})]})]}),c.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap",marginTop:8},children:[c.jsxs("label",{className:"small row",style:{gap:6,alignItems:"center"},children:[c.jsx("input",{type:"checkbox",checked:_,onChange:W=>x(W.target.checked)}),"Pas de texte  trou ambigu"]}),c.jsxs("label",{className:"small row",style:{gap:6,alignItems:"center"},children:[c.jsx("input",{type:"checkbox",checked:I,onChange:W=>k(W.target.checked)}),"Inclure lesson + ancres"]}),c.jsxs("label",{className:"small",children:["Source leon",c.jsxs("select",{className:"input",value:S,onChange:W=>O(W.target.value),children:[c.jsx("option",{value:"from_block_reference",children:"from_block_reference"}),c.jsx("option",{value:"manual_override",children:"manual_override"})]})]})]}),S==="manual_override"&&c.jsxs("label",{className:"small",style:{display:"block",marginTop:10},children:["Markdown de leon (override)",c.jsx("textarea",{className:"input",style:{minHeight:120},value:B,onChange:W=>V(W.target.value)})]}),c.jsxs("label",{className:"small",style:{display:"block",marginTop:10},children:["Notes",c.jsx("textarea",{className:"input",style:{minHeight:80},value:$,onChange:W=>F(W.target.value)})]})]}),c.jsxs("div",{className:"card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsx("h3",{style:{margin:0},children:"Markdown gnr"}),c.jsxs("div",{className:"row",style:{gap:6},children:[c.jsx("button",{className:"btn secondary",onClick:te,disabled:!ie,children:"Copier"}),c.jsx("button",{className:"btn secondary",onClick:q,disabled:!ie,children:"Tlcharger .md"})]})]}),H&&c.jsx("div",{className:"small",style:{marginTop:6},children:H}),c.jsx("textarea",{className:"input",style:{marginTop:10,minHeight:280,fontFamily:"monospace"},value:ie,readOnly:!0})]})]})}const GO=[{value:"wrong_answer",label:"Mauvaise correction"},{value:"ambiguous",label:"nonc ambigu"},{value:"typo",label:"Faute ou typo"},{value:"too_hard",label:"Trop difficile"},{value:"off_topic",label:"Hors sujet"},{value:"other",label:"Autre"}];function QO(){const{user:t}=Hn(),e=ts(),[n,r]=iE(),[s,o]=j.useState({status:"open",reason:"",primaryTag:"",blockId:"",questionId:n.get("questionId")||"",dateRange:"7"}),[l,d]=j.useState([]),[h,f]=j.useState(!1),[g,y]=j.useState(""),[_,x]=j.useState(null),[I,k]=j.useState(n.get("questionId")),[S,O]=j.useState(!1),[B,V]=j.useState(null),[$,F]=j.useState(""),H=j.useCallback(async()=>{f(!0),F("");try{const N=await OV({sinceDays:s.dateRange==="all"?void 0:Number(s.dateRange)});d(N)}catch(N){F(N?.message||"Impossible de charger les reports.")}finally{f(!1)}},[s.dateRange]),A=j.useCallback(async N=>{O(!0);try{const[M,ie]=await Promise.all([US(N),UV(N)]);V({reports:M,totalAttempts:ie.total,wrongAttempts:ie.wrong,wrongRate:ie.wrongRate})}catch(M){V(null),F(M?.message||"Stats indisponibles.")}finally{O(!1)}},[]);j.useEffect(()=>{H()},[H]),j.useEffect(()=>{const N=new URLSearchParams;s.questionId&&N.set("questionId",s.questionId),r(N,{replace:!0})},[s.questionId,r]),j.useEffect(()=>{I?A(I):V(null)},[I,A]);const E=j.useMemo(()=>l.filter(N=>!(s.status&&N.status!==s.status||s.reason&&N.reason!==s.reason||s.questionId&&N.questionId!==s.questionId||s.primaryTag&&N.context?.primaryTag!==s.primaryTag||s.blockId&&N.context?.blockId!==s.blockId)),[s.blockId,s.primaryTag,s.questionId,s.reason,s.status,l]),P=j.useMemo(()=>FV(l,20),[l]),L=N=>o(M=>({...M,...N})),C=async(N,M)=>{x(N.id);try{await BV(N.id,M,{notes:g||void 0,resolvedBy:M==="resolved"?t?.uid||null:void 0}),d(ie=>ie.map(te=>te.id===N.id?{...te,status:M,admin:{...te.admin||{},notes:g||te.admin?.notes,resolvedBy:M==="resolved"?t?.uid||null:te.admin?.resolvedBy,resolvedAt:M==="resolved"?new Date:te.admin?.resolvedAt}}:te)),(M==="resolved"||M==="triaged")&&y("")}catch(ie){F(ie?.message||"Mise  jour impossible.")}finally{x(null)}};return c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Reports questions"}),c.jsxs("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[c.jsxs("label",{className:"small",children:["Statut",c.jsxs("select",{className:"input",value:s.status,onChange:N=>L({status:N.target.value}),children:[c.jsx("option",{value:"",children:"Tous"}),c.jsx("option",{value:"open",children:"Open"}),c.jsx("option",{value:"triaged",children:"Triaged"}),c.jsx("option",{value:"resolved",children:"Resolved"})]})]}),c.jsxs("label",{className:"small",children:["Raison",c.jsxs("select",{className:"input",value:s.reason,onChange:N=>L({reason:N.target.value}),children:[c.jsx("option",{value:"",children:"Toutes"}),GO.map(N=>c.jsx("option",{value:N.value,children:N.label},N.value))]})]}),c.jsxs("label",{className:"small",children:["Tag",c.jsx("input",{className:"input",value:s.primaryTag,onChange:N=>L({primaryTag:N.target.value}),placeholder:"primaryTag"})]}),c.jsxs("label",{className:"small",children:["Bloc",c.jsx("input",{className:"input",value:s.blockId,onChange:N=>L({blockId:N.target.value}),placeholder:"blockId"})]}),c.jsxs("label",{className:"small",children:["QuestionId",c.jsx("input",{className:"input",value:s.questionId,onChange:N=>{const M=N.target.value;L({questionId:M}),k(M||null)},placeholder:"id"})]}),c.jsxs("label",{className:"small",children:["Priode",c.jsxs("select",{className:"input",value:s.dateRange,onChange:N=>L({dateRange:N.target.value}),children:[c.jsx("option",{value:"7",children:"7 jours"}),c.jsx("option",{value:"30",children:"30 jours"}),c.jsx("option",{value:"all",children:"Tout"})]})]}),c.jsx("button",{className:"btn secondary",onClick:H,disabled:h,children:"Recharger"})]}),c.jsx("div",{className:"small",style:{marginTop:6},children:h?"Chargement":`${E.length} reports (${l.length} chargs)`}),$&&c.jsx("div",{className:"small",style:{color:"#ff5a6f",marginTop:6},children:$})]}),c.jsxs("div",{className:"grid",style:{gridTemplateColumns:"2fr 1fr",gap:12},children:[c.jsxs("div",{className:"card",style:{maxHeight:"60vh",overflowY:"auto"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:700},children:"Liste"}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Clique pour focus stats / modration."})]}),c.jsxs("label",{className:"small",style:{display:"flex",flexDirection:"column"},children:["Note admin",c.jsx("textarea",{className:"input",value:g,onChange:N=>y(N.target.value),placeholder:"Notes pour triage/rsolution"})]})]}),E.length===0&&c.jsx("div",{className:"small",style:{marginTop:8},children:"Aucun report."}),E.map(N=>{const M=typeof N.createdAt?.toDate=="function"?N.createdAt.toDate().toLocaleString():"";return c.jsx("div",{className:"pill",style:{marginTop:8,borderColor:I===N.questionId?"var(--accent)":void 0},children:c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"flex-start",gap:8},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:M}),c.jsxs("div",{style:{fontWeight:700},children:["QID ",N.questionId]}),c.jsxs("div",{className:"small",children:[N.reason,"  ",N.status]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)",maxWidth:460,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:N.message||""}),c.jsxs("div",{className:"small",style:{marginTop:4},children:[N.context?.primaryTag&&c.jsxs("span",{className:"badge",children:["tag ",N.context.primaryTag]})," "," ",N.context?.blockId&&c.jsxs("span",{className:"badge",children:["bloc ",N.context.blockId]})," "," ",N.context?.setId&&c.jsxs("span",{className:"badge",children:["set ",N.context.setId]})]})]}),c.jsxs("div",{className:"row",style:{gap:6,flexWrap:"wrap"},children:[c.jsx("button",{className:"btn secondary",onClick:()=>{k(N.questionId),L({questionId:N.questionId})},children:"Stats"}),c.jsx("button",{className:"btn secondary",onClick:()=>e("/admin/questions",{state:{focusQuestionId:N.questionId}}),children:"Ouvrir question"}),c.jsx("button",{className:"btn secondary",onClick:()=>C(N,"triaged"),disabled:_===N.id,children:"Trier"}),c.jsx("button",{className:"btn secondary",onClick:()=>C(N,"resolved"),disabled:_===N.id,children:"Rsoudre"})]})]})},N.id)})]}),c.jsxs("div",{className:"card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Stats question"}),c.jsx("div",{style:{fontWeight:900},children:I||""})]}),c.jsx("button",{className:"btn secondary",onClick:()=>I&&A(I),disabled:!I||S,children:"Rafrachir"})]}),S&&c.jsx("div",{className:"small",style:{marginTop:8},children:"Chargement"}),B&&!S&&c.jsxs("div",{style:{marginTop:8},children:[c.jsxs("div",{className:"small",children:["Reports : ",c.jsx("strong",{children:B.reports})]}),c.jsxs("div",{className:"small",children:["Attempts : ",c.jsx("strong",{children:B.totalAttempts})]}),c.jsxs("div",{className:"small",children:["Wrong : ",c.jsx("strong",{children:B.wrongAttempts})]}),c.jsxs("div",{className:"small",children:["Wrong rate : ",c.jsxs("strong",{children:[B.wrongRate,"%"]})]})]}),c.jsx("hr",{}),c.jsxs("div",{children:[c.jsxs("div",{style:{fontWeight:700},children:["Top reports (client, derniers ",l.length,")"]}),P.length===0&&c.jsx("div",{className:"small",children:"Aucun report."}),P.map(N=>c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginTop:6},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:700},children:N.questionId}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["reports: ",N.count]})]}),c.jsx("button",{className:"btn secondary",onClick:()=>{k(N.questionId),L({questionId:N.questionId})},children:"Voir"})]},N.questionId))]})]})]})]})}const XO=[{id:"all",label:"Toutes"},{id:"fr",label:"Franais"},{id:"math",label:"Maths"},{id:"en",label:"Anglais"},{id:"es",label:"Espagnol"},{id:"hist",label:"Histoire"}];function YO(t){if(!t)return null;const e=t.split("_")[0];return e==="fr"||e==="math"||e==="en"||e==="es"||e==="hist"?e:null}function JO(){const{user:t,activeChild:e}=Hn(),n=e?.id||t?.uid||null,{rewards:r}=Ps(n),[s,o]=j.useState("all"),[l,d]=j.useState(""),h=r.masteryByTag||{},f=Object.entries(h).map(([g,y])=>({tag:g,data:y,meta:Qt(g)})).filter(({tag:g,meta:y})=>s==="all"?!0:YO(g)===s).filter(({meta:g})=>g.label.toLowerCase().includes(l.toLowerCase())).sort((g,y)=>{const _=k=>k==="mastered"?0:k==="progressing"?1:2,x=_(g.data.state),I=_(y.data.state);return x!==I?x-I:(g.meta.order||9999)!==(y.meta.order||9999)?(g.meta.order||9999)-(y.meta.order||9999):g.meta.label.localeCompare(y.meta.label)});return n?c.jsxs("div",{children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Progression"}),c.jsxs("div",{className:"row",style:{alignItems:"center",gap:8},children:[c.jsx("span",{className:"small",children:"Matire"}),c.jsx("select",{className:"input",value:s,onChange:g=>o(g.target.value),children:XO.map(g=>c.jsx("option",{value:g.id,children:g.label},g.id))}),c.jsx("input",{className:"input",style:{maxWidth:260},placeholder:"Rechercher un tag",value:l,onChange:g=>d(g.target.value)})]})]}),c.jsx("div",{className:"grid",children:f.length===0?c.jsx("div",{className:"card small",children:"Aucune donne de matrise pour linstant."}):f.map(({tag:g,data:y,meta:_})=>{const x=Math.min(100,Math.max(0,Math.round(y.score||0)));return c.jsxs("div",{className:"card",style:{padding:12},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:_.label}),c.jsxs("div",{className:"small",children:[ca[_.subject],"  ",_.theme]}),c.jsx("div",{className:"small",title:nO[y.state]||"",children:tO[y.state]||y.state})]}),c.jsxs("div",{className:"small",children:[x,"/100"]})]}),c.jsx("div",{style:{height:10,background:"rgba(255,255,255,0.08)",borderRadius:999,marginTop:6},children:c.jsx("div",{style:{height:"100%",width:`${x}%`,background:y.state==="mastered"?"#2ecc71":y.state==="progressing"?"#7aa2ff":"#ff9f43",borderRadius:999}})})]},g)})})]}):c.jsx("div",{className:"card",children:"Slectionnez un enfant pour voir la progression."})}function ZO(){return c.jsx("div",{className:"container",children:c.jsx(JO,{})})}function eF(){return c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Page introuvable."})})}const tF={common:"Commun",rare:"Rare",epic:"pique"};function tC(){const{user:t,activeChild:e}=Hn(),n=e?.id||t?.uid||null,{rewards:r}=Ps(n),[s,o]=j.useState("sticker"),l=new Set(r?.collectibles?.owned||[]),d=r?.collectibles?.equippedAvatarId,h=async g=>{if(n)try{await lv(n,g)}catch(y){console.error("equipAvatar",y)}},f=Pi.filter(g=>g.type===s);return n?c.jsxs("div",{children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Collection"}),c.jsxs("div",{className:"row",style:{gap:8},children:[c.jsx("button",{className:`btn ${s==="sticker"?"":"secondary"}`,onClick:()=>o("sticker"),children:"Stickers"}),c.jsx("button",{className:`btn ${s==="avatar"?"":"secondary"}`,onClick:()=>o("avatar"),children:"Avatars"})]})]}),c.jsx("div",{className:"grid",children:f.map(g=>{const y=l.has(g.id),_=g.id===d;return c.jsxs("div",{className:"card",style:{opacity:y?1:.65},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"1.8rem"},children:g.icon}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:g.title}),c.jsx("div",{className:"small",children:g.description}),c.jsxs("div",{className:"small",children:["Raret : ",tF[g.rarity]]})]})]}),_&&c.jsx("span",{className:"badge",children:"quip"})]}),!y&&c.jsx("div",{className:"small",style:{marginTop:8,color:"rgba(255,255,255,0.7)"},children:" dbloquer en jouant "}),g.type==="avatar"&&y&&c.jsx("button",{className:"btn secondary",style:{marginTop:10},onClick:()=>h(g.id),children:_?"quip":"quiper"})]},g.id)})})]}):c.jsx("div",{className:"card",children:"Slectionnez un enfant pour voir sa collection."})}function nF(){return c.jsx("div",{className:"container",children:c.jsx(tC,{})})}function Rg(t){return Number.isNaN(t)?0:Math.max(0,Math.min(100,Math.round(t)))}function rF(t){return t?t instanceof Date?t:typeof t.toDate=="function"?t.toDate():null:null}function sF(t){if(!t)return 0;const e=Date.now()-t.getTime();return e>0?Math.floor(e/(1e3*60*60*24)):0}function _i(t,e){return e?Rg(t/e*100):0}function Lf(t){const e=t?.attempts??0,n=t?.correct??0,r=typeof t?.successRate=="number"?t.successRate:null,s=Rg(r!==null?r:e>0?n/e*100:0),o=Rg(typeof t?.masteryScore=="number"?t.masteryScore:typeof t?.score=="number"?t.score:0);let l;e===0?l="locked":o>=80?l="beautified":s<40?l="cracked":l="repaired";const d=sF(rF(t?.updatedAt)||null)>14;return{state:l,weathered:d,attempts:e,successRate:s,masteryScore:o}}function Tu(t,e,n,r,s){const o={total:n.length,locked:0,cracked:0,repaired:0,beautified:0,stable:0};let l=0;n.forEach(x=>{const I=r.blockProgress?.[x],k=r.masteryByTag?.[x]?.score,S=Lf({...I||{},score:I?.score??k??0});S.state==="locked"&&(o.locked+=1),S.state==="cracked"&&(o.cracked+=1),S.state==="repaired"&&(o.repaired+=1),S.state==="beautified"&&(o.beautified+=1),(S.state==="repaired"||S.state==="beautified")&&(o.stable+=1),S.weathered&&(l+=1)});const d=_i(o.locked+o.cracked,o.total),h=_i(o.stable,o.total);let f;const g=s?.target||35,y=s?.correctCount||0,_=y>=g;return _?f="rebuilt":y>0?f="rebuilding":d>=70?f="ruins":h>=80?f="rebuilt_ready":f="building",{state:f,breakdown:{...o,lockedPct:_i(o.locked,o.total),crackedPct:_i(o.cracked,o.total),stablePct:h},weatheredPct:_i(l,o.total),rebuild:s?{correctCount:y,target:g,rebuilt:_}:void 0}}function Yh(t,e,n,r){const s=e.map(({theme:k,tagIds:S})=>({theme:k,visual:Tu(t,k,S,n,r?.zoneRebuildProgress?.[`${t}__${k}`])})),o={totalTags:0,locked:0,cracked:0,repaired:0,beautified:0,stable:0};s.forEach(({visual:k})=>{o.totalTags+=k.breakdown.total,o.locked+=k.breakdown.locked,o.cracked+=k.breakdown.cracked,o.repaired+=k.breakdown.repaired,o.beautified+=k.breakdown.beautified,o.stable+=k.breakdown.stable});const l=_i(o.locked+o.cracked,o.totalTags),d=_i(o.stable,o.totalTags);let h;l>=70?h="wasteland":d>=80?h="thriving":d>=40?h="recovering":h="neglected";const f=e.length,g=s.filter(k=>k.visual.rebuild?.rebuilt).length,y=f>0?g/f>=.6:!1,_=r?.biomeRebuild?.target||100,x=r?.biomeRebuild?.correctCount||0;let I="not_ready";return x>=_?I="rebuilt":x>0&&y?I="rebuilding":y&&(I="ready"),{state:h,breakdown:{...o,lockedPct:_i(o.locked,o.totalTags),crackedPct:_i(o.cracked,o.totalTags),stablePct:d},zones:s,rebuild:{status:I,correctCount:x,target:_,rebuiltZones:g,totalZones:f}}}function iF(){const{user:t,activeChild:e}=Hn(),n=e?.id||t?.uid||null,{rewards:r,loading:s}=Ps(n),o=ts(),l=r.blockProgress||{},d=r.masteryByTag||{},h=r.zoneRebuildProgress||{},f=r.biomeRebuildProgress||{},g={not_ready:"Pas prt",ready:"Prt",rebuilding:"En reconstruction",rebuilt:"Reconstruit"};return n?c.jsxs("div",{className:"container grid",children:[c.jsxs("div",{className:"card mc-card",children:[c.jsx("h2",{className:"mc-title",children:"Carte du monde MaloCraft"}),c.jsx("div",{className:"small",children:"Choisis un biome pour voir tes blocs, leur tat et ta progression."})]}),c.jsx("div",{className:"grid2",children:Eh.map(y=>{const _=Gs(y.id),x=_.filter(H=>r.masteryByTag?.[H.tagId]?.state==="mastered").length,I=_.length,k=!s&&I>0?Math.round(x/I*100):null,S={};_.forEach(H=>{S[H.theme]||(S[H.theme]=[]),S[H.theme].push(H.tagId)});const O=Object.entries(S).map(([H,A])=>({theme:H,tagIds:A})),B=Yh(y.subject,O,{blockProgress:l,masteryByTag:d},{zoneRebuildProgress:h,biomeRebuild:f[y.subject]}),V=B.rebuild?.rebuiltZones||0,$=B.rebuild?.totalZones||O.length,F=Math.min(100,Math.round((B.rebuild?.correctCount||0)/(B.rebuild?.target||100)*100));return c.jsxs("div",{className:"card mc-card world-card",role:"button",tabIndex:0,onClick:()=>o(`/world/${y.id}`),onKeyDown:H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),o(`/world/${y.id}`))},children:[c.jsxs("div",{className:"row",style:{alignItems:"center",gap:12},children:[c.jsx("div",{style:{fontSize:"1.8rem"},children:y.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:800,fontSize:"1.1rem"},children:y.name}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:y.description})]}),c.jsxs("div",{className:"mc-chip accent",children:[I||0," blocs"]})]}),c.jsxs("div",{className:"small",style:{marginTop:10},children:["Progression : ",k!==null?`${k}% (${x}/${I})`:""]}),c.jsxs("div",{className:"small",style:{marginTop:6},children:["Zones reconstruites : ",V,"/",$,"  Biome ",g[B.rebuild?.status||"not_ready"]]}),c.jsx("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid var(--mc-border)",borderRadius:6,height:10,overflow:"hidden",marginTop:6},children:c.jsx("div",{style:{width:`${F}%`,background:"var(--mc-accent)",height:"100%"}})})]},y.id)})})]}):c.jsx("div",{className:"container grid",children:c.jsx("div",{className:"card",children:"Slectionnez un enfant rattach pour accder  la carte du monde."})})}function nC(t){const[e,n]=j.useState(null),[r,s]=j.useState(!!t);return j.useEffect(()=>{let o=null;if(!t){n(null),s(!1);return}return(async()=>{try{await KS(t)}catch{}const l=Oe(we,"users",t,"meta","daily");o=kS(l,d=>{d.exists()?n(d.data()):n(null),s(!1)},()=>s(!1))})(),()=>{o&&o()}},[t]),{daily:e,loading:r}}function kg(t,e){return t?.[e]?.state||"discovering"}function Jh(t){switch(t){case"mastered":return"Brillant";case"progressing":return"Solide";default:return"Fissur"}}function rC(t){const{tagId:e,biomeId:n,masteryState:r,shouldRepair:s}=t,o=[];o.push({type:"mine",biomeId:n,targetTagId:e,estimatedMinutes:10,recommended:!1}),s&&o.push({type:"repair",biomeId:n,targetTagId:e,estimatedMinutes:8,recommended:!0}),r!=="discovering"&&o.push({type:"craft",biomeId:n,targetTagId:e,estimatedMinutes:12,recommended:!1});let l=!1;return o.forEach(d=>{d.recommended&&!l?l=!0:d.recommended=!1}),!l&&o.length&&(o[0].recommended=!0),o}const Dc={zone_rebuild:["Cette zone est presque prte. Chaque bonne rponse aide  la reconstruire.","On peut rebtir cette zone ensemble. Tes rponses consolident les blocs.","Encore un effort et la zone sera reconstruite."],biome_rebuild:["Une grande reconstruction est possible dans ce biome.","Le biome peut renatre : lanons la reconstruction.","Cest le moment de rparer tout le biome."],remediation:["Ce bloc est fragile. Le rparer aidera tout le biome.","On rpare ce bloc avant quil ne seffondre.","Ce bloc fissur a besoin de toi."],progression:["Continuons ce bloc pour stabiliser la zone.","On avance sur ce bloc pour faire progresser le biome.","Encore un peu de travail sur ce bloc."],fallback:["Tu peux choisir ce que tu veux travailler.","Libre  toi dexplorer le biome.","Choisis le bloc qui tinspire aujourdhui."]};function oF(t,e,n){const r=e?.[t]?.score,s=n?.[t]?.score??n?.[t]?.masteryScore,o=typeof r=="number"?r:typeof s=="number"?s:0;return Number.isNaN(o)?0:Math.max(0,Math.min(100,Math.round(o)))}function aF(t,e){return!e||e.size===0?!0:t.some(n=>e.has(n))}function lF(t,e,n,r){const s=[];return t.forEach(o=>{o.tagIds.forEach(l=>{if(n&&n.size&&!n.has(l)||r&&r.size&&!r.has(l))return;const d=oF(l,e.masteryByTag,e.blockProgress);s.push({tagId:l,score:d,zoneTheme:o.theme,zoneState:o.visual.state})})}),s}function cF(t){const e=t.allowedTags&&t.allowedTags.size?t.allowedTags:void 0,n=lF(t.zones,t,e,t.availableTags),r=[];t.zones.forEach(g=>{aF(g.tagIds,e)&&(g.visual.state==="rebuilt_ready"||g.visual.state==="rebuilding")&&r.push({adviceId:`zone_rebuild_${t.subjectId}__${g.theme}`,actionType:"reconstruction_theme",payload:{theme:g.theme,expeditionType:"repair"},messageCode:"zone_rebuild",messageVariants:Dc.zone_rebuild,meta:{zoneState:g.visual.state}})});const s=t.biomeVisual.rebuild,o=s?.correctCount||0,l=s?.target||100;return s&&(s.status==="ready"||s.status==="rebuilding")&&o<l&&r.push({adviceId:`biome_rebuild_${t.subjectId}`,actionType:"reconstruction_biome",payload:{expeditionType:"repair"},messageCode:"biome_rebuild",messageVariants:Dc.biome_rebuild,meta:{zoneState:s.status}}),n.filter(g=>g.score<50).forEach(g=>{const y=Qt(g.tagId);r.push({adviceId:`remediate_${g.tagId}`,actionType:"tag_session",payload:{tagId:g.tagId,expeditionType:"repair"},messageCode:"remediation",messageVariants:Dc.remediation.map(_=>_.replace("ce bloc",y?.label||"ce bloc")),meta:{score:g.score,zoneState:g.zoneState}})}),n.filter(g=>g.score>=30&&g.score<80&&g.zoneState!=="rebuilt").forEach(g=>{const y=Qt(g.tagId);r.push({adviceId:`progress_${g.tagId}`,actionType:"tag_session",payload:{tagId:g.tagId,expeditionType:"mine"},messageCode:"progression",messageVariants:Dc.progression.map(_=>_.replace("ce bloc",y?.label||"ce bloc")),meta:{score:g.score,zoneState:g.zoneState}})}),r.push({adviceId:`explore_${t.subjectId}`,actionType:"explore",messageCode:"fallback",messageVariants:Dc.fallback}),r}function uF(t,e){return t&&e?{theme:.55,remediation:.2,progress:.2,biome:.05,fallback:.05}:t?{theme:.45,remediation:.25,progress:.25,biome:.05,fallback:.05}:{theme:.2,remediation:.25,progress:.3,biome:.15,fallback:.1}}function dF(t,e){const n=t.some(I=>I.actionType==="reconstruction_theme"),r=t.some(I=>I.actionType==="reconstruction_theme"&&I.meta?.zoneState==="rebuilding"),s=uF(n,r),o=e.rebuild,l=o?.correctCount||0,d=o?.target||100,h=o&&(o.status==="ready"||o.status==="rebuilding")&&l<d;let f=h?s.biome:0;if(h&&d){const I=l/d*100;I>=90?f*=2:I>=70&&(f*=1.5)}const g={theme:[],remediation:[],progress:[],biome:[],fallback:[]};t.forEach(I=>{I.actionType==="reconstruction_theme"?g.theme.push(I):I.actionType==="reconstruction_biome"?g.biome.push(I):I.actionType==="tag_session"&&I.adviceId.startsWith("remediate_")?g.remediation.push(I):I.actionType==="tag_session"&&I.adviceId.startsWith("progress_")?g.progress.push(I):g.fallback.push(I)});const y=new Map,_=(I,k)=>{if(!I.length||k<=0)return;const S=k/I.length;I.forEach(O=>y.set(O.adviceId,S))};_(g.theme,s.theme),_(g.remediation,s.remediation),_(g.progress,s.progress),_(g.biome,f),_(g.fallback,s.fallback);const x=Array.from(y.values()).reduce((I,k)=>I+k,0);if(x===0&&t.length){const I=1/t.length;return t.forEach(k=>y.set(k.adviceId,I)),y}return x>0&&t.forEach(I=>{const k=y.get(I.adviceId)||0;y.set(I.adviceId,k/x)}),y}function hF(t){let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e=Math.imul(e,16777619);return e>>>0}function fF(t){return function(){let e=t+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function vx(t,e,n){const r=t.map(d=>({opt:d,w:e.get(d.adviceId)??0})),s=r.reduce((d,h)=>d+h.w,0);if(s<=0)return t[0];const o=n()*s;let l=0;for(const d of r)if(l+=d.w,o<=l)return d.opt;return r[r.length-1].opt}function mF(t,e,n){if(!n)return e;const r=new Map(e),s=t.filter(l=>l.adviceId===n.adviceId||l.actionType===n.actionType).map(l=>l.adviceId);if(!s.length)return e;s.forEach(l=>{const d=r.get(l);typeof d=="number"&&r.set(l,d*.25)});const o=Array.from(r.values()).reduce((l,d)=>l+d,0);return o===0?e:(r.forEach((l,d)=>r.set(d,l/o)),r)}function pF(t,e,n,r){if(!t.length)throw new Error("No options available for NPC advisor");if(t.length===1)return t[0];const s=vx(t,e,n);if(!(r&&(s.adviceId===r.adviceId||s.actionType===r.actionType)))return s;const l=mF(t,e,r);return vx(t,l,n)}function sC(t){const e=cF(t),n=dF(e,t.biomeVisual),r=hF(t.seed),s=fF(r||1),o=pF(e,n,s,t.lastAdvice),l=t.lastAdvice?.messageKey||null,d=y=>{if(!y||!y.startsWith(`${o.messageCode}:`))return null;const _=Number(y.split(":")[1]||0);return!Number.isFinite(_)||_<0||_>=o.messageVariants.length?null:{messageKey:y,message:o.messageVariants[_]}},h=t.lastAdvice?.adviceId===o.adviceId?d(l):null,{messageKey:f,message:g}=h||(()=>{if(o.messageVariants.length===0)return{messageKey:`${o.messageCode}:0`,message:""};let y=0;if(l?.startsWith(`${o.messageCode}:`)){const _=Number(l.split(":")[1]||0);Number.isFinite(_)&&_>=0&&(y=(_+1)%o.messageVariants.length)}return{messageKey:`${o.messageCode}:${y}`,message:o.messageVariants[y]}})();return{adviceId:o.adviceId,messageKey:f,message:g,ctaLabel:o.actionType==="reconstruction_theme"?"Continuer la reconstruction":o.actionType==="reconstruction_biome"?"Reconstruire le biome":o.actionType==="tag_session"&&o.payload?.expeditionType==="repair"?"Rparer ce bloc":o.actionType==="tag_session"?"Continuer la progression":"Explorer le biome",actionType:o.actionType,payload:o.payload}}function iC({open:t,onClose:e,onPicked:n}){return t?c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999},children:c.jsxs("div",{className:"card mc-card",style:{maxWidth:600,width:"92%",maxHeight:"90vh",overflowY:"auto"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsx("h3",{className:"mc-title",children:"Choisis ton guide"}),c.jsx("button",{className:"mc-button secondary",onClick:e,children:"Fermer"})]}),c.jsx("div",{className:"grid2",children:Object.values(va).map(r=>c.jsxs("div",{className:"mc-card",style:{border:"2px solid var(--mc-border)"},children:[c.jsxs("div",{className:"row",style:{alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"2rem"},children:r.avatar}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:900},children:r.name}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:r.shortTagline})]})]}),c.jsx("button",{className:"mc-button",style:{marginTop:10,width:"100%"},onClick:()=>{cv(r.id),n?.(r.id),e()},children:"Choisir"})]},r.id))})]})}):null}function gF(){const t=new Date,n=new Intl.DateTimeFormat("fr-FR",{timeZone:"Europe/Paris",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),r=n.find(l=>l.type==="year")?.value,s=n.find(l=>l.type==="month")?.value,o=n.find(l=>l.type==="day")?.value;return`${r}-${s}-${o}`}function yF(){const{biomeId:t}=Ru(),e=t?xi(t):null,{user:n,activeChild:r}=Hn(),s=r?.id||n?.uid||null,{rewards:o,loading:l}=Ps(s),{daily:d}=nC(s),h=ts(),[f,g]=j.useState(null),[y,_]=j.useState({}),[x,I]=j.useState(xu()),[k,S]=j.useState(!1),[O,B]=j.useState(null),V=(()=>{try{if(typeof window>"u")return null;const Q=localStorage.getItem(`npcGuide:last:${t||""}`);if(!Q)return null;try{const de=JSON.parse(Q);if(de&&de.adviceId&&de.actionType)return de}catch{return{adviceId:"legacy",actionType:"explore",messageKey:Q}}}catch{return null}})(),$=j.useRef(V);if(!t||!e)return c.jsx("div",{className:"container grid",children:c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{className:"small",children:"Biome introuvable."}),c.jsx("button",{className:"mc-button secondary",style:{marginTop:10},onClick:()=>h("/world"),children:" Retour carte"})]})});if(!s)return c.jsx("div",{className:"container grid",children:c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{className:"small",children:"Slectionnez un enfant rattach pour accder au biome."}),c.jsx("button",{className:"mc-button secondary",style:{marginTop:10},onClick:()=>h("/world"),children:" Retour carte"})]})});const F=o.masteryByTag||{},H=o.blockProgress||{},A=o.zoneRebuildProgress||{},E=o.biomeRebuildProgress||{},P={mastered:0,progressing:1,discovering:2},L=Gs(t).map(Q=>{const de=Qt(Q.tagId),Se=kg(F,Q.tagId),fe=H[Q.tagId],Re=Lf({...fe||{},score:fe?.score??F?.[Q.tagId]?.score??0});return{...Q,masteryState:Se,visual:Re,description:de.description}}).sort((Q,de)=>{const Se=(P[Q.masteryState]??2)-(P[de.masteryState]??2);if(Se!==0)return Se;const fe=Q.theme.localeCompare(de.theme);return fe!==0?fe:Q.blockName.localeCompare(de.blockName)}),C=L.find(Q=>Q.tagId===f)||null,N=C?rC({tagId:C.tagId,biomeId:t,masteryState:C.masteryState,shouldRepair:Df(C.tagId,[])}):[];j.useEffect(()=>{let Q=!1;return(async()=>{const Se=await Promise.all(L.map(async fe=>{try{const Re=await tu(fe.tagId,{uid:s});return[fe.tagId,Re.length>0]}catch{return[fe.tagId,!1]}}));if(!Q){const fe={};Se.forEach(([Re,$e])=>{fe[Re]=$e}),_(fe)}})(),()=>{Q=!0}},[L,s]),j.useEffect(()=>{try{if(typeof window>"u")return;const Q=localStorage.getItem(`npcGuide:last:${t||""}`);if(!Q){$.current=null;return}const de=JSON.parse(Q);de&&de.adviceId&&de.actionType?$.current=de:$.current={adviceId:"legacy",actionType:"explore",messageKey:Q}}catch{$.current=null}},[t]),j.useEffect(()=>{let Q=!1;if(!s){B(null);return}return kl(s).then(de=>{Q||B(new Set(de))}).catch(()=>{Q||B(null)}),()=>{Q=!0}},[s]),j.useEffect(()=>{I(xu())},[t]);const M=j.useMemo(()=>{const Q={};return L.forEach(de=>{Q[de.theme]||(Q[de.theme]=[]),Q[de.theme].push(de)}),Object.entries(Q).map(([de,Se])=>({theme:de,tagIds:Se.map(fe=>fe.tagId),visual:Tu(e.subject,de,Se.map(fe=>fe.tagId),{blockProgress:H,masteryByTag:F},A[jl(e.subject,de)]),blocks:Se}))},[L,H,F,e.subject,A]),ie=j.useMemo(()=>Yh(e.subject,M.map(Q=>({theme:Q.theme,tagIds:Q.tagIds})),{blockProgress:H,masteryByTag:F},{zoneRebuildProgress:A,biomeRebuild:E[e.subject]}),[e.subject,M,H,F,A,E]),te=d?.dateKey||gF(),q=j.useMemo(()=>{if(!t)return null;const Q=`${s||"anon"}|${t}|${te}`,de=new Set(Object.entries(y).filter(([,Se])=>Se!==!1).map(([Se])=>Se));return sC({subjectId:e.subject,zones:M,biomeVisual:ie,masteryByTag:F,blockProgress:H,allowedTags:O||void 0,availableTags:de,seed:Q,lastAdvice:$.current})},[O,y,e.subject,t,ie,H,te,F,s,M]);j.useEffect(()=>{if(!(!q||!t)&&!($.current?.adviceId===q.adviceId&&$.current?.messageKey===q.messageKey)){$.current={adviceId:q.adviceId,actionType:q.actionType,messageKey:q.messageKey};try{localStorage.setItem(`npcGuide:last:${t}`,JSON.stringify($.current))}catch{}}},[t,q]);const W={ruins:"Ruines",building:"En chantier",rebuilt_ready:"Prte  reconstruire",rebuilding:"Reconstruction en cours",rebuilt:"Reconstruite"},Y={ruins:"",building:"accent",rebuilt_ready:"gold",rebuilding:"accent",rebuilt:"gold"},ne={not_ready:"Pr-requis manquants",ready:"Biome prt",rebuilding:"Reconstruction en cours",rebuilt:"Biome reconstruit"},se=ie.rebuild?.status==="ready"||ie.rebuild?.status==="rebuilding",z=va[x],ee=j.useCallback(()=>{if(q){if(q.actionType==="reconstruction_theme"&&q.payload?.theme){h(`/theme/reconstruction_${encodeURIComponent(q.payload.theme)}?sessionKind=reconstruction_theme&subjectId=${e.subject}&theme=${encodeURIComponent(q.payload.theme)}`);return}if(q.actionType==="reconstruction_biome"){h(`/theme/reconstruction_biome_${e.subject}?sessionKind=reconstruction_biome&subjectId=${e.subject}`);return}if(q.actionType==="tag_session"){const Q=q.payload?.tagId;if(Q){const de=new URLSearchParams;de.set("expeditionType",q.payload?.expeditionType||"mine"),de.set("targetTagId",Q),de.set("biomeId",t),h(`/theme/expedition?${de.toString()}`);return}}h(`/world/${t}`)}},[e.subject,t,h,q]);return c.jsxs("div",{className:"container grid",children:[c.jsxs("div",{className:"card mc-card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsx("button",{className:"mc-button secondary",onClick:()=>h("/world"),children:" Retour carte"}),c.jsxs("div",{className:"mc-chip accent",children:[L.length," blocs"]})]}),c.jsxs("h2",{className:"mc-title",style:{marginTop:10},children:[e.icon," ",e.name]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:e.description})]}),q&&c.jsxs("div",{className:"card mc-card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"2rem"},children:z.avatar}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:900},children:z.name}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:z.shortTagline})]})]}),c.jsx("button",{className:"mc-button secondary",onClick:()=>S(!0),children:"Changer de guide"})]}),c.jsx("div",{className:"mc-card",style:{marginTop:10,border:"2px solid var(--mc-border)"},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,justifyContent:"space-between"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Guide MaloCraft"}),c.jsx("div",{style:{fontWeight:800},children:q.message})]}),c.jsx("button",{className:"mc-button",onClick:ee,children:q.ctaLabel})]})})]}),c.jsxs("div",{className:"card mc-card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Biome"}),c.jsx("div",{style:{fontWeight:800},children:"Reconstruction du biome"}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["Zones reconstruites : ",ie.rebuild?.rebuiltZones||0,"/",ie.rebuild?.totalZones||0," (seuil 60%)"]})]}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("span",{className:"mc-chip",children:ne[ie.rebuild?.status||"not_ready"]}),c.jsx("button",{className:"mc-button",disabled:!se,title:se?"Lancer la reconstruction du biome":"Reconstruis dabord 60% des zones",onClick:()=>{se&&h(`/theme/reconstruction_biome_${e.subject}?sessionKind=reconstruction_biome&subjectId=${e.subject}`)},children:"Reconstruire le biome"})]})]}),c.jsxs("div",{style:{marginTop:10},children:[c.jsxs("div",{className:"small",children:["Jauge : ",ie.rebuild?.correctCount||0,"/",ie.rebuild?.target||100]}),c.jsx("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid var(--mc-border)",borderRadius:6,height:12,overflow:"hidden"},children:c.jsx("div",{style:{width:`${Math.min(100,Math.round((ie.rebuild?.correctCount||0)/(ie.rebuild?.target||100)*100))}%`,background:"var(--mc-accent)",height:"100%"}})})]})]}),c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Zones du biome"}),c.jsxs("div",{style:{fontWeight:800},children:["tat des zones (",M.length,")"]})]})}),l?c.jsx("div",{className:"grid2",style:{marginTop:10},children:[1,2,3].map(Q=>c.jsx("div",{className:"mc-card skeleton",style:{height:82}},Q))}):c.jsx("div",{className:"grid2",style:{marginTop:10},children:M.map(Q=>c.jsxs("div",{className:"mc-card",role:"button",tabIndex:0,onClick:()=>h(`/world/${t}/zone/${encodeURIComponent(Q.theme)}`),onKeyDown:de=>{(de.key==="Enter"||de.key===" ")&&(de.preventDefault(),h(`/world/${t}/zone/${encodeURIComponent(Q.theme)}`))},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:Q.theme}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[Q.blocks.length," blocs  stables ",Q.visual.breakdown.stablePct,"%"]})]}),c.jsx("span",{className:`mc-chip ${Y[Q.visual.state]||""}`,children:W[Q.visual.state]||Q.visual.state})]}),Q.visual.rebuild&&c.jsxs("div",{style:{marginTop:6},children:[c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["Reconstruction : ",Q.visual.rebuild.correctCount,"/",Q.visual.rebuild.target]}),c.jsx("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid var(--mc-border)",borderRadius:6,height:8,overflow:"hidden"},children:c.jsx("div",{style:{width:`${Math.min(100,Math.round(Q.visual.rebuild.correctCount/Q.visual.rebuild.target*100))}%`,background:"var(--mc-accent)",height:"100%"}})})]}),Q.visual.weatheredPct>0&&c.jsxs("div",{className:"small",style:{marginTop:6,color:"var(--mc-muted)"},children:[Q.visual.weatheredPct,"% des blocs patins (14j+ sans activit)"]})]},Q.theme))})]}),l?c.jsx("div",{className:"grid",children:[1,2,3].map(Q=>c.jsx("div",{className:"block-card mc-card skeleton"},Q))}):c.jsx("div",{className:"grid",style:{gap:12},children:L.map(Q=>{const de=Q.masteryState==="mastered"?"block-shiny":Q.masteryState==="progressing"?"block-solid":"block-cracked",Se=Q.masteryState==="mastered"?"gold":Q.masteryState==="progressing"?"accent":"",fe=y[Q.tagId]!==!1;return c.jsxs("div",{className:`block-card mc-card ${de}`,role:"button",tabIndex:0,onClick:()=>fe&&g(Q.tagId),onKeyDown:Re=>{fe&&(Re.key==="Enter"||Re.key===" ")&&(Re.preventDefault(),g(Q.tagId))},style:{cursor:fe?"pointer":"not-allowed",opacity:fe?1:.55,outline:f===Q.tagId?"2px solid var(--mc-accent)":void 0},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:Q.blockName}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Q.description||"Description  venir."})]}),c.jsxs("span",{className:`mc-chip ${Se}`,children:[Q.masteryState==="mastered"?"":Q.masteryState==="progressing"?"":""," ",Jh(Q.masteryState)]})]}),!fe&&c.jsx("div",{className:"small",style:{color:"var(--mc-muted)",marginTop:6},children:"Pas encore de missions pour ce bloc."})]},Q.tagId)})}),C&&c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999},role:"dialog","aria-modal":"true",children:c.jsxs("div",{className:"card mc-card",style:{maxWidth:520,width:"92%",maxHeight:"90vh",overflowY:"auto"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Bloc cibl"}),c.jsx("div",{style:{fontWeight:900},children:C.blockName}),c.jsx("div",{className:"small",children:Jh(C.masteryState)})]}),c.jsx("button",{className:"mc-button secondary",onClick:()=>g(null),children:"Fermer"})]}),c.jsx("div",{className:"grid",style:{gap:10,marginTop:12},children:N.slice(0,3).map(Q=>{const de=Q.type==="mine"?"":Q.type==="repair"?"":"",Se=Q.type==="mine"?"Mine":Q.type==="repair"?"Rparer":"Artisanat",fe=Q.type==="mine"?"Rcolte et consolidation de ton bloc.":Q.type==="repair"?"Corriger les fissures : focus sur les erreurs rcentes.":"Combiner ce bloc avec un autre pour progresser.";return c.jsxs("div",{className:"mc-card",style:{border:"2px solid var(--mc-border)"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[c.jsx("div",{style:{fontSize:"1.4rem"},children:de}),c.jsxs("div",{children:[c.jsxs("div",{style:{fontWeight:800},children:[Se," ",Q.recommended?" recommand":""]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:fe})]})]}),c.jsxs("div",{className:"mc-chip",children:[Q.estimatedMinutes," min"]})]}),c.jsx("button",{className:"mc-button",style:{marginTop:10,width:"100%"},onClick:()=>h(`/theme/expedition?expeditionType=${Q.type}&targetTagId=${C.tagId}&biomeId=${t}`),children:"Commencer lexpdition"})]},Q.type)})})]})}),c.jsx(iC,{open:k,onClose:()=>S(!1),onPicked:Q=>{I(Q),cv(Q),S(!1)}})]})}function vF(){const{biomeId:t,themeId:e}=Ru(),n=e?decodeURIComponent(e):null,r=t?xi(t):null,{user:s,activeChild:o}=Hn(),l=o?.id||s?.uid||null,{rewards:d,loading:h}=Ps(l),f=ts();if(!t||!r||!n)return c.jsx("div",{className:"container grid",children:c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{className:"small",children:"Zone introuvable."}),c.jsx("button",{className:"mc-button secondary",style:{marginTop:10},onClick:()=>f("/world"),children:" Retour carte"})]})});if(!l)return c.jsx("div",{className:"container grid",children:c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{className:"small",children:"Slectionnez un enfant rattach pour accder  cette zone."}),c.jsx("button",{className:"mc-button secondary",style:{marginTop:10},onClick:()=>f("/world"),children:" Retour carte"})]})});const g=d.blockProgress||{},y=d.masteryByTag||{},_=d.zoneRebuildProgress?.[jl(r.subject,n)]||null,I=Gs(t).filter(F=>F.theme===n).map(F=>{const H=Qt(F.tagId),A=g[F.tagId],E=Lf({...A||{},score:A?.score??y?.[F.tagId]?.score??0});return{...F,label:H.label,description:H.description,visual:E}}),k=Tu(r.subject,n,I.map(F=>F.tagId),{blockProgress:g,masteryByTag:y},_),S={locked:"Verrouill",beautified:"Embelli",cracked:"Fissur",repaired:"Rpar"},O={locked:"",beautified:"gold",cracked:"",repaired:"accent"},B={ruins:"Ruines",building:"En chantier",rebuilt_ready:"Prte  reconstruire",rebuilding:"Reconstruction en cours",rebuilt:"Reconstruite"},V=k.state==="rebuilt_ready"||k.state==="rebuilding",$=k.rebuild?`${k.rebuild.correctCount}/${k.rebuild.target}`:"0/35";return c.jsxs("div",{className:"container grid",children:[c.jsxs("div",{className:"card mc-card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsx("button",{className:"mc-button secondary",onClick:()=>f(`/world/${t}`),children:" Retour biome"}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("span",{className:`mc-chip ${k.state==="rebuilt_ready"||k.state==="rebuilt"?"gold":k.state==="building"||k.state==="rebuilding"?"accent":""}`,children:B[k.state]}),c.jsx("button",{className:"mc-button",disabled:!V,title:V?"Lancer la reconstruction":"Stabilise dabord les blocs",onClick:()=>{V&&f(`/theme/reconstruction_${encodeURIComponent(n)}?sessionKind=reconstruction_theme&subjectId=${r.subject}&theme=${encodeURIComponent(n)}`)},children:"Reconstruire la zone"})]})]}),c.jsxs("h2",{className:"mc-title",style:{marginTop:10},children:[r.icon," ",r.name,"  ",n]}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[I.length," blocs  stables ",k.breakdown.stablePct,"%  patins ",k.weatheredPct,"%  Reconstruction ",$]}),k.rebuild&&c.jsxs("div",{style:{marginTop:8},children:[c.jsxs("div",{className:"small",children:["Jauge : ",k.rebuild.correctCount,"/",k.rebuild.target]}),c.jsx("div",{style:{background:"rgba(255,255,255,0.08)",border:"1px solid var(--mc-border)",borderRadius:6,height:10,overflow:"hidden"},children:c.jsx("div",{style:{width:`${Math.min(100,Math.round(k.rebuild.correctCount/k.rebuild.target*100))}%`,background:"var(--mc-accent)",height:"100%"}})})]})]}),h?c.jsx("div",{className:"grid",children:[1,2,3].map(F=>c.jsx("div",{className:"block-card mc-card skeleton"},F))}):I.length?c.jsx("div",{className:"grid",style:{gap:12},children:I.map(F=>{const H=O[F.visual.state]||"",A=F.visual.weathered;return c.jsxs("div",{className:`block-card mc-card ${A?"block-weathered":""}`,style:{position:"relative"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:F.label}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:F.description||"Description  venir."})]}),c.jsx("span",{className:`mc-chip ${H}`,children:S[F.visual.state]})]}),c.jsxs("div",{className:"row",style:{marginTop:8,gap:10},children:[c.jsxs("div",{className:"small",children:["Russite : ",F.visual.successRate,"%"]}),c.jsxs("div",{className:"small",children:["Matrise : ",F.visual.masteryScore,"%"]}),c.jsxs("div",{className:"small",children:["Tentatives : ",F.visual.attempts]}),A&&c.jsx("span",{className:"mc-chip muted",children:"Patin  14j+"})]})]},F.tagId)})}):c.jsx("div",{className:"card mc-card",children:c.jsx("div",{className:"small",children:"Aucun bloc pour cette zone."})})]})}const _F={common:"Commun",rare:"Rare",epic:"pique"},wF={sticker:"Sticker",fragment:"Fragment",trophy:"Trophe",avatar:"Avatar"};function oC(){const{user:t,activeChild:e}=Hn(),n=e?.id||t?.uid||null,{rewards:r}=Ps(n),s=new Set(r.malocraft?.ownedLootIds||[]),[o,l]=j.useState("all"),d=async f=>{if(n)try{await lv(n,f)}catch(g){console.error("equip avatar",g)}},h=bu.filter(f=>o==="all"?!0:f.type===o).sort((f,g)=>(f.biomeId||"").localeCompare(g.biomeId||"")||f.title.localeCompare(g.title));return n?c.jsxs("div",{className:"grid",children:[c.jsxs("div",{className:"card mc-card",children:[c.jsx("h2",{className:"mc-title",children:"Coffre MaloCraft"}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Tous les loots gagns en expditions."}),c.jsx("div",{className:"row",style:{gap:8,marginTop:10,flexWrap:"wrap"},children:["all","sticker","fragment","trophy","avatar"].map(f=>c.jsx("button",{className:`mc-button ${o===f?"":"secondary"}`,onClick:()=>l(f),children:f==="all"?"Tout":wF[f]},f))})]}),c.jsx("div",{className:"grid2",children:h.map(f=>{const g=s.has(f.id),y=f.type==="avatar",_=r.collectibles?.equippedAvatarId===f.id;return c.jsxs("div",{className:"card mc-card",style:{opacity:g?1:.5},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[c.jsx("div",{style:{fontSize:"1.8rem"},children:f.icon}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:f.title}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:f.description}),c.jsxs("div",{className:"small",children:[_F[f.rarity]," ",f.biomeId?` ${f.biomeId}`:""]})]})]}),_&&c.jsx("span",{className:"mc-chip accent",children:"quip"})]}),!g&&c.jsx("div",{className:"small",style:{marginTop:6},children:" gagner en expdition"}),y&&g&&c.jsx("button",{className:"mc-button secondary",style:{marginTop:8},onClick:()=>d(f.id),children:_?"quip":"quiper"})]},f.id)})})]}):c.jsx("div",{className:"card",children:"Slectionnez un enfant pour voir son coffre."})}function bF(){return c.jsx("div",{className:"container grid",children:c.jsx(oC,{})})}function Nl({value:t,max:e=100,label:n,tone:r="default"}){const s=Math.min(100,Math.max(0,Math.round(t/e*100))),o=r==="gold"?"#f1c66d":r==="accent"?"var(--mc-accent)":"#7aa2ff";return c.jsxs("div",{children:[n&&c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:n}),c.jsx("div",{style:{height:10,background:"rgba(255,255,255,0.08)",borderRadius:999,overflow:"hidden",border:"1px solid var(--mc-border)"},children:c.jsx("div",{style:{width:`${s}%`,height:"100%",background:o,transition:"width 0.3s ease"}})})]})}function aC(t,e){return!t||t<=0?"locked":t>=e?"active":"building"}function Vf({count:t,target:e}){const n=aC(t,e),r=n==="active"?"gold":n==="building"?"accent":"muted",s=n==="active"?"Actif":n==="building"?"En chantier":"Verrouill";return c.jsxs("span",{className:`mc-chip ${r==="gold"?"gold":r==="accent"?"accent":"muted"}`,children:[" ",s,"  ",t,"/",e]})}function xF({biome:t,totalBlocks:e,masteredCount:n,monumentCount:r,target:s=100,onClick:o,highlighted:l=!1,className:d,variant:h="default"}){const f=e>0?Math.round(n/e*100):0,g=h==="compact",y=g?10:16,_=g?"1.4rem":"1.8rem",x=g?"1rem":"1.1rem";return c.jsxs("div",{className:`card mc-card world-card ${d||""}`,role:"button",tabIndex:0,onClick:o,onKeyDown:I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),o())},style:{padding:y,minHeight:g?"auto":void 0,...l?{boxShadow:"0 0 24px rgba(122,162,255,0.55)",borderColor:"rgba(122,162,255,0.8)"}:{}},children:[c.jsxs("div",{className:"row",style:{alignItems:"center",gap:g?10:12},children:[c.jsx("div",{style:{fontSize:_},children:t.icon}),c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{style:{fontWeight:800,fontSize:x,lineHeight:1.2},children:t.name}),!g&&c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:t.description})]}),c.jsx(Vf,{count:r,target:s})]}),!g&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"small",style:{marginTop:10},children:["Progression : ",f,"% (",n,"/",e,")"]}),c.jsx(Nl,{value:f,label:"Matrise"})]}),g&&c.jsxs("div",{className:"small",style:{marginTop:6,display:"flex",alignItems:"center",gap:6},children:[c.jsxs("span",{children:[f,"%"]}),c.jsx(Nl,{value:f,label:"Matrise"})]}),c.jsxs("div",{className:"row",style:{marginTop:g?6:8,justifyContent:"flex-end",gap:8,alignItems:"center"},children:[!g&&c.jsx("span",{className:"small",style:{color:"var(--mc-muted)"},children:"Entrer dans le biome"}),c.jsx("span",{className:"mc-chip accent",children:""})]})]})}function TF({theme:t,blocksCount:e,stablePct:n=0,weatheredPct:r=0,rebuild:s,onClick:o,highlighted:l=!1,className:d}){const h=aC(s.count,s.target),f=h==="active"?"Reconstruite":h==="building"?"En chantier":"Ruines";return c.jsxs("div",{className:`mc-card zone-card ${d||""}`,role:"button",tabIndex:0,onClick:o,onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),o())},style:l?{boxShadow:"0 0 18px rgba(122,162,255,0.55)",borderColor:"rgba(122,162,255,0.8)"}:void 0,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:t}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[e," blocs  stables ",n,"%"]}),r>0&&c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["Patins ",r,"%"]})]}),c.jsx(Vf,{count:s.count,target:s.target})]}),c.jsx("div",{style:{marginTop:6},children:c.jsx(Nl,{value:s.count,max:s.target,label:`${f} (${s.count}/${s.target})`,tone:h==="active"?"gold":"accent"})}),c.jsxs("div",{className:"row",style:{marginTop:8,justifyContent:"flex-end",gap:8,alignItems:"center"},children:[c.jsx("span",{className:"small",style:{color:"var(--mc-muted)"},children:"Ouvrir la zone"}),c.jsx("span",{className:"mc-chip accent",children:""})]})]})}function EF({label:t,description:e,visual:n,chip:r,onClick:s,selectable:o=!0,className:l}){const d=n.state==="beautified"?"gold":n.state==="repaired"?"accent":"";return c.jsxs("div",{className:`block-card mc-card ${n.state==="beautified"?"block-shiny":n.state==="repaired"?"block-solid":"block-cracked"} ${n.weathered?"block-weathered":""} ${l||""}`,role:o?"button":void 0,tabIndex:o?0:-1,onClick:o?s:void 0,onKeyDown:o?h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),s?.())}:void 0,style:{position:"relative",cursor:o?"pointer":"default"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:t}),e?c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:e}):null]}),r&&c.jsx("span",{className:`mc-chip ${d}`,children:r})]}),c.jsxs("div",{className:"row",style:{marginTop:8,gap:10},children:[c.jsxs("div",{className:"small",children:["Russite : ",n.successRate,"%"]}),c.jsxs("div",{className:"small",children:["Matrise : ",n.masteryScore,"%"]}),c.jsxs("div",{className:"small",children:["Tentatives : ",n.attempts]}),n.weathered&&c.jsx("span",{className:"mc-chip muted",children:"Patin  14j+"})]})]})}function IF({biome:t,rebuild:e,onRebuild:n,canRebuild:r,className:s}){return c.jsxs("div",{className:`card mc-card ${s||""}`,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Biome"}),c.jsxs("div",{style:{fontWeight:800,fontSize:"1.1rem"},children:[t.icon," ",t.name]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:t.description}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:8,alignItems:"center"},children:[c.jsx(Vf,{count:e.correctCount,target:e.target}),c.jsx("span",{className:"mc-chip",children:e.statusLabel})]})]}),n&&c.jsx("button",{className:"mc-button",disabled:!r,onClick:n,title:r?"Reconstruire le biome":"Reconstruis dabord les zones",children:"Reconstruire"})]}),c.jsx("div",{style:{marginTop:10},children:c.jsx(Nl,{value:e.correctCount,max:e.target,label:`Jauge ${e.correctCount}/${e.target}`,tone:e.correctCount>=e.target?"gold":"accent"})})]})}function SF({zones:t,onSelect:e,highlightedTheme:n,className:r}){return c.jsxs("div",{className:`card mc-card ${r||""}`,children:[c.jsx("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Zones du biome"}),c.jsxs("div",{style:{fontWeight:800},children:["tat des zones (",t.length,")"]})]})}),c.jsx("div",{className:"grid2",style:{marginTop:10},children:t.map(s=>c.jsx(TF,{theme:s.theme,blocksCount:s.blocks.length,stablePct:s.visual.breakdown.stablePct,weatheredPct:s.visual.weatheredPct,rebuild:{count:s.visual.rebuild?.correctCount||0,target:s.visual.rebuild?.target||35},onClick:()=>e(s.theme),highlighted:n===s.theme,className:r},s.theme))})]})}function CF({blockName:t,masteryLabel:e,expeditions:n,onStart:r,onClose:s}){return c.jsxs("div",{className:"card mc-card",style:{maxWidth:520},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Bloc cibl"}),c.jsx("div",{style:{fontWeight:900},children:t}),c.jsx("div",{className:"small",children:e})]}),c.jsx("button",{className:"mc-button secondary",onClick:s,children:"Fermer"})]}),c.jsx("div",{className:"grid",style:{gap:10,marginTop:12},children:n.slice(0,3).map(o=>{const l=o.type==="mine"?"":o.type==="repair"?"":"",d=o.type==="mine"?"Mine":o.type==="repair"?"Rparer":"Artisanat",h=o.type==="mine"?"Rcolte et consolidation de ton bloc.":o.type==="repair"?"Corriger les fissures : focus sur les erreurs rcentes.":"Combiner ce bloc avec un autre pour progresser.";return c.jsxs("div",{className:"mc-card",style:{border:"2px solid var(--mc-border)"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[c.jsx("div",{style:{fontSize:"1.4rem"},children:l}),c.jsxs("div",{children:[c.jsxs("div",{style:{fontWeight:800},children:[d," ",o.recommended?" recommand":""]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:h})]})]}),c.jsxs("div",{className:"mc-chip",children:[o.estimatedMinutes," min"]})]}),c.jsx("button",{className:"mc-button",style:{marginTop:10,width:"100%"},onClick:()=>r(o.type),children:"Commencer lexpdition"})]},o.type)})})]})}function AF({biome:t,theme:e,rebuild:n,weatheredPct:r=0,stablePct:s=0,onRebuild:o,canRebuild:l,className:d}){const h=n.correctCount>=n.target?"Reconstruite":n.correctCount>0?"En chantier":"Ruines";return c.jsxs("div",{className:`card mc-card ${d||""}`,children:[c.jsx("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Zone"}),c.jsxs("div",{style:{fontWeight:800,fontSize:"1.05rem"},children:[t.icon," ",t.name,"  ",e]}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["stables ",s,"%  patins ",r,"%  ",h]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:6,alignItems:"center"},children:[c.jsx(Vf,{count:n.correctCount,target:n.target}),o&&c.jsx("button",{className:"mc-button",disabled:!l,onClick:o,title:l?"Lancer la reconstruction":"Stabilise dabord les blocs",children:"Reconstruire"})]})]})}),c.jsx("div",{style:{marginTop:8},children:c.jsx(Nl,{value:n.correctCount,max:n.target,label:`Jauge ${n.correctCount}/${n.target}`,tone:n.correctCount>=n.target?"gold":"accent"})})]})}function RF({blocks:t,onSelect:e,className:n}){return c.jsx("div",{className:"grid",style:{gap:12},children:t.map(r=>c.jsx(EF,{label:r.label,description:r.description,visual:r.visual,chip:void 0,onClick:e?()=>e(r.tagId):void 0,selectable:!!e,className:n},r.tagId))})}const kF=[{id:"streak_3",title:"Srie 3",description:"3 jours de suite",icon:""},{id:"streak_7",title:"Srie 7",description:"7 jours de suite",icon:""},{id:"retry_5",title:"Persvrant",description:"5 erreurs revues",icon:""},{id:"tag_master_3",title:"Matre x3",description:"3 tags matriss",icon:""},{id:"tag_master_10",title:"Matre x10",description:"10 tags matriss",icon:""},{id:"fractions_first_mastery",title:"As des fractions",description:"1er tag fractions matris",icon:""},{id:"grammar_first_mastery",title:"As de grammaire",description:"1er tag grammaire matris",icon:""},{id:"sessions_10",title:"Marathon 10",description:"10 sances termines",icon:""}];function PF({rewards:t,streak:e=0,equippedAvatarId:n,onOpenCollection:r,onChangeNpc:s}){const o=ya(t.xp||0),d=(t.badges||[]).slice(-3).map(g=>kF.find(y=>y.id===g)).filter(Boolean),h=n?Pi.find(g=>g.id===n):void 0,f=t.coins||0;return c.jsxs("div",{className:"card mc-card",children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"1.8rem",width:38,height:38,borderRadius:"50%",background:"rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center"},children:h?.icon||""}),c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Profil"}),c.jsxs("div",{style:{fontWeight:900},children:["Niveau ",o.level]}),c.jsxs("div",{className:"small",children:["XP ",t.xp||0,"  Prochain : ",o.xpIntoLevel,"/",o.xpForNext]})]})]}),c.jsxs("div",{className:"row",style:{gap:6},children:[c.jsxs("span",{className:"mc-chip gold",children:[" ",f]}),e>0&&c.jsxs("span",{className:"mc-chip accent",children:[" Streak ",e," j"]})]})]}),d.length>0&&c.jsxs("div",{style:{marginTop:8},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Derniers badges"}),c.jsx("div",{className:"row",style:{gap:6},children:d.map(g=>c.jsxs("span",{className:"mc-chip",children:[g.icon||""," ",g.title]},g.id))})]}),c.jsxs("div",{className:"row",style:{marginTop:10,gap:8},children:[r&&c.jsx("button",{className:"mc-button secondary",onClick:r,children:"Voir ma collection"}),s&&c.jsx("button",{className:"mc-button secondary",onClick:s,children:"Changer de guide"})]})]})}const jF={session:"",remediation:"",progress:""};function NF({npcId:t,quests:e,loading:n=!1,bonusAwarded:r=!1,onStart:s,onChangeNpc:o,className:l}){const d=va[t],h=e.length>0&&e.every(f=>f.completed);return e.find(f=>f.tagId)||e[0],c.jsxs("div",{className:`card mc-card ${l||""}`,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"2rem"},children:d.avatar}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:900},children:d.name}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:d.shortTagline})]})]}),o&&c.jsx("button",{className:"mc-button secondary",onClick:o,children:"Changer"})]}),n?c.jsx("div",{className:"mc-card",style:{marginTop:8,border:"2px solid var(--mc-border)"},children:c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Chargement des qutes"})}):h?c.jsxs("div",{className:"mc-card",style:{marginTop:8,border:"2px solid var(--mc-border)",display:"flex",flexDirection:"column",gap:10},children:[c.jsxs("div",{className:"pill",style:{background:"rgba(126, 220, 134, 0.15)",border:"1px solid rgba(126,220,134,0.4)"},children:[" Qutes termines ",r?` Bonus du jour +${xs.xpRewards.dailyBonus} XP obtenu`:` Bonus prt (+${xs.xpRewards.dailyBonus} XP)`]}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[d.shortTagline||d.name," : Reviens demain pour de nouvelles missions."]})]}):c.jsxs("div",{className:"mc-card",style:{marginTop:8,border:"2px solid var(--mc-border)",display:"flex",flexDirection:"column",gap:10},children:[e.map(f=>{const g=f.target?Math.min(100,Math.round((f.progress||0)/f.target*100)):0;return c.jsxs("div",{className:"mc-card",style:{border:"1px solid var(--mc-border)",background:"rgba(255,255,255,0.03)"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:8},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[c.jsx("div",{style:{fontSize:"1.2rem"},children:jF[f.type||"session"]||""}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:800},children:f.title}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:f.tagHint||f.description})]})]}),c.jsx("div",{className:"mc-chip",children:c.jsxs("span",{style:{fontWeight:700},children:["+",xs.xpRewards[f.type||"progress"]," XP"]})})]}),c.jsx("div",{className:"small",style:{marginTop:6},children:f.npcLine||f.description}),c.jsx("div",{style:{height:8,background:"rgba(255,255,255,0.08)",borderRadius:999,overflow:"hidden",marginTop:8},children:c.jsx("div",{style:{height:"100%",width:`${g}%`,background:f.completed?"linear-gradient(90deg,#7fffb2,#2ecc71)":"linear-gradient(90deg,#7aa2ff,#2ecc71)",transition:"width 0.4s ease"}})})]},f.id)}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Complte les 3 qutes pour dclencher le bonus du jour."})]})]})}function Rs(t){return t.replace(/\/+$/,"")}function MF(t){return t.replace(/^\/+/,"")}function Pn(t,e){const n=Rs(t),r=MF(e);return r?n?`${n}/${r}`:`/${r}`:n}const DF={BASE_URL:"/malo-study-app/"};function LF(t){if(!t||!t.id||!t.label||!t.grade||!t.version)throw new Error("Manifest du pack graphique incomplet (identit manquante)");if(!t.map||!t.map.baseLayer)throw new Error("Manifest du pack graphique invalide (map manquante)");if(!_x(t.map.width)||!_x(t.map.height))throw new Error("Manifest du pack graphique invalide (dimensions requises)");if(!Array.isArray(t.css)||t.css.length===0)throw new Error("Manifest du pack graphique invalide (CSS requis)")}function _x(t){return typeof t=="number"&&Number.isFinite(t)&&t>0}function VF(t){const n=t.split("#")[0].split("?")[0],r="/pack.json";return n.endsWith(r)?Rs(n.slice(0,n.length-r.length)):Rs(n)}async function OF(t){const e=DF||{},n=typeof e?.BASE_URL=="string"?e.BASE_URL:"/",r=[t];if(t.startsWith("/")&&n&&n!=="/"){const o=Pn(n,t);r.includes(o)||r.push(o)}let s=null;for(const o of r){const l=await fetch(o);if(l.ok){let d;try{d=await l.json()}catch{throw new Error("Pack graphique illisible (JSON invalide)")}return{manifest:d,finalUrl:o}}s=l.status}throw new Error(`Impossible de charger le pack graphique (${s??"network"})`)}async function dv(t){const{manifest:e,finalUrl:n}=await OF(t);LF(e);const r=VF(n),s=e.maps?.world||e.map,o=Pn(r,s.baseLayer),l=e.css.map(d=>Pn(r,d));return{manifest:e,baseLayerUrl:o,cssUrls:l,packRootUrl:r}}const FF={BASE_URL:"/malo-study-app/",VITE_BASE_PATH:"/malo-study-app/"};function hv(){const t=FF||{},e=t?.VITE_GRAPHIC_PACK;if(typeof e=="string"&&e.trim().length>0)return e.trim();const n=typeof document<"u"?(()=>{try{return new URL(document.baseURI).pathname||"/"}catch{return"/"}})():"/",r=typeof t?.VITE_BASE_PATH=="string"&&t.VITE_BASE_PATH.trim()?t.VITE_BASE_PATH:typeof t?.BASE_URL=="string"&&t.BASE_URL.trim()?t.BASE_URL:n;return Pn(r,"assets/graphic-packs/pack-5e-mvp/pack.json")}function BF(t,e){const n=document.querySelector("head");return n?(t.forEach(r=>{const s=`link[data-mc-pack="${e}"][href="${r}"]`;if(n.querySelector(s))return;const o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("href",r),o.dataset.mcPack=e,n.appendChild(o)}),()=>{n.querySelectorAll(`link[data-mc-pack="${e}"]`).forEach(r=>r.remove())}):()=>{}}function UF(t){return t?(t.split(/[?#]/)[0]?.trim().toLowerCase()).endsWith(".svg"):!1}function fv({baseLayerUrl:t,width:e,height:n}){const r=j.useMemo(()=>UF(t),[t]),[s,o]=j.useState(null),[l,d]=j.useState(null),h=e>0&&n>0?`${e} / ${n}`:"16 / 9";j.useEffect(()=>{if(d(null),!r){o(null);return}let _=!1;return(async()=>{try{const I=await fetch(t);if(!I.ok){typeof console<"u"&&console.info&&console.info("[MapBaseLayer] Base layer unavailable",{url:t,status:I.status}),_||d(`Base layer unavailable (${I.status})`);return}const k=await I.text();_||o(k)}catch(I){typeof console<"u"&&console.info&&console.info("[MapBaseLayer] Failed to load base layer",{url:t,error:I?.message||I}),_||d("Base layer unavailable")}})(),()=>{_=!0}},[t,r]);const f=_=>c.jsxs("div",{className:"mc-map-base-layer__fallback","aria-hidden":!0,children:[c.jsx("div",{className:"mc-map-base-layer__fallbackPattern"}),_&&c.jsx("div",{className:"mc-map-base-layer__fallbackLabel",children:"Carte indisponible"})]}),g=()=>l?f(!0):c.jsx("img",{src:t,alt:"","aria-hidden":!0,loading:"lazy",style:{width:"100%",height:"100%",objectFit:"contain",pointerEvents:"none",userSelect:"none"},onError:()=>{typeof console<"u"&&console.info&&console.info("[MapBaseLayer] Raster base layer unavailable",{url:t}),d("Base layer unavailable")}}),y=()=>l?f(!0):s?c.jsx("div",{className:"mc-map-base-layer__svg","aria-hidden":!0,dangerouslySetInnerHTML:{__html:s}}):f(!1);return c.jsx("div",{className:"mc-map-base-layer",style:{aspectRatio:h,width:"100%"},children:r?y():g()})}function lC(t,e,n,r){const s=cC(t,e,n,r),o=s.x/e*100,l=s.y/n*100;return{position:"absolute",left:`${o}%`,top:`${l}%`,transform:"translate(-50%, -50%)"}}function cC(t,e,n,r){if(!r)return t;const{left:s=0,right:o=0,top:l=0,bottom:d=0}=r;return{...t,x:Math.min(Math.max(t.x,s),Math.max(0,e-o)),y:Math.min(Math.max(t.y,l),Math.max(0,n-d))}}function Zh({width:t,height:e,children:n,safeArea:r}){const s=j.useCallback(o=>lC(o,t,e,r),[t,e,r]);return c.jsx("div",{style:{position:"absolute",inset:0},children:n(s)})}const $F={id:"world-5e",grade:"5e",label:"MaloCraft 5e",baseLayer:{type:"svg",src:"base/map.svg",aspectRatio:"16:9",width:1920,height:1080},biomes:[{biomeId:"biome_fr_foret_langue",subject:"fr",label:"Franais",anchor:{x:320,y:520,radius:140}},{biomeId:"biome_math_mines",subject:"math",label:"Mathmatiques",anchor:{x:720,y:420,radius:140}},{biomeId:"biome_en_village",subject:"en",label:"Anglais",anchor:{x:1120,y:360,radius:140}},{biomeId:"biome_es_village",subject:"es",label:"Espagnol",anchor:{x:1420,y:620,radius:140}},{biomeId:"biome_hist_plaines",subject:"hist",label:"Histoire",anchor:{x:980,y:720,radius:140}}]};function zF(t){return t&&t==="5e"?$F:null}function Pg(t,e,n){const r=e?.anchors?.world?.biomes||{},s=r[t.id]||r[t.subject];if(s&&wx(s))return s;const o=n?.biomes.find(l=>l.biomeId===t.id)?.anchor;return o&&wx(o)?o:null}function wx(t){return t&&typeof t.x=="number"&&typeof t.y=="number"}function mv({width:t,height:e,anchors:n,safeArea:r,containerRef:s,onAnchorChange:o}){if(!n.length)return null;typeof console<"u"&&console.info&&console.info("[MapAnchorsDebugLayer] render",{anchorCount:n.length,hasOnChange:!!o,safeArea:r});const l=(h,f,g)=>{if(!s?.current)return;g.preventDefault(),console.info("[MapAnchorsDebugLayer] pointerdown",{id:h,x:f.x,y:f.y,target:g.target});const y=f.radius,_={t:0},x=k=>{if(!s.current)return;const S=s.current.getBoundingClientRect(),O=k.clientX-S.left,B=k.clientY-S.top,V=O/S.width*t,$=B/S.height*e,F=cC({x:V,y:$,radius:y},t,e,r);o?.(h,F);const H=performance.now();H-_.t>200&&(console.debug("[MapAnchorsDebugLayer] pointermove",{id:h,x:F.x,y:F.y,radius:F.radius}),_.t=H)},I=()=>{console.info("[MapAnchorsDebugLayer] pointerup",{id:h}),window.removeEventListener("pointermove",x),window.removeEventListener("pointerup",I)};window.addEventListener("pointermove",x),window.addEventListener("pointerup",I)},d=h=>{if(typeof console<"u"&&console.info){const f=h.target;console.info("[MapAnchorsDebugLayer] capture pointerdown",{targetTag:f?.tagName,targetClass:f?.className,targetDataset:f?.dataset,layer:"debug",x:h.clientX,y:h.clientY})}};return c.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",zIndex:9999},onPointerDown:d,children:n.map(({id:h,anchor:f})=>{const g=lC(f,t,e,r),y=typeof f.radius=="number"?f.radius:null;return c.jsx("div",{style:{...g,transform:`${g.transform} scale(1)`,pointerEvents:o?"auto":"none"},onPointerDown:o?_=>l(h,f,_):void 0,children:c.jsxs("div",{style:{position:"relative"},children:[c.jsx("div",{"data-anchor-id":h,style:{width:28,height:28,marginTop:-7,marginLeft:-7,background:"#ff9fb0",borderRadius:999,boxShadow:"0 0 10px rgba(255,159,176,0.95)",border:"2px solid #0f172a",cursor:o?"grab":"default",pointerEvents:o?"auto":"none",touchAction:"none"},onPointerDown:o?_=>l(h,f,_):void 0}),c.jsx("div",{style:{position:"absolute",top:-6,left:"50%",width:1,height:20,background:"#ff9fb0"}}),c.jsx("div",{style:{position:"absolute",top:"50%",left:-9,height:1,width:20,background:"#ff9fb0"}}),y&&c.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",width:y*2,height:y*2,borderRadius:"50%",border:"1px dashed rgba(255,159,176,0.8)",transform:"translate(-50%, -50%)"}}),c.jsxs("div",{style:{position:"absolute",top:14,left:14,fontSize:11,color:"#ff9fb0",textShadow:"0 0 6px rgba(0,0,0,0.6)",background:"rgba(0,0,0,0.45)",padding:"2px 6px",borderRadius:6},children:[h," (",Math.round(f.x),", ",Math.round(f.y),")"]})]})},h)})})}function uC(t,e){const n=e?.anchors?.biomes;if(!n)return[];const r={};Object.values(As).forEach(l=>{if(l.subject!==t)return;const d=l.theme.toLowerCase();r[d]||(r[d]={label:l.theme,tagIds:[]}),r[d].tagIds.push(l.id)});const s=n[t]?.zones;if(!s)return[];const o=[];return Object.entries(s).forEach(([l,d])=>{const h=l.toLowerCase(),f=r[h];if(!f||f.tagIds.length===0){typeof console<"u"&&console.warn&&console.warn("Anchor ignor (zone inconnue)",{subjectId:t,themeLabel:l});return}o.push({subjectId:t,themeLabel:f.label,anchor:d,zoneKey:jl(t,f.label),tagIds:f.tagIds})}),o}function qF({label:t,progress0to100:e,state:n,highlighted:r,onClick:s}){const o=Math.min(100,Math.max(0,Math.round(e))),l=["zone-monument-chip",`zone-${n}`];return n==="degraded"&&l.push("is-weathered"),r&&l.push("is-highlighted"),c.jsxs("div",{className:l.join(" "),"aria-label":`Ouvrir la zone ${t}, progression ${o}%`,title:`Ouvrir la zone ${t} (${o}%)`,style:{minWidth:36,padding:6,borderRadius:10,background:"rgba(0,0,0,0.45)",border:"1px solid rgba(255,255,255,0.14)",color:"#fff",fontSize:12,boxShadow:r?"0 0 12px rgba(122,162,255,0.6)":"0 2px 6px rgba(0,0,0,0.4)",pointerEvents:s?"auto":"none",textAlign:"center",cursor:s?"pointer":"default"},role:s?"button":void 0,tabIndex:s?0:-1,onClick:s,onKeyDown:s?d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),s())}:void 0,children:[c.jsx("div",{style:{fontWeight:800,marginBottom:4},children:t}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,justifyContent:"center"},children:[c.jsx("div",{style:{width:40,height:6,borderRadius:6,background:"rgba(255,255,255,0.12)",overflow:"hidden"},children:c.jsx("div",{style:{width:`${o}%`,height:"100%",background:n==="rebuilt"?"#7fc4a3":n==="rebuilding"?"#7aa2ff":"rgba(255,255,255,0.5)"}})}),c.jsxs("span",{style:{fontVariantNumeric:"tabular-nums"},children:[o,"%"]})]})]})}const WF=336*60*60*1e3;function pv(t,e){const n=e.zoneRebuildProgress?.[t.zoneKey],r=n?.target||100,s=n?.correctCount??HF(t.tagIds,e.blockProgress||{}),o=QF(Math.round(s/r*100),0,100),l=KF(t.tagIds,e.blockProgress||{});let d="intact";return l?d="degraded":o>=100?d="rebuilt":o>0&&(d="rebuilding"),{progressPct:o,correctCount:s,target:r,state:d}}function HF(t,e){return t.reduce((n,r)=>{const s=e[r];return!s||typeof s.correct!="number"?n:n+Math.max(0,s.correct)},0)}function KF(t,e){let n=0;return t.forEach(r=>{const s=e[r],o=GF(s?.updatedAt);o&&o>n&&(n=o)}),n?Date.now()-n>WF:!1}function GF(t){if(!t)return null;if(typeof t=="number")return t;if(typeof t=="object"){if(typeof t.toMillis=="function")return t.toMillis();if(typeof t.toDate=="function")return t.toDate().getTime();if(typeof t.seconds=="number")return t.seconds*1e3+(t.nanoseconds?t.nanoseconds/1e6:0)}return null}function QF(t,e,n){return Math.min(n,Math.max(e,t))}function _l(t){const e=(t||"").trim().toLowerCase();if(!e)return"zone";let n=e.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"");return n=n.replace(/&/g," et ").replace(/[']/g,"").replace(/-/g,"_"),n=n.replace(/[^a-z0-9]/g," "),n=n.replace(/\s+/g," "),n=n.replace(/ /g,"_"),n=n.replace(/_+/g,"_"),n=n.replace(/^_+|_+$/g,""),n||"zone"}function XF(t,e){return`${t}:${_l(e)}`}function YF(t,e){const n=t.maps?.world||t.map;return{baseLayerUrl:Pn(e,n.baseLayer),width:n.width,height:n.height,safeArea:t.anchors?.world?.safeArea}}function zc(t,e,n,r){const s=t.maps?.biomes?.[n]||(r?t.maps?.biomes?.[r]:void 0);if(!s)return null;const o=t.anchors?.biomes?.[n]||(r?t.anchors?.biomes?.[r]:void 0);return{baseLayerUrl:Pn(e,s.baseLayer),width:s.width,height:s.height,safeArea:o?.safeArea}}function dC(t,e,n,r){const s=r||n,o=_l(s);return[`${t}:${n}`,`${t}:${s}`,`${t}:${o}`,`${e}:${n}`,`${e}:${s}`,`${e}:${o}`,XF(e,s)]}function JF(t,e,n,r,s,o){const l=dC(n,s||n,r,o);for(const d of l){const h=t.maps?.zones?.[d];if(!h)continue;const f=t.anchors?.zones?.[d];return{baseLayerUrl:Pn(e,h.baseLayer),width:h.width,height:h.height,safeArea:f?.safeArea}}return null}function hC(t,e,n,r,s){return dC(e,r||e,n,s).some(l=>!!t.maps?.zones?.[l])}function ZF(t){return t.startsWith("/biome/")}function e4(){return typeof window>"u"?!1:ZF(window.location.pathname||"")}const jg="mc_nav_from",ef="mc_nav_anchor",nu="mc_nav_mapSize",tf="mc_nav_ts",t4=5e3,qc={w:1920,h:1080};function fC(){try{return typeof window>"u"?null:window.sessionStorage}catch{return null}}function mC(t,e,n){const r=fC();if(r)try{r.setItem(jg,t),e?(r.setItem(ef,JSON.stringify({x:e.x,y:e.y})),n?.w&&n?.h?r.setItem(nu,JSON.stringify({w:n.w,h:n.h})):r.removeItem(nu),r.setItem(tf,Date.now().toString())):(r.removeItem(ef),r.removeItem(nu),r.removeItem(tf))}catch{}}function bx(){const t=fC();if(!t)return null;try{const e=t.getItem(jg),n=t.getItem(tf),r=t.getItem(ef),s=t.getItem(nu);if(t.removeItem(jg),t.removeItem(ef),t.removeItem(nu),t.removeItem(tf),!e)return null;const o=n?parseInt(n,10):null;if(o&&Date.now()-o>t4)return null;const l=r?xx(r):null,d=s?xx(s):null;if(!l||typeof l.x!="number"||typeof l.y!="number")return{from:e,anchorPx:void 0,mapSize:void 0};const h=d&&typeof d.w=="number"&&typeof d.h=="number"?{w:d.w,h:d.h}:qc;return{from:e,anchorPx:{x:l.x,y:l.y},mapSize:h}}catch{return null}}function xx(t){try{return JSON.parse(t)}catch{return null}}function n4({anchorPx:t,mapSize:e,viewport:n,panFactor:r,maxPan:s}){if(!t||!e)return{x:0,y:0};const o=typeof e.w=="number"&&e.w||qc.w,l=typeof e.h=="number"&&e.h||qc.h,d={x:o/2,y:l/2},h=t.x-d.x,f=t.y-d.y,g=-h*r,y=-f*r,_=n&&n.w&&n.w<860?50:80,x=Math.min(Math.abs(s),_);return{x:Tx(g,-x,x),y:Tx(y,-x,x)}}function Tx(t,e,n){return Math.min(Math.max(t,e),n)}function pC(t=450){const[e,n]=j.useState(!1),r=j.useRef(null),s=j.useCallback(()=>{r.current&&clearTimeout(r.current),n(!0),r.current=setTimeout(()=>n(!1),t)},[t]);return j.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]),{locked:e,lock:s}}const Lp=new Map;async function Ex(t,e){try{const n=await fetch(t,{method:e,cache:"no-store"});if(n.ok)return!0;if(n.status===404)return!1}catch{}return!1}async function Ts(t){if(Lp.has(t))return Lp.get(t);const e=await Ex(t,"HEAD")||await Ex(t,"GET");return Lp.set(t,e),e}function r4(t,e,n=12){const r=t.top-n,s=t.left+t.width/2,o=Math.max(n,Math.min(r,e.h-n));return{left:Math.max(n,Math.min(s,e.w-n)),top:o}}function gv({label:t,masteryPct:e,state:n,anchorRef:r,visible:s}){const[o,l]=j.useState({left:0,top:0});return j.useEffect(()=>{if(!s)return;const d=r?.current;if(!d)return;const h=d.getBoundingClientRect(),f={w:window.innerWidth,h:window.innerHeight};l(r4(h,f))},[r,s,t,e]),!s||typeof document>"u"?null:mR.createPortal(c.jsxs("div",{className:"mc-poiTooltip",style:{left:o.left,top:o.top},children:[c.jsx("div",{className:"mc-poiTooltip__label",title:t,children:t}),c.jsxs("div",{className:"mc-poiTooltip__meta",children:[c.jsxs("span",{className:`mc-poiTooltip__pill is-${n||"default"}`,children:[Math.round(e),"%"]}),c.jsx("span",{className:"mc-poiTooltip__bar",children:c.jsx("span",{style:{width:`${Math.min(100,Math.max(0,e))}%`}})})]})]}),document.body)}function yv({open:t,label:e,masteryPct:n,state:r,onClose:s,onStart:o,entityLabel:l="Bloc",metricLabel:d="Matrise"}){const h=j.useRef(null);return j.useEffect(()=>{if(!t)return;const f=g=>{g.key==="Escape"&&(g.stopPropagation(),s())};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[t,s]),t?c.jsxs("div",{className:"mc-poiPanel",role:"dialog","aria-label":`${l} ${e}`,ref:h,children:[c.jsxs("div",{className:"mc-poiPanel__header",children:[c.jsx("div",{className:"mc-poiPanel__title",children:e}),c.jsx("button",{className:"mc-poiPanel__close","aria-label":"Fermer",onClick:s,children:""})]}),c.jsxs("div",{className:"mc-poiPanel__body",children:[c.jsxs("div",{className:"mc-poiPanel__meter",children:[c.jsx("div",{className:"mc-poiPanel__bar",children:c.jsx("span",{style:{width:`${Math.min(100,Math.max(0,n))}%`}})}),c.jsxs("div",{className:"mc-poiPanel__meta",children:[d," ",Math.round(n),"% ",r?` ${r}`:""]})]}),o&&c.jsx("button",{className:"mc-button",onClick:()=>{o(),s()},children:"Lancer une session"})]})]}):null}function vv(t){return Math.min(100,Math.max(0,Math.round(t||0)))}function _v(t,e,n,r){return n?!1:!!e||r.includes(t)}function wv(){const[t,e]=j.useState(!1);return j.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>e(!!n.matches);return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),t}function s4(t){return t?t==="weathered"?"weathered":t:"low"}function i4(t,e){if(!t)return[];const n=Rs(t||"/");return[Pn(n,`poi/biomes/${e}.svg`),Pn(n,`poi/biome_${e}.svg`),Pn(n,`poi/${e}.svg`)]}function o4({biomeId:t,label:e,progressPct:n,state:r,isHighlighted:s,anchor:o,onOpen:l,debug:d,packBaseUrl:h}){const f=vv(n),g=s4(r),[y,_]=j.useState(null),[x,I]=j.useState(!1),[k,S]=j.useState(!1),[O,B]=j.useState(!1),V=wv(),$=j.useRef(null);j.useEffect(()=>{if(typeof window>"u")return;const P=window.matchMedia("(max-width: 900px)"),L=()=>B(P.matches);return L(),P.addEventListener("change",L),()=>P.removeEventListener("change",L)},[]),j.useEffect(()=>{let P=!1;const L=i4(h,t);_(null);async function C(){for(const N of L){const M=await Ts(N);if(P)return;if(M){_(N);return}}}return C(),()=>{P=!0}},[h,t]);const F=["mc-poi","mc-biome-poi",`mc-poi-state-${g}`];s&&F.push("mc-biome-poi-highlight"),_v(g,s,V,["mid","high","max"])&&F.push("has-halo");const H=`${e}, progression ${f}%`,A=o?.radius?{width:`${Math.max(52,Math.min(110,o.radius*1.1))}px`,height:`${Math.max(52,Math.min(110,o.radius*1.1))}px`}:void 0,E=()=>{S(!0),I(!1)};return c.jsxs(c.Fragment,{children:[c.jsxs("button",{type:"button",className:F.join(" "),"aria-label":H,title:H,ref:$,style:{...A,pointerEvents:d?"none":"auto"},onClick:P=>{if(O){P.preventDefault(),E();return}l()},onMouseEnter:()=>!O&&I(!0),onMouseLeave:()=>I(!1),onFocus:()=>!O&&I(!0),onBlur:()=>I(!1),onKeyDown:P=>{P.key==="Escape"&&(I(!1),S(!1)),(P.key==="Enter"||P.key===" ")&&O&&(P.preventDefault(),E()),(P.key==="Enter"||P.key===" ")&&!O&&(P.preventDefault(),l())},children:[c.jsxs("span",{className:"mc-poi-icon","aria-hidden":!0,children:[y?c.jsx("img",{src:y,alt:"",loading:"lazy"}):c.jsx("span",{className:"mc-poi-dot"}),c.jsxs("svg",{viewBox:"0 0 36 36",className:"mc-poi-ring mc-biome-poi-ring","aria-hidden":!0,children:[c.jsx("circle",{className:"mc-poi-ring-bg",cx:"18",cy:"18",r:"14"}),c.jsx("circle",{className:"mc-poi-ring-fg",cx:"18",cy:"18",r:"14",strokeDasharray:`${f/100*88}, 140`})]})]}),d&&c.jsx("span",{className:"mc-poi-debugLabel",children:e})]}),c.jsx(gv,{label:e,masteryPct:f,state:g,anchorRef:$,visible:x&&!k&&!O}),c.jsx(yv,{open:k||O&&x,label:e,masteryPct:f,state:g,onClose:()=>{S(!1),I(!1)},onStart:O?l:void 0,entityLabel:"Biome",metricLabel:"Progression"})]})}const bv=14,Vp={repairing:40,repaired:70,enhanced:85};function a4(t){if(!t)return null;if(t instanceof Date)return t.getTime();if(typeof t=="number")return t;if(typeof t=="object"){if(typeof t.toMillis=="function")return t.toMillis();if(typeof t.toDate=="function")return t.toDate().getTime();if(typeof t.seconds=="number"){const e=typeof t.nanoseconds=="number"?t.nanoseconds:0;return t.seconds*1e3+e/1e6}}return null}function xv(t,e,n){const r=a4(t);return r?e.getTime()-r>n*24*60*60*1e3:!1}function gC(t){const e=Math.max(0,Math.round(t.zoneProgressCorrect||0)),n=typeof t.weatherDays=="number"?t.weatherDays:bv;return e>=100&&xv(t.zoneLastActivityAt,t.now,n)?"weathered":e>=100?"rebuilt":e>0?"rebuilding":"foundation"}function Ix(t){const e=Math.max(0,Math.round(t.masteryPct||0)),n=typeof t.weatherDays=="number"?t.weatherDays:bv;return e>0&&xv(t.tagLastActivityAt,t.now,n)?"weathered":e>=Vp.enhanced?"enhanced":e>=Vp.repaired?"repaired":e>=Vp.repairing?"repairing":"cracked"}function Tv(t){const e=Math.max(0,Math.round(t.biomeRebuiltPct||0)),n=typeof t.weatherDays=="number"?t.weatherDays:bv;return e>0&&xv(t.biomeLastActivityAt,t.now,n)?"weathered":e>=80?"max":e>=50?"high":e>=25?"mid":"low"}const l4={};function c4(){const t=new Date,n=new Intl.DateTimeFormat("fr-FR",{timeZone:"Europe/Paris",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(t),r=n.find(l=>l.type==="year")?.value,s=n.find(l=>l.type==="month")?.value,o=n.find(l=>l.type==="day")?.value;return`${r}-${s}-${o}`}function u4(t){if(!t)return null;if(typeof t=="number")return t;if(t instanceof Date)return t.getTime();if(typeof t=="object"){if(typeof t.toMillis=="function")return t.toMillis();if(typeof t.toDate=="function")return t.toDate().getTime();if(typeof t.seconds=="number")return t.seconds*1e3+(t.nanoseconds?t.nanoseconds/1e6:0)}return null}function Sx(){const{user:t,role:e,activeChild:n,recoveryCode:r}=Hn(),s=e==="parent"||e==="admin",o=n?.id||t?.uid||null,{rewards:l}=Ps(o),{daily:d,loading:h}=nC(o),f=ts(),[g,y]=j.useState(xu()),[_,x]=j.useState(!1),[I,k]=j.useState(0),[S,O]=j.useState(null),[B,V]=j.useState(null),[$,F]=j.useState(null),[H,A]=j.useState(!1),[E,P]=j.useState(!1),[L,C]=j.useState(!1),[N,M]=j.useState("all"),[ie,te]=j.useState(null),[q,W]=j.useState(null),[Y,ne]=j.useState(null),[se,z]=j.useState(null),[ee,Q]=j.useState(null),[de,Se]=j.useState(!0),fe=l.blockProgress||{},Re=l.masteryByTag||{},$e=l.zoneRebuildProgress||{},Me=l.biomeRebuildProgress||{},At=l.collectibles?.equippedAvatarId||null,[Wt,ur]=j.useState(null),[Ie,Ir]=j.useState(null),[ce,xe]=j.useState(null),[De,Rt]=j.useState(!1),[Ze,pt]=j.useState(null),[ye,Ne]=j.useState({}),Ke=j.useRef(null),kt=ks(),it=j.useMemo(()=>{const X=(l4?.VITE_MAP_DEBUG||"").toString().toLowerCase(),le=X==="true"||X==="1",ke=new URLSearchParams(kt.search).get("mapDebug")?.toLowerCase();return le||(ke==="1"||ke==="true")},[kt.search]),{locked:_n,lock:Sr}=pC(450),gt=j.useRef(new Date),Yt=j.useMemo(()=>{if(!Ie)return null;const X=Ie.manifest.maps?.world;return{width:X?.width||Ie.manifest.map.width,height:X?.height||Ie.manifest.map.height}},[Ie]),Bt=j.useCallback((X,le,_e)=>{if(_n)return;Sr();const ke=_e&&_e.width&&_e.height?{w:_e.width,h:_e.height}:Yt?{w:Yt.width,h:Yt.height}:null;mC("world",le?{x:le.x,y:le.y}:void 0,ke||void 0),f(X)},[Sr,f,_n,Yt]);j.useEffect(()=>{if(!it||!Ke.current)return;const X=_e=>{console.info("[WorldHub mapDebug] pointerdown on overlay",{target:_e.target,x:_e.clientX,y:_e.clientY})},le=Ke.current;return le.addEventListener("pointerdown",X,!0),()=>le.removeEventListener("pointerdown",X,!0)},[it]),j.useEffect(()=>{if(!it)return;const X=le=>{const _e=document.elementFromPoint(le.clientX,le.clientY),ke=_e?getComputedStyle(_e):null,We=le.composedPath().slice(0,8).map(St=>{const jt=St;return{tag:jt?.tagName||"unknown",className:jt?.className||"",id:jt?.id||"",dataset:jt?.dataset||{}}});console.info("[WorldHub mapDebug] pointerdown global",{target:le.target,topElement:_e,topInfo:_e?{tag:_e.tagName,className:_e.className,id:_e.id,dataset:_e.dataset,pointerEvents:ke?.pointerEvents,zIndex:ke?.zIndex}:null,path:We,coords:{x:le.clientX,y:le.clientY}})};return window.addEventListener("pointerdown",X,!0),()=>window.removeEventListener("pointerdown",X,!0)},[it]),j.useEffect(()=>{o&&(async()=>{try{const le=[...await aO(o)].sort((ke,We)=>(We.dateKey||"").localeCompare(ke.dateKey||""));let _e=0;for(const ke of le)if((ke.sessions||0)>0)_e+=1;else break;k(_e)}catch{k(0)}})()},[o]),j.useEffect(()=>{let X=!1;const le=hv();return Rt(!0),dv(le).then(_e=>{if(X)return;Ir(_e),xe(null);const ke=zF(_e.manifest.grade);pt(ke)}).catch(_e=>{X||(Ir(null),xe(_e?.message||"Pack graphique indisponible"),typeof console<"u"&&console?.warn&&console.warn("Graphic pack load failed",_e))}).finally(()=>{X||Rt(!1)}),()=>{X=!0}},[]),j.useEffect(()=>Ie?BF(Ie.cssUrls,Ie.manifest.id):void 0,[Ie]);const tn=j.useMemo(()=>d?(d.quests||[]).map(X=>{const le=X.type==="remediation"?"repair":X.type==="progress"?"priority":"spaced",_e=ro(g,"daily_quest",{reasonCode:le}).text;return{...X,npcLine:_e}}):[],[d?.dateKey,g]);j.useMemo(()=>(d?.quests||[]).every(X=>X.completed),[d?.quests]);const tr=X=>{if(s)return;const le=X||tn.find(ke=>ke.tagId)||null,_e=le?.tagId;if(_e){const ke=new URLSearchParams;ke.set("expeditionType",le?.type==="remediation"?"repair":"mine"),ke.set("targetTagId",_e),f(`/theme/expedition?${ke.toString()}`)}else f("/world")},Un=d?.dateKey||c4(),Or=j.useMemo(()=>Eh.map(X=>{const le=Gs(X.id),_e=le.filter(Pe=>l.masteryByTag?.[Pe.tagId]?.state==="mastered").length,ke=le.length,We={};le.forEach(Pe=>{We[Pe.theme]||(We[Pe.theme]=[]),We[Pe.theme].push(Pe.tagId)});const St=Object.entries(We).map(([Pe,pn])=>({theme:Pe,tagIds:pn})),jt=Yh(X.subject,St,{blockProgress:fe,masteryByTag:Re},{zoneRebuildProgress:$e,biomeRebuild:Me[X.subject]});return{biome:X,masteredCount:_e,total:ke,biomeVisual:jt}}),[fe,Re,$e,Me,l.masteryByTag]),Ht=S||Eh[0]?.id||null,Xe=Ht?xi(Ht):null,Kn=j.useMemo(()=>{if(!Ht)return[];const X=Gs(Ht),le={};return X.forEach(_e=>{le[_e.theme]||(le[_e.theme]=[]),le[_e.theme].push(_e)}),Object.entries(le).map(([_e,ke])=>({theme:_e,tagIds:ke.map(We=>We.tagId),blocks:ke,visual:Tu(Xe?.subject||ke[0]?.subject||"fr",_e,ke.map(We=>We.tagId),{blockProgress:fe,masteryByTag:Re},$e[jl(Xe?.subject||ke[0]?.subject||"fr",_e)])}))},[fe,Re,Xe?.subject,Ht,$e]),Jt=j.useMemo(()=>Xe?Yh(Xe.subject,Kn.map(X=>({theme:X.theme,tagIds:X.tagIds})),{blockProgress:fe,masteryByTag:Re},{zoneRebuildProgress:$e,biomeRebuild:Me[Xe.subject]}):null,[fe,Re,$e,Me,Xe,Kn]);j.useEffect(()=>{let X=!1;const le=Kn.flatMap(_e=>_e.tagIds);if(!o||!le.length){ur(null);return}return(async()=>{const _e=await Promise.all(le.map(async We=>{try{return(await tu(We,{uid:o})).length>0?We:null}catch{return null}}));if(X)return;const ke=new Set(_e.filter(Boolean));ur(ke)})(),()=>{X=!0}},[o,Kn]);const Ee=j.useMemo(()=>Ie?Array.from(new Set(Eh.map(le=>le.subject))).flatMap(le=>uC(le,Ie.manifest)):[],[Ie]),nt=j.useCallback((X,le)=>{if(!Ie)return!1;const _e=xi(X),ke=le||_e?.subject;return!!zc(Ie.manifest,Ie.packRootUrl,X,ke||void 0)},[Ie]),ht=j.useMemo(()=>S||(it?se:null),[S,se,it]),dt=j.useRef(null);j.useEffect(()=>{try{if(!Ht)return;const X=localStorage.getItem(`npcGuide:last:${Ht}`)||"";if(!X){dt.current=null;return}const le=JSON.parse(X);le&&le.adviceId&&le.actionType?dt.current=le:dt.current={adviceId:"legacy",actionType:"explore",messageKey:X}}catch{dt.current=null}},[Ht]);const Be=j.useMemo(()=>{if(!Xe||!Jt)return null;const X=`${o||"anon"}|${Xe.id}|${Un}`;return sC({biomeId:Xe.id,subjectId:Xe.subject,zones:Kn,biomeVisual:Jt,masteryByTag:Re,blockProgress:fe,allowedTags:void 0,availableTags:Wt||void 0,seed:X,lastAdvice:dt.current})},[Wt,fe,Un,Xe,Jt,Re,o,Kn]);if(!o)return c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Slectionnez un enfant rattach pour accder au monde."})});j.useEffect(()=>{if(!Be||!Xe){z(null),Q(null);return}if(Be.actionType==="reconstruction_biome")z(Xe.id),Q(null);else if(Be.actionType==="reconstruction_theme"&&Be.payload?.theme)z(Xe.id),Q(Be.payload.theme);else if(Be.actionType==="tag_session"&&Be.payload?.tagId){const le=Gs(Xe.id).find(_e=>_e.tagId===Be.payload?.tagId);z(Xe.id),Q(le?.theme||null)}},[Xe,Be]),j.useEffect(()=>{if(!(!Be||!Ht)&&!(dt.current?.adviceId===Be.adviceId&&dt.current?.messageKey===Be.messageKey)){dt.current={adviceId:Be.adviceId,actionType:Be.actionType,messageKey:Be.messageKey};try{localStorage.setItem(`npcGuide:last:${Ht}`,JSON.stringify(dt.current))}catch{}}},[Ht,Be]);const Le=S?xi(S):null,_t=j.useMemo(()=>S?Gs(S).map(X=>{const le=Qt(X.tagId),_e=fe[X.tagId],ke=kg(Re,X.tagId),We=Lf({..._e||{},score:_e?.score??Re?.[X.tagId]?.score??0});return{...X,blockName:X.blockName,description:le.description,visual:We,masteryState:ke}}):[],[fe,Re,S]),Pt=j.useMemo(()=>{if(!S||!Le)return[];const X={};return _t.forEach(le=>{X[le.theme]||(X[le.theme]=[]),X[le.theme].push(le)}),Object.entries(X).map(([le,_e])=>({theme:le,tagIds:_e.map(ke=>ke.tagId),visual:Tu(Le.subject,le,_e.map(ke=>ke.tagId),{blockProgress:fe,masteryByTag:Re},$e[jl(Le.subject,le)]),blocks:_e}))},[_t,fe,Re,S,Le,$e]),Lt=j.useMemo(()=>!B||!Le?null:Pt.find(X=>X.theme===B.theme)||null,[Pt,B,Le]),mt=j.useMemo(()=>$&&_t.find(le=>le.tagId===$.tagId)||null,[_t,$]),jn=j.useMemo(()=>!mt||!Le?[]:rC({tagId:mt.tagId,biomeId:Le.id,masteryState:kg(Re,mt.tagId),shouldRepair:Df(mt.tagId,[])}),[Re,Le,mt]),je=X=>{if(!mt)return;const le=new URLSearchParams;le.set("expeditionType",X),le.set("targetTagId",mt.tagId),Le&&le.set("biomeId",Le.id),f(`/theme/expedition?${le.toString()}`)},It=async X=>{if(o){ne(X),W(null),te(null);try{await MO(o,X),te("Achet !")}catch(le){W(le?.message||"Achat impossible")}finally{ne(null)}}},Nn=async X=>{if(o){ne(X),W(null),te(null);try{await DO(o,X),te("quip !")}catch(le){W(le?.message||"quipement impossible")}finally{ne(null)}}},Gn=va[g],Mn=Be?ro(g,Be.messageKey,{}):null,nn=X=>X==="monument_skin_biome"?"biomeMonumentSkin":X==="monument_skin_zone"?"zoneMonumentSkin":X==="tile_effect"?"tileEffect":"npcStyle",fn=(X,le)=>le?`${X} ${X}--${le.replace(/_/g,"-")}`:"",ft=fn("monument-skin",l.equippedCosmetics?.biomeMonumentSkin),Ft=fn("monument-skin",l.equippedCosmetics?.zoneMonumentSkin),wn=fn("tile-effect",l.equippedCosmetics?.tileEffect),mn=fn("npc-style",l.equippedCosmetics?.npcStyle),rn=ZS.filter(X=>N==="monuments"?X.type==="monument_skin_biome"||X.type==="monument_skin_zone":N==="effects"?X.type==="tile_effect":N==="npc"?X.type==="npc_style":!0),Fr=(X,le)=>{if(e4()){console.warn("GLOBAL DRAWER OPEN BLOCKED on /biome route",{biomeId:X,theme:le,pathname:typeof window<"u"?window.location.pathname:""});return}typeof console<"u"&&console.warn("GLOBAL DRAWER OPEN CALLED",{biomeId:X,theme:le,pathname:typeof window<"u"?window.location.pathname:""}),O(X),V({biomeId:X,theme:le}),F(null),z(X),Q(le),Se(!0)},Br=(X,le)=>{if(!Ie||!Ze||!X.length||!ht&&!it)return null;const _e=X.filter(We=>{if(it)return!0;const St=ht?xi(ht):null;return St&&St.subject===We.subjectId});if(!_e.length)return null;const ke=_e.map(We=>{const St=`zone:${We.subjectId}:${We.themeLabel}`,jt=it&&ye[St]?ye[St]:We.anchor,Pe=pv(We,{blockProgress:fe,zoneRebuildProgress:$e}),pn=ee&&ee===We.themeLabel,sn=ht||Pl(We.subjectId);return{id:St,anchor:jt,element:c.jsx(qF,{label:We.themeLabel,progress0to100:Pe.progressPct,state:Pe.state,highlighted:pn,onClick:()=>{if(!sn)return;if(Ie&&zc(Ie.manifest,Ie.packRootUrl,sn,We.subjectId)){const Dn=new URLSearchParams;Dn.set("zone",We.zoneKey||We.themeLabel),Bt(`/biome/${sn}?${Dn.toString()}`,jt||void 0,Yt||{width:Ie?.manifest.maps?.world?.width||Ie?.manifest.map.width,height:Ie?.manifest.maps?.world?.height||Ie?.manifest.map.height});return}Fr(sn,We.themeLabel)}},St)}}).filter(We=>We.anchor);return ke.length?c.jsx(Zh,{width:Ie.manifest.maps?.world?.width||Ie.manifest.map.width,height:Ie.manifest.maps?.world?.height||Ie.manifest.map.height,safeArea:le,children:We=>ke.map(({id:St,anchor:jt,element:Pe})=>c.jsx("div",{style:{...We(jt),width:"14%",pointerEvents:"auto",zIndex:1},children:Pe},St))}):null};return c.jsx("div",{className:"container mc-worldhub-shell","data-pack-loading":De?"true":"false","data-pack-error":ce||"",children:c.jsxs("div",{className:"grid mc-worldhub-content",children:[c.jsxs("div",{className:"grid2",children:[c.jsx(PF,{rewards:l,streak:I,equippedAvatarId:At,onOpenCollection:()=>P(!0),onChangeNpc:()=>x(!0)}),!s&&c.jsxs("div",{className:`card mc-card ${mn}`,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[c.jsx("div",{style:{fontSize:"2rem"},children:Gn.avatar}),c.jsxs("div",{children:[c.jsx("div",{style:{fontWeight:900},children:Gn.name}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:Gn.shortTagline})]})]}),c.jsx("button",{className:"mc-button secondary",onClick:()=>x(!0),children:"Changer"})]}),c.jsx("div",{className:`mc-card ${mn}`,style:{marginTop:10,border:"2px solid var(--mc-border)"},children:c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,justifyContent:"space-between"},children:[c.jsxs("div",{style:{flex:1},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Guide MaloCraft"}),c.jsx("div",{style:{fontWeight:800},children:Be?.message||Mn?.text||"Choisis un biome pour commencer."})]}),Be?.ctaLabel&&c.jsx("button",{className:"mc-button",onClick:()=>{if(Xe&&nt(Xe.id,Xe.subject)){const X=Pg(Xe,Ie?.manifest,Ze);Bt(`/biome/${Xe.id}`,X||void 0,Yt||void 0);return}if(Be.actionType==="reconstruction_theme"&&Be.payload?.theme&&Xe)O(Xe.id),V({biomeId:Xe.id,theme:Be.payload.theme}),z(Xe.id),Q(Be.payload.theme);else if(Be.actionType==="reconstruction_biome"&&Xe)O(Xe.id),z(Xe.id),Q(null);else if(Be.actionType==="tag_session"&&Be.payload?.tagId&&Xe){const le=Gs(Xe.id).find(ke=>ke.tagId===Be.payload?.tagId),_e=le?.theme;O(Xe.id),_e?(V({biomeId:Xe.id,theme:_e}),Q(_e),F({tagId:le.tagId,biomeId:Xe.id})):Q(null),z(Xe.id)}},children:Be.ctaLabel})]})})]}),s&&n&&c.jsxs("div",{className:"card mc-card",children:[c.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Profil enfant"}),c.jsxs("div",{className:"small",children:["Nom : ",c.jsx("strong",{children:n.displayName})]}),r&&c.jsxs("div",{className:"small",children:["Code de reprise : ",c.jsx("span",{className:"badge",children:r})]}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)",marginTop:6},children:"Mode parent : visualisation uniquement (pas de PNJ guide)."})]})]}),!s&&c.jsx(NF,{npcId:g,quests:tn,loading:h,bonusAwarded:d?.bonusAwarded,onStart:tr,onChangeNpc:()=>x(!0),className:mn}),!s&&c.jsxs("div",{className:"row",style:{gap:10,flexWrap:"wrap"},children:[c.jsx("button",{className:"mc-button secondary",onClick:()=>A(!0),children:" Inventaire"}),c.jsx("button",{className:"mc-button secondary",onClick:()=>P(!0),children:" Collection"}),c.jsx("button",{className:"mc-button",onClick:()=>C(!0),children:" Atelier"}),c.jsxs("span",{className:"mc-chip gold",children:[" ",l.coins||0]})]}),Ie&&Ze?c.jsxs("div",{style:{position:"relative",aspectRatio:`${Ie.manifest.maps?.world?.width||Ie.manifest.map.width}/${Ie.manifest.maps?.world?.height||Ie.manifest.map.height}`,width:"100%",overflow:"hidden"},children:[c.jsx(fv,{baseLayerUrl:Ie.baseLayerUrl,width:Ie.manifest.maps?.world?.width||Ie.manifest.map.width,height:Ie.manifest.maps?.world?.height||Ie.manifest.map.height}),c.jsxs("div",{ref:Ke,style:{position:"absolute",inset:0},children:[!it&&de&&Br(Ee,Ie.manifest.anchors?.world?.safeArea||Ie.manifest.anchors?.safeArea),(()=>{const X=Or.map(({biome:le,masteredCount:_e,total:ke,biomeVisual:We})=>{const St=se===le.id,jt=Pg(le,Ie?.manifest,Ze),Pe=`biome:${le.id}`,pn=it&&ye[Pe]?ye[Pe]:jt,sn=ke>0?Math.round(_e/ke*100):0,Dn=Gs(le.id).reduce((gn,Zt)=>{const Ut=u4(l.blockProgress?.[Zt.tagId]?.updatedAt);return Ut&&Ut>gn?Ut:gn},0),xn=l.biomeRebuildProgress?.[le.subject],pe=xn?Math.round(xn.correctCount/(xn.target||100)*100):sn,lt=xn?.updatedAt||xn?.rebuiltAt||(Dn?new Date(Dn):void 0),Nt=Tv({biomeRebuiltPct:pe,biomeLastActivityAt:lt||void 0,now:gt.current});return{biomeId:le.id,anchor:pn,anchorKey:Pe,name:le.name,element:c.jsx(o4,{biomeId:le.id,label:le.name,progressPct:sn,state:Nt,isHighlighted:St,anchor:pn||void 0,packBaseUrl:Ie?.packRootUrl,debug:it,onOpen:()=>{if(Ie?zc(Ie.manifest,Ie.packRootUrl,le.id,le.subject):null){Bt(`/biome/${le.id}`,pn||void 0,Yt||{width:Ie?.manifest.maps?.world?.width||Ie?.manifest.map.width,height:Ie?.manifest.maps?.world?.height||Ie?.manifest.map.height});return}O(le.id),V(null),F(null),z(null),Q(null)}})}}).filter(le=>le.anchor);return c.jsxs(c.Fragment,{children:[it&&console.info("[WorldHub mapDebug] anchored biomes",X.map(le=>({id:le.biomeId,x:Math.round(le.anchor.x),y:Math.round(le.anchor.y)}))),c.jsx("div",{style:{pointerEvents:"auto"},children:c.jsx(Zh,{width:Ie.manifest.maps?.world?.width||Ie.manifest.map.width,height:Ie.manifest.maps?.world?.height||Ie.manifest.map.height,safeArea:Ie.manifest.anchors?.world?.safeArea||Ie.manifest.anchors?.safeArea,children:le=>X.map(({biomeId:_e,anchor:ke,element:We,name:St})=>c.jsx("div",{style:{...le(ke),pointerEvents:it?"none":"auto"},"aria-label":`Ouvrir le biome ${St}`,children:We},_e))})}),it&&c.jsx(mv,{width:Ie.manifest.map.width,height:Ie.manifest.map.height,anchors:[...X.map(le=>({id:le.anchorKey,anchor:le.anchor}))],safeArea:Ie.manifest.anchors?.world?.safeArea||Ie.manifest.anchors?.safeArea,containerRef:Ke,onAnchorChange:(le,_e)=>{Ne(ke=>({...ke,[le]:_e}))}}),it&&c.jsx("div",{style:{position:"absolute",top:10,right:10,display:"flex",gap:8,alignItems:"center"},children:c.jsx("button",{className:"mc-button secondary",onClick:()=>{const le={};X.forEach(Pe=>{le[Pe.biomeId]={x:Math.round(Pe.anchor.x),y:Math.round(Pe.anchor.y),...typeof Pe.anchor.radius=="number"?{radius:Math.round(Pe.anchor.radius)}:{}}});const _e={};Ee.forEach(Pe=>{const pn=`zone:${Pe.subjectId}:${Pe.themeLabel}`,sn=it&&ye[pn]||Pe.anchor;_e[Pe.subjectId]||(_e[Pe.subjectId]={}),_e[Pe.subjectId][Pe.themeLabel]={x:Math.round(sn.x),y:Math.round(sn.y),...typeof sn.radius=="number"?{radius:Math.round(sn.radius)}:{}}});const ke={anchors:{world:{...Ie.manifest.anchors?.world?.safeArea?{safeArea:Ie.manifest.anchors.world.safeArea}:{},...Object.keys(le).length?{biomes:le}:{}},...Object.keys(_e).length?{biomes:Object.fromEntries(Object.entries(_e).map(([Pe,pn])=>[Pe,{zones:pn}]))}:{}}},We=JSON.stringify(ke,null,2),St=()=>prompt("Copier les anchors dans pack.json",We),jt=()=>{const Pe=document.createElement("textarea");Pe.value=We,Pe.style.position="fixed",Pe.style.opacity="0",document.body.appendChild(Pe),Pe.select();try{document.execCommand("copy"),console.info("[WorldHub mapDebug] anchors copied via execCommand")}catch(pn){console.warn("[WorldHub mapDebug] execCommand copy failed",pn),St()}finally{document.body.removeChild(Pe)}};navigator?.clipboard?.writeText?navigator.clipboard.writeText(We).then(()=>console.info("[WorldHub mapDebug] anchors copied to clipboard")).catch(Pe=>{console.warn("[WorldHub mapDebug] clipboard.writeText failed",Pe),jt()}):jt()},children:"Copy JSON"})})]})})()]})]}):c.jsx("div",{className:"grid2",children:Or.map(({biome:X,masteredCount:le,total:_e,biomeVisual:ke})=>c.jsx(xF,{biome:X,totalBlocks:_e,masteredCount:le,monumentCount:ke.rebuild?.correctCount||0,target:ke.rebuild?.target||100,highlighted:se===X.id,className:ft,onClick:()=>{!!(Ie&&zc(Ie.manifest,Ie.packRootUrl,X.id,X.subject))?Bt(`/biome/${X.id}`,void 0,Yt||void 0):(O(X.id),V(null),F(null),z(null),Q(null))}},X.id))}),!s&&c.jsx(iC,{open:_,onClose:()=>x(!1),onPicked:X=>{y(X),cv(X),x(!1)}}),c.jsxs(sa,{open:!!S,onClose:()=>{O(null),V(null),F(null)},title:Le?`${Le.icon} ${Le.name}`:"Biome",zIndex:920,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Quartiers sur la carte"}),c.jsxs("label",{className:"small",style:{display:"flex",alignItems:"center",gap:8},children:[c.jsx("input",{type:"checkbox",checked:de,onChange:X=>Se(X.target.checked)}),"Voir"]})]}),Le&&Jt&&c.jsx(IF,{biome:Le,rebuild:{correctCount:Jt.rebuild?.correctCount||0,target:Jt.rebuild?.target||100,statusLabel:Jt.rebuild?.status==="rebuilt"?"Biome reconstruit":Jt.rebuild?.status==="ready"?"Prt":Jt.rebuild?.status==="rebuilding"?"Reconstruction en cours":"Pr-requis manquants"},canRebuild:Jt.rebuild?.status==="ready"||Jt.rebuild?.status==="rebuilding",onRebuild:Jt.rebuild?.status==="ready"||Jt.rebuild?.status==="rebuilding"?()=>f(`/theme/reconstruction_biome_${Le.subject}?sessionKind=reconstruction_biome&subjectId=${Le.subject}`):void 0,className:ft}),c.jsx(SF,{zones:Pt,highlightedTheme:ee,className:Ft,onSelect:X=>{V({biomeId:S,theme:X}),F(null),Q(null)}})]}),c.jsx(sa,{open:!!B,onClose:()=>{V(null),F(null)},onBack:()=>V(null),title:B?`${Le?.icon||""} ${B.theme}`:"Zone",zIndex:940,children:Lt&&Le&&c.jsxs(c.Fragment,{children:[c.jsx(AF,{biome:Le,theme:Lt.theme,rebuild:{correctCount:Lt.visual.rebuild?.correctCount||0,target:Lt.visual.rebuild?.target||35},weatheredPct:Lt.visual.weatheredPct,stablePct:Lt.visual.breakdown.stablePct,canRebuild:!s&&(Lt.visual.state==="rebuilt_ready"||Lt.visual.state==="rebuilding"),onRebuild:()=>{s||Lt.visual.state!=="rebuilt_ready"&&Lt.visual.state!=="rebuilding"||f(`/theme/reconstruction_${encodeURIComponent(Lt.theme)}?sessionKind=reconstruction_theme&subjectId=${Le.subject}&theme=${encodeURIComponent(Lt.theme)}`)},className:Ft}),c.jsx("div",{style:{marginTop:10},children:c.jsx(RF,{blocks:Lt.blocks.map(X=>({tagId:X.tagId,label:Qt(X.tagId).label,description:X.description,visual:X.visual})),className:wn,onSelect:X=>F({tagId:X,biomeId:Le.id})})})]})}),c.jsx(sa,{open:!!$,onClose:()=>F(null),onBack:()=>F(null),title:mt?.blockName||"Bloc",zIndex:960,width:520,children:mt&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{marginBottom:10},children:[c.jsx("div",{style:{fontWeight:800},children:mt.blockName}),c.jsxs("div",{className:"small",children:["Etat : ",Jh(Re[mt.tagId]?.state||"discovering")]})]}),s?c.jsx("div",{className:"card",style:{background:"rgba(255,255,255,0.04)"},children:c.jsx("div",{className:"small",children:"Mode parent : visualisation uniquement."})}):c.jsx(CF,{blockName:mt.blockName,masteryLabel:Jh(Re[mt.tagId]?.state||"discovering"),expeditions:jn,onStart:je,onClose:()=>F(null)})]})}),c.jsxs(sa,{open:L,onClose:()=>{C(!1),te(null),W(null),ne(null)},title:"Atelier",zIndex:970,children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:10,marginBottom:10},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Solde"}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsxs("span",{className:"mc-chip gold",children:[" ",l.coins||0]}),c.jsxs("span",{className:"mc-chip",children:["Niveau ",l.level||1]})]})]}),c.jsx("div",{className:"row",style:{gap:8,flexWrap:"wrap"},children:[{id:"all",label:"Tous"},{id:"monuments",label:"Monuments"},{id:"effects",label:"Effets"},{id:"npc",label:"PNJ"}].map(X=>c.jsx("button",{className:`mc-chip ${N===X.id?"accent":""}`,onClick:()=>M(X.id),children:X.label},X.id))})]}),ie&&c.jsx("div",{className:"small",style:{color:"#7fffb2",marginBottom:8},children:ie}),q&&c.jsx("div",{className:"small",style:{color:"#ff9fb0",marginBottom:8},children:q}),c.jsx("div",{className:"grid2",children:rn.map(X=>{const le=uv(X,l),_e=l.equippedCosmetics?.[nn(X.type)]===X.id,ke=!le&&!!X.unlockLevel&&(l.level||1)<X.unlockLevel,We=!le&&typeof X.costCoins=="number"&&!ke,St=We&&(l.coins||0)>=(X.costCoins||0),jt=X.type==="tile_effect"?fn("tile-effect",X.id):X.type==="npc_style"?fn("npc-style",X.id):fn("monument-skin",X.id),Pe=X.type==="tile_effect"?"":X.type==="npc_style"?"":"";return c.jsxs("div",{className:`mc-card ${jt}`,style:{position:"relative",overflow:"hidden"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"flex-start",gap:8},children:[c.jsxs("div",{children:[c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[Pe," ",X.type==="npc_style"?"PNJ":X.type==="tile_effect"?"Effet":"Monument"]}),c.jsx("div",{style:{fontWeight:900},children:X.label}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:X.description})]}),_e&&c.jsx("span",{className:"mc-chip accent",children:"quip"})]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:8,flexWrap:"wrap"},children:[typeof X.costCoins=="number"&&c.jsxs("span",{className:"mc-chip gold",children:[" ",X.costCoins]}),X.unlockLevel&&c.jsxs("span",{className:`mc-chip ${le?"accent":"muted"}`,children:["Niveau ",X.unlockLevel]})]}),c.jsxs("div",{className:"row",style:{gap:8,marginTop:10,flexWrap:"wrap"},children:[ke&&c.jsxs("span",{className:"mc-chip muted",children:["Niveau ",X.unlockLevel," requis"]}),!ke&&!le&&We&&c.jsx("button",{className:"mc-button",disabled:!St||Y===X.id,onClick:()=>It(X.id),children:St?`Acheter (${X.costCoins} coins)`:"Manque de coins"}),!ke&&le&&!_e&&c.jsx("button",{className:"mc-button secondary",disabled:Y===X.id,onClick:()=>Nn(X.id),children:"quiper"}),le&&!We&&!_e&&!ke&&c.jsx("span",{className:"mc-chip accent",children:"Dbloqu"})]})]},X.id)})})]}),c.jsx(sa,{open:H,onClose:()=>A(!1),title:"Coffre",zIndex:980,children:c.jsx(oC,{})}),c.jsx(sa,{open:E,onClose:()=>P(!1),title:"Collection",zIndex:980,children:c.jsx(tC,{})})]})})}function d4({open:t,biome:e,zone:n,progress:r,tags:s,rewards:o,onClose:l,onNavigateTheme:d,onNavigateTag:h}){const f=h4("(min-width: 900px)");if(!t||!n)return null;const g=o.masteryByTag||{},y=o.blockProgress||{};return c.jsxs("div",{style:{position:f?"relative":"fixed",top:f?0:void 0,right:f?0:void 0,bottom:0,width:f?"clamp(320px, 30vw, 460px)":"100%",maxHeight:f?"100%":"70vh",background:f?"rgba(10,14,24,0.78)":"rgba(10,14,24,0.9)",backdropFilter:"blur(8px)",borderLeft:f?"1px solid rgba(255,255,255,0.12)":void 0,boxShadow:f?"-8px 0 20px rgba(0,0,0,0.35)":"0 -8px 20px rgba(0,0,0,0.35)",padding:16,overflowY:"auto",zIndex:1200},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:10},children:[c.jsxs("div",{children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:e?.name||""}),c.jsx("div",{style:{fontWeight:900},children:n.themeLabel})]}),c.jsx("button",{className:"mc-button secondary",onClick:l,children:"Fermer"})]}),r&&c.jsxs("div",{className:"mc-card",style:{background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.08)",marginBottom:12},children:[c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:"Reconstruction"}),c.jsxs("div",{style:{fontWeight:800},children:[r.correctCount,"/",r.target," bonnes rponses"]}),c.jsx("div",{style:{marginTop:6},children:c.jsx(Nl,{value:r.progressPct,max:100,label:`${r.progressPct}%`})}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)",marginTop:6},children:["Etat : ",r.state==="rebuilt"?"Reconstruite":r.state==="rebuilding"?"En chantier":r.state==="degraded"?"Patine (14j+)":"Intacte"]}),c.jsx("div",{className:"row",style:{gap:8,marginTop:10,flexWrap:"wrap"},children:c.jsx("button",{className:"mc-button",onClick:()=>d(n.themeLabel),children:"Lancer reconstruction"})})]}),c.jsx("div",{style:{fontWeight:900,marginTop:6,marginBottom:6},children:"Blocs de la zone"}),c.jsx("div",{className:"grid2",children:s.map(_=>{const x=g[_.id]?.state||"discovering",I=y[_.id]||{attempts:0,score:g[_.id]?.score||0},k=x==="mastered"?"gold":x==="progressing"?"accent":"muted";return c.jsxs("div",{className:"mc-card",style:{padding:12,background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.08)"},children:[c.jsx("div",{style:{fontWeight:800},children:_.label}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:_.description}),c.jsxs("div",{className:"row",style:{gap:6,marginTop:6},children:[c.jsx("span",{className:`mc-chip ${k}`,children:x==="mastered"?"Matris":x==="progressing"?"En progrs":"Dcouverte"}),c.jsxs("span",{className:"mc-chip muted",children:["Tentatives ",I.attempts||0]})]}),c.jsx("div",{className:"row",style:{marginTop:8,gap:8},children:c.jsx("button",{className:"mc-button secondary",onClick:()=>h(_.id),children:"Session cible"})})]},_.id)})})]})}function h4(t){const[e,n]=j.useState(()=>typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia(t).matches);return j.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return;const r=window.matchMedia(t),s=o=>n(o.matches);return r.addEventListener("change",s),n(r.matches),()=>r.removeEventListener("change",s)},[t]),e}function yC(t,e){return Object.values(As).filter(n=>n.subject===t&&n.theme===e)}function f4(t,e){return t==="weathered"?"weathered":t==="rebuilt"?"rebuilt":t==="rebuilding"?e>=35?"progressing":"rebuilding":"discovering"}function m4(t,e,n){const r=Rs(t||"/"),s=[];return e&&n&&s.push(Pn(r,`monuments/${e}/${n}/poi.svg`)),e&&n&&s.push(Pn(r,`poi/zones/${e}/${n}.svg`)),n&&s.push(Pn(r,`poi/zones/${n}.svg`)),s}function p4({label:t,progressPct:e,state:n,highlight:r,onEnter:s,onShowPanel:o,packBaseUrl:l,subjectId:d,zoneSlug:h,mapDebug:f,radiusPx:g}){const y=vv(e),_=f4(n,y),[x,I]=j.useState(null),[k,S]=j.useState(!1),[O,B]=j.useState(!1),[V,$]=j.useState(!1),F=wv(),H=j.useRef(null);j.useEffect(()=>{if(typeof window>"u")return;const C=window.matchMedia("(max-width: 900px)"),N=()=>$(C.matches);return N(),C.addEventListener("change",N),()=>C.removeEventListener("change",N)},[]),j.useEffect(()=>{let C=!1;const N=m4(l,d,h);I(null);async function M(){for(const ie of N){const te=await Ts(ie);if(C)return;if(te){I(ie);return}}I(null)}return M(),()=>{C=!0}},[l,d,h]);const A=["mc-poi","mc-zone-poi",`mc-poi-state-${_}`];r&&A.push("is-highlighted"),_v(_,r,F,["progressing"])&&A.push("has-halo"),_==="weathered"&&A.push("has-weather");const E=g?{width:`${Math.max(56,Math.min(120,g*1.4))}px`,height:`${Math.max(56,Math.min(120,g*1.4))}px`}:void 0,P=()=>{B(!0),S(!1),o?.()},L=`Zone ${t}, progression ${y}%`;return c.jsxs(c.Fragment,{children:[c.jsxs("button",{type:"button",className:A.join(" "),"aria-label":L,title:L,style:E,onClick:C=>{if(V){C.preventDefault(),P();return}s?.()},onMouseEnter:()=>!V&&S(!0),onMouseLeave:()=>S(!1),onFocus:()=>!V&&S(!0),onBlur:()=>S(!1),onKeyDown:C=>{C.key==="Escape"&&(S(!1),B(!1)),(C.key==="Enter"||C.key===" ")&&V&&(C.preventDefault(),P())},ref:H,children:[c.jsxs("span",{className:"mc-poi-icon","aria-hidden":!0,children:[x?c.jsx("img",{src:x,alt:"",loading:"lazy"}):c.jsx("span",{className:"mc-poi-dot"}),c.jsxs("svg",{viewBox:"0 0 44 44",className:"mc-poi-ring","aria-hidden":!0,children:[c.jsx("circle",{className:"mc-poi-ring-bg",cx:"22",cy:"22",r:"18"}),c.jsx("circle",{className:"mc-poi-ring-fg",cx:"22",cy:"22",r:"18",strokeDasharray:`${y/100*113}, 160`})]}),_==="rebuilding"&&c.jsx("span",{className:"mc-poi-badge","aria-hidden":!0,children:""})]}),f&&c.jsx("span",{className:"mc-poi-debugLabel",children:t})]}),c.jsx(gv,{label:t,masteryPct:y,state:_,anchorRef:H,visible:k&&!O&&!V}),c.jsx(yv,{open:O||V&&k,label:t,masteryPct:y,state:_,onClose:()=>{B(!1),S(!1)},onStart:V?s:void 0,entityLabel:"Zone",metricLabel:"Progression"})]})}const g4={};function ah(t){if(!t)return null;if(typeof t=="number")return t;if(t instanceof Date)return t.getTime();if(typeof t=="object"){if(typeof t.toMillis=="function")return t.toMillis();if(typeof t.toDate=="function")return t.toDate().getTime();if(typeof t.seconds=="number")return t.seconds*1e3+(t.nanoseconds?t.nanoseconds/1e6:0)}return null}function y4(){const{biomeId:t=""}=Ru(),e=ts(),n=ks(),{user:r,activeChild:s}=Hn(),o=s?.id||r?.uid||null,{rewards:l}=Ps(o),[d,h]=j.useState(null),[f,g]=j.useState(null),y=j.useRef(null),_=j.useMemo(()=>{const ne=(g4?.VITE_MAP_DEBUG||"").toString().toLowerCase(),se=ne==="true"||ne==="1",ee=new URLSearchParams(n.search).get("mapDebug")?.toLowerCase();return se||(ee==="1"||ee==="true")},[n.search]),[x,I]=j.useState(null),[k,S]=j.useState(!1),[O,B]=j.useState({}),{locked:V,lock:$}=pC(450),F=j.useRef(new Date),H=j.useCallback(ne=>{const se=l.zoneRebuildProgress?.[ne.zoneKey];let ee=ah(se?.updatedAt)||ah(se?.rebuiltAt)||0;return ne.tagIds.forEach(Q=>{const de=ah(l.blockProgress?.[Q]?.updatedAt);de&&de>ee&&(ee=de)}),ee?new Date(ee):null},[l.blockProgress,l.zoneRebuildProgress]);j.useEffect(()=>{const ne=hv();dv(ne).then(se=>{h(se)}).catch(se=>g(se?.message||"Pack indisponible"))},[]);const A=j.useMemo(()=>{const ne=t?xi(t):null;return ne||(["fr","math","en","es","hist"].includes(t)?xi(Pl(t)):null)||null},[t]),E=A?.id||t,P=d&&A?zc(d.manifest,d.packRootUrl,E,A.subject):null,L=d?P||YF(d.manifest,d.packRootUrl):null,C=d&&A?Pg(A,d.manifest,null):null,N=_&&A&&O[`biome:${A.id}`]?O[`biome:${A.id}`]:C,M=d&&A?uC(A.subject,d.manifest):[],ie=j.useCallback((ne,se)=>{if(V)return;$();const z=L?{w:L.width,h:L.height}:null;mC("biome",se?.anchor?{x:se.anchor.x,y:se.anchor.y}:void 0,z||void 0);const ee=_l(se.themeLabel),Q=new URLSearchParams;Q.set("label",se.themeLabel),e(`/zone/${ne}/${ee}?${Q.toString()}`)},[$,V,e,L]),te=M.map(ne=>{const se=pv(ne,{blockProgress:l.blockProgress||{},zoneRebuildProgress:l.zoneRebuildProgress||{}}),z=H(ne),ee=gC({zoneProgressCorrect:se.correctCount,zoneLastActivityAt:z||void 0,now:F.current});return{zone:ne,progress:se,lastActivity:z,state:ee}}),q=j.useMemo(()=>{if(!A)return null;const ne=te.length||1,se=te.filter(Re=>Re.progress.progressPct>=100).length,z=Math.round(se/ne*100);let ee=0;te.forEach(Re=>{const $e=ah(Re.lastActivity);$e&&$e>ee&&(ee=$e)});const Q=l.biomeRebuildProgress?.[A.subject],de=Q?Math.round(Q.correctCount/(Q.target||100)*100):null,Se=typeof de=="number"?de:z,fe=Q?.updatedAt||Q?.rebuiltAt||(ee?new Date(ee):null);return Tv({biomeRebuiltPct:Se,biomeLastActivityAt:fe||void 0,now:F.current})},[A,te,l.biomeRebuildProgress]);j.useEffect(()=>{const se=new URLSearchParams(n.search).get("zone");if(!se)return;const z=te.find(ee=>ee.zone.zoneKey===se||ee.zone.themeLabel===se);z&&(I(z.zone.zoneKey),S(!0))},[n.search,te]);const W=x?te.find(ne=>ne.zone.zoneKey===x):null,Y=W&&A?yC(A.subject,W.zone.themeLabel):[];return c.jsxs("div",{className:`container grid ${q?`mc-biome-state-${q}`:""}`,style:{gap:16},children:[!A&&c.jsx("div",{className:"card",children:"Biome inconnu."}),f&&c.jsxs("div",{className:"card",children:["Pack indisponible : ",f]}),!d&&!f&&c.jsx("div",{className:"card",children:"Chargement pack..."}),A&&d&&L&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("button",{className:"mc-button secondary",onClick:()=>e("/home"),children:" Retour au monde"}),c.jsx("div",{className:"small",style:{color:"var(--mc-muted)"},children:A?.name})]})}),c.jsxs("div",{style:{display:"grid",gap:12,gridTemplateColumns:"1fr auto"},children:[c.jsxs("div",{style:{position:"relative",aspectRatio:`${L?.width||16}/${L?.height||9}`,width:"100%",overflow:"hidden"},children:[c.jsx(fv,{baseLayerUrl:L.baseLayerUrl,width:L.width,height:L.height}),c.jsxs("div",{ref:y,style:{position:"absolute",inset:0},children:[A&&c.jsx("div",{style:{position:"absolute",top:12,left:12,zIndex:2,pointerEvents:"none"},children:c.jsx("div",{className:"mc-chip accent",style:{justifyContent:"center"},children:A.name})}),c.jsx(Zh,{width:L.width,height:L.height,safeArea:L.safeArea,children:ne=>c.jsx(c.Fragment,{children:te.map(({zone:se,progress:z,state:ee})=>{const de=(_?O[`zone:${se.zoneKey}`]:null)||se.anchor,Se=d&&hC(d.manifest,A.id,se.zoneKey,A.subject,se.themeLabel),fe=()=>{I(se.zoneKey),S(!0)};return c.jsx("div",{style:{...ne(de),display:"flex",justifyContent:"center",pointerEvents:"auto"},children:c.jsx(p4,{label:se.themeLabel,progressPct:z.progressPct,state:ee,highlight:x===se.zoneKey,subjectId:A.subject,zoneSlug:se.zoneKey,packBaseUrl:d.packRootUrl,onEnter:Se?()=>ie(A.id,{...se,anchor:de}):fe,onShowPanel:fe,mapDebug:_,radiusPx:de?.radius})},se.zoneKey)})})}),_&&c.jsx(mv,{width:L?.width||1920,height:L?.height||1080,anchors:[...N?[{id:`biome:${A?.id}`,anchor:N}]:[],...te.map(ne=>{const se=O[`zone:${ne.zone.zoneKey}`];return{id:`zone:${ne.zone.zoneKey}`,anchor:se||ne.zone.anchor}})],safeArea:L?.safeArea,containerRef:y,onAnchorChange:(ne,se)=>{B(z=>({...z,[ne]:se}))}}),_&&c.jsx("div",{style:{position:"absolute",top:10,right:10,display:"flex",gap:8,alignItems:"center"},children:c.jsx("button",{className:"mc-button secondary",onClick:()=>{const ne={};te.forEach(de=>{const Se=de.zone.themeLabel,fe=O[`zone:${de.zone.zoneKey}`]||de.zone.anchor;ne[Se]={x:Math.round(fe.x),y:Math.round(fe.y),...typeof fe.radius=="number"?{radius:Math.round(fe.radius)}:{}}});const se={anchors:{biomes:{[A.subject]:{zones:ne}}}},z=JSON.stringify(se,null,2),ee=()=>prompt("Copier les anchors zones dans pack.json",z),Q=()=>{const de=document.createElement("textarea");de.value=z,de.style.position="fixed",de.style.opacity="0",document.body.appendChild(de),de.select();try{document.execCommand("copy"),console.info("[Biome mapDebug] anchors copied via execCommand")}catch(Se){console.warn("[Biome mapDebug] execCommand copy failed",Se),ee()}finally{document.body.removeChild(de)}};navigator?.clipboard?.writeText?navigator.clipboard.writeText(z).then(()=>console.info("[Biome mapDebug] anchors copied to clipboard")).catch(de=>{console.warn("[Biome mapDebug] clipboard.writeText failed",de),Q()}):Q()},children:"Copy JSON"})})]})]}),c.jsx(d4,{open:k&&!!W,biome:A||void 0,zone:W?.zone||null,progress:W?.progress||null,tags:Y,rewards:l,onClose:()=>{S(!1),I(null)},onNavigateTheme:ne=>e(`/theme/reconstruction_${encodeURIComponent(ne)}?sessionKind=reconstruction_theme&subjectId=${A.subject}&theme=${encodeURIComponent(ne)}`),onNavigateTag:ne=>e(`/theme/expedition?targetTagId=${encodeURIComponent(ne)}`)})]})]})]})}function v4(){const{linkedChildren:t,activeChild:e,setActiveChildId:n,role:r}=Hn(),[s,o]=j.useState(e?.id||""),[l,d]=j.useState([]),[h,f]=j.useState(new Set),[g,y]=j.useState(""),[_,x]=j.useState(!1),[I,k]=j.useState(!1),[S,O]=j.useState(""),[B,V]=j.useState(new Set),[$,F]=j.useState(new Set);j.useEffect(()=>{d(Object.values(As).map(te=>({id:te.id,label:te.label,subject:te.subject,theme:te.theme,order:te.order})).sort((te,q)=>te.subject.localeCompare(q.subject)||te.theme.localeCompare(q.theme)||(te.order??999)-(q.order??999)))},[]);const H=j.useCallback(async te=>{k(!0);try{const q=await kl(te);f(new Set(q))}catch{f(new Set)}finally{k(!1)}},[]);j.useEffect(()=>{e?.id&&r==="parent"?(o(e.id),H(e.id)):t[0]&&(o(t[0].id),H(t[0].id))},[e?.id,t.map(te=>te.id).join(","),H,r]);const A=te=>{f(q=>{const W=new Set(q);return W.has(te)?W.delete(te):W.add(te),W})},E=()=>f(new Set(l.map(te=>te.id))),P=()=>f(new Set),L=async()=>{if(s){x(!0),O("");try{await WS(s,Array.from(h)),O("Priorits enregistres.")}catch{O("Erreur lors de lenregistrement.")}finally{x(!1)}}},C=l.filter(te=>te.label.toLowerCase().includes(g.toLowerCase())||te.id.toLowerCase().includes(g.toLowerCase())||te.theme.toLowerCase().includes(g.toLowerCase())||ca[te.subject].toLowerCase().includes(g.toLowerCase())),N=j.useMemo(()=>{const te={};return C.forEach(q=>{te[q.subject]||(te[q.subject]={}),te[q.subject][q.theme]||(te[q.subject][q.theme]=[]),te[q.subject][q.theme].push(q)}),Object.entries(te).sort(([q],[W])=>ca[q].localeCompare(ca[W])).map(([q,W])=>({subject:q,themes:Object.entries(W).map(([Y,ne])=>({theme:Y,items:ne.sort((se,z)=>(se.order??999)-(z.order??999)||se.label.localeCompare(z.label))})).sort((Y,ne)=>Y.theme.localeCompare(ne.theme))}))},[C]);j.useEffect(()=>{V(new Set),F(new Set)},[N.length]);const M=te=>{V(q=>{const W=new Set(q);return W.has(te)?W.delete(te):W.add(te),W})},ie=(te,q)=>{const W=`${te}::${q}`;F(Y=>{const ne=new Set(Y);return ne.has(W)?ne.delete(W):ne.add(W),ne})};return c.jsxs("div",{className:"container",children:[c.jsxs("div",{className:"card",children:[c.jsx("h2",{style:{marginTop:0},children:"Priorits pdagogiques (PNJ)"}),c.jsx("p",{className:"small",children:"Les priorits guident les PNJ : les exercices et qutes proposs au joueur mettront en avant les blocs cochs pour lenfant slectionn. Tu peux ajuster par matire puis par zone (thme) et enfin par bloc prcis. Enregistre pour que les choix soient pris en compte dans le jeu."}),c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center",flexWrap:"wrap"},children:[c.jsx("span",{className:"small",children:"Enfant"}),c.jsx("select",{className:"input",value:s,onChange:te=>{const q=te.target.value;o(q),n(q),H(q)},children:t.map(te=>c.jsx("option",{value:te.id,children:te.displayName},te.id))}),c.jsx("input",{className:"input",placeholder:"Filtrer un tag",value:g,onChange:te=>y(te.target.value)}),c.jsx("button",{className:"btn secondary",onClick:E,children:"Tout slectionner"}),c.jsx("button",{className:"btn secondary",onClick:P,children:"Vider"}),c.jsx("button",{className:"btn",onClick:L,disabled:_||I||!s,children:"Enregistrer"})]}),S&&c.jsx("div",{className:"small",style:{marginTop:8},children:S})]}),I?c.jsx("div",{className:"card",children:"Chargement"}):N.length===0?c.jsx("div",{className:"card small",children:"Aucun tag trouv."}):N.map(te=>c.jsxs("div",{style:{borderBottom:"1px solid var(--border)",padding:"8px 0"},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>M(te.subject),children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[c.jsx("span",{style:{fontWeight:900},children:B.has(te.subject)?"":"+"}),c.jsx("h3",{style:{margin:0},children:ca[te.subject]})]}),c.jsxs("span",{className:"small",style:{color:"var(--muted)"},children:[te.themes.length," zones"]})]}),B.has(te.subject)?c.jsx("div",{className:"stack",style:{gap:8,marginLeft:24},children:te.themes.map(q=>{const W=`${te.subject}::${q.theme}`,Y=$.has(W);return c.jsxs("div",{style:{borderLeft:"2px solid var(--border)",paddingLeft:12,marginBottom:4},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>ie(te.subject,q.theme),children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,fontWeight:700},children:[c.jsx("span",{children:Y?"":"+"}),c.jsx("span",{children:q.theme})]}),c.jsxs("div",{className:"small",style:{color:"var(--muted)"},children:[q.items.length," bloc(s)"]})]}),Y?c.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:8,marginTop:6},children:q.items.map(ne=>{const se=h.has(ne.id);return c.jsxs("label",{style:{border:"1px solid var(--border)",borderRadius:6,padding:8,cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[c.jsx("div",{children:c.jsx("div",{style:{fontWeight:700},children:ne.label})}),c.jsx("input",{type:"checkbox",checked:se,onChange:()=>A(ne.id)})]},ne.id)})}):null]},q.theme)})}):null]},te.subject))]})}function _4({tagId:t,label:e,state:n,masteryPct:r,highlight:s,variant:o="overlay",onStartSession:l}){const d=Math.min(100,Math.max(0,Math.round(r||0))),h=["mc-blockTile",`mc-blockTile--${o}`,`is-${n}`];s&&h.push("is-highlighted");const f=n==="cracked"?"":n==="repairing"?"":n==="repaired"?"":"";return c.jsxs("button",{className:h.join(" "),"data-tag-id":t,"aria-label":`Lancer le bloc ${e}, matrise ${d}%`,title:`${e} (${d}%)`,onClick:l,children:[c.jsx("span",{className:"mc-blockTile__icon","aria-hidden":!0,children:f}),c.jsx("span",{className:"mc-blockTile__label",children:e}),c.jsx("span",{className:"mc-blockTile__bar",children:c.jsx("span",{className:"mc-blockTile__barFill",style:{width:`${d}%`}})}),c.jsxs("span",{className:"mc-blockTile__pct",children:[d,"%"]})]})}function Cx(t,e){return!(t.x+t.w<=e.x||e.x+e.w<=t.x||t.y+t.h<=e.y||e.y+e.h<=t.y)}function lh(t,e,n){return Math.min(n,Math.max(e,t))}function w4(t,e,n,r,s){const o=s?.maxTries,l=s?.stepPx,d=s?.growthEvery,h={x:lh(t.x,r.left,r.right-e.w),y:lh(t.y,r.top,r.bottom-e.h)};let f={x:h.x,y:h.y,w:e.w,h:e.h};if(!n.some(_=>Cx(_,f)))return{x:f.x,y:f.y,nudged:!1,tries:0};const g=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[-1,1],[-1,-1],[1,-1]];let y=0;for(let _=0;_<o;_++){const x=l*(1+Math.floor(_/d)),I=g[_%g.length],k=lh(h.x+I[0]*x,r.left,r.right-e.w),S=lh(h.y+I[1]*x,r.top,r.bottom-e.h);if(f={x:k,y:S,w:e.w,h:e.h},y=_+1,!n.some(O=>Cx(O,f)))return{x:f.x,y:f.y,nudged:!0,tries:y}}return{x:f.x,y:f.y,nudged:!0,tries:o}}function Ax(t,e){const n=Rs(t||"/");return Pn(n,`poi/poi_${e}.svg`)}function b4({tagId:t,label:e,state:n,masteryPct:r,highlight:s,onStart:o,packBaseUrl:l,mapDebug:d}){const h=vv(r),[f,g]=j.useState(null),[y,_]=j.useState(!1),[x,I]=j.useState(!1),[k,S]=j.useState(!1),O=wv(),B=j.useRef(null);j.useEffect(()=>{if(typeof window>"u")return;const H=window.matchMedia("(max-width: 900px)"),A=()=>S(H.matches);return A(),H.addEventListener("change",A),()=>H.removeEventListener("change",A)},[]),j.useEffect(()=>{let H=!1;const A=Ax(l,n),E=n==="weathered"?Ax(l,"cracked"):null,P=[A,E].filter(Boolean);g(null);async function L(){for(const C of P){const N=await Ts(C);if(H)return;if(N){g(C);return}}g(null)}return L(),()=>{H=!0}},[l,n]);const V=["mc-poi","mc-block-poi",`mc-poi-state-${n}`];s&&V.push("is-highlighted"),_v(n,s,O,["repairing","enhanced"])&&V.push("has-halo"),n==="weathered"&&V.push("has-weather");const $=`Bloc ${e}, matrise ${h}%`,F=()=>{I(!0),_(!1)};return c.jsxs(c.Fragment,{children:[c.jsxs("button",{type:"button",className:V.join(" "),"aria-label":$,title:$,"data-tag-id":t,onClick:H=>{if(k){H.preventDefault(),F();return}o()},onMouseEnter:()=>!k&&_(!0),onMouseLeave:()=>_(!1),onFocus:()=>!k&&_(!0),onBlur:()=>_(!1),onKeyDown:H=>{H.key==="Escape"&&(_(!1),I(!1)),(H.key==="Enter"||H.key===" ")&&k&&(H.preventDefault(),F())},ref:B,children:[c.jsxs("span",{className:"mc-poi-icon","aria-hidden":!0,children:[f?c.jsx("img",{src:f,alt:"",loading:"lazy"}):c.jsx("span",{className:"mc-poi-dot"}),c.jsxs("svg",{viewBox:"0 0 32 32",className:"mc-poi-ring","aria-hidden":!0,children:[c.jsx("circle",{className:"mc-poi-ring-bg",cx:"16",cy:"16",r:"12"}),c.jsx("circle",{className:"mc-poi-ring-fg",cx:"16",cy:"16",r:"12",strokeDasharray:`${h/100*75}, 120`})]})]}),c.jsx("span",{className:"mc-poi-meter","aria-hidden":!0,children:c.jsx("span",{style:{width:`${h}%`}})}),d&&c.jsx("span",{className:"mc-poi-debugLabel",children:e})]}),c.jsx(gv,{label:e,masteryPct:h,state:n,anchorRef:B,visible:y&&!x&&!k}),c.jsx(yv,{open:x||k&&y,label:e,masteryPct:h,state:n,onClose:()=>{I(!1),_(!1)},onStart:k?o:void 0,entityLabel:"Bloc",metricLabel:"Matrise"})]})}function vC(t){const e=Math.max(0,Math.min(100,Math.round(t||0)));return e>=100?4:e>=75?3:e>=50?2:e>=25?1:0}function _C(t,e){return e==="rebuilding"&&t>0}const Ev=ue.createContext({});function Iv(t){const e=ue.useRef(null);return e.current===null&&(e.current=t()),e.current}const Of=ue.createContext(null),Sv=ue.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});class x4 extends ue.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function T4({children:t,isPresent:e}){const n=ue.useId(),r=ue.useRef(null),s=ue.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=ue.useContext(Sv);return ue.useInsertionEffect(()=>{const{width:l,height:d,top:h,left:f}=s.current;if(e||!r.current||!l||!d)return;r.current.dataset.motionPopId=n;const g=document.createElement("style");return o&&(g.nonce=o),document.head.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${d}px !important;
            top: ${h}px !important;
            left: ${f}px !important;
          }
        `),()=>{document.head.removeChild(g)}},[e]),c.jsx(x4,{isPresent:e,childRef:r,sizeRef:s,children:ue.cloneElement(t,{ref:r})})}const E4=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:s,presenceAffectsLayout:o,mode:l})=>{const d=Iv(I4),h=ue.useId(),f=ue.useCallback(y=>{d.set(y,!0);for(const _ of d.values())if(!_)return;r&&r()},[d,r]),g=ue.useMemo(()=>({id:h,initial:e,isPresent:n,custom:s,onExitComplete:f,register:y=>(d.set(y,!1),()=>d.delete(y))}),o?[Math.random(),f]:[n,f]);return ue.useMemo(()=>{d.forEach((y,_)=>d.set(_,!1))},[n]),ue.useEffect(()=>{!n&&!d.size&&r&&r()},[n]),l==="popLayout"&&(t=c.jsx(T4,{isPresent:n,children:t})),c.jsx(Of.Provider,{value:g,children:t})};function I4(){return new Map}function wC(t=!0){const e=ue.useContext(Of);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:s}=e,o=ue.useId();ue.useEffect(()=>{t&&s(o)},[t]);const l=ue.useCallback(()=>t&&r&&r(o),[o,r,t]);return!n&&r?[!1,l]:[!0]}const ch=t=>t.key||"";function Rx(t){const e=[];return ue.Children.forEach(t,n=>{ue.isValidElement(n)&&e.push(n)}),e}const Cv=typeof window<"u",bC=Cv?ue.useLayoutEffect:ue.useEffect,S4=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:s=!0,mode:o="sync",propagate:l=!1})=>{const[d,h]=wC(l),f=ue.useMemo(()=>Rx(t),[t]),g=l&&!d?[]:f.map(ch),y=ue.useRef(!0),_=ue.useRef(f),x=Iv(()=>new Map),[I,k]=ue.useState(f),[S,O]=ue.useState(f);bC(()=>{y.current=!1,_.current=f;for(let $=0;$<S.length;$++){const F=ch(S[$]);g.includes(F)?x.delete(F):x.get(F)!==!0&&x.set(F,!1)}},[S,g.length,g.join("-")]);const B=[];if(f!==I){let $=[...f];for(let F=0;F<S.length;F++){const H=S[F],A=ch(H);g.includes(A)||($.splice(F,0,H),B.push(H))}o==="wait"&&B.length&&($=B),O(Rx($)),k(f);return}const{forceRender:V}=ue.useContext(Ev);return c.jsx(c.Fragment,{children:S.map($=>{const F=ch($),H=l&&!d?!1:f===S||g.includes(F),A=()=>{if(x.has(F))x.set(F,!0);else return;let E=!0;x.forEach(P=>{P||(E=!1)}),E&&(V?.(),O(_.current),l&&h?.(),r&&r())};return c.jsx(E4,{isPresent:H,initial:!y.current||n?void 0:!1,custom:H?void 0:e,presenceAffectsLayout:s,mode:o,onExitComplete:H?void 0:A,children:$},F)})})},Zr=t=>t;let xC=Zr;function Av(t){let e;return()=>(e===void 0&&(e=t()),e)}const Ml=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r},Ei=t=>t*1e3,Ii=t=>t/1e3,C4={useManualTiming:!1};function A4(t){let e=new Set,n=new Set,r=!1,s=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function d(f){o.has(f)&&(h.schedule(f),t()),f(l)}const h={schedule:(f,g=!1,y=!1)=>{const x=y&&r?e:n;return g&&o.add(f),x.has(f)||x.add(f),f},cancel:f=>{n.delete(f),o.delete(f)},process:f=>{if(l=f,r){s=!0;return}r=!0,[e,n]=[n,e],e.forEach(d),e.clear(),r=!1,s&&(s=!1,h.process(f))}};return h}const uh=["read","resolveKeyframes","update","preRender","render","postRender"],R4=40;function TC(t,e){let n=!1,r=!0;const s={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,l=uh.reduce((O,B)=>(O[B]=A4(o),O),{}),{read:d,resolveKeyframes:h,update:f,preRender:g,render:y,postRender:_}=l,x=()=>{const O=performance.now();n=!1,s.delta=r?1e3/60:Math.max(Math.min(O-s.timestamp,R4),1),s.timestamp=O,s.isProcessing=!0,d.process(s),h.process(s),f.process(s),g.process(s),y.process(s),_.process(s),s.isProcessing=!1,n&&e&&(r=!1,t(x))},I=()=>{n=!0,r=!0,s.isProcessing||t(x)};return{schedule:uh.reduce((O,B)=>{const V=l[B];return O[B]=($,F=!1,H=!1)=>(n||I(),V.schedule($,F,H)),O},{}),cancel:O=>{for(let B=0;B<uh.length;B++)l[uh[B]].cancel(O)},state:s,steps:l}}const{schedule:Xt,cancel:So,state:or,steps:Op}=TC(typeof requestAnimationFrame<"u"?requestAnimationFrame:Zr,!0),EC=ue.createContext({strict:!1}),kx={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Dl={};for(const t in kx)Dl[t]={isEnabled:e=>kx[t].some(n=>!!e[n])};function k4(t){for(const e in t)Dl[e]={...Dl[e],...t[e]}}const P4=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nf(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||P4.has(t)}let IC=t=>!nf(t);function j4(t){t&&(IC=e=>e.startsWith("on")?!nf(e):t(e))}try{j4(require("@emotion/is-prop-valid").default)}catch{}function N4(t,e,n){const r={};for(const s in t)s==="values"&&typeof t.values=="object"||(IC(s)||n===!0&&nf(s)||!e&&!nf(s)||t.draggable&&s.startsWith("onDrag"))&&(r[s]=t[s]);return r}function M4(t){if(typeof Proxy>"u")return t;const e=new Map,n=(...r)=>t(...r);return new Proxy(n,{get:(r,s)=>s==="create"?t:(e.has(s)||e.set(s,t(s)),e.get(s))})}const Ff=ue.createContext({});function Eu(t){return typeof t=="string"||Array.isArray(t)}function Bf(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const Rv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],kv=["initial",...Rv];function Uf(t){return Bf(t.animate)||kv.some(e=>Eu(t[e]))}function SC(t){return!!(Uf(t)||t.variants)}function D4(t,e){if(Uf(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Eu(n)?n:void 0,animate:Eu(r)?r:void 0}}return t.inherit!==!1?e:{}}function L4(t){const{initial:e,animate:n}=D4(t,ue.useContext(Ff));return ue.useMemo(()=>({initial:e,animate:n}),[Px(e),Px(n)])}function Px(t){return Array.isArray(t)?t.join(" "):t}const V4=Symbol.for("motionComponentSymbol");function cl(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function O4(t,e,n){return ue.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):cl(n)&&(n.current=r))},[e])}const Pv=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),F4="framerAppearId",CC="data-"+Pv(F4),{schedule:jv}=TC(queueMicrotask,!1),AC=ue.createContext({});function B4(t,e,n,r,s){var o,l;const{visualElement:d}=ue.useContext(Ff),h=ue.useContext(EC),f=ue.useContext(Of),g=ue.useContext(Sv).reducedMotion,y=ue.useRef(null);r=r||h.renderer,!y.current&&r&&(y.current=r(t,{visualState:e,parent:d,props:n,presenceContext:f,blockInitialAnimation:f?f.initial===!1:!1,reducedMotionConfig:g}));const _=y.current,x=ue.useContext(AC);_&&!_.projection&&s&&(_.type==="html"||_.type==="svg")&&U4(y.current,n,s,x);const I=ue.useRef(!1);ue.useInsertionEffect(()=>{_&&I.current&&_.update(n,f)});const k=n[CC],S=ue.useRef(!!k&&!(!((o=window.MotionHandoffIsComplete)===null||o===void 0)&&o.call(window,k))&&((l=window.MotionHasOptimisedAnimation)===null||l===void 0?void 0:l.call(window,k)));return bC(()=>{_&&(I.current=!0,window.MotionIsMounted=!0,_.updateFeatures(),jv.render(_.render),S.current&&_.animationState&&_.animationState.animateChanges())}),ue.useEffect(()=>{_&&(!S.current&&_.animationState&&_.animationState.animateChanges(),S.current&&(queueMicrotask(()=>{var O;(O=window.MotionHandoffMarkAsComplete)===null||O===void 0||O.call(window,k)}),S.current=!1))}),_}function U4(t,e,n,r){const{layoutId:s,layout:o,drag:l,dragConstraints:d,layoutScroll:h,layoutRoot:f}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:RC(t.parent)),t.projection.setOptions({layoutId:s,layout:o,alwaysMeasureLayout:!!l||d&&cl(d),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:r,layoutScroll:h,layoutRoot:f})}function RC(t){if(t)return t.options.allowProjection!==!1?t.projection:RC(t.parent)}function $4({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:r,Component:s}){var o,l;t&&k4(t);function d(f,g){let y;const _={...ue.useContext(Sv),...f,layoutId:z4(f)},{isStatic:x}=_,I=L4(f),k=r(f,x);if(!x&&Cv){q4();const S=W4(_);y=S.MeasureLayout,I.visualElement=B4(s,k,_,e,S.ProjectionNode)}return c.jsxs(Ff.Provider,{value:I,children:[y&&I.visualElement?c.jsx(y,{visualElement:I.visualElement,..._}):null,n(s,f,O4(k,I.visualElement,g),k,x,I.visualElement)]})}d.displayName=`motion.${typeof s=="string"?s:`create(${(l=(o=s.displayName)!==null&&o!==void 0?o:s.name)!==null&&l!==void 0?l:""})`}`;const h=ue.forwardRef(d);return h[V4]=s,h}function z4({layoutId:t}){const e=ue.useContext(Ev).id;return e&&t!==void 0?e+"-"+t:t}function q4(t,e){ue.useContext(EC).strict}function W4(t){const{drag:e,layout:n}=Dl;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e?.isEnabled(t)||n?.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}const H4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Nv(t){return typeof t!="string"||t.includes("-")?!1:!!(H4.indexOf(t)>-1||/[A-Z]/u.test(t))}function jx(t){const e=[{},{}];return t?.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function Mv(t,e,n,r){if(typeof e=="function"){const[s,o]=jx(r);e=e(n!==void 0?n:t.custom,s,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[s,o]=jx(r);e=e(n!==void 0?n:t.custom,s,o)}return e}const Ng=t=>Array.isArray(t),K4=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),G4=t=>Ng(t)?t[t.length-1]||0:t,xr=t=>!!(t&&t.getVelocity);function Ih(t){const e=xr(t)?t.get():t;return K4(e)?e.toValue():e}function Q4({scrapeMotionValuesFromProps:t,createRenderState:e,onUpdate:n},r,s,o){const l={latestValues:X4(r,s,o,t),renderState:e()};return n&&(l.onMount=d=>n({props:r,current:d,...l}),l.onUpdate=d=>n(d)),l}const kC=t=>(e,n)=>{const r=ue.useContext(Ff),s=ue.useContext(Of),o=()=>Q4(t,e,r,s);return n?o():Iv(o)};function X4(t,e,n,r){const s={},o=r(t,{});for(const _ in o)s[_]=Ih(o[_]);let{initial:l,animate:d}=t;const h=Uf(t),f=SC(t);e&&f&&!h&&t.inherit!==!1&&(l===void 0&&(l=e.initial),d===void 0&&(d=e.animate));let g=n?n.initial===!1:!1;g=g||l===!1;const y=g?d:l;if(y&&typeof y!="boolean"&&!Bf(y)){const _=Array.isArray(y)?y:[y];for(let x=0;x<_.length;x++){const I=Mv(t,_[x]);if(I){const{transitionEnd:k,transition:S,...O}=I;for(const B in O){let V=O[B];if(Array.isArray(V)){const $=g?V.length-1:0;V=V[$]}V!==null&&(s[B]=V)}for(const B in k)s[B]=k[B]}}}return s}const Gl=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Sa=new Set(Gl),PC=t=>e=>typeof e=="string"&&e.startsWith(t),jC=PC("--"),Y4=PC("var(--"),Dv=t=>Y4(t)?J4.test(t.split("/*")[0].trim()):!1,J4=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,NC=(t,e)=>e&&typeof t=="number"?e.transform(t):t,ji=(t,e,n)=>n>e?e:n<t?t:n,Ql={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Iu={...Ql,transform:t=>ji(0,1,t)},dh={...Ql,default:1},Wu=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),no=Wu("deg"),Zs=Wu("%"),et=Wu("px"),Z4=Wu("vh"),e5=Wu("vw"),Nx={...Zs,parse:t=>Zs.parse(t)/100,transform:t=>Zs.transform(t*100)},t5={borderWidth:et,borderTopWidth:et,borderRightWidth:et,borderBottomWidth:et,borderLeftWidth:et,borderRadius:et,radius:et,borderTopLeftRadius:et,borderTopRightRadius:et,borderBottomRightRadius:et,borderBottomLeftRadius:et,width:et,maxWidth:et,height:et,maxHeight:et,top:et,right:et,bottom:et,left:et,padding:et,paddingTop:et,paddingRight:et,paddingBottom:et,paddingLeft:et,margin:et,marginTop:et,marginRight:et,marginBottom:et,marginLeft:et,backgroundPositionX:et,backgroundPositionY:et},n5={rotate:no,rotateX:no,rotateY:no,rotateZ:no,scale:dh,scaleX:dh,scaleY:dh,scaleZ:dh,skew:no,skewX:no,skewY:no,distance:et,translateX:et,translateY:et,translateZ:et,x:et,y:et,z:et,perspective:et,transformPerspective:et,opacity:Iu,originX:Nx,originY:Nx,originZ:et},Mx={...Ql,transform:Math.round},Lv={...t5,...n5,zIndex:Mx,size:et,fillOpacity:Iu,strokeOpacity:Iu,numOctaves:Mx},r5={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},s5=Gl.length;function i5(t,e,n){let r="",s=!0;for(let o=0;o<s5;o++){const l=Gl[o],d=t[l];if(d===void 0)continue;let h=!0;if(typeof d=="number"?h=d===(l.startsWith("scale")?1:0):h=parseFloat(d)===0,!h||n){const f=NC(d,Lv[l]);if(!h){s=!1;const g=r5[l]||l;r+=`${g}(${f}) `}n&&(e[l]=f)}}return r=r.trim(),n?r=n(e,s?"":r):s&&(r="none"),r}function Vv(t,e,n){const{style:r,vars:s,transformOrigin:o}=t;let l=!1,d=!1;for(const h in e){const f=e[h];if(Sa.has(h)){l=!0;continue}else if(jC(h)){s[h]=f;continue}else{const g=NC(f,Lv[h]);h.startsWith("origin")?(d=!0,o[h]=g):r[h]=g}}if(e.transform||(l||n?r.transform=i5(e,t.transform,n):r.transform&&(r.transform="none")),d){const{originX:h="50%",originY:f="50%",originZ:g=0}=o;r.transformOrigin=`${h} ${f} ${g}`}}const o5={offset:"stroke-dashoffset",array:"stroke-dasharray"},a5={offset:"strokeDashoffset",array:"strokeDasharray"};function l5(t,e,n=1,r=0,s=!0){t.pathLength=1;const o=s?o5:a5;t[o.offset]=et.transform(-r);const l=et.transform(e),d=et.transform(n);t[o.array]=`${l} ${d}`}function Dx(t,e,n){return typeof t=="string"?t:et.transform(e+n*t)}function c5(t,e,n){const r=Dx(e,t.x,t.width),s=Dx(n,t.y,t.height);return`${r} ${s}`}function Ov(t,{attrX:e,attrY:n,attrScale:r,originX:s,originY:o,pathLength:l,pathSpacing:d=1,pathOffset:h=0,...f},g,y){if(Vv(t,f,y),g){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:_,style:x,dimensions:I}=t;_.transform&&(I&&(x.transform=_.transform),delete _.transform),I&&(s!==void 0||o!==void 0||x.transform)&&(x.transformOrigin=c5(I,s!==void 0?s:.5,o!==void 0?o:.5)),e!==void 0&&(_.x=e),n!==void 0&&(_.y=n),r!==void 0&&(_.scale=r),l!==void 0&&l5(_,l,d,h,!1)}const Fv=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),MC=()=>({...Fv(),attrs:{}}),Bv=t=>typeof t=="string"&&t.toLowerCase()==="svg";function DC(t,{style:e,vars:n},r,s){Object.assign(t.style,e,s&&s.getProjectionStyles(r));for(const o in n)t.style.setProperty(o,n[o])}const LC=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function VC(t,e,n,r){DC(t,e,void 0,r);for(const s in e.attrs)t.setAttribute(LC.has(s)?s:Pv(s),e.attrs[s])}const rf={};function u5(t){Object.assign(rf,t)}function OC(t,{layout:e,layoutId:n}){return Sa.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!rf[t]||t==="opacity")}function Uv(t,e,n){var r;const{style:s}=t,o={};for(const l in s)(xr(s[l])||e.style&&xr(e.style[l])||OC(l,t)||((r=n?.getValue(l))===null||r===void 0?void 0:r.liveStyle)!==void 0)&&(o[l]=s[l]);return o}function FC(t,e,n){const r=Uv(t,e,n);for(const s in t)if(xr(t[s])||xr(e[s])){const o=Gl.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[o]=t[s]}return r}function d5(t,e){try{e.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Lx=["x","y","width","height","cx","cy","r"],h5={useVisualState:kC({scrapeMotionValuesFromProps:FC,createRenderState:MC,onUpdate:({props:t,prevProps:e,current:n,renderState:r,latestValues:s})=>{if(!n)return;let o=!!t.drag;if(!o){for(const d in s)if(Sa.has(d)){o=!0;break}}if(!o)return;let l=!e;if(e)for(let d=0;d<Lx.length;d++){const h=Lx[d];t[h]!==e[h]&&(l=!0)}l&&Xt.read(()=>{d5(n,r),Xt.render(()=>{Ov(r,s,Bv(n.tagName),t.transformTemplate),VC(n,r)})})}})},f5={useVisualState:kC({scrapeMotionValuesFromProps:Uv,createRenderState:Fv})};function BC(t,e,n){for(const r in e)!xr(e[r])&&!OC(r,n)&&(t[r]=e[r])}function m5({transformTemplate:t},e){return ue.useMemo(()=>{const n=Fv();return Vv(n,e,t),Object.assign({},n.vars,n.style)},[e])}function p5(t,e){const n=t.style||{},r={};return BC(r,n,t),Object.assign(r,m5(t,e)),r}function g5(t,e){const n={},r=p5(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}function y5(t,e,n,r){const s=ue.useMemo(()=>{const o=MC();return Ov(o,e,Bv(r),t.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};BC(o,t.style,t),s.style={...o,...s.style}}return s}function v5(t=!1){return(n,r,s,{latestValues:o},l)=>{const h=(Nv(n)?y5:g5)(r,o,l,n),f=N4(r,typeof n=="string",t),g=n!==ue.Fragment?{...f,...h,ref:s}:{},{children:y}=r,_=ue.useMemo(()=>xr(y)?y.get():y,[y]);return ue.createElement(n,{...g,children:_})}}function _5(t,e){return function(r,{forwardMotionProps:s}={forwardMotionProps:!1}){const l={...Nv(r)?h5:f5,preloadedFeatures:t,useRender:v5(s),createVisualElement:e,Component:r};return $4(l)}}function UC(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function $f(t,e,n){const r=t.getProps();return Mv(r,e,n!==void 0?n:r.custom,t)}const w5=Av(()=>window.ScrollTimeline!==void 0);class b5{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,n){for(let r=0;r<this.animations.length;r++)this.animations[r][e]=n}attachTimeline(e,n){const r=this.animations.map(s=>{if(w5()&&s.attachTimeline)return s.attachTimeline(e);if(typeof n=="function")return n(s)});return()=>{r.forEach((s,o)=>{s&&s(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let n=0;n<this.animations.length;n++)e=Math.max(e,this.animations[n].duration);return e}runAll(e){this.animations.forEach(n=>n[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class x5 extends b5{then(e,n){return Promise.all(this.animations).then(e).catch(n)}}function $v(t,e){return t?t[e]||t.default||t:void 0}const Mg=2e4;function $C(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<Mg;)e+=n,r=t.next(e);return e>=Mg?1/0:e}function zv(t){return typeof t=="function"}function Vx(t,e){t.timeline=e,t.onfinish=null}const qv=t=>Array.isArray(t)&&typeof t[0]=="number",T5={linearEasing:void 0};function E5(t,e){const n=Av(t);return()=>{var r;return(r=T5[e])!==null&&r!==void 0?r:n()}}const sf=E5(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),zC=(t,e,n=10)=>{let r="";const s=Math.max(Math.round(e/n),2);for(let o=0;o<s;o++)r+=t(Ml(0,s-1,o))+", ";return`linear(${r.substring(0,r.length-2)})`};function qC(t){return!!(typeof t=="function"&&sf()||!t||typeof t=="string"&&(t in Dg||sf())||qv(t)||Array.isArray(t)&&t.every(qC))}const Wc=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,Dg={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Wc([0,.65,.55,1]),circOut:Wc([.55,0,1,.45]),backIn:Wc([.31,.01,.66,-.59]),backOut:Wc([.33,1.53,.69,.99])};function WC(t,e){if(t)return typeof t=="function"&&sf()?zC(t,e):qv(t)?Wc(t):Array.isArray(t)?t.map(n=>WC(n,e)||Dg.easeOut):Dg[t]}const bs={x:!1,y:!1};function HC(){return bs.x||bs.y}function I5(t,e,n){var r;if(t instanceof Element)return[t];if(typeof t=="string"){let s=document;const o=(r=void 0)!==null&&r!==void 0?r:s.querySelectorAll(t);return o?Array.from(o):[]}return Array.from(t)}function KC(t,e){const n=I5(t),r=new AbortController,s={passive:!0,...e,signal:r.signal};return[n,s,()=>r.abort()]}function Ox(t){return e=>{e.pointerType==="touch"||HC()||t(e)}}function S5(t,e,n={}){const[r,s,o]=KC(t,n),l=Ox(d=>{const{target:h}=d,f=e(d);if(typeof f!="function"||!h)return;const g=Ox(y=>{f(y),h.removeEventListener("pointerleave",g)});h.addEventListener("pointerleave",g,s)});return r.forEach(d=>{d.addEventListener("pointerenter",l,s)}),o}const GC=(t,e)=>e?t===e?!0:GC(t,e.parentElement):!1,Wv=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,C5=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function A5(t){return C5.has(t.tagName)||t.tabIndex!==-1}const Hc=new WeakSet;function Fx(t){return e=>{e.key==="Enter"&&t(e)}}function Fp(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const R5=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=Fx(()=>{if(Hc.has(n))return;Fp(n,"down");const s=Fx(()=>{Fp(n,"up")}),o=()=>Fp(n,"cancel");n.addEventListener("keyup",s,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function Bx(t){return Wv(t)&&!HC()}function k5(t,e,n={}){const[r,s,o]=KC(t,n),l=d=>{const h=d.currentTarget;if(!Bx(d)||Hc.has(h))return;Hc.add(h);const f=e(d),g=(x,I)=>{window.removeEventListener("pointerup",y),window.removeEventListener("pointercancel",_),!(!Bx(x)||!Hc.has(h))&&(Hc.delete(h),typeof f=="function"&&f(x,{success:I}))},y=x=>{g(x,n.useGlobalTarget||GC(h,x.target))},_=x=>{g(x,!1)};window.addEventListener("pointerup",y,s),window.addEventListener("pointercancel",_,s)};return r.forEach(d=>{!A5(d)&&d.getAttribute("tabindex")===null&&(d.tabIndex=0),(n.useGlobalTarget?window:d).addEventListener("pointerdown",l,s),d.addEventListener("focus",f=>R5(f,s),s)}),o}function P5(t){return t==="x"||t==="y"?bs[t]?null:(bs[t]=!0,()=>{bs[t]=!1}):bs.x||bs.y?null:(bs.x=bs.y=!0,()=>{bs.x=bs.y=!1})}const QC=new Set(["width","height","top","left","right","bottom",...Gl]);let Sh;function j5(){Sh=void 0}const ei={now:()=>(Sh===void 0&&ei.set(or.isProcessing||C4.useManualTiming?or.timestamp:performance.now()),Sh),set:t=>{Sh=t,queueMicrotask(j5)}};function Hv(t,e){t.indexOf(e)===-1&&t.push(e)}function Kv(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Gv{constructor(){this.subscriptions=[]}add(e){return Hv(this.subscriptions,e),()=>Kv(this.subscriptions,e)}notify(e,n,r){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,n,r);else for(let o=0;o<s;o++){const l=this.subscriptions[o];l&&l(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function XC(t,e){return e?t*(1e3/e):0}const Ux=30,N5=t=>!isNaN(parseFloat(t));class M5{constructor(e,n={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(r,s=!0)=>{const o=ei.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=ei.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=N5(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new Gv);const r=this.events[e].add(n);return e==="change"?()=>{r(),Xt.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=ei.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Ux)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Ux);return XC(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Su(t,e){return new M5(t,e)}function D5(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,Su(n))}function L5(t,e){const n=$f(t,e);let{transitionEnd:r={},transition:s={},...o}=n||{};o={...o,...r};for(const l in o){const d=G4(o[l]);D5(t,l,d)}}function V5(t){return!!(xr(t)&&t.add)}function Lg(t,e){const n=t.getValue("willChange");if(V5(n))return n.add(e)}function YC(t){return t.props[CC]}const JC=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,O5=1e-7,F5=12;function B5(t,e,n,r,s){let o,l,d=0;do l=e+(n-e)/2,o=JC(l,r,s)-t,o>0?n=l:e=l;while(Math.abs(o)>O5&&++d<F5);return l}function Hu(t,e,n,r){if(t===e&&n===r)return Zr;const s=o=>B5(o,0,1,t,n);return o=>o===0||o===1?o:JC(s(o),e,r)}const ZC=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,eA=t=>e=>1-t(1-e),tA=Hu(.33,1.53,.69,.99),Qv=eA(tA),nA=ZC(Qv),rA=t=>(t*=2)<1?.5*Qv(t):.5*(2-Math.pow(2,-10*(t-1))),Xv=t=>1-Math.sin(Math.acos(t)),sA=eA(Xv),iA=ZC(Xv),oA=t=>/^0[^.\s]+$/u.test(t);function U5(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||oA(t):!0}const ru=t=>Math.round(t*1e5)/1e5,Yv=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function $5(t){return t==null}const z5=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Jv=(t,e)=>n=>!!(typeof n=="string"&&z5.test(n)&&n.startsWith(t)||e&&!$5(n)&&Object.prototype.hasOwnProperty.call(n,e)),aA=(t,e,n)=>r=>{if(typeof r!="string")return r;const[s,o,l,d]=r.match(Yv);return{[t]:parseFloat(s),[e]:parseFloat(o),[n]:parseFloat(l),alpha:d!==void 0?parseFloat(d):1}},q5=t=>ji(0,255,t),Bp={...Ql,transform:t=>Math.round(q5(t))},ua={test:Jv("rgb","red"),parse:aA("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+Bp.transform(t)+", "+Bp.transform(e)+", "+Bp.transform(n)+", "+ru(Iu.transform(r))+")"};function W5(t){let e="",n="",r="",s="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),s=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),s=t.substring(4,5),e+=e,n+=n,r+=r,s+=s),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:s?parseInt(s,16)/255:1}}const Vg={test:Jv("#"),parse:W5,transform:ua.transform},ul={test:Jv("hsl","hue"),parse:aA("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+Zs.transform(ru(e))+", "+Zs.transform(ru(n))+", "+ru(Iu.transform(r))+")"},_r={test:t=>ua.test(t)||Vg.test(t)||ul.test(t),parse:t=>ua.test(t)?ua.parse(t):ul.test(t)?ul.parse(t):Vg.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?ua.transform(t):ul.transform(t)},H5=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function K5(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(Yv))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(H5))===null||n===void 0?void 0:n.length)||0)>0}const lA="number",cA="color",G5="var",Q5="var(",$x="${}",X5=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Cu(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},s=[];let o=0;const d=e.replace(X5,h=>(_r.test(h)?(r.color.push(o),s.push(cA),n.push(_r.parse(h))):h.startsWith(Q5)?(r.var.push(o),s.push(G5),n.push(h)):(r.number.push(o),s.push(lA),n.push(parseFloat(h))),++o,$x)).split($x);return{values:n,split:d,indexes:r,types:s}}function uA(t){return Cu(t).values}function dA(t){const{split:e,types:n}=Cu(t),r=e.length;return s=>{let o="";for(let l=0;l<r;l++)if(o+=e[l],s[l]!==void 0){const d=n[l];d===lA?o+=ru(s[l]):d===cA?o+=_r.transform(s[l]):o+=s[l]}return o}}const Y5=t=>typeof t=="number"?0:t;function J5(t){const e=uA(t);return dA(t)(e.map(Y5))}const Co={test:K5,parse:uA,createTransformer:dA,getAnimatableNone:J5},Z5=new Set(["brightness","contrast","saturate","opacity"]);function eB(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(Yv)||[];if(!r)return t;const s=n.replace(r,"");let o=Z5.has(e)?1:0;return r!==n&&(o*=100),e+"("+o+s+")"}const tB=/\b([a-z-]*)\(.*?\)/gu,Og={...Co,getAnimatableNone:t=>{const e=t.match(tB);return e?e.map(eB).join(" "):t}},nB={...Lv,color:_r,backgroundColor:_r,outlineColor:_r,fill:_r,stroke:_r,borderColor:_r,borderTopColor:_r,borderRightColor:_r,borderBottomColor:_r,borderLeftColor:_r,filter:Og,WebkitFilter:Og},Zv=t=>nB[t];function hA(t,e){let n=Zv(t);return n!==Og&&(n=Co),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const rB=new Set(["auto","none","0"]);function sB(t,e,n){let r=0,s;for(;r<t.length&&!s;){const o=t[r];typeof o=="string"&&!rB.has(o)&&Cu(o).values.length&&(s=t[r]),r++}if(s&&n)for(const o of e)t[o]=hA(n,s)}const zx=t=>t===Ql||t===et,qx=(t,e)=>parseFloat(t.split(", ")[e]),Wx=(t,e)=>(n,{transform:r})=>{if(r==="none"||!r)return 0;const s=r.match(/^matrix3d\((.+)\)$/u);if(s)return qx(s[1],e);{const o=r.match(/^matrix\((.+)\)$/u);return o?qx(o[1],t):0}},iB=new Set(["x","y","z"]),oB=Gl.filter(t=>!iB.has(t));function aB(t){const e=[];return oB.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Ll={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:Wx(4,13),y:Wx(5,14)};Ll.translateX=Ll.x;Ll.translateY=Ll.y;const ha=new Set;let Fg=!1,Bg=!1;function fA(){if(Bg){const t=Array.from(ha).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const s=aB(r);s.length&&(n.set(r,s),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const s=n.get(r);s&&s.forEach(([o,l])=>{var d;(d=r.getValue(o))===null||d===void 0||d.set(l)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}Bg=!1,Fg=!1,ha.forEach(t=>t.complete()),ha.clear()}function mA(){ha.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Bg=!0)})}function lB(){mA(),fA()}class e_{constructor(e,n,r,s,o,l=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=s,this.element=o,this.isAsync=l}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ha.add(this),Fg||(Fg=!0,Xt.read(mA),Xt.resolveKeyframes(fA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:s}=this;for(let o=0;o<e.length;o++)if(e[o]===null)if(o===0){const l=s?.get(),d=e[e.length-1];if(l!==void 0)e[0]=l;else if(r&&n){const h=r.readValue(n,d);h!=null&&(e[0]=h)}e[0]===void 0&&(e[0]=d),s&&l===void 0&&s.set(e[0])}else e[o]=e[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ha.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ha.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const pA=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t),cB=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function uB(t){const e=cB.exec(t);if(!e)return[,];const[,n,r,s]=e;return[`--${n??r}`,s]}function gA(t,e,n=1){const[r,s]=uB(t);if(!r)return;const o=window.getComputedStyle(e).getPropertyValue(r);if(o){const l=o.trim();return pA(l)?parseFloat(l):l}return Dv(s)?gA(s,e,n+1):s}const yA=t=>e=>e.test(t),dB={test:t=>t==="auto",parse:t=>t},vA=[Ql,et,Zs,no,e5,Z4,dB],Hx=t=>vA.find(yA(t));class _A extends e_{constructor(e,n,r,s,o){super(e,n,r,s,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let h=0;h<e.length;h++){let f=e[h];if(typeof f=="string"&&(f=f.trim(),Dv(f))){const g=gA(f,n.current);g!==void 0&&(e[h]=g),h===e.length-1&&(this.finalKeyframe=f)}}if(this.resolveNoneKeyframes(),!QC.has(r)||e.length!==2)return;const[s,o]=e,l=Hx(s),d=Hx(o);if(l!==d)if(zx(l)&&zx(d))for(let h=0;h<e.length;h++){const f=e[h];typeof f=="string"&&(e[h]=parseFloat(f))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let s=0;s<e.length;s++)U5(e[s])&&r.push(s);r.length&&sB(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ll[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const s=n[n.length-1];s!==void 0&&e.getValue(r,s).jump(s,!1)}measureEndState(){var e;const{element:n,name:r,unresolvedKeyframes:s}=this;if(!n||!n.current)return;const o=n.getValue(r);o&&o.jump(this.measuredOrigin,!1);const l=s.length-1,d=s[l];s[l]=Ll[r](n.measureViewportBox(),window.getComputedStyle(n.current)),d!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=d),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([h,f])=>{n.getValue(h).set(f)}),this.resolveNoneKeyframes()}}const Kx=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Co.test(t)||t==="0")&&!t.startsWith("url("));function hB(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function fB(t,e,n,r){const s=t[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],l=Kx(s,e),d=Kx(o,e);return!l||!d?!1:hB(t)||(n==="spring"||zv(n))&&r}const mB=t=>t!==null;function zf(t,{repeat:e,repeatType:n="loop"},r){const s=t.filter(mB),o=e&&n!=="loop"&&e%2===1?0:s.length-1;return!o||r===void 0?s[o]:r}const pB=40;class wA{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:s=0,repeatDelay:o=0,repeatType:l="loop",...d}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ei.now(),this.options={autoplay:e,delay:n,type:r,repeat:s,repeatDelay:o,repeatType:l,...d},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>pB?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&lB(),this._resolved}onKeyframesResolved(e,n){this.resolvedAt=ei.now(),this.hasAttemptedResolve=!0;const{name:r,type:s,velocity:o,delay:l,onComplete:d,onUpdate:h,isGenerator:f}=this.options;if(!f&&!fB(e,r,s,o))if(l)this.options.duration=0;else{h&&h(zf(e,this.options,n)),d&&d(),this.resolveFinishedPromise();return}const g=this.initPlayback(e,n);g!==!1&&(this._resolved={keyframes:e,finalKeyframe:n,...g},this.onPostResolved())}onPostResolved(){}then(e,n){return this.currentFinishedPromise.then(e,n)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ln=(t,e,n)=>t+(e-t)*n;function Up(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function gB({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let s=0,o=0,l=0;if(!e)s=o=l=n;else{const d=n<.5?n*(1+e):n+e-n*e,h=2*n-d;s=Up(h,d,t+1/3),o=Up(h,d,t),l=Up(h,d,t-1/3)}return{red:Math.round(s*255),green:Math.round(o*255),blue:Math.round(l*255),alpha:r}}function of(t,e){return n=>n>0?e:t}const $p=(t,e,n)=>{const r=t*t,s=n*(e*e-r)+r;return s<0?0:Math.sqrt(s)},yB=[Vg,ua,ul],vB=t=>yB.find(e=>e.test(t));function Gx(t){const e=vB(t);if(!e)return!1;let n=e.parse(t);return e===ul&&(n=gB(n)),n}const Qx=(t,e)=>{const n=Gx(t),r=Gx(e);if(!n||!r)return of(t,e);const s={...n};return o=>(s.red=$p(n.red,r.red,o),s.green=$p(n.green,r.green,o),s.blue=$p(n.blue,r.blue,o),s.alpha=ln(n.alpha,r.alpha,o),ua.transform(s))},_B=(t,e)=>n=>e(t(n)),Ku=(...t)=>t.reduce(_B),Ug=new Set(["none","hidden"]);function wB(t,e){return Ug.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function bB(t,e){return n=>ln(t,e,n)}function t_(t){return typeof t=="number"?bB:typeof t=="string"?Dv(t)?of:_r.test(t)?Qx:EB:Array.isArray(t)?bA:typeof t=="object"?_r.test(t)?Qx:xB:of}function bA(t,e){const n=[...t],r=n.length,s=t.map((o,l)=>t_(o)(o,e[l]));return o=>{for(let l=0;l<r;l++)n[l]=s[l](o);return n}}function xB(t,e){const n={...t,...e},r={};for(const s in n)t[s]!==void 0&&e[s]!==void 0&&(r[s]=t_(t[s])(t[s],e[s]));return s=>{for(const o in r)n[o]=r[o](s);return n}}function TB(t,e){var n;const r=[],s={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const l=e.types[o],d=t.indexes[l][s[l]],h=(n=t.values[d])!==null&&n!==void 0?n:0;r[o]=h,s[l]++}return r}const EB=(t,e)=>{const n=Co.createTransformer(e),r=Cu(t),s=Cu(e);return r.indexes.var.length===s.indexes.var.length&&r.indexes.color.length===s.indexes.color.length&&r.indexes.number.length>=s.indexes.number.length?Ug.has(t)&&!s.values.length||Ug.has(e)&&!r.values.length?wB(t,e):Ku(bA(TB(r,s),s.values),n):of(t,e)};function xA(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?ln(t,e,n):t_(t)(t,e)}const IB=5;function TA(t,e,n){const r=Math.max(e-IB,0);return XC(n-t(r),e-r)}const vn={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},zp=.001;function SB({duration:t=vn.duration,bounce:e=vn.bounce,velocity:n=vn.velocity,mass:r=vn.mass}){let s,o,l=1-e;l=ji(vn.minDamping,vn.maxDamping,l),t=ji(vn.minDuration,vn.maxDuration,Ii(t)),l<1?(s=f=>{const g=f*l,y=g*t,_=g-n,x=$g(f,l),I=Math.exp(-y);return zp-_/x*I},o=f=>{const y=f*l*t,_=y*n+n,x=Math.pow(l,2)*Math.pow(f,2)*t,I=Math.exp(-y),k=$g(Math.pow(f,2),l);return(-s(f)+zp>0?-1:1)*((_-x)*I)/k}):(s=f=>{const g=Math.exp(-f*t),y=(f-n)*t+1;return-zp+g*y},o=f=>{const g=Math.exp(-f*t),y=(n-f)*(t*t);return g*y});const d=5/t,h=AB(s,o,d);if(t=Ei(t),isNaN(h))return{stiffness:vn.stiffness,damping:vn.damping,duration:t};{const f=Math.pow(h,2)*r;return{stiffness:f,damping:l*2*Math.sqrt(r*f),duration:t}}}const CB=12;function AB(t,e,n){let r=n;for(let s=1;s<CB;s++)r=r-t(r)/e(r);return r}function $g(t,e){return t*Math.sqrt(1-e*e)}const RB=["duration","bounce"],kB=["stiffness","damping","mass"];function Xx(t,e){return e.some(n=>t[n]!==void 0)}function PB(t){let e={velocity:vn.velocity,stiffness:vn.stiffness,damping:vn.damping,mass:vn.mass,isResolvedFromDuration:!1,...t};if(!Xx(t,kB)&&Xx(t,RB))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),s=r*r,o=2*ji(.05,1,1-(t.bounce||0))*Math.sqrt(s);e={...e,mass:vn.mass,stiffness:s,damping:o}}else{const n=SB(t);e={...e,...n,mass:vn.mass},e.isResolvedFromDuration=!0}return e}function EA(t=vn.visualDuration,e=vn.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:s}=n;const o=n.keyframes[0],l=n.keyframes[n.keyframes.length-1],d={done:!1,value:o},{stiffness:h,damping:f,mass:g,duration:y,velocity:_,isResolvedFromDuration:x}=PB({...n,velocity:-Ii(n.velocity||0)}),I=_||0,k=f/(2*Math.sqrt(h*g)),S=l-o,O=Ii(Math.sqrt(h/g)),B=Math.abs(S)<5;r||(r=B?vn.restSpeed.granular:vn.restSpeed.default),s||(s=B?vn.restDelta.granular:vn.restDelta.default);let V;if(k<1){const F=$g(O,k);V=H=>{const A=Math.exp(-k*O*H);return l-A*((I+k*O*S)/F*Math.sin(F*H)+S*Math.cos(F*H))}}else if(k===1)V=F=>l-Math.exp(-O*F)*(S+(I+O*S)*F);else{const F=O*Math.sqrt(k*k-1);V=H=>{const A=Math.exp(-k*O*H),E=Math.min(F*H,300);return l-A*((I+k*O*S)*Math.sinh(E)+F*S*Math.cosh(E))/F}}const $={calculatedDuration:x&&y||null,next:F=>{const H=V(F);if(x)d.done=F>=y;else{let A=0;k<1&&(A=F===0?Ei(I):TA(V,F,H));const E=Math.abs(A)<=r,P=Math.abs(l-H)<=s;d.done=E&&P}return d.value=d.done?l:H,d},toString:()=>{const F=Math.min($C($),Mg),H=zC(A=>$.next(F*A).value,F,30);return F+"ms "+H}};return $}function Yx({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:l,min:d,max:h,restDelta:f=.5,restSpeed:g}){const y=t[0],_={done:!1,value:y},x=E=>d!==void 0&&E<d||h!==void 0&&E>h,I=E=>d===void 0?h:h===void 0||Math.abs(d-E)<Math.abs(h-E)?d:h;let k=n*e;const S=y+k,O=l===void 0?S:l(S);O!==S&&(k=O-y);const B=E=>-k*Math.exp(-E/r),V=E=>O+B(E),$=E=>{const P=B(E),L=V(E);_.done=Math.abs(P)<=f,_.value=_.done?O:L};let F,H;const A=E=>{x(_.value)&&(F=E,H=EA({keyframes:[_.value,I(_.value)],velocity:TA(V,E,_.value),damping:s,stiffness:o,restDelta:f,restSpeed:g}))};return A(0),{calculatedDuration:null,next:E=>{let P=!1;return!H&&F===void 0&&(P=!0,$(E),A(E)),F!==void 0&&E>=F?H.next(E-F):(!P&&$(E),_)}}}const jB=Hu(.42,0,1,1),NB=Hu(0,0,.58,1),IA=Hu(.42,0,.58,1),MB=t=>Array.isArray(t)&&typeof t[0]!="number",DB={linear:Zr,easeIn:jB,easeInOut:IA,easeOut:NB,circIn:Xv,circInOut:iA,circOut:sA,backIn:Qv,backInOut:nA,backOut:tA,anticipate:rA},Jx=t=>{if(qv(t)){xC(t.length===4);const[e,n,r,s]=t;return Hu(e,n,r,s)}else if(typeof t=="string")return DB[t];return t};function LB(t,e,n){const r=[],s=n||xA,o=t.length-1;for(let l=0;l<o;l++){let d=s(t[l],t[l+1]);if(e){const h=Array.isArray(e)?e[l]||Zr:e;d=Ku(h,d)}r.push(d)}return r}function VB(t,e,{clamp:n=!0,ease:r,mixer:s}={}){const o=t.length;if(xC(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const l=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const d=LB(e,r,s),h=d.length,f=g=>{if(l&&g<t[0])return e[0];let y=0;if(h>1)for(;y<t.length-2&&!(g<t[y+1]);y++);const _=Ml(t[y],t[y+1],g);return d[y](_)};return n?g=>f(ji(t[0],t[o-1],g)):f}function OB(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const s=Ml(0,e,r);t.push(ln(n,1,s))}}function FB(t){const e=[0];return OB(e,t.length-1),e}function BB(t,e){return t.map(n=>n*e)}function UB(t,e){return t.map(()=>e||IA).splice(0,t.length-1)}function af({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const s=MB(r)?r.map(Jx):Jx(r),o={done:!1,value:e[0]},l=BB(n&&n.length===e.length?n:FB(e),t),d=VB(l,e,{ease:Array.isArray(s)?s:UB(e,s)});return{calculatedDuration:t,next:h=>(o.value=d(h),o.done=h>=t,o)}}const $B=t=>{const e=({timestamp:n})=>t(n);return{start:()=>Xt.update(e,!0),stop:()=>So(e),now:()=>or.isProcessing?or.timestamp:ei.now()}},zB={decay:Yx,inertia:Yx,tween:af,keyframes:af,spring:EA},qB=t=>t/100;class n_ extends wA{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:h}=this.options;h&&h()};const{name:n,motionValue:r,element:s,keyframes:o}=this.options,l=s?.KeyframeResolver||e_,d=(h,f)=>this.onKeyframesResolved(h,f);this.resolver=new l(o,d,n,r,s),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:n="keyframes",repeat:r=0,repeatDelay:s=0,repeatType:o,velocity:l=0}=this.options,d=zv(n)?n:zB[n]||af;let h,f;d!==af&&typeof e[0]!="number"&&(h=Ku(qB,xA(e[0],e[1])),e=[0,100]);const g=d({...this.options,keyframes:e});o==="mirror"&&(f=d({...this.options,keyframes:[...e].reverse(),velocity:-l})),g.calculatedDuration===null&&(g.calculatedDuration=$C(g));const{calculatedDuration:y}=g,_=y+s,x=_*(r+1)-s;return{generator:g,mirroredGenerator:f,mapPercentToKeyframes:h,calculatedDuration:y,resolvedDuration:_,totalDuration:x}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,n=!1){const{resolved:r}=this;if(!r){const{keyframes:E}=this.options;return{done:!0,value:E[E.length-1]}}const{finalKeyframe:s,generator:o,mirroredGenerator:l,mapPercentToKeyframes:d,keyframes:h,calculatedDuration:f,totalDuration:g,resolvedDuration:y}=r;if(this.startTime===null)return o.next(0);const{delay:_,repeat:x,repeatType:I,repeatDelay:k,onUpdate:S}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-g/this.speed,this.startTime)),n?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const O=this.currentTime-_*(this.speed>=0?1:-1),B=this.speed>=0?O<0:O>g;this.currentTime=Math.max(O,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=g);let V=this.currentTime,$=o;if(x){const E=Math.min(this.currentTime,g)/y;let P=Math.floor(E),L=E%1;!L&&E>=1&&(L=1),L===1&&P--,P=Math.min(P,x+1),P%2&&(I==="reverse"?(L=1-L,k&&(L-=k/y)):I==="mirror"&&($=l)),V=ji(0,1,L)*y}const F=B?{done:!1,value:h[0]}:$.next(V);d&&(F.value=d(F.value));let{done:H}=F;!B&&f!==null&&(H=this.speed>=0?this.currentTime>=g:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&H);return A&&s!==void 0&&(F.value=zf(h,this.options,s)),S&&S(F.value),A&&this.finish(),F}get duration(){const{resolved:e}=this;return e?Ii(e.calculatedDuration):0}get time(){return Ii(this.currentTime)}set time(e){e=Ei(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Ii(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=$B,onPlay:n,startTime:r}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),n&&n();const s=this.driver.now();this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=s):this.startTime=r??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const WB=new Set(["opacity","clipPath","filter","transform"]);function HB(t,e,n,{delay:r=0,duration:s=300,repeat:o=0,repeatType:l="loop",ease:d="easeInOut",times:h}={}){const f={[e]:n};h&&(f.offset=h);const g=WC(d,s);return Array.isArray(g)&&(f.easing=g),t.animate(f,{delay:r,duration:s,easing:Array.isArray(g)?"linear":g,fill:"both",iterations:o+1,direction:l==="reverse"?"alternate":"normal"})}const KB=Av(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),lf=10,GB=2e4;function QB(t){return zv(t.type)||t.type==="spring"||!qC(t.ease)}function XB(t,e){const n=new n_({...e,keyframes:t,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:t[0]};const s=[];let o=0;for(;!r.done&&o<GB;)r=n.sample(o),s.push(r.value),o+=lf;return{times:void 0,keyframes:s,duration:o-lf,ease:"linear"}}const SA={anticipate:rA,backInOut:nA,circInOut:iA};function YB(t){return t in SA}class Zx extends wA{constructor(e){super(e);const{name:n,motionValue:r,element:s,keyframes:o}=this.options;this.resolver=new _A(o,(l,d)=>this.onKeyframesResolved(l,d),n,r,s),this.resolver.scheduleResolve()}initPlayback(e,n){let{duration:r=300,times:s,ease:o,type:l,motionValue:d,name:h,startTime:f}=this.options;if(!d.owner||!d.owner.current)return!1;if(typeof o=="string"&&sf()&&YB(o)&&(o=SA[o]),QB(this.options)){const{onComplete:y,onUpdate:_,motionValue:x,element:I,...k}=this.options,S=XB(e,k);e=S.keyframes,e.length===1&&(e[1]=e[0]),r=S.duration,s=S.times,o=S.ease,l="keyframes"}const g=HB(d.owner.current,h,e,{...this.options,duration:r,times:s,ease:o});return g.startTime=f??this.calcStartTime(),this.pendingTimeline?(Vx(g,this.pendingTimeline),this.pendingTimeline=void 0):g.onfinish=()=>{const{onComplete:y}=this.options;d.set(zf(e,this.options,n)),y&&y(),this.cancel(),this.resolveFinishedPromise()},{animation:g,duration:r,times:s,type:l,ease:o,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:n}=e;return Ii(n)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:n}=e;return Ii(n.currentTime||0)}set time(e){const{resolved:n}=this;if(!n)return;const{animation:r}=n;r.currentTime=Ei(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:n}=e;return n.playbackRate}set speed(e){const{resolved:n}=this;if(!n)return;const{animation:r}=n;r.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:n}=e;return n.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:n}=e;return n.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:n}=this;if(!n)return Zr;const{animation:r}=n;Vx(r,e)}return Zr}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:n}=e;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:n,keyframes:r,duration:s,type:o,ease:l,times:d}=e;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:f,onUpdate:g,onComplete:y,element:_,...x}=this.options,I=new n_({...x,keyframes:r,duration:s,type:o,ease:l,times:d,isGenerator:!0}),k=Ei(this.time);f.setWithVelocity(I.sample(k-lf).value,I.sample(k).value,lf)}const{onStop:h}=this.options;h&&h(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:n,name:r,repeatDelay:s,repeatType:o,damping:l,type:d}=e;if(!n||!n.owner||!(n.owner.current instanceof HTMLElement))return!1;const{onUpdate:h,transformTemplate:f}=n.owner.getProps();return KB()&&r&&WB.has(r)&&!h&&!f&&!s&&o!=="mirror"&&l!==0&&d!=="inertia"}}const JB={type:"spring",stiffness:500,damping:25,restSpeed:10},ZB=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),eU={type:"keyframes",duration:.8},tU={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},nU=(t,{keyframes:e})=>e.length>2?eU:Sa.has(t)?t.startsWith("scale")?ZB(e[1]):JB:tU;function rU({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:s,repeat:o,repeatType:l,repeatDelay:d,from:h,elapsed:f,...g}){return!!Object.keys(g).length}const r_=(t,e,n,r={},s,o)=>l=>{const d=$v(r,t)||{},h=d.delay||r.delay||0;let{elapsed:f=0}=r;f=f-Ei(h);let g={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...d,delay:-f,onUpdate:_=>{e.set(_),d.onUpdate&&d.onUpdate(_)},onComplete:()=>{l(),d.onComplete&&d.onComplete()},name:t,motionValue:e,element:o?void 0:s};rU(d)||(g={...g,...nU(t,g)}),g.duration&&(g.duration=Ei(g.duration)),g.repeatDelay&&(g.repeatDelay=Ei(g.repeatDelay)),g.from!==void 0&&(g.keyframes[0]=g.from);let y=!1;if((g.type===!1||g.duration===0&&!g.repeatDelay)&&(g.duration=0,g.delay===0&&(y=!0)),y&&!o&&e.get()!==void 0){const _=zf(g.keyframes,d);if(_!==void 0)return Xt.update(()=>{g.onUpdate(_),g.onComplete()}),new x5([])}return!o&&Zx.supports(g)?new Zx(g):new n_(g)};function sU({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function CA(t,e,{delay:n=0,transitionOverride:r,type:s}={}){var o;let{transition:l=t.getDefaultTransition(),transitionEnd:d,...h}=e;r&&(l=r);const f=[],g=s&&t.animationState&&t.animationState.getState()[s];for(const y in h){const _=t.getValue(y,(o=t.latestValues[y])!==null&&o!==void 0?o:null),x=h[y];if(x===void 0||g&&sU(g,y))continue;const I={delay:n,...$v(l||{},y)};let k=!1;if(window.MotionHandoffAnimation){const O=YC(t);if(O){const B=window.MotionHandoffAnimation(O,y,Xt);B!==null&&(I.startTime=B,k=!0)}}Lg(t,y),_.start(r_(y,_,x,t.shouldReduceMotion&&QC.has(y)?{type:!1}:I,t,k));const S=_.animation;S&&f.push(S)}return d&&Promise.all(f).then(()=>{Xt.update(()=>{d&&L5(t,d)})}),f}function zg(t,e,n={}){var r;const s=$f(t,e,n.type==="exit"?(r=t.presenceContext)===null||r===void 0?void 0:r.custom:void 0);let{transition:o=t.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(o=n.transitionOverride);const l=s?()=>Promise.all(CA(t,s,n)):()=>Promise.resolve(),d=t.variantChildren&&t.variantChildren.size?(f=0)=>{const{delayChildren:g=0,staggerChildren:y,staggerDirection:_}=o;return iU(t,e,g+f,y,_,n)}:()=>Promise.resolve(),{when:h}=o;if(h){const[f,g]=h==="beforeChildren"?[l,d]:[d,l];return f().then(()=>g())}else return Promise.all([l(),d(n.delay)])}function iU(t,e,n=0,r=0,s=1,o){const l=[],d=(t.variantChildren.size-1)*r,h=s===1?(f=0)=>f*r:(f=0)=>d-f*r;return Array.from(t.variantChildren).sort(oU).forEach((f,g)=>{f.notify("AnimationStart",e),l.push(zg(f,e,{...o,delay:n+h(g)}).then(()=>f.notify("AnimationComplete",e)))}),Promise.all(l)}function oU(t,e){return t.sortNodePosition(e)}function aU(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const s=e.map(o=>zg(t,o,n));r=Promise.all(s)}else if(typeof e=="string")r=zg(t,e,n);else{const s=typeof e=="function"?$f(t,e,n.custom):e;r=Promise.all(CA(t,s,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}const lU=kv.length;function AA(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?AA(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<lU;n++){const r=kv[n],s=t.props[r];(Eu(s)||s===!1)&&(e[r]=s)}return e}const cU=[...Rv].reverse(),uU=Rv.length;function dU(t){return e=>Promise.all(e.map(({animation:n,options:r})=>aU(t,n,r)))}function hU(t){let e=dU(t),n=eT(),r=!0;const s=h=>(f,g)=>{var y;const _=$f(t,g,h==="exit"?(y=t.presenceContext)===null||y===void 0?void 0:y.custom:void 0);if(_){const{transition:x,transitionEnd:I,...k}=_;f={...f,...k,...I}}return f};function o(h){e=h(t)}function l(h){const{props:f}=t,g=AA(t.parent)||{},y=[],_=new Set;let x={},I=1/0;for(let S=0;S<uU;S++){const O=cU[S],B=n[O],V=f[O]!==void 0?f[O]:g[O],$=Eu(V),F=O===h?B.isActive:null;F===!1&&(I=S);let H=V===g[O]&&V!==f[O]&&$;if(H&&r&&t.manuallyAnimateOnMount&&(H=!1),B.protectedKeys={...x},!B.isActive&&F===null||!V&&!B.prevProp||Bf(V)||typeof V=="boolean")continue;const A=fU(B.prevProp,V);let E=A||O===h&&B.isActive&&!H&&$||S>I&&$,P=!1;const L=Array.isArray(V)?V:[V];let C=L.reduce(s(O),{});F===!1&&(C={});const{prevResolvedValues:N={}}=B,M={...N,...C},ie=W=>{E=!0,_.has(W)&&(P=!0,_.delete(W)),B.needsAnimating[W]=!0;const Y=t.getValue(W);Y&&(Y.liveStyle=!1)};for(const W in M){const Y=C[W],ne=N[W];if(x.hasOwnProperty(W))continue;let se=!1;Ng(Y)&&Ng(ne)?se=!UC(Y,ne):se=Y!==ne,se?Y!=null?ie(W):_.add(W):Y!==void 0&&_.has(W)?ie(W):B.protectedKeys[W]=!0}B.prevProp=V,B.prevResolvedValues=C,B.isActive&&(x={...x,...C}),r&&t.blockInitialAnimation&&(E=!1),E&&(!(H&&A)||P)&&y.push(...L.map(W=>({animation:W,options:{type:O}})))}if(_.size){const S={};_.forEach(O=>{const B=t.getBaseTarget(O),V=t.getValue(O);V&&(V.liveStyle=!0),S[O]=B??null}),y.push({animation:S})}let k=!!y.length;return r&&(f.initial===!1||f.initial===f.animate)&&!t.manuallyAnimateOnMount&&(k=!1),r=!1,k?e(y):Promise.resolve()}function d(h,f){var g;if(n[h].isActive===f)return Promise.resolve();(g=t.variantChildren)===null||g===void 0||g.forEach(_=>{var x;return(x=_.animationState)===null||x===void 0?void 0:x.setActive(h,f)}),n[h].isActive=f;const y=l(h);for(const _ in n)n[_].protectedKeys={};return y}return{animateChanges:l,setActive:d,setAnimateFunction:o,getState:()=>n,reset:()=>{n=eT(),r=!0}}}function fU(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!UC(e,t):!1}function ta(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function eT(){return{animate:ta(!0),whileInView:ta(),whileHover:ta(),whileTap:ta(),whileDrag:ta(),whileFocus:ta(),exit:ta()}}class Mo{constructor(e){this.isMounted=!1,this.node=e}update(){}}class mU extends Mo{constructor(e){super(e),e.animationState||(e.animationState=hU(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Bf(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let pU=0;class gU extends Mo{constructor(){super(...arguments),this.id=pU++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const s=this.node.animationState.setActive("exit",!e);n&&!e&&s.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const yU={animation:{Feature:mU},exit:{Feature:gU}};function Au(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function Gu(t){return{point:{x:t.pageX,y:t.pageY}}}const vU=t=>e=>Wv(e)&&t(e,Gu(e));function su(t,e,n,r){return Au(t,e,vU(n),r)}const tT=(t,e)=>Math.abs(t-e);function _U(t,e){const n=tT(t.x,e.x),r=tT(t.y,e.y);return Math.sqrt(n**2+r**2)}class RA{constructor(e,n,{transformPagePoint:r,contextWindow:s,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Wp(this.lastMoveEventInfo,this.history),_=this.startEvent!==null,x=_U(y.offset,{x:0,y:0})>=3;if(!_&&!x)return;const{point:I}=y,{timestamp:k}=or;this.history.push({...I,timestamp:k});const{onStart:S,onMove:O}=this.handlers;_||(S&&S(this.lastMoveEvent,y),this.startEvent=this.lastMoveEvent),O&&O(this.lastMoveEvent,y)},this.handlePointerMove=(y,_)=>{this.lastMoveEvent=y,this.lastMoveEventInfo=qp(_,this.transformPagePoint),Xt.update(this.updatePoint,!0)},this.handlePointerUp=(y,_)=>{this.end();const{onEnd:x,onSessionEnd:I,resumeAnimation:k}=this.handlers;if(this.dragSnapToOrigin&&k&&k(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const S=Wp(y.type==="pointercancel"?this.lastMoveEventInfo:qp(_,this.transformPagePoint),this.history);this.startEvent&&x&&x(y,S),I&&I(y,S)},!Wv(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=r,this.contextWindow=s||window;const l=Gu(e),d=qp(l,this.transformPagePoint),{point:h}=d,{timestamp:f}=or;this.history=[{...h,timestamp:f}];const{onSessionStart:g}=n;g&&g(e,Wp(d,this.history)),this.removeListeners=Ku(su(this.contextWindow,"pointermove",this.handlePointerMove),su(this.contextWindow,"pointerup",this.handlePointerUp),su(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),So(this.updatePoint)}}function qp(t,e){return e?{point:e(t.point)}:t}function nT(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Wp({point:t},e){return{point:t,delta:nT(t,kA(e)),offset:nT(t,wU(e)),velocity:bU(e,.1)}}function wU(t){return t[0]}function kA(t){return t[t.length-1]}function bU(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const s=kA(t);for(;n>=0&&(r=t[n],!(s.timestamp-r.timestamp>Ei(e)));)n--;if(!r)return{x:0,y:0};const o=Ii(s.timestamp-r.timestamp);if(o===0)return{x:0,y:0};const l={x:(s.x-r.x)/o,y:(s.y-r.y)/o};return l.x===1/0&&(l.x=0),l.y===1/0&&(l.y=0),l}const PA=1e-4,xU=1-PA,TU=1+PA,jA=.01,EU=0-jA,IU=0+jA;function es(t){return t.max-t.min}function SU(t,e,n){return Math.abs(t-e)<=n}function rT(t,e,n,r=.5){t.origin=r,t.originPoint=ln(e.min,e.max,t.origin),t.scale=es(n)/es(e),t.translate=ln(n.min,n.max,t.origin)-t.originPoint,(t.scale>=xU&&t.scale<=TU||isNaN(t.scale))&&(t.scale=1),(t.translate>=EU&&t.translate<=IU||isNaN(t.translate))&&(t.translate=0)}function iu(t,e,n,r){rT(t.x,e.x,n.x,r?r.originX:void 0),rT(t.y,e.y,n.y,r?r.originY:void 0)}function sT(t,e,n){t.min=n.min+e.min,t.max=t.min+es(e)}function CU(t,e,n){sT(t.x,e.x,n.x),sT(t.y,e.y,n.y)}function iT(t,e,n){t.min=e.min-n.min,t.max=t.min+es(e)}function ou(t,e,n){iT(t.x,e.x,n.x),iT(t.y,e.y,n.y)}function AU(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?ln(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?ln(n,t,r.max):Math.min(t,n)),t}function oT(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function RU(t,{top:e,left:n,bottom:r,right:s}){return{x:oT(t.x,n,s),y:oT(t.y,e,r)}}function aT(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function kU(t,e){return{x:aT(t.x,e.x),y:aT(t.y,e.y)}}function PU(t,e){let n=.5;const r=es(t),s=es(e);return s>r?n=Ml(e.min,e.max-r,t.min):r>s&&(n=Ml(t.min,t.max-s,e.min)),ji(0,1,n)}function jU(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const qg=.35;function NU(t=qg){return t===!1?t=0:t===!0&&(t=qg),{x:lT(t,"left","right"),y:lT(t,"top","bottom")}}function lT(t,e,n){return{min:cT(t,e),max:cT(t,n)}}function cT(t,e){return typeof t=="number"?t:t[e]||0}const uT=()=>({translate:0,scale:1,origin:0,originPoint:0}),dl=()=>({x:uT(),y:uT()}),dT=()=>({min:0,max:0}),Cn=()=>({x:dT(),y:dT()});function cs(t){return[t("x"),t("y")]}function NA({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function MU({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function DU(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function Hp(t){return t===void 0||t===1}function Wg({scale:t,scaleX:e,scaleY:n}){return!Hp(t)||!Hp(e)||!Hp(n)}function ia(t){return Wg(t)||MA(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function MA(t){return hT(t.x)||hT(t.y)}function hT(t){return t&&t!=="0%"}function cf(t,e,n){const r=t-n,s=e*r;return n+s}function fT(t,e,n,r,s){return s!==void 0&&(t=cf(t,s,r)),cf(t,n,r)+e}function Hg(t,e=0,n=1,r,s){t.min=fT(t.min,e,n,r,s),t.max=fT(t.max,e,n,r,s)}function DA(t,{x:e,y:n}){Hg(t.x,e.translate,e.scale,e.originPoint),Hg(t.y,n.translate,n.scale,n.originPoint)}const mT=.999999999999,pT=1.0000000000001;function LU(t,e,n,r=!1){const s=n.length;if(!s)return;e.x=e.y=1;let o,l;for(let d=0;d<s;d++){o=n[d],l=o.projectionDelta;const{visualElement:h}=o.options;h&&h.props.style&&h.props.style.display==="contents"||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&fl(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),l&&(e.x*=l.x.scale,e.y*=l.y.scale,DA(t,l)),r&&ia(o.latestValues)&&fl(t,o.latestValues))}e.x<pT&&e.x>mT&&(e.x=1),e.y<pT&&e.y>mT&&(e.y=1)}function hl(t,e){t.min=t.min+e,t.max=t.max+e}function gT(t,e,n,r,s=.5){const o=ln(t.min,t.max,s);Hg(t,e,n,o,r)}function fl(t,e){gT(t.x,e.x,e.scaleX,e.scale,e.originX),gT(t.y,e.y,e.scaleY,e.scale,e.originY)}function LA(t,e){return NA(DU(t.getBoundingClientRect(),e))}function VU(t,e,n){const r=LA(t,n),{scroll:s}=e;return s&&(hl(r.x,s.offset.x),hl(r.y,s.offset.y)),r}const VA=({current:t})=>t?t.ownerDocument.defaultView:null,OU=new WeakMap;class FU{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Cn(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const s=g=>{const{dragSnapToOrigin:y}=this.getProps();y?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Gu(g).point)},o=(g,y)=>{const{drag:_,dragPropagation:x,onDragStart:I}=this.getProps();if(_&&!x&&(this.openDragLock&&this.openDragLock(),this.openDragLock=P5(_),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),cs(S=>{let O=this.getAxisMotionValue(S).get()||0;if(Zs.test(O)){const{projection:B}=this.visualElement;if(B&&B.layout){const V=B.layout.layoutBox[S];V&&(O=es(V)*(parseFloat(O)/100))}}this.originPoint[S]=O}),I&&Xt.postRender(()=>I(g,y)),Lg(this.visualElement,"transform");const{animationState:k}=this.visualElement;k&&k.setActive("whileDrag",!0)},l=(g,y)=>{const{dragPropagation:_,dragDirectionLock:x,onDirectionLock:I,onDrag:k}=this.getProps();if(!_&&!this.openDragLock)return;const{offset:S}=y;if(x&&this.currentDirection===null){this.currentDirection=BU(S),this.currentDirection!==null&&I&&I(this.currentDirection);return}this.updateAxis("x",y.point,S),this.updateAxis("y",y.point,S),this.visualElement.render(),k&&k(g,y)},d=(g,y)=>this.stop(g,y),h=()=>cs(g=>{var y;return this.getAnimationState(g)==="paused"&&((y=this.getAxisMotionValue(g).animation)===null||y===void 0?void 0:y.play())}),{dragSnapToOrigin:f}=this.getProps();this.panSession=new RA(e,{onSessionStart:s,onStart:o,onMove:l,onSessionEnd:d,resumeAnimation:h},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:f,contextWindow:VA(this.visualElement)})}stop(e,n){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:s}=n;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&Xt.postRender(()=>o(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:s}=this.getProps();if(!r||!hh(e,s,this.currentDirection))return;const o=this.getAxisMotionValue(e);let l=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(l=AU(l,this.constraints[e],this.elastic[e])),o.set(l)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:r}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,o=this.constraints;n&&cl(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&s?this.constraints=RU(s.layoutBox,n):this.constraints=!1,this.elastic=NU(r),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&cs(l=>{this.constraints!==!1&&this.getAxisMotionValue(l)&&(this.constraints[l]=jU(s.layoutBox[l],this.constraints[l]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!cl(e))return!1;const r=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const o=VU(r,s.root,this.visualElement.getTransformPagePoint());let l=kU(s.layout.layoutBox,o);if(n){const d=n(MU(l));this.hasMutatedConstraints=!!d,d&&(l=NA(d))}return l}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:s,dragTransition:o,dragSnapToOrigin:l,onDragTransitionEnd:d}=this.getProps(),h=this.constraints||{},f=cs(g=>{if(!hh(g,n,this.currentDirection))return;let y=h&&h[g]||{};l&&(y={min:0,max:0});const _=s?200:1e6,x=s?40:1e7,I={type:"inertia",velocity:r?e[g]:0,bounceStiffness:_,bounceDamping:x,timeConstant:750,restDelta:1,restSpeed:10,...o,...y};return this.startAxisValueAnimation(g,I)});return Promise.all(f).then(d)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return Lg(this.visualElement,e),r.start(r_(e,r,0,n,this.visualElement,!1))}stopAnimation(){cs(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){cs(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),s=r[n];return s||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){cs(n=>{const{drag:r}=this.getProps();if(!hh(n,r,this.currentDirection))return;const{projection:s}=this.visualElement,o=this.getAxisMotionValue(n);if(s&&s.layout){const{min:l,max:d}=s.layout.layoutBox[n];o.set(e[n]-ln(l,d,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!cl(n)||!r||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};cs(l=>{const d=this.getAxisMotionValue(l);if(d&&this.constraints!==!1){const h=d.get();s[l]=PU({min:h,max:h},this.constraints[l])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),cs(l=>{if(!hh(l,e,null))return;const d=this.getAxisMotionValue(l),{min:h,max:f}=this.constraints[l];d.set(ln(h,f,s[l]))})}addListeners(){if(!this.visualElement.current)return;OU.set(this.visualElement,this);const e=this.visualElement.current,n=su(e,"pointerdown",h=>{const{drag:f,dragListener:g=!0}=this.getProps();f&&g&&this.start(h)}),r=()=>{const{dragConstraints:h}=this.getProps();cl(h)&&h.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,o=s.addEventListener("measure",r);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Xt.read(r);const l=Au(window,"resize",()=>this.scalePositionWithinConstraints()),d=s.addEventListener("didUpdate",(({delta:h,hasLayoutChanged:f})=>{this.isDragging&&f&&(cs(g=>{const y=this.getAxisMotionValue(g);y&&(this.originPoint[g]+=h[g].translate,y.set(y.get()+h[g].translate))}),this.visualElement.render())}));return()=>{l(),n(),o(),d&&d()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:s=!1,dragConstraints:o=!1,dragElastic:l=qg,dragMomentum:d=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:s,dragConstraints:o,dragElastic:l,dragMomentum:d}}}function hh(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function BU(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class UU extends Mo{constructor(e){super(e),this.removeGroupControls=Zr,this.removeListeners=Zr,this.controls=new FU(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Zr}unmount(){this.removeGroupControls(),this.removeListeners()}}const yT=t=>(e,n)=>{t&&Xt.postRender(()=>t(e,n))};class $U extends Mo{constructor(){super(...arguments),this.removePointerDownListener=Zr}onPointerDown(e){this.session=new RA(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:VA(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:s}=this.node.getProps();return{onSessionStart:yT(e),onStart:yT(n),onMove:r,onEnd:(o,l)=>{delete this.session,s&&Xt.postRender(()=>s(o,l))}}}mount(){this.removePointerDownListener=su(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Ch={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vT(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Lc={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(et.test(t))t=parseFloat(t);else return t;const n=vT(t,e.target.x),r=vT(t,e.target.y);return`${n}% ${r}%`}},zU={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,s=Co.parse(t);if(s.length>5)return r;const o=Co.createTransformer(t),l=typeof s[0]!="number"?1:0,d=n.x.scale*e.x,h=n.y.scale*e.y;s[0+l]/=d,s[1+l]/=h;const f=ln(d,h,.5);return typeof s[2+l]=="number"&&(s[2+l]/=f),typeof s[3+l]=="number"&&(s[3+l]/=f),o(s)}};class qU extends ue.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:s}=this.props,{projection:o}=e;u5(WU),o&&(n.group&&n.group.add(o),r&&r.register&&s&&r.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),Ch.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:s,isPresent:o}=this.props,l=r.projection;return l&&(l.isPresent=o,s||e.layoutDependency!==n||n===void 0?l.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?l.promote():l.relegate()||Xt.postRender(()=>{const d=l.getStack();(!d||!d.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),jv.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(s),r&&r.deregister&&r.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function OA(t){const[e,n]=wC(),r=ue.useContext(Ev);return c.jsx(qU,{...t,layoutGroup:r,switchLayoutGroup:ue.useContext(AC),isPresent:e,safeToRemove:n})}const WU={borderRadius:{...Lc,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Lc,borderTopRightRadius:Lc,borderBottomLeftRadius:Lc,borderBottomRightRadius:Lc,boxShadow:zU};function HU(t,e,n){const r=xr(t)?t:Su(t);return r.start(r_("",r,e,n)),r.animation}function KU(t){return t instanceof SVGElement&&t.tagName!=="svg"}const GU=(t,e)=>t.depth-e.depth;class QU{constructor(){this.children=[],this.isDirty=!1}add(e){Hv(this.children,e),this.isDirty=!0}remove(e){Kv(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(GU),this.isDirty=!1,this.children.forEach(e)}}function XU(t,e){const n=ei.now(),r=({timestamp:s})=>{const o=s-n;o>=e&&(So(r),t(o-e))};return Xt.read(r,!0),()=>So(r)}const FA=["TopLeft","TopRight","BottomLeft","BottomRight"],YU=FA.length,_T=t=>typeof t=="string"?parseFloat(t):t,wT=t=>typeof t=="number"||et.test(t);function JU(t,e,n,r,s,o){s?(t.opacity=ln(0,n.opacity!==void 0?n.opacity:1,ZU(r)),t.opacityExit=ln(e.opacity!==void 0?e.opacity:1,0,e3(r))):o&&(t.opacity=ln(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,r));for(let l=0;l<YU;l++){const d=`border${FA[l]}Radius`;let h=bT(e,d),f=bT(n,d);if(h===void 0&&f===void 0)continue;h||(h=0),f||(f=0),h===0||f===0||wT(h)===wT(f)?(t[d]=Math.max(ln(_T(h),_T(f),r),0),(Zs.test(f)||Zs.test(h))&&(t[d]+="%")):t[d]=f}(e.rotate||n.rotate)&&(t.rotate=ln(e.rotate||0,n.rotate||0,r))}function bT(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const ZU=BA(0,.5,sA),e3=BA(.5,.95,Zr);function BA(t,e,n){return r=>r<t?0:r>e?1:n(Ml(t,e,r))}function xT(t,e){t.min=e.min,t.max=e.max}function ls(t,e){xT(t.x,e.x),xT(t.y,e.y)}function TT(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function ET(t,e,n,r,s){return t-=e,t=cf(t,1/n,r),s!==void 0&&(t=cf(t,1/s,r)),t}function t3(t,e=0,n=1,r=.5,s,o=t,l=t){if(Zs.test(e)&&(e=parseFloat(e),e=ln(l.min,l.max,e/100)-l.min),typeof e!="number")return;let d=ln(o.min,o.max,r);t===o&&(d-=e),t.min=ET(t.min,e,n,d,s),t.max=ET(t.max,e,n,d,s)}function IT(t,e,[n,r,s],o,l){t3(t,e[n],e[r],e[s],e.scale,o,l)}const n3=["x","scaleX","originX"],r3=["y","scaleY","originY"];function ST(t,e,n,r){IT(t.x,e,n3,n?n.x:void 0,r?r.x:void 0),IT(t.y,e,r3,n?n.y:void 0,r?r.y:void 0)}function CT(t){return t.translate===0&&t.scale===1}function UA(t){return CT(t.x)&&CT(t.y)}function AT(t,e){return t.min===e.min&&t.max===e.max}function s3(t,e){return AT(t.x,e.x)&&AT(t.y,e.y)}function RT(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function $A(t,e){return RT(t.x,e.x)&&RT(t.y,e.y)}function kT(t){return es(t.x)/es(t.y)}function PT(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class i3{constructor(){this.members=[]}add(e){Hv(this.members,e),e.scheduleRender()}remove(e){if(Kv(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(s=>e===s);if(n===0)return!1;let r;for(let s=n;s>=0;s--){const o=this.members[s];if(o.isPresent!==!1){r=o;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function o3(t,e,n){let r="";const s=t.x.translate/e.x,o=t.y.translate/e.y,l=n?.z||0;if((s||o||l)&&(r=`translate3d(${s}px, ${o}px, ${l}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:f,rotate:g,rotateX:y,rotateY:_,skewX:x,skewY:I}=n;f&&(r=`perspective(${f}px) ${r}`),g&&(r+=`rotate(${g}deg) `),y&&(r+=`rotateX(${y}deg) `),_&&(r+=`rotateY(${_}deg) `),x&&(r+=`skewX(${x}deg) `),I&&(r+=`skewY(${I}deg) `)}const d=t.x.scale*e.x,h=t.y.scale*e.y;return(d!==1||h!==1)&&(r+=`scale(${d}, ${h})`),r||"none"}const oa={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Kc=typeof window<"u"&&window.MotionDebug!==void 0,Kp=["","X","Y","Z"],a3={visibility:"hidden"},jT=1e3;let l3=0;function Gp(t,e,n,r){const{latestValues:s}=e;s[t]&&(n[t]=s[t],e.setStaticValue(t,0),r&&(r[t]=0))}function zA(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=YC(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:s,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Xt,!(s||o))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&zA(r)}function qA({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:s}){return class{constructor(l={},d=e?.()){this.id=l3++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Kc&&(oa.totalNodes=oa.resolvedTargetDeltas=oa.recalculatedProjection=0),this.nodes.forEach(d3),this.nodes.forEach(g3),this.nodes.forEach(y3),this.nodes.forEach(h3),Kc&&window.MotionDebug.record(oa)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=l,this.root=d?d.root||d:this,this.path=d?[...d.path,d]:[],this.parent=d,this.depth=d?d.depth+1:0;for(let h=0;h<this.path.length;h++)this.path[h].shouldResetTransform=!0;this.root===this&&(this.nodes=new QU)}addEventListener(l,d){return this.eventHandlers.has(l)||this.eventHandlers.set(l,new Gv),this.eventHandlers.get(l).add(d)}notifyListeners(l,...d){const h=this.eventHandlers.get(l);h&&h.notify(...d)}hasListeners(l){return this.eventHandlers.has(l)}mount(l,d=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=KU(l),this.instance=l;const{layoutId:h,layout:f,visualElement:g}=this.options;if(g&&!g.current&&g.mount(l),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),d&&(f||h)&&(this.isLayoutDirty=!0),t){let y;const _=()=>this.root.updateBlockedByResize=!1;t(l,()=>{this.root.updateBlockedByResize=!0,y&&y(),y=XU(_,250),Ch.hasAnimatedSinceResize&&(Ch.hasAnimatedSinceResize=!1,this.nodes.forEach(MT))})}h&&this.root.registerSharedNode(h,this),this.options.animate!==!1&&g&&(h||f)&&this.addEventListener("didUpdate",({delta:y,hasLayoutChanged:_,hasRelativeTargetChanged:x,layout:I})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const k=this.options.transition||g.getDefaultTransition()||x3,{onLayoutAnimationStart:S,onLayoutAnimationComplete:O}=g.getProps(),B=!this.targetLayout||!$A(this.targetLayout,I)||x,V=!_&&x;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||V||_&&(B||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(y,V);const $={...$v(k,"layout"),onPlay:S,onComplete:O};(g.shouldReduceMotion||this.options.layoutRoot)&&($.delay=0,$.type=!1),this.startAnimation($)}else _||MT(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=I})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const l=this.getStack();l&&l.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,So(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(v3),this.animationId++)}getTransformTemplate(){const{visualElement:l}=this.options;return l&&l.getProps().transformTemplate}willUpdate(l=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&zA(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let g=0;g<this.path.length;g++){const y=this.path[g];y.shouldResetTransform=!0,y.updateScroll("snapshot"),y.options.layoutRoot&&y.willUpdate(!1)}const{layoutId:d,layout:h}=this.options;if(d===void 0&&!h)return;const f=this.getTransformTemplate();this.prevTransformTemplateValue=f?f(this.latestValues,""):void 0,this.updateSnapshot(),l&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(NT);return}this.isUpdating||this.nodes.forEach(m3),this.isUpdating=!1,this.nodes.forEach(p3),this.nodes.forEach(c3),this.nodes.forEach(u3),this.clearAllSnapshots();const d=ei.now();or.delta=ji(0,1e3/60,d-or.timestamp),or.timestamp=d,or.isProcessing=!0,Op.update.process(or),Op.preRender.process(or),Op.render.process(or),or.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,jv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(f3),this.sharedNodes.forEach(_3)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let h=0;h<this.path.length;h++)this.path[h].updateScroll();const l=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Cn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:d}=this.options;d&&d.notify("LayoutMeasure",this.layout.layoutBox,l?l.layoutBox:void 0)}updateScroll(l="measure"){let d=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===l&&(d=!1),d){const h=r(this.instance);this.scroll={animationId:this.root.animationId,phase:l,isRoot:h,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:h}}}resetTransform(){if(!s)return;const l=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,d=this.projectionDelta&&!UA(this.projectionDelta),h=this.getTransformTemplate(),f=h?h(this.latestValues,""):void 0,g=f!==this.prevTransformTemplateValue;l&&(d||ia(this.latestValues)||g)&&(s(this.instance,f),this.shouldResetTransform=!1,this.scheduleRender())}measure(l=!0){const d=this.measurePageBox();let h=this.removeElementScroll(d);return l&&(h=this.removeTransform(h)),T3(h),{animationId:this.root.animationId,measuredBox:d,layoutBox:h,latestValues:{},source:this.id}}measurePageBox(){var l;const{visualElement:d}=this.options;if(!d)return Cn();const h=d.measureViewportBox();if(!(((l=this.scroll)===null||l===void 0?void 0:l.wasRoot)||this.path.some(E3))){const{scroll:g}=this.root;g&&(hl(h.x,g.offset.x),hl(h.y,g.offset.y))}return h}removeElementScroll(l){var d;const h=Cn();if(ls(h,l),!((d=this.scroll)===null||d===void 0)&&d.wasRoot)return h;for(let f=0;f<this.path.length;f++){const g=this.path[f],{scroll:y,options:_}=g;g!==this.root&&y&&_.layoutScroll&&(y.wasRoot&&ls(h,l),hl(h.x,y.offset.x),hl(h.y,y.offset.y))}return h}applyTransform(l,d=!1){const h=Cn();ls(h,l);for(let f=0;f<this.path.length;f++){const g=this.path[f];!d&&g.options.layoutScroll&&g.scroll&&g!==g.root&&fl(h,{x:-g.scroll.offset.x,y:-g.scroll.offset.y}),ia(g.latestValues)&&fl(h,g.latestValues)}return ia(this.latestValues)&&fl(h,this.latestValues),h}removeTransform(l){const d=Cn();ls(d,l);for(let h=0;h<this.path.length;h++){const f=this.path[h];if(!f.instance||!ia(f.latestValues))continue;Wg(f.latestValues)&&f.updateSnapshot();const g=Cn(),y=f.measurePageBox();ls(g,y),ST(d,f.latestValues,f.snapshot?f.snapshot.layoutBox:void 0,g)}return ia(this.latestValues)&&ST(d,this.latestValues),d}setTargetDelta(l){this.targetDelta=l,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(l){this.options={...this.options,...l,crossfade:l.crossfade!==void 0?l.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==or.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(l=!1){var d;const h=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=h.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=h.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=h.isSharedProjectionDirty);const f=!!this.resumingFrom||this!==h;if(!(l||f&&this.isSharedProjectionDirty||this.isProjectionDirty||!((d=this.parent)===null||d===void 0)&&d.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:y,layoutId:_}=this.options;if(!(!this.layout||!(y||_))){if(this.resolvedRelativeTargetAt=or.timestamp,!this.targetDelta&&!this.relativeTarget){const x=this.getClosestProjectingParent();x&&x.layout&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cn(),this.relativeTargetOrigin=Cn(),ou(this.relativeTargetOrigin,this.layout.layoutBox,x.layout.layoutBox),ls(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Cn(),this.targetWithTransforms=Cn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),CU(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ls(this.target,this.layout.layoutBox),DA(this.target,this.targetDelta)):ls(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const x=this.getClosestProjectingParent();x&&!!x.resumingFrom==!!this.resumingFrom&&!x.options.layoutScroll&&x.target&&this.animationProgress!==1?(this.relativeParent=x,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Cn(),this.relativeTargetOrigin=Cn(),ou(this.relativeTargetOrigin,this.target,x.target),ls(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Kc&&oa.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Wg(this.parent.latestValues)||MA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var l;const d=this.getLead(),h=!!this.resumingFrom||this!==d;let f=!0;if((this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty)&&(f=!1),h&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(f=!1),this.resolvedRelativeTargetAt===or.timestamp&&(f=!1),f)return;const{layout:g,layoutId:y}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(g||y))return;ls(this.layoutCorrected,this.layout.layoutBox);const _=this.treeScale.x,x=this.treeScale.y;LU(this.layoutCorrected,this.treeScale,this.path,h),d.layout&&!d.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(d.target=d.layout.layoutBox,d.targetWithTransforms=Cn());const{target:I}=d;if(!I){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(TT(this.prevProjectionDelta.x,this.projectionDelta.x),TT(this.prevProjectionDelta.y,this.projectionDelta.y)),iu(this.projectionDelta,this.layoutCorrected,I,this.latestValues),(this.treeScale.x!==_||this.treeScale.y!==x||!PT(this.projectionDelta.x,this.prevProjectionDelta.x)||!PT(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",I)),Kc&&oa.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(l=!0){var d;if((d=this.options.visualElement)===null||d===void 0||d.scheduleRender(),l){const h=this.getStack();h&&h.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=dl(),this.projectionDelta=dl(),this.projectionDeltaWithTransform=dl()}setAnimationOrigin(l,d=!1){const h=this.snapshot,f=h?h.latestValues:{},g={...this.latestValues},y=dl();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!d;const _=Cn(),x=h?h.source:void 0,I=this.layout?this.layout.source:void 0,k=x!==I,S=this.getStack(),O=!S||S.members.length<=1,B=!!(k&&!O&&this.options.crossfade===!0&&!this.path.some(b3));this.animationProgress=0;let V;this.mixTargetDelta=$=>{const F=$/1e3;DT(y.x,l.x,F),DT(y.y,l.y,F),this.setTargetDelta(y),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ou(_,this.layout.layoutBox,this.relativeParent.layout.layoutBox),w3(this.relativeTarget,this.relativeTargetOrigin,_,F),V&&s3(this.relativeTarget,V)&&(this.isProjectionDirty=!1),V||(V=Cn()),ls(V,this.relativeTarget)),k&&(this.animationValues=g,JU(g,f,this.latestValues,F,B,O)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=F},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(l){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(So(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xt.update(()=>{Ch.hasAnimatedSinceResize=!0,this.currentAnimation=HU(0,jT,{...l,onUpdate:d=>{this.mixTargetDelta(d),l.onUpdate&&l.onUpdate(d)},onComplete:()=>{l.onComplete&&l.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const l=this.getStack();l&&l.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(jT),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const l=this.getLead();let{targetWithTransforms:d,target:h,layout:f,latestValues:g}=l;if(!(!d||!h||!f)){if(this!==l&&this.layout&&f&&WA(this.options.animationType,this.layout.layoutBox,f.layoutBox)){h=this.target||Cn();const y=es(this.layout.layoutBox.x);h.x.min=l.target.x.min,h.x.max=h.x.min+y;const _=es(this.layout.layoutBox.y);h.y.min=l.target.y.min,h.y.max=h.y.min+_}ls(d,h),fl(d,g),iu(this.projectionDeltaWithTransform,this.layoutCorrected,d,g)}}registerSharedNode(l,d){this.sharedNodes.has(l)||this.sharedNodes.set(l,new i3),this.sharedNodes.get(l).add(d);const f=d.options.initialPromotionConfig;d.promote({transition:f?f.transition:void 0,preserveFollowOpacity:f&&f.shouldPreserveFollowOpacity?f.shouldPreserveFollowOpacity(d):void 0})}isLead(){const l=this.getStack();return l?l.lead===this:!0}getLead(){var l;const{layoutId:d}=this.options;return d?((l=this.getStack())===null||l===void 0?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:d}=this.options;return d?(l=this.getStack())===null||l===void 0?void 0:l.prevLead:void 0}getStack(){const{layoutId:l}=this.options;if(l)return this.root.sharedNodes.get(l)}promote({needsReset:l,transition:d,preserveFollowOpacity:h}={}){const f=this.getStack();f&&f.promote(this,h),l&&(this.projectionDelta=void 0,this.needsReset=!0),d&&this.setOptions({transition:d})}relegate(){const l=this.getStack();return l?l.relegate(this):!1}resetSkewAndRotation(){const{visualElement:l}=this.options;if(!l)return;let d=!1;const{latestValues:h}=l;if((h.z||h.rotate||h.rotateX||h.rotateY||h.rotateZ||h.skewX||h.skewY)&&(d=!0),!d)return;const f={};h.z&&Gp("z",l,f,this.animationValues);for(let g=0;g<Kp.length;g++)Gp(`rotate${Kp[g]}`,l,f,this.animationValues),Gp(`skew${Kp[g]}`,l,f,this.animationValues);l.render();for(const g in f)l.setStaticValue(g,f[g]),this.animationValues&&(this.animationValues[g]=f[g]);l.scheduleRender()}getProjectionStyles(l){var d,h;if(!this.instance||this.isSVG)return;if(!this.isVisible)return a3;const f={visibility:""},g=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,f.opacity="",f.pointerEvents=Ih(l?.pointerEvents)||"",f.transform=g?g(this.latestValues,""):"none",f;const y=this.getLead();if(!this.projectionDelta||!this.layout||!y.target){const k={};return this.options.layoutId&&(k.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,k.pointerEvents=Ih(l?.pointerEvents)||""),this.hasProjected&&!ia(this.latestValues)&&(k.transform=g?g({},""):"none",this.hasProjected=!1),k}const _=y.animationValues||y.latestValues;this.applyTransformsToTarget(),f.transform=o3(this.projectionDeltaWithTransform,this.treeScale,_),g&&(f.transform=g(_,f.transform));const{x,y:I}=this.projectionDelta;f.transformOrigin=`${x.origin*100}% ${I.origin*100}% 0`,y.animationValues?f.opacity=y===this?(h=(d=_.opacity)!==null&&d!==void 0?d:this.latestValues.opacity)!==null&&h!==void 0?h:1:this.preserveOpacity?this.latestValues.opacity:_.opacityExit:f.opacity=y===this?_.opacity!==void 0?_.opacity:"":_.opacityExit!==void 0?_.opacityExit:0;for(const k in rf){if(_[k]===void 0)continue;const{correct:S,applyTo:O}=rf[k],B=f.transform==="none"?_[k]:S(_[k],y);if(O){const V=O.length;for(let $=0;$<V;$++)f[O[$]]=B}else f[k]=B}return this.options.layoutId&&(f.pointerEvents=y===this?Ih(l?.pointerEvents)||"":"none"),f}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(l=>{var d;return(d=l.currentAnimation)===null||d===void 0?void 0:d.stop()}),this.root.nodes.forEach(NT),this.root.sharedNodes.clear()}}}function c3(t){t.updateLayout()}function u3(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:s}=t.layout,{animationType:o}=t.options,l=n.source!==t.layout.source;o==="size"?cs(y=>{const _=l?n.measuredBox[y]:n.layoutBox[y],x=es(_);_.min=r[y].min,_.max=_.min+x}):WA(o,n.layoutBox,r)&&cs(y=>{const _=l?n.measuredBox[y]:n.layoutBox[y],x=es(r[y]);_.max=_.min+x,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[y].max=t.relativeTarget[y].min+x)});const d=dl();iu(d,r,n.layoutBox);const h=dl();l?iu(h,t.applyTransform(s,!0),n.measuredBox):iu(h,r,n.layoutBox);const f=!UA(d);let g=!1;if(!t.resumeFrom){const y=t.getClosestProjectingParent();if(y&&!y.resumeFrom){const{snapshot:_,layout:x}=y;if(_&&x){const I=Cn();ou(I,n.layoutBox,_.layoutBox);const k=Cn();ou(k,r,x.layoutBox),$A(I,k)||(g=!0),y.options.layoutRoot&&(t.relativeTarget=k,t.relativeTargetOrigin=I,t.relativeParent=y)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:n,delta:h,layoutDelta:d,hasLayoutChanged:f,hasRelativeTargetChanged:g})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function d3(t){Kc&&oa.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function h3(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function f3(t){t.clearSnapshot()}function NT(t){t.clearMeasurements()}function m3(t){t.isLayoutDirty=!1}function p3(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function MT(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function g3(t){t.resolveTargetDelta()}function y3(t){t.calcProjection()}function v3(t){t.resetSkewAndRotation()}function _3(t){t.removeLeadSnapshot()}function DT(t,e,n){t.translate=ln(e.translate,0,n),t.scale=ln(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function LT(t,e,n,r){t.min=ln(e.min,n.min,r),t.max=ln(e.max,n.max,r)}function w3(t,e,n,r){LT(t.x,e.x,n.x,r),LT(t.y,e.y,n.y,r)}function b3(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const x3={duration:.45,ease:[.4,0,.1,1]},VT=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),OT=VT("applewebkit/")&&!VT("chrome/")?Math.round:Zr;function FT(t){t.min=OT(t.min),t.max=OT(t.max)}function T3(t){FT(t.x),FT(t.y)}function WA(t,e,n){return t==="position"||t==="preserve-aspect"&&!SU(kT(e),kT(n),.2)}function E3(t){var e;return t!==t.root&&((e=t.scroll)===null||e===void 0?void 0:e.wasRoot)}const I3=qA({attachResizeListener:(t,e)=>Au(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Qp={current:void 0},HA=qA({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Qp.current){const t=new I3({});t.mount(window),t.setOptions({layoutScroll:!0}),Qp.current=t}return Qp.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),S3={pan:{Feature:$U},drag:{Feature:UU,ProjectionNode:HA,MeasureLayout:OA}};function BT(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const s="onHover"+n,o=r[s];o&&Xt.postRender(()=>o(e,Gu(e)))}class C3 extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=S5(e,n=>(BT(this.node,n,"Start"),r=>BT(this.node,r,"End"))))}unmount(){}}class A3 extends Mo{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ku(Au(this.node.current,"focus",()=>this.onFocus()),Au(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function UT(t,e,n){const{props:r}=t;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const s="onTap"+(n==="End"?"":n),o=r[s];o&&Xt.postRender(()=>o(e,Gu(e)))}class R3 extends Mo{mount(){const{current:e}=this.node;e&&(this.unmount=k5(e,n=>(UT(this.node,n,"Start"),(r,{success:s})=>UT(this.node,r,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Kg=new WeakMap,Xp=new WeakMap,k3=t=>{const e=Kg.get(t.target);e&&e(t)},P3=t=>{t.forEach(k3)};function j3({root:t,...e}){const n=t||document;Xp.has(n)||Xp.set(n,{});const r=Xp.get(n),s=JSON.stringify(e);return r[s]||(r[s]=new IntersectionObserver(P3,{root:t,...e})),r[s]}function N3(t,e,n){const r=j3(e);return Kg.set(t,n),r.observe(t),()=>{Kg.delete(t),r.unobserve(t)}}const M3={some:0,all:1};class D3 extends Mo{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:s="some",once:o}=e,l={root:n?n.current:void 0,rootMargin:r,threshold:typeof s=="number"?s:M3[s]},d=h=>{const{isIntersecting:f}=h;if(this.isInView===f||(this.isInView=f,o&&!f&&this.hasEnteredView))return;f&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",f);const{onViewportEnter:g,onViewportLeave:y}=this.node.getProps(),_=f?g:y;_&&_(h)};return N3(this.node.current,l,d)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(L3(e,n))&&this.startObserver()}unmount(){}}function L3({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const V3={inView:{Feature:D3},tap:{Feature:R3},focus:{Feature:A3},hover:{Feature:C3}},O3={layout:{ProjectionNode:HA,MeasureLayout:OA}},uf={current:null},s_={current:!1};function KA(){if(s_.current=!0,!!Cv)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>uf.current=t.matches;t.addListener(e),e()}else uf.current=!1}const F3=[...vA,_r,Co],B3=t=>F3.find(yA(t)),$T=new WeakMap;function U3(t,e,n){for(const r in e){const s=e[r],o=n[r];if(xr(s))t.addValue(r,s);else if(xr(o))t.addValue(r,Su(s,{owner:t}));else if(o!==s)if(t.hasValue(r)){const l=t.getValue(r);l.liveStyle===!0?l.jump(s):l.hasAnimated||l.set(s)}else{const l=t.getStaticValue(r);t.addValue(r,Su(l!==void 0?l:s,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const zT=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class $3{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:s,blockInitialAnimation:o,visualState:l},d={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=e_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const x=ei.now();this.renderScheduledAt<x&&(this.renderScheduledAt=x,Xt.render(this.render,!1,!0))};const{latestValues:h,renderState:f,onUpdate:g}=l;this.onUpdate=g,this.latestValues=h,this.baseTarget={...h},this.initialValues=n.initial?{...h}:{},this.renderState=f,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=d,this.blockInitialAnimation=!!o,this.isControllingVariants=Uf(n),this.isVariantNode=SC(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:y,..._}=this.scrapeMotionValuesFromProps(n,{},this);for(const x in _){const I=_[x];h[x]!==void 0&&xr(I)&&I.set(h[x],!1)}}mount(e){this.current=e,$T.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,r)=>this.bindToMotionValue(r,n)),s_.current||KA(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:uf.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){$T.delete(this.current),this.projection&&this.projection.unmount(),So(this.notifyUpdate),So(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const n=this.features[e];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Sa.has(e),s=n.on("change",d=>{this.latestValues[e]=d,this.props.onUpdate&&Xt.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let l;window.MotionCheckAppearSync&&(l=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{s(),o(),l&&l(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Dl){const n=Dl[e];if(!n)continue;const{isEnabled:r,Feature:s}=n;if(!this.features[e]&&s&&r(this.props)&&(this.features[e]=new s(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Cn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<zT.length;r++){const s=zT[r];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const o="on"+s,l=e[o];l&&(this.propEventSubscriptions[s]=this.on(s,l))}this.prevMotionValues=U3(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=Su(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){var r;let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(r=this.getBaseTargetFromProps(this.props,e))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(pA(s)||oA(s))?s=parseFloat(s):!B3(s)&&Co.test(n)&&(s=hA(e,n)),this.setBaseTarget(e,xr(s)?s.get():s)),xr(s)?s.get():s}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:r}=this.props;let s;if(typeof r=="string"||typeof r=="object"){const l=Mv(this.props,r,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);l&&(s=l[e])}if(r&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!xr(o)?o:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new Gv),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class GA extends $3{constructor(){super(...arguments),this.KeyframeResolver=_A}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;xr(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function z3(t){return window.getComputedStyle(t)}class q3 extends GA{constructor(){super(...arguments),this.type="html",this.renderInstance=DC}readValueFromInstance(e,n){if(Sa.has(n)){const r=Zv(n);return r&&r.default||0}else{const r=z3(e),s=(jC(n)?r.getPropertyValue(n):r[n])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:n}){return LA(e,n)}build(e,n,r){Vv(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return Uv(e,n,r)}}class W3 extends GA{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Cn}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Sa.has(n)){const r=Zv(n);return r&&r.default||0}return n=LC.has(n)?n:Pv(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return FC(e,n,r)}build(e,n,r){Ov(e,n,this.isSVGTag,r.transformTemplate)}renderInstance(e,n,r,s){VC(e,n,r,s)}mount(e){this.isSVGTag=Bv(e.tagName),super.mount(e)}}const H3=(t,e)=>Nv(t)?new W3(e):new q3(e,{allowProjection:t!==ue.Fragment}),K3=_5({...yU,...V3,...S3,...O3},H3),G3=M4(K3);function QA(){!s_.current&&KA();const[t]=ue.useState(uf.current);return t}const Q3=900,qT=new Set;function X3(){try{return typeof window>"u"?null:window.localStorage}catch{return null}}function XA(t,e){const n=QA(),[r,s]=j.useState(!1),o=j.useRef(e),l=j.useRef(null);return j.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]),j.useEffect(()=>{const d=X3(),h=`mc_zone_sparkled_${t}`,f=qT.has(h)||d?.getItem(h)==="1",g=!o.current&&e;if(o.current=e,n||!g||f){s(!1);return}if(qT.add(h),d)try{d.setItem(h,"1")}catch{}s(!0),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>s(!1),Q3)},[e,n,t]),{sparkle:r}}function Y3({label:t,state:e,progressPct:n,highlight:r,variant:s="overlay",radiusPx:o,onOpenZone:l,subjectId:d,zoneSlug:h,packBaseUrl:f}){const g=Math.min(100,Math.max(0,Math.round(n||0))),y=["mc-zoneTile",`mc-zoneTile--${s}`,`is-${e}`];r&&y.push("is-highlighted");const _=o?Math.max(72,Math.min(140,o*2.2)):void 0,x=e==="locked"?"":e==="foundation"?"":e==="rebuilding"?"":e==="rebuilt"?"":"",I=vC(g),k=_C(I,e),[S,O]=j.useState(null),[B,V]=j.useState(!1),[$,F]=j.useState(null),[H,A]=j.useState(!1),{sparkle:E}=XA(h||t,e==="rebuilt"&&g>=100);return j.useEffect(()=>{let P=!1;if(!k||!d||!h||!f){O(null),V(!1);return}const L=Rs(f||"/"),C=Pn(L,`monuments/${d}/${h}/construction_stage${I}.svg`);return O(null),V(!1),Ts(C).then(N=>{P||(N?O(C):V(!0))}),()=>{P=!0}},[f,k,I,d,h]),B&&k&&y.push(`mc-construction-stage-${I}`),j.useEffect(()=>{let P=!1;if(!E||!f){F(null),A(!1);return}const L=Rs(f||"/"),C=d&&h?Pn(L,`monuments/${d}/${h}/sparkle.svg`):null,N=Pn(L,"effects/sparkle.svg");async function M(){if(C){const te=await Ts(C);if(P)return;if(te){F(C),A(!1);return}}const ie=await Ts(N);if(!P){if(ie){F(N),A(!1);return}F(null),A(!0)}}return M(),()=>{P=!0}},[f,E,d,h]),H&&E&&y.push("mc-zone-sparkle--fallback"),c.jsxs("button",{className:y.join(" "),style:_?{width:_,height:_}:void 0,"aria-label":`Ouvrir la zone ${t}, progression ${g}%`,title:`${t} (${g}%)`,onClick:l,"data-stage":k?I:void 0,children:[c.jsx("span",{className:"mc-zoneTile__badge","aria-hidden":!0,children:x}),k&&S&&c.jsx("img",{className:"mc-zoneTile__overlay",src:S,alt:"",loading:"lazy"}),k&&B&&c.jsx("span",{className:`mc-construction-overlay mc-construction-stage-${I}`,"aria-hidden":!0}),E&&$&&c.jsx("img",{className:"mc-zoneTile__sparkle",src:$,alt:"",loading:"lazy"}),E&&!$&&H&&c.jsx("span",{className:"mc-zoneTile__sparkle mc-zone-sparkle--fallback","aria-hidden":!0}),c.jsx("span",{className:"mc-zoneTile__label",children:t}),c.jsxs("span",{className:"mc-zoneTile__progress","data-pct":g,children:[c.jsxs("svg",{viewBox:"0 0 42 42",className:"mc-zoneTile__ring","aria-hidden":!0,children:[c.jsx("circle",{className:"mc-zoneTile__ring-bg",cx:"21",cy:"21",r:"18"}),c.jsx("circle",{className:"mc-zoneTile__ring-fg",cx:"21",cy:"21",r:"18",strokeDasharray:`${g/100*113}, 200`})]}),c.jsxs("span",{className:"mc-zoneTile__pct",children:[g,"%"]})]})]})}function WT(t,e,n,r){const s=Rs(t||"/");return Pn(s,`monuments/${e}/${n}/monument_${r}.svg`)}function J3({subjectId:t,zoneSlug:e,label:n,state:r,progressPct:s,highlight:o,onOpen:l,packBaseUrl:d}){const[h,f]=j.useState(null),[g,y]=j.useState(!1),[_,x]=j.useState(null),[I,k]=j.useState(!1),[S,O]=j.useState(null),[B,V]=j.useState(!1),$=Math.min(100,Math.max(0,Math.round(s||0))),F=vC($),H=_C(F,r),{sparkle:A}=XA(e,r==="rebuilt");if(j.useEffect(()=>{let P=!1;const L=WT(d,t,e,r),C=r==="locked"?L:WT(d,t,e,"locked");y(!1),f(null);async function N(){const M=await Ts(L);if(P)return;if(M){f(L);return}const ie=await Ts(C);if(!P){if(ie){f(C);return}y(!0)}}return N(),()=>{P=!0}},[d,t,e,r]),j.useEffect(()=>{let P=!1;if(!H){x(null),k(!1);return}const L=Rs(d||"/"),C=Pn(L,`monuments/${t}/${e}/construction_stage${F}.svg`);return x(null),k(!1),Ts(C).then(N=>{P||(N?x(C):k(!0))}),()=>{P=!0}},[d,H,F,t,e]),j.useEffect(()=>{let P=!1;if(!A){O(null),V(!1);return}const L=Rs(d||"/"),C=Pn(L,`monuments/${t}/${e}/sparkle.svg`),N=Pn(L,"effects/sparkle.svg");async function M(){const ie=await Ts(C);if(P)return;if(ie){O(C),V(!1);return}const te=await Ts(N);if(!P){if(te){O(N),V(!1);return}O(null),V(!0)}}return M(),()=>{P=!0}},[d,A,t,e]),g)return c.jsx(Y3,{label:n,state:r==="locked"?"locked":r==="weathered"?"weathered":r,progressPct:$,highlight:o,onOpenZone:l,subjectId:t,zoneSlug:e,packBaseUrl:d});const E=["mc-monument",`is-${r}`];return o&&E.push("is-highlighted"),I&&H&&E.push(`mc-construction-stage-${F}`),B&&A&&E.push("mc-zone-sparkle--fallback"),c.jsxs("button",{type:"button",className:E.join(" "),"aria-label":`Ouvrir la zone ${n}, progression ${$}%`,onClick:l,children:[r==="rebuilding"&&c.jsx("div",{className:"mc-monument__badge","aria-hidden":!0,children:""}),c.jsxs("div",{className:"mc-monument__art","aria-hidden":!0,children:[h?c.jsx("img",{src:h,alt:"",loading:"lazy"}):c.jsx("div",{className:"mc-monument__placeholder"}),H&&_&&c.jsx("img",{className:"mc-monument__overlay",src:_,alt:"",loading:"lazy"}),H&&I&&c.jsx("div",{className:"mc-construction-overlay"}),A&&S&&c.jsx("img",{className:"mc-zone-sparkle",src:S,alt:"",loading:"lazy"}),A&&!S&&B&&c.jsx("div",{className:"mc-zone-sparkle mc-zone-sparkle--fallback"})]}),c.jsx("div",{className:"mc-monument__label",children:n}),c.jsxs("div",{className:"mc-monument__progress","data-pct":$,"aria-hidden":!0,children:[c.jsxs("svg",{viewBox:"0 0 42 42",className:"mc-monument__ring",children:[c.jsx("circle",{className:"mc-monument__ring-bg",cx:"21",cy:"21",r:"18"}),c.jsx("circle",{className:"mc-monument__ring-fg",cx:"21",cy:"21",r:"18",strokeDasharray:`${$/100*113}, 200`})]}),c.jsxs("span",{className:"mc-monument__pct",children:[$,"%"]})]})]})}function HT(t,e,n){const r=e?.[t]?.score;if(typeof r=="number")return r;const s=n?.[t]?.score;return typeof s=="number"?s:0}function KT(t,e){const n=e?.[t]?.updatedAt;return n?typeof n=="number"?n:typeof n.toMillis=="function"?n.toMillis():typeof n.toDate=="function"?n.toDate().getTime():typeof n.seconds=="number"?n.seconds*1e3+(n.nanoseconds?n.nanoseconds/1e6:0):0:0}function Z3({tags:t,masteryByTag:e,blockProgress:n,recentlyPlayed:r=[],limit:s=10}){const o=new Set(r),l=[...t].sort((h,f)=>{const g=HT(h.id,e,n),y=HT(f.id,e,n),_=g<50?0:g<80?1:o.has(h.id)?2:3,x=y<50?0:y<80?1:o.has(f.id)?2:3;if(_!==x)return _-x;const I=KT(h.id,n),k=KT(f.id,n);if(I!==k)return k-I;const S=typeof h.order=="number"?h.order:9999,O=typeof f.order=="number"?f.order:9999;return S!==O?S-O:h.id.localeCompare(f.id)}),d=Math.max(0,Math.floor(s));return d?l.slice(0,d):[]}const e6={},t6=1.35;function Vc(t){return t?typeof t=="number"?t:typeof t.toMillis=="function"?t.toMillis():typeof t.toDate=="function"?t.toDate().getTime():typeof t.seconds=="number"?t.seconds*1e3+(t.nanoseconds?t.nanoseconds/1e6:0):null:null}function n6(){const{biomeId:t="",zoneKey:e=""}=Ru(),n=ks(),r=ts(),{user:s,activeChild:o}=Hn(),l=o?.id||s?.uid||null,{rewards:d}=Ps(l),[h,f]=j.useState(null),[g,y]=j.useState(null),_=j.useRef(null),[x,I]=j.useState(!1),[k,S]=j.useState(null),[O,B]=j.useState({});j.useLayoutEffect(()=>{const ye=_.current;if(!ye)return;const Ne=()=>{const kt=ye.getBoundingClientRect();S({width:kt.width,height:kt.height})};Ne();const Ke=new ResizeObserver(Ne);return Ke.observe(ye),()=>Ke.disconnect()},[]),j.useEffect(()=>{const ye=hv();dv(ye).then(Ne=>{f(Ne)}).catch(Ne=>y(Ne?.message||"Pack indisponible"))},[]);const V=j.useMemo(()=>new URLSearchParams(n.search),[n.search]),$=j.useMemo(()=>{const ye=(e6?.VITE_MAP_DEBUG||"").toString()==="true",Ne=V.get("mapDebug")==="1";return ye||Ne},[V]),H=V.get("label")||""||e,A=t&&xi(t)||null,E=h&&A?hC(h.manifest,t,e,A.subject,H):!1,P=h&&A&&E?JF(h.manifest,h.packRootUrl,t,e,A.subject,H):null,L=h?.packRootUrl||"",C=j.useRef(new Date);j.useEffect(()=>{h&&!E&&t&&e&&(I(!0),r(`/biome/${t}?zone=${encodeURIComponent(e)}`,{replace:!0}))},[h,E,t,e,r]);const N=j.useMemo(()=>A?yC(A.subject,H):[],[A,H]),M=A?`${A.subject}__${H}`:H,ie=j.useMemo(()=>pv({zoneKey:M,subjectId:A?.subject||"fr",tagIds:N.map(ye=>ye.id)},{blockProgress:d.blockProgress||{},zoneRebuildProgress:d.zoneRebuildProgress||{}}),[A?.subject,d.blockProgress,d.zoneRebuildProgress,N,H,M]),te=h?.manifest?.anchors?.zones||{},q=_l(H),ne=[`${t}:${e}`,`${t}:${H}`,`${t}:${q}`,`${A?.subject}:${e}`,`${A?.subject}:${H}`,`${A?.subject}:${q}`].map(ye=>te[ye]).find(Boolean)?.blocks||{},se=j.useMemo(()=>{const ye=d.zoneRebuildProgress?.[e];let Ke=Vc(ye?.updatedAt)||Vc(ye?.rebuiltAt)||0;return N.forEach(kt=>{const it=Vc(d.blockProgress?.[kt.id]?.updatedAt);it&&it>Ke&&(Ke=it)}),Ke?new Date(Ke):null},[d.blockProgress,d.zoneRebuildProgress,N,e]),z=j.useMemo(()=>{if(!A)return null;const ye=d.biomeRebuildProgress?.[A.subject],Ne=ye?Math.min(100,Math.round(ye.correctCount/(ye.target||100)*100)):0,Ke=ye?.updatedAt||ye?.rebuiltAt||se;return Tv({biomeRebuiltPct:Ne,biomeLastActivityAt:Ke||void 0,now:C.current})},[A,d.biomeRebuildProgress,se]),ee=j.useMemo(()=>N.map(ye=>{const Ke=[ye.id,_l(ye.label||""),_l(ye.theme||"")].map(_n=>ne[_n]).find(Boolean),it=($?O[ye.id]:null)||Ke;return it?{tag:ye,anchor:it}:null}).filter(Boolean),[N,ne,O,$]),Q=j.useMemo(()=>{const ye=new Map;return ee.forEach(Ne=>ye.set(Ne.tag.id,Ne)),ye},[ee]),de=j.useMemo(()=>Object.entries(d.blockProgress||{}).map(([Ne,Ke])=>({tagId:Ne,ts:Vc(Ke?.updatedAt)||0})).filter(Ne=>Ne.ts>0).sort((Ne,Ke)=>Ke.ts-Ne.ts).slice(0,8).map(Ne=>Ne.tagId),[d.blockProgress]),Se=j.useMemo(()=>Z3({tags:ee.map(Ne=>Ne.tag),masteryByTag:d.masteryByTag,blockProgress:d.blockProgress,recentlyPlayed:de,limit:10}).map(Ne=>Q.get(Ne.id)).filter(Boolean),[Q,ee,de,d.blockProgress,d.masteryByTag]),fe=j.useMemo(()=>{if(!P)return Se;const ye=P.safeArea||{left:0,top:0,right:0,bottom:0},Ne=16,Ke=Math.min(220,Math.max(160,Math.round(P.width*.12))),kt=Ke*t6,_n=[{x:Math.min(Math.max(ye.left+Ne,Ke/2),Math.max(0,P.width-ye.right-Ne-Ke/2))-Ke/2,y:Math.min(Math.max(ye.top+Ne,kt/2),Math.max(0,P.height-ye.bottom-Ne-kt/2))-kt/2,w:Ke+24,h:kt+24}],Sr={left:0+(ye.left||0)+Ke*.85,top:0+(ye.top||0)+kt*.4,right:P.width-(ye.right||0),bottom:P.height-(ye.bottom||0)};return[...Se].sort((gt,Yt)=>gt.tag.id.localeCompare(Yt.tag.id)).map(gt=>{const Yt=gt.tag.label||"",tn=Math.min(2,Math.ceil(Yt.length/12)||1),tr=96,Un=70+(tn-1)*14,Or={x:gt.anchor.x-tr/2,y:gt.anchor.y-Un/2},Ht=w4(Or,{w:tr,h:Un},_n,Sr,{stepPx:18,growthEvery:2,maxTries:14});_n.push({x:Ht.x,y:Ht.y,w:tr,h:Un});const Xe={x:Ht.x+tr/2,y:Ht.y+Un/2};return{...gt,renderAnchor:Xe,nudged:Ht,size:{w:tr,h:Un}}})},[Se,P]),Re=j.useCallback(ye=>{const Ne=d.masteryByTag?.[ye]?.score;if(typeof Ne=="number")return Ne;const Ke=d.blockProgress?.[ye]?.score;return typeof Ke=="number"?Ke:0},[d.blockProgress,d.masteryByTag]),$e=j.useCallback(ye=>Vc(d.blockProgress?.[ye]?.updatedAt),[d.blockProgress]),Me=j.useCallback(ye=>{const Ne=Ix({masteryPct:Re(ye),tagLastActivityAt:$e(ye)||void 0,now:C.current});return Ne==="enhanced"?"enhanced":Ne==="repaired"?"repaired":Ne==="repairing"?"repairing":"cracked"},[$e,Re]),At=j.useCallback(ye=>Ix({masteryPct:Re(ye),tagLastActivityAt:$e(ye)||void 0,now:C.current}),[$e,Re]),[Wt,ur]=j.useState(ee.length===0);j.useEffect(()=>{ee.length===0&&ur(!0)},[ee.length]);const Ie=gC({zoneProgressCorrect:ie.correctCount,zoneLastActivityAt:se||void 0,now:C.current}),Ir=fe.length,ce=ee.length,xe=ce>0?Math.min(10,ce):10,De=j.useMemo(()=>P?Math.min(220,Math.max(160,Math.round(P.width*.12))):200,[P]),Rt=j.useMemo(()=>{if(!P)return null;const ye=P.safeArea||{left:0,top:0,right:0,bottom:0},Ne=16,Ke=Math.min(Math.max(ye.left+Ne+De/2,De/2),Math.max(0,P.width-ye.right-De/2-Ne)),kt=Math.min(Math.max(ye.top+Ne+De/2,De/2),Math.max(0,P.height-ye.bottom-De/2-Ne));return{x:Ke,y:kt}},[P,De]),Ze=j.useRef("");j.useEffect(()=>{if(!P)return;const ye=fe.map(kt=>({tagId:kt.tag.id,label:kt.tag.label,anchor:kt.anchor,render:kt.renderAnchor,size:kt.size})),Ne={map:{width:P.width,height:P.height,safeArea:P.safeArea||null},monument:Rt?{anchor:Rt,size:De}:null,poiCount:ye.length,poiSample:ye.slice(0,12)},Ke=JSON.stringify(Ne);Ke!==Ze.current&&(Ze.current=Ke,console.info("[ZoneMap overlay]",Ne))},[fe,Rt,De,P]);const pt=j.useRef("");return j.useEffect(()=>{const ye=_.current;if(!ye)return;const Ne=requestAnimationFrame(()=>{const Ke=ye.getBoundingClientRect(),kt=ye.querySelector(".mc-monument"),it=kt?kt.getBoundingClientRect():null,Sr=Array.from(ye.querySelectorAll(".mc-poi")).map(Bt=>{const tn=Bt.getBoundingClientRect();return{tagId:Bt.dataset.tagId,width:Math.round(tn.width),height:Math.round(tn.height),left:Math.round(tn.left-Ke.left),top:Math.round(tn.top-Ke.top)}}),gt={container:{width:Math.round(Ke.width),height:Math.round(Ke.height)},monument:it?{width:Math.round(it.width),height:Math.round(it.height),left:Math.round(it.left-Ke.left),top:Math.round(it.top-Ke.top)}:null,pois:Sr},Yt=JSON.stringify(gt);Yt!==pt.current&&(pt.current=Yt,console.info("[ZoneMap overlay DOM]",gt))});return()=>cancelAnimationFrame(Ne)},[fe.length,Rt,De]),!t||!e?c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Zone inconnue."})}):g?c.jsx("div",{className:"container",children:c.jsxs("div",{className:"card",children:["Pack indisponible : ",g]})}):!h||!P&&E?c.jsx("div",{className:"container",children:c.jsx("div",{className:"card",children:"Chargement map..."})}):!E||x?null:c.jsxs("div",{className:`container grid ${z?`mc-biome-state-${z}`:""}`,style:{gap:12},children:[c.jsx("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:c.jsxs("div",{className:"row",style:{gap:8,alignItems:"center"},children:[c.jsx("button",{className:"mc-button secondary",onClick:()=>r(`/biome/${t}?zone=${encodeURIComponent(e)}`),children:" Retour biome"}),c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:[t," / ",e]})]})}),c.jsxs("div",{style:{position:"relative",aspectRatio:`${P?.width||16}/${P?.height||9}`,width:"100%",overflow:"hidden"},children:[P&&c.jsx(fv,{baseLayerUrl:P.baseLayerUrl,width:P.width,height:P.height}),c.jsxs("div",{ref:_,style:{position:"absolute",inset:0},children:[P&&c.jsx(Zh,{width:P.width,height:P.height,safeArea:P.safeArea,children:ye=>c.jsxs(c.Fragment,{children:[Rt&&c.jsx("div",{style:{...ye(Rt),zIndex:2,width:`${De}px`,pointerEvents:"auto"},children:c.jsx(J3,{subjectId:A?.subject||"fr",zoneSlug:e,label:H,state:Ie,progressPct:ie.progressPct,highlight:!0,packBaseUrl:L,onOpen:()=>r(`/biome/${t}?zone=${encodeURIComponent(e)}`)})}),fe.map(({tag:Ne,renderAnchor:Ke})=>c.jsx("div",{style:{...ye(Ke),pointerEvents:"auto"},children:c.jsx(b4,{tagId:Ne.id,label:Ne.label,masteryPct:Re(Ne.id),state:At(Ne.id),highlight:de.includes(Ne.id),onStart:()=>r(`/theme/expedition?targetTagId=${encodeURIComponent(Ne.id)}`),packBaseUrl:L,mapDebug:$})},Ne.id))]})}),$&&P&&c.jsx(mv,{width:P.width,height:P.height,anchors:ee.map(ye=>({id:ye.tag.id,anchor:ye.anchor})),safeArea:P.safeArea,containerRef:_,onAnchorChange:(ye,Ne)=>{B(Ke=>({...Ke,[ye]:Ne}))}})]})]}),c.jsxs("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:8},children:[c.jsxs("div",{className:"small",style:{color:"var(--mc-muted)"},children:["POI affichs ",Ir,"/",xe||0,"  Total blocs ",N.length,ce<N.length?`  ${N.length-ce} sans ancre`:""]}),c.jsxs("div",{className:"row",style:{gap:8},children:[ce===0&&c.jsx("span",{className:"mc-chip muted",children:"Aucun anchor de bloc sur la carte"}),c.jsx("button",{className:"mc-button",onClick:()=>ur(ye=>!ye),"aria-expanded":Wt,children:Wt?"Masquer la liste":`Voir tous les blocs (${N.length})`})]})]}),Wt&&c.jsx("div",{className:"grid2",children:N.map(ye=>c.jsx(_4,{tagId:ye.id,label:ye.label,masteryPct:Re(ye.id),state:Me(ye.id),variant:"list",onStartSession:()=>r(`/theme/expedition?targetTagId=${encodeURIComponent(ye.id)}`)},ye.id))})]})}function r6(){const{user:t,profile:e,role:n,signOutUser:r,activeChild:s,linkedChildren:o,setActiveChildId:l,linkedParentName:d,generatePairingCode:h,unlinkChild:f,recoveryCode:g,redeemPairingCode:y,regenerateRecoveryCode:_}=Hn(),x=s?.id||t?.uid||null,{rewards:I}=Ps(x),k=I?.collectibles?.equippedAvatarId,S=k?Pi.find(Me=>Me.id===k):null,O=n==="admin"||!1,[B,V]=j.useState(!1),[$,F]=j.useState(null),[H,A]=j.useState(""),[E,P]=j.useState(!1),[L,C]=j.useState(""),[N,M]=j.useState(!1),[ie,te]=j.useState(""),[q,W]=j.useState(""),[Y,ne]=j.useState(""),[se,z]=j.useState(!1),[ee,Q]=j.useState(!1),[de,Se]=j.useState(""),fe=async()=>{A(""),F(null);try{const Me=await h(),At=Me.expiresAt&&typeof Me.expiresAt.toDate=="function"?Me.expiresAt.toDate():new Date;F({code:Me.code,expiresAt:At})}catch(Me){A(Me?.message||"Impossible de gnrer le code.")}};j.useEffect(()=>{B?fe().catch(()=>{}):(F(null),A(""))},[B]);const Re=j.useMemo(()=>n==="parent"||n==="admin"?[{to:"/hub",label:"Monde",icon:"",requireUser:!1}]:[{to:"/hub",label:"Monde",icon:"",requireUser:!1},{to:"/chest",label:"Coffre",icon:"",requireUser:!0},{to:"/collection",label:"Collection",icon:"",requireUser:!0}],[n]),$e=async()=>{W(""),ne("");try{await y(ie),ne("Enfant ajout."),te(""),M(!1)}catch(Me){W(Me?.message||"Code invalide ou expir.")}};return c.jsxs("div",{className:"card",style:{marginBottom:14},children:[c.jsxs("div",{className:"row",style:{justifyContent:"space-between"},children:[c.jsxs("div",{children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[c.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"linear-gradient(135deg,#ff8a3d,#ff4d6d)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:900,fontSize:"0.95rem",letterSpacing:1},children:"MC"}),c.jsx("div",{style:{fontWeight:900,fontSize:"1.05rem"},children:"Malo Craft"})]}),S&&c.jsx("div",{style:{width:30,height:30,borderRadius:"50%",background:"rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center"},"aria-label":"avatar quip",children:S.icon})]}),c.jsx("div",{className:"small",children:t?c.jsxs(c.Fragment,{children:["Connect : ",c.jsx("strong",{children:e?.displayName||t.displayName||"Utilisateur"})," ",c.jsx("span",{className:"badge",children:n}),s&&(n==="parent"||n==="admin")&&c.jsxs(c.Fragment,{children:["  Enfant actif : ",c.jsx("strong",{children:s.displayName}),g&&c.jsx("span",{className:"badge",style:{marginLeft:6},title:"Code de reprise :  saisir sur un autre appareil (Accueil > Reprendre ma partie) pour restaurer la progression.",children:se?g:""}),g&&c.jsx("button",{className:"btn secondary",style:{padding:"2px 8px",fontSize:"0.75rem",marginLeft:6},onClick:()=>{z(!0),setTimeout(()=>z(!1),3e3)},children:"Rvler 3s"}),c.jsx("button",{className:"btn secondary",style:{padding:"2px 8px",fontSize:"0.75rem",marginLeft:6},onClick:async()=>{if(!(!s||!window.confirm(`Dissocier ${s.displayName} ?`))){C(""),P(!0);try{await f(s.id)}catch(At){C(At?.message||"Impossible de dissocier.")}finally{P(!1)}}},disabled:E,title:"Supprimer lappairage avec cet enfant",children:E?"...":"Dissocier"})]}),n==="child"&&(d?c.jsxs(c.Fragment,{children:["  Parent : ",c.jsx("strong",{children:d})]}):c.jsxs(c.Fragment,{children:["  ",c.jsx("button",{className:"btn secondary",style:{padding:"2px 8px",fontSize:"0.75rem"},onClick:()=>V(!0),children:"Associer un parent"})]})),n==="child"&&g&&c.jsxs(c.Fragment,{children:["  ",c.jsxs("span",{className:"badge",title:"Code de reprise : sur un autre appareil, clique sur  Reprendre ma partie  et saisis-le pour retrouver ton monde.",children:["Code reprise : ",g]}),c.jsx("button",{className:"btn secondary",style:{padding:"2px 8px",fontSize:"0.75rem",marginLeft:6},disabled:ee,onClick:async()=>{Se(""),Q(!0);try{await _()}catch(Me){Se(Me?.message||"Impossible de rgnrer le code.")}finally{Q(!1)}},title:"Rvoque lancien code et gnre-en un nouveau",children:ee?"...":"Rgnrer"})]})]}):"Non connect"})]}),c.jsxs("div",{className:"row",style:{gap:8},children:[(n==="parent"||n==="admin")&&o.length>0&&c.jsx("select",{className:"input",value:s?.id||"",onChange:Me=>l(Me.target.value||null),children:o.map(Me=>c.jsx("option",{value:Me.id,children:Me.displayName},Me.id))}),(n==="parent"||n==="admin")&&c.jsx(c.Fragment,{children:c.jsx("button",{className:"btn secondary",onClick:()=>M(!0),children:"Associer un enfant"})}),Re.map(Me=>Me.requireUser&&!x?null:c.jsxs(ea,{className:"btn secondary",to:Me.to,"aria-label":Me.label,children:[Me.icon," ",Me.label]},Me.to)),n==="parent"&&c.jsx(ea,{className:"btn secondary",to:"/parent/priorites",children:"Priorit pdagogique"}),O&&c.jsxs(c.Fragment,{children:[c.jsx(ea,{className:"btn secondary",to:"/admin/import",children:"Import"}),c.jsx(ea,{className:"btn secondary",to:"/admin/questions",children:"Questions"}),c.jsx(ea,{className:"btn secondary",to:"/admin/reports",children:"Reports"}),c.jsx(ea,{className:"btn secondary",to:"/admin/pack-request",children:"Pack request"}),c.jsx(ea,{className:"btn secondary",to:"/admin/progression",children:"Progression enfant"})]}),t&&c.jsx("button",{className:"btn secondary",onClick:r,children:"Dconnexion"})]})]}),L&&c.jsx("div",{className:"small",style:{color:"#ff5a6f",marginTop:8},children:L}),B&&c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:c.jsxs("div",{className:"card",style:{maxWidth:420,width:"100%",position:"relative"},children:[c.jsx("button",{className:"btn secondary",style:{position:"absolute",top:8,right:8},onClick:()=>V(!1),children:"Fermer"}),c.jsx("h3",{style:{marginTop:0},children:"Associer un parent"}),c.jsxs("p",{className:"small",children:["1) Ce code est gnr automatiquement.",c.jsx("br",{}),"2) Donne-le au parent.",c.jsx("br",{}),"3) Le parent se connecte avec Google sur la page daccueil et saisit ce code pour te rattacher."]}),$&&c.jsxs("div",{className:"pill",style:{marginTop:10,display:"inline-flex",alignItems:"center",gap:8},children:[c.jsx("span",{children:"Code :"}),c.jsx("strong",{style:{letterSpacing:2},children:$.code}),c.jsxs("span",{className:"badge",children:["Expire  ",$.expiresAt.toLocaleTimeString()]})]}),H&&c.jsx("div",{className:"small",style:{marginTop:8,color:"#ff5a6f"},children:H})]})}),de&&c.jsx("div",{className:"small",style:{color:"#ff5a6f",marginTop:8},children:de}),N&&c.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.6)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:c.jsxs("div",{className:"card",style:{maxWidth:420,width:"100%",position:"relative"},children:[c.jsx("button",{className:"btn secondary",style:{position:"absolute",top:8,right:8},onClick:()=>M(!1),children:"Fermer"}),c.jsx("h3",{style:{marginTop:0},children:"Associer un enfant"}),c.jsx("p",{className:"small",children:"Saisis le code  8 caractres gnr sur lapp enfant (valide 10 minutes)."}),c.jsxs("div",{className:"row",style:{gap:8},children:[c.jsx("input",{className:"input",value:ie,onChange:Me=>te(Me.target.value),placeholder:"Code dappairage"}),c.jsx("button",{className:"btn",onClick:$e,disabled:!ie.trim(),children:"Valider"})]}),q&&c.jsx("div",{className:"small",style:{marginTop:8,color:"#ff5a6f"},children:q}),Y&&c.jsx("div",{className:"small success",style:{marginTop:8},children:Y})]})})]})}const s6=.4,i6=.12;function o6(t,e,n){const r=t?{x:0,y:0}:n4({anchorPx:e?.anchorPx||null,mapSize:e?.mapSize||null,viewport:n||null,panFactor:i6,maxPan:n&&n.w&&n.w<860?50:80});return{variants:{initial:{opacity:t?1:0,scale:t?1:.975,filter:t?"none":"blur(2px)",x:r.x,y:r.y},animate:{opacity:1,scale:1,filter:t?"none":"blur(0px)",x:0,y:0},exit:{opacity:t?1:0,scale:t?1:1.01,filter:t?"none":"blur(2px)",x:t?0:-r.x*.35,y:t?0:-r.y*.35}},transition:{duration:t?0:s6,ease:"easeOut"}}}function a6({children:t,routeKey:e,navContext:n}){const r=QA(),s=j.useMemo(()=>typeof window>"u"?null:{w:window.innerWidth,h:window.innerHeight},[]),{variants:o,transition:l}=j.useMemo(()=>o6(!!r,n||null,s),[r,n,s]);return c.jsx(G3.div,{variants:o,transition:l,initial:"initial",animate:"animate",exit:"exit",style:{width:"100%"},children:t},e)}function fh({children:t,routeKey:e,navContext:n}){const r=j.useRef(null),[s,o]=j.useState(72);return j.useEffect(()=>{typeof window<"u"&&"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")},[]),j.useLayoutEffect(()=>{const l=r.current;if(!l||typeof ResizeObserver>"u")return;const d=()=>{o(l.getBoundingClientRect().height||72)};d();const h=new ResizeObserver(d);return h.observe(l),()=>h.disconnect()},[]),c.jsxs("div",{className:"mc-shell","aria-label":"Carte MaloCraft",style:{"--mc-topbar-height":`${s}px`},children:[c.jsx("div",{className:"mc-shell__topbar",ref:r,children:c.jsx("div",{className:"container",children:c.jsx(r6,{})})}),c.jsx("div",{className:"mc-shell__viewport",children:c.jsx(S4,{mode:"wait",initial:!1,children:c.jsx(a6,{routeKey:e,navContext:n,children:c.jsx("div",{className:"mc-shell__viewportInner",children:c.jsx("div",{className:"container mc-shell__viewportContent",children:t})})})})})]})}function l6(){const t=ks(),e=t.pathname,n=j.useMemo(()=>{if(e.startsWith("/biome/")){const r=bx();return r&&r.from==="world"?r:null}if(e.startsWith("/zone/")){const r=bx();return r&&r.from==="biome"?r:null}return null},[e]);return c.jsxs(ok,{location:t,children:[c.jsx(Sn,{path:"/",element:c.jsx(cx,{})}),c.jsx(Sn,{path:"/connexion",element:c.jsx(cx,{})}),c.jsx(Sn,{path:"/home",element:c.jsx(_s,{children:c.jsx(fh,{routeKey:e,navContext:n,children:c.jsx(Sx,{})})})}),c.jsx(Sn,{path:"/hub",element:c.jsx(_s,{children:c.jsx(fh,{routeKey:e,navContext:n,children:c.jsx(Sx,{})})})}),c.jsx(Sn,{path:"/theme/:themeId",element:c.jsx(_s,{children:c.jsx(OO,{})})}),c.jsx(Sn,{path:"/admin/import",element:c.jsx(Nc,{children:c.jsx(FO,{})})}),c.jsx(Sn,{path:"/admin/progression",element:c.jsx(Nc,{children:c.jsx($O,{})})}),c.jsx(Sn,{path:"/admin/questions",element:c.jsx(Nc,{children:c.jsx(qO,{})})}),c.jsx(Sn,{path:"/admin/reports",element:c.jsx(Nc,{children:c.jsx(QO,{})})}),c.jsx(Sn,{path:"/admin/pack-request",element:c.jsx(Nc,{children:c.jsx(KO,{})})}),c.jsx(Sn,{path:"/parent/priorites",element:c.jsx(lV,{children:c.jsx(v4,{})})}),c.jsx(Sn,{path:"/collection",element:c.jsx(_s,{children:c.jsx(nF,{})})}),c.jsx(Sn,{path:"/progression",element:c.jsx(_s,{children:c.jsx(ZO,{})})}),c.jsx(Sn,{path:"/chest",element:c.jsx(_s,{children:c.jsx(bF,{})})}),c.jsx(Sn,{path:"/world",element:c.jsx(_s,{children:c.jsx(iF,{})})}),c.jsx(Sn,{path:"/world/:biomeId",element:c.jsx(_s,{children:c.jsx(yF,{})})}),c.jsx(Sn,{path:"/biome/:biomeId",element:c.jsx(_s,{children:c.jsx(fh,{routeKey:e,navContext:n,children:c.jsx(y4,{})})})}),c.jsx(Sn,{path:"/zone/:biomeId/:zoneKey",element:c.jsx(_s,{children:c.jsx(fh,{routeKey:e,navContext:n,children:c.jsx(n6,{})})})}),c.jsx(Sn,{path:"/world/:biomeId/zone/:themeId",element:c.jsx(_s,{children:c.jsx(vF,{})})}),c.jsx(Sn,{path:"*",element:c.jsx(eF,{})})]},e)}function c6(){return j.useEffect(()=>{typeof window<"u"&&"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")},[]),c.jsx(mk,{children:c.jsx(l6,{})})}function u6(){"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("${import.meta.env.BASE_URL}sw.js").catch(()=>{})})}document.body.classList.add("malocraft");fR.createRoot(document.getElementById("root")).render(c.jsx(j.StrictMode,{children:c.jsx(aV,{children:c.jsx(c6,{})})}));u6();
